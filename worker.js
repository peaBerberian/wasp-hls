"use strict";(()=>{var ur=Object.defineProperty;var cr=(r,e)=>{for(var t in e)ur(r,t,{get:e[t],enumerable:!0})};var Ue={};cr(Ue,{abortRequest:()=>jn,addSourceBuffer:()=>Vn,announceFetchedContent:()=>ea,announceTrackUpdate:()=>ta,announceVariantLockStatusChange:()=>sa,announceVariantUpdate:()=>ra,appendBuffer:()=>Hn,attachMediaSource:()=>zn,clearTimer:()=>Dn,doFetch:()=>Ln,endOfStream:()=>Yn,flush:()=>Nn,freeResource:()=>Kn,getRandom:()=>ia,getResourceData:()=>Bn,isTypeSupported:()=>oa,log:()=>Rn,removeBuffer:()=>Qn,removeMediaSource:()=>qn,seek:()=>Wn,sendMediaPlaylistParsingError:()=>An,sendMediaPlaylistRequestError:()=>In,sendMultivariantPlaylistParsingError:()=>wn,sendMultivariantPlaylistRequestError:()=>Tn,sendOtherError:()=>En,sendPushedSegmentError:()=>Pn,sendRemoveBufferError:()=>Mn,sendSegmentParsingError:()=>Cn,sendSegmentRequestError:()=>kn,sendSourceBufferCreationError:()=>Un,setMediaOffset:()=>$n,setMediaSourceDuration:()=>Gn,setPlaybackRate:()=>Fn,startObservingPlayback:()=>Xn,startRebuffering:()=>na,stopObservingPlayback:()=>_t,stopRebuffering:()=>aa,timer:()=>On,updateContentInfo:()=>Jn});var ce=class{constructor(){this._listeners={}}addEventListener(e,t){let n=this._listeners[e];Array.isArray(n)?n.push(t):this._listeners[e]=[t]}removeEventListener(e,t){if(e===void 0){this._listeners={};return}let n=this._listeners[e];if(!Array.isArray(n))return;if(t===void 0){delete this._listeners[e];return}let a=n.indexOf(t);a!==-1&&n.splice(a,1),n.length===0&&delete this._listeners[e]}trigger(e,t){let n=this._listeners[e];Array.isArray(n)&&n.slice().forEach(a=>{try{a(t)}catch(o){p.error("EventEmitter: listener error",o instanceof Error?o:null)}})}};function B(){}var dr=0,Ye=class extends ce{constructor(){super();this.error=B,this.warn=B,this.info=B,this.debug=B,this._currentLevel=dr}setLevel(t){let n=t<0||t>4?0:t;this._currentLevel=n,this.error=n>=1?console.error.bind(console):B,this.warn=n>=2?console.warn.bind(console):B,this.info=n>=3?console.info.bind(console):B,this.debug=n>=4?console.debug.bind(console):B,this.trigger("onLogLevelChange",n)}getLevel(){return this._currentLevel}hasLevel(t){return t>=this._currentLevel}},lr=new Ye,p=lr;function Xe(){let r="",e=-1;return function(){return e++,e>=Number.MAX_SAFE_INTEGER&&(r+="0",e=0),r+String(e)}}var fr=4294967295;function yt(){let r=-1;return function(){return r++,r>=fr&&(p.warn("Exceeding `numberIdGenerator` limit. Collisions may occur"),r=0),r}}function de(r){throw new Error("Unreachable path taken")}var le=class{constructor(e){this._sourceBuffer=e,this._queue=[],this._pendingTask=null;let t=setInterval(()=>{this._flush()},2e3),n=this._onPendingTaskError.bind(this),a=()=>{this._flush()};e.addEventListener("error",n),e.addEventListener("updateend",a),this._dispose=[()=>{clearInterval(t),e.removeEventListener("error",n),e.removeEventListener("updateend",a)}]}push(e){return p.debug("QSB: receiving order to push data to the SourceBuffer"),this._addToQueue({type:0,value:e})}removeBuffer(e,t){return p.debug("QSB: receiving order to remove data from the SourceBuffer",e,t),this._addToQueue({type:1,value:{start:e,end:t}})}getBufferedRanges(){return this._sourceBuffer.buffered}dispose(){for(this._dispose.forEach(e=>e()),this._pendingTask!==null&&(this._pendingTask.reject(new Error("QueuedSourceBuffer Cancelled")),this._pendingTask=null);this._queue.length>0;){let e=this._queue.shift();e!==void 0&&e.reject(new Error("QueuedSourceBuffer Cancelled"))}}_onPendingTaskError(e){let t=e instanceof Error?e:new Error("An unknown error occured when doing operations on the SourceBuffer");this._pendingTask!=null&&this._pendingTask.reject(t)}_addToQueue(e){return new Promise((t,n)=>{let a=this._queue.length===0&&this._pendingTask===null,o={resolve:t,reject:n,...e};this._queue.push(o),a&&this._flush()})}_flush(){if(!this._sourceBuffer.updating){if(this._pendingTask!==null){let e=this._pendingTask,{resolve:t}=e;return this._pendingTask=null,t(),this._flush()}else{let e=this._queue.shift();if(e===void 0)return;this._pendingTask=e}try{switch(this._pendingTask.type){case 0:let e=this._pendingTask.value;if(e===void 0){this._flush();return}p.debug("QSB: pushing data"),this._sourceBuffer.appendBuffer(e);break;case 1:let{start:t,end:n}=this._pendingTask.value;p.debug("QSB: removing data from SourceBuffer",t,n),this._sourceBuffer.remove(t,n);break;default:de(this._pendingTask)}}catch(e){this._onPendingTaskError(e)}}}};function ee(r){let e=new Float64Array(r.length*2);for(let t=0;t<r.length;t++){let n=t*2;e[n]=r.start(t),e[n+1]=r.end(t)}return e}var vr={},d,St=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});St.decode();var fe=null;function he(){return(fe===null||fe.byteLength===0)&&(fe=new Uint8Array(d.memory.buffer)),fe}function M(r,e){return St.decode(he().subarray(r,r+e))}var T=0,Ce=new TextEncoder("utf-8"),pr=typeof Ce.encodeInto=="function"?function(r,e){return Ce.encodeInto(r,e)}:function(r,e){let t=Ce.encode(r);return e.set(t),{read:r.length,written:t.length}};function W(r,e,t){if(t===void 0){let s=Ce.encode(r),u=e(s.length);return he().subarray(u,u+s.length).set(s),T=s.length,u}let n=r.length,a=e(n),o=he(),i=0;for(;i<n;i++){let s=r.charCodeAt(i);if(s>127)break;o[a+i]=s}if(i!==n){i!==0&&(r=r.slice(i)),a=t(a,n,n=i+r.length*3);let s=he().subarray(a+i,a+n),u=pr(r,s);i+=u.written}return T=i,a}function y(r){return r==null}function U(r,e){if(!(r instanceof e))throw new Error(`expected instance of ${e.name}`);return r.ptr}var pe=null;function te(){return(pe===null||pe.byteLength===0)&&(pe=new Int32Array(d.memory.buffer)),pe}var me=null;function re(){return(me===null||me.byteLength===0)&&(me=new Float64Array(d.memory.buffer)),me}function mr(r,e){let t=e(r.length*8);return re().set(r,t/8),T=r.length,t}function j(r){return()=>{throw new Error(`${r} is not defined`)}}function gr(r,e){let t=e(r.length*1);return he().set(r,t/1),T=r.length,t}var ge=null;function hr(){return(ge===null||ge.byteLength===0)&&(ge=new Uint32Array(d.memory.buffer)),ge}function xt(r,e){return hr().subarray(r/4,r/4+e)}function _r(r,e){return re().subarray(r/8,r/8+e)}var br=Object.freeze({Init:0,0:"Init",RegularInterval:1,1:"RegularInterval",Seeking:2,2:"Seeking",Seeked:3,3:"Seeked",LoadedData:4,4:"LoadedData",LoadedMetadata:5,5:"LoadedMetadata",CanPlay:6,6:"CanPlay",CanPlayThrough:7,7:"CanPlayThrough",Ended:8,8:"Ended",Pause:9,9:"Pause",Play:10,10:"Play",RateChange:11,11:"RateChange",Stalled:12,12:"Stalled"}),Ta=Object.freeze({MultivariantPlaylist:0,0:"MultivariantPlaylist",MediaPlaylist:1,1:"MediaPlaylist"}),vt=Object.freeze({NoSupportedVariant:0,0:"NoSupportedVariant",UnfoundLockedVariant:1,1:"UnfoundLockedVariant",MediaSourceAttachmentError:2,2:"MediaSourceAttachmentError",Unknown:3,3:"Unknown"}),Ia=Object.freeze({AlreadyCreatedWithSameType:0,0:"AlreadyCreatedWithSameType",CantPlayType:1,1:"CantPlayType",EmptyMimeType:2,2:"EmptyMimeType",MediaSourceIsClosed:3,3:"MediaSourceIsClosed",NoMediaSourceAttached:4,4:"NoMediaSourceAttached",QuotaExceededError:5,5:"QuotaExceededError",Unknown:6,6:"Unknown"}),Pa=Object.freeze({Timeout:0,0:"Timeout",Status:1,1:"Status",Error:2,2:"Error",Other:3,3:"Other"}),Be=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",UnknownError:1,1:"UnknownError"}),Re=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",UnknownError:1,1:"UnknownError"}),$e=Object.freeze({UnknownError:0,0:"UnknownError",NoContentLoaded:1,1:"NoContentLoaded"}),Oe=Object.freeze({SourceBufferNotFound:0,0:"SourceBufferNotFound",UnknownError:1,1:"UnknownError"}),Ke=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",UnknownError:1,1:"UnknownError"}),Ma=Object.freeze({MissingExtM3uHeader:0,0:"MissingExtM3uHeader",MultivariantPlaylistWithoutVariant:1,1:"MultivariantPlaylistWithoutVariant",MissingUriLineAfterVariant:2,2:"MissingUriLineAfterVariant",UnableToReadVariantUri:3,3:"UnableToReadVariantUri",VariantMissingBandwidth:4,4:"VariantMissingBandwidth",InvalidValue:5,5:"InvalidValue",MediaTagMissingType:6,6:"MediaTagMissingType",MediaTagMissingName:7,7:"MediaTagMissingName",MediaTagMissingGroupId:8,8:"MediaTagMissingGroupId",UnableToReadLine:9,9:"UnableToReadLine",Unknown:10,10:"Unknown"}),Ea=Object.freeze({UnparsableExtInf:0,0:"UnparsableExtInf",UriMissingInMap:1,1:"UriMissingInMap",MissingTargetDuration:2,2:"MissingTargetDuration",UriWithoutExtInf:3,3:"UriWithoutExtInf",UnparsableByteRange:4,4:"UnparsableByteRange",Unknown:5,5:"Unknown"}),N=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",MediaSourceIsClosed:1,1:"MediaSourceIsClosed",QuotaExceededError:2,2:"QuotaExceededError",TypeNotSupportedError:3,3:"TypeNotSupportedError",EmptyMimeType:4,4:"EmptyMimeType",UnknownError:5,5:"UnknownError"}),K=Object.freeze({NoResource:0,0:"NoResource",NoSourceBuffer:1,1:"NoSourceBuffer",TransmuxerError:2,2:"TransmuxerError",UnknownError:3,3:"UnknownError"}),ne=Object.freeze({BufferFull:0,0:"BufferFull",UnknownError:1,1:"UnknownError"}),wa=Object.freeze({Init:0,0:"Init",Seeked:1,1:"Seeked",Seeking:2,2:"Seeking",Ended:3,3:"Ended",ReadyStateChanged:4,4:"ReadyStateChanged",RegularInterval:5,5:"RegularInterval",Error:6,6:"Error"}),Aa=Object.freeze({MediaPlaylistRefresh:0,0:"MediaPlaylistRefresh",RetryRequest:1,1:"RetryRequest"}),_e=Object.freeze({Error:0,0:"Error",Warn:1,1:"Warn",Info:2,2:"Info",Debug:3,3:"Debug"}),F=Object.freeze({Audio:0,0:"Audio",Video:1,1:"Video"}),Ua=Object.freeze({Event:0,0:"Event",VoD:1,1:"VoD",Live:2,2:"Live",Unknown:3,3:"Unknown"}),be=Object.freeze({Closed:0,0:"Closed",Ended:1,1:"Ended",Open:2,2:"Open"}),Ca=Object.freeze({Absolute:0,0:"Absolute",FromBeginning:1,1:"FromBeginning",FromEnd:2,2:"FromEnd"}),x=class{static __wrap(e){let t=Object.create(x.prototype);return t.ptr=e,t}__destroy_into_raw(){let e=this.ptr;return this.ptr=0,e}free(){let e=this.__destroy_into_raw();d.__wbg_addsourcebufferresult_free(e)}static success(e){let t=d.addsourcebufferresult_success(e);return x.__wrap(t)}static error(e,t){var n=y(t)?0:W(t,d.__wbindgen_malloc,d.__wbindgen_realloc),a=T;let o=d.addsourcebufferresult_error(e,n,a);return x.__wrap(o)}},E=class{static __wrap(e){let t=Object.create(E.prototype);return t.ptr=e,t}__destroy_into_raw(){let e=this.ptr;return this.ptr=0,e}free(){let e=this.__destroy_into_raw();d.__wbg_appendbufferresult_free(e)}static success(e,t){let n=d.appendbufferresult_success(!y(e),y(e)?0:e,!y(t),y(t)?0:t);return E.__wrap(n)}static error(e,t){var n=y(t)?0:W(t,d.__wbindgen_malloc,d.__wbindgen_realloc),a=T;let o=d.appendbufferresult_error(e,n,a);return E.__wrap(o)}},D=class{static __wrap(e){let t=Object.create(D.prototype);return t.ptr=e,t}__destroy_into_raw(){let e=this.ptr;return this.ptr=0,e}free(){let e=this.__destroy_into_raw();d.__wbg_attachmediasourceresult_free(e)}static success(){let e=d.attachmediasourceresult_success();return D.__wrap(e)}static error(e,t){var n=y(t)?0:W(t,d.__wbindgen_malloc,d.__wbindgen_realloc),a=T;let o=d.attachmediasourceresult_error(e,n,a);return D.__wrap(o)}},$=class{static __wrap(e){let t=Object.create($.prototype);return t.ptr=e,t}__destroy_into_raw(){let e=this.ptr;return this.ptr=0,e}free(){let e=this.__destroy_into_raw();d.__wbg_dispatcher_free(e)}constructor(e){let t=d.dispatcher_new(e);return $.__wrap(t)}load_content(e,t){let n=W(e,d.__wbindgen_malloc,d.__wbindgen_realloc),a=T,o=0;y(t)||(U(t,G),o=t.__destroy_into_raw()),d.dispatcher_load_content(this.ptr,n,a,o)}minimum_position(){try{let n=d.__wbindgen_add_to_stack_pointer(-16);d.dispatcher_minimum_position(n,this.ptr);var e=te()[n/4+0],t=re()[n/8+1];return e===0?void 0:t}finally{d.__wbindgen_add_to_stack_pointer(16)}}maximum_position(){try{let n=d.__wbindgen_add_to_stack_pointer(-16);d.dispatcher_maximum_position(n,this.ptr);var e=te()[n/4+0],t=re()[n/8+1];return e===0?void 0:t}finally{d.__wbindgen_add_to_stack_pointer(16)}}set_wanted_speed(e){d.dispatcher_set_wanted_speed(this.ptr,e)}set_buffer_goal(e){d.dispatcher_set_buffer_goal(this.ptr,e)}stop(){d.dispatcher_stop(this.ptr)}lock_variant(e){d.dispatcher_lock_variant(this.ptr,e)}unlock_variant(){d.dispatcher_unlock_variant(this.ptr)}set_audio_track(e){d.dispatcher_set_audio_track(this.ptr,!y(e),y(e)?0:e)}set_segment_request_max_retry(e){d.dispatcher_set_segment_request_max_retry(this.ptr,e)}set_segment_request_timeout(e){d.dispatcher_set_segment_request_timeout(this.ptr,e)}set_segment_backoff_base(e){d.dispatcher_set_segment_backoff_base(this.ptr,e)}set_segment_backoff_max(e){d.dispatcher_set_segment_backoff_max(this.ptr,e)}set_multi_variant_playlist_request_max_retry(e){d.dispatcher_set_multi_variant_playlist_request_max_retry(this.ptr,e)}set_multi_variant_playlist_request_timeout(e){d.dispatcher_set_multi_variant_playlist_request_timeout(this.ptr,e)}set_multi_variant_playlist_backoff_base(e){d.dispatcher_set_multi_variant_playlist_backoff_base(this.ptr,e)}set_multi_variant_playlist_backoff_max(e){d.dispatcher_set_multi_variant_playlist_backoff_max(this.ptr,e)}set_media_playlist_request_max_retry(e){d.dispatcher_set_media_playlist_request_max_retry(this.ptr,e)}set_media_playlist_request_timeout(e){d.dispatcher_set_media_playlist_request_timeout(this.ptr,e)}set_media_playlist_backoff_base(e){d.dispatcher_set_media_playlist_backoff_base(this.ptr,e)}set_media_playlist_backoff_max(e){d.dispatcher_set_media_playlist_backoff_max(this.ptr,e)}on_request_finished(e,t,n,a,o){let i=W(a,d.__wbindgen_malloc,d.__wbindgen_realloc),s=T;d.dispatcher_on_request_finished(this.ptr,e,t,n,i,s,o)}on_request_failed(e,t,n){d.dispatcher_on_request_failed(this.ptr,e,t,!y(n),y(n)?0:n)}on_media_source_state_change(e){d.dispatcher_on_media_source_state_change(this.ptr,e)}on_source_buffer_update(e,t){U(t,k);var n=t.__destroy_into_raw();d.dispatcher_on_source_buffer_update(this.ptr,e,n)}on_source_buffer_creation_error(e,t,n){let a=W(n,d.__wbindgen_malloc,d.__wbindgen_realloc),o=T;d.dispatcher_on_source_buffer_creation_error(this.ptr,e,t,a,o)}on_append_buffer_error(e,t){d.dispatcher_on_append_buffer_error(this.ptr,e,t)}on_remove_buffer_error(e){d.dispatcher_on_remove_buffer_error(this.ptr,e)}on_playback_tick(e){U(e,q);var t=e.__destroy_into_raw();d.dispatcher_on_playback_tick(this.ptr,t)}on_timer_ended(e,t){d.dispatcher_on_timer_ended(this.ptr,e,t)}on_codecs_support_update(){d.dispatcher_on_codecs_support_update(this.ptr)}},L=class{static __wrap(e){let t=Object.create(L.prototype);return t.ptr=e,t}__destroy_into_raw(){let e=this.ptr;return this.ptr=0,e}free(){let e=this.__destroy_into_raw();d.__wbg_endofstreamresult_free(e)}static success(){let e=d.attachmediasourceresult_success();return L.__wrap(e)}static error(e,t){var n=y(t)?0:W(t,d.__wbindgen_malloc,d.__wbindgen_realloc),a=T;let o=d.attachmediasourceresult_error(e,n,a);return L.__wrap(o)}},k=class{static __wrap(e){let t=Object.create(k.prototype);return t.ptr=e,t}__destroy_into_raw(){let e=this.ptr;return this.ptr=0,e}free(){let e=this.__destroy_into_raw();d.__wbg_jstimeranges_free(e)}constructor(e){let t=mr(e,d.__wbindgen_malloc),n=T,a=d.jstimeranges_new(t,n);return k.__wrap(a)}len(){return d.jstimeranges_len(this.ptr)>>>0}start(e){try{let a=d.__wbindgen_add_to_stack_pointer(-16);d.jstimeranges_start(a,this.ptr,e);var t=te()[a/4+0],n=re()[a/8+1];return t===0?void 0:n}finally{d.__wbindgen_add_to_stack_pointer(16)}}start_unchecked(e){return d.jstimeranges_start_unchecked(this.ptr,e)}end(e){try{let a=d.__wbindgen_add_to_stack_pointer(-16);d.jstimeranges_end(a,this.ptr,e);var t=te()[a/4+0],n=re()[a/8+1];return t===0?void 0:n}finally{d.__wbindgen_add_to_stack_pointer(16)}}end_unchecked(e){return d.jstimeranges_end_unchecked(this.ptr,e)}},q=class{static __wrap(e){let t=Object.create(q.prototype);return t.ptr=e,t}__destroy_into_raw(){let e=this.ptr;return this.ptr=0,e}free(){let e=this.__destroy_into_raw();d.__wbg_mediaobservation_free(e)}constructor(e,t,n,a,o,i,s,u,c,f){U(a,k);var g=a.__destroy_into_raw();let I=0;y(c)||(U(c,k),I=c.__destroy_into_raw());let w=0;y(f)||(U(f,k),w=f.__destroy_into_raw());let v=d.mediaobservation_new(e,t,n,g,o,i,s,u,I,w);return q.__wrap(v)}},C=class{static __wrap(e){let t=Object.create(C.prototype);return t.ptr=e,t}__destroy_into_raw(){let e=this.ptr;return this.ptr=0,e}free(){let e=this.__destroy_into_raw();d.__wbg_mediasourcedurationupdateresult_free(e)}static success(){let e=d.attachmediasourceresult_success();return C.__wrap(e)}static error(e,t){var n=y(t)?0:W(t,d.__wbindgen_malloc,d.__wbindgen_realloc),a=T;let o=d.attachmediasourceresult_error(e,n,a);return C.__wrap(o)}};var R=class{static __wrap(e){let t=Object.create(R.prototype);return t.ptr=e,t}__destroy_into_raw(){let e=this.ptr;return this.ptr=0,e}free(){let e=this.__destroy_into_raw();d.__wbg_removebufferresult_free(e)}static success(){let e=d.attachmediasourceresult_success();return R.__wrap(e)}static error(e,t){var n=y(t)?0:W(t,d.__wbindgen_malloc,d.__wbindgen_realloc),a=T;let o=d.attachmediasourceresult_error(e,n,a);return R.__wrap(o)}},O=class{static __wrap(e){let t=Object.create(O.prototype);return t.ptr=e,t}__destroy_into_raw(){let e=this.ptr;return this.ptr=0,e}free(){let e=this.__destroy_into_raw();d.__wbg_removemediasourceresult_free(e)}static success(){let e=d.attachmediasourceresult_success();return O.__wrap(e)}static error(e,t){var n=y(t)?0:W(t,d.__wbindgen_malloc,d.__wbindgen_realloc),a=T;let o=d.attachmediasourceresult_error(e,n,a);return O.__wrap(o)}},G=class{static __wrap(e){let t=Object.create(G.prototype);return t.ptr=e,t}__destroy_into_raw(){let e=this.ptr;return this.ptr=0,e}free(){let e=this.__destroy_into_raw();d.__wbg_startingposition_free(e)}constructor(e,t){let n=d.startingposition_new(e,t);return G.__wrap(n)}};async function yr(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}let t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function xr(){let r={};return r.wbg={},r.wbg.__wbg_jsClearTimer_301dcdf2418211d8=typeof jsClearTimer=="function"?jsClearTimer:j("jsClearTimer"),r.wbg.__wbg_jsLog_00474289f6bb98ad=function(e,t,n){jsLog(e>>>0,M(t,n))},r.wbg.__wbg_jsRemoveMediaSource_0d37f27d9b42d9ce=function(){let e=jsRemoveMediaSource();U(e,O);var t=e.__destroy_into_raw();return t},r.wbg.__wbg_jsFreeResource_6609ca971af5f47d=function(e){return jsFreeResource(e>>>0)},r.wbg.__wbg_jsSetPlaybackRate_8247ee561962e420=typeof jsSetPlaybackRate=="function"?jsSetPlaybackRate:j("jsSetPlaybackRate"),r.wbg.__wbg_jsAttachMediaSource_40cb11dc3be19e8e=function(){let e=jsAttachMediaSource();U(e,D);var t=e.__destroy_into_raw();return t},r.wbg.__wbg_jsSeek_f944db11e1f41ebf=typeof jsSeek=="function"?jsSeek:j("jsSeek"),r.wbg.__wbg_jsSetMediaOffset_6d1607073568aeb3=typeof jsSetMediaOffset=="function"?jsSetMediaOffset:j("jsSetMediaOffset"),r.wbg.__wbg_jsStartRebuffering_d4b15d38c994c6ca=typeof jsStartRebuffering=="function"?jsStartRebuffering:j("jsStartRebuffering"),r.wbg.__wbg_jsStopRebuffering_7a6e6a540fadf84a=typeof jsStopRebuffering=="function"?jsStopRebuffering:j("jsStopRebuffering"),r.wbg.__wbg_jsFlush_4665ec6ea69b198d=typeof jsFlush=="function"?jsFlush:j("jsFlush"),r.wbg.__wbg_jsEndOfStream_7f8bd6e7f2e41320=function(){let e=jsEndOfStream();U(e,L);var t=e.__destroy_into_raw();return t},r.wbg.__wbg_jsAddSourceBuffer_1b11b41ab7ab4aff=function(e,t,n){let a=jsAddSourceBuffer(e>>>0,M(t,n));U(a,x);var o=a.__destroy_into_raw();return o},r.wbg.__wbg_jsAppendBuffer_70d371a8fc0520ee=function(e,t,n){let a=jsAppendBuffer(e>>>0,t>>>0,n!==0);U(a,E);var o=a.__destroy_into_raw();return o},r.wbg.__wbg_jsRemoveBuffer_eedc34a61cd96de7=function(e,t,n){let a=jsRemoveBuffer(e>>>0,t,n);U(a,R);var o=a.__destroy_into_raw();return o},r.wbg.__wbg_jsGetResourceData_9905194ca1df9740=function(e,t){let n=jsGetResourceData(t>>>0);var a=y(n)?0:gr(n,d.__wbindgen_malloc),o=T;te()[e/4+1]=o,te()[e/4+0]=a},r.wbg.__wbg_jsTimer_6771e0ed6c76c4c2=function(e,t){return jsTimer(e,t>>>0)},r.wbg.__wbg_jsFetch_cbeb721c2c17cfa2=function(e,t,n,a,o,i,s){return jsFetch(M(e,t),n===0?void 0:a>>>0,o===0?void 0:i>>>0,s)},r.wbg.__wbg_jsAbortRequest_35213bab3d31c896=function(e){return jsAbortRequest(e>>>0)},r.wbg.__wbg_jsSetMediaSourceDuration_1453ce98975684aa=function(e){let t=jsSetMediaSourceDuration(e);U(t,C);var n=t.__destroy_into_raw();return n},r.wbg.__wbg_jsIsTypeSupported_15d2a1c90a822b21=function(e,t,n){let a=jsIsTypeSupported(e>>>0,M(t,n));return y(a)?16777215:a?1:0},r.wbg.__wbg_jsStartObservingPlayback_f8cbb6fb1575b404=typeof jsStartObservingPlayback=="function"?jsStartObservingPlayback:j("jsStartObservingPlayback"),r.wbg.__wbg_jsStopObservingPlayback_4c7502cb150ed3eb=typeof jsStopObservingPlayback=="function"?jsStopObservingPlayback:j("jsStopObservingPlayback"),r.wbg.__wbg_jsUpdateContentInfo_9b8f8c7324b3d043=function(e,t,n,a,o){jsUpdateContentInfo(e===0?void 0:t,n===0?void 0:a,o>>>0)},r.wbg.__wbg_jsAnnounceFetchedContent_cd2294515e7cf424=function(e,t,n,a){var o=xt(e,t).slice();d.__wbindgen_free(e,t*4);var i=xt(n,a).slice();d.__wbindgen_free(n,a*4),jsAnnounceFetchedContent(o,i)},r.wbg.__wbg_jsAnnounceVariantUpdate_667bf75b88ab696e=function(e,t){jsAnnounceVariantUpdate(e===0?void 0:t>>>0)},r.wbg.__wbg_jsAnnounceTrackUpdate_edddb7ba6ce38e21=function(e,t,n,a){jsAnnounceTrackUpdate(e>>>0,t===0?void 0:n>>>0,a!==0)},r.wbg.__wbg_jsAnnounceVariantLockStatusChange_199561e79ae2fc0c=function(e,t){jsAnnounceVariantLockStatusChange(e===0?void 0:t>>>0)},r.wbg.__wbg_jsGetRandom_6ce7dcf19c779ac6=typeof jsGetRandom=="function"?jsGetRandom:j("jsGetRandom"),r.wbg.__wbg_jsSendSegmentRequestError_c24222a3b05bd7e3=function(e,t,n,a,o,i,s,u,c,f){let g;o!==0&&(g=_r(o,i).slice(),d.__wbindgen_free(o,i*8)),jsSendSegmentRequestError(e!==0,M(t,n),a!==0,g,s>>>0,u>>>0,c===0?void 0:f>>>0)},r.wbg.__wbg_jsSendMultivariantPlaylistRequestError_3e349bf07620b20e=function(e,t,n,a,o,i){jsSendMultivariantPlaylistRequestError(e!==0,M(t,n),a>>>0,o===0?void 0:i>>>0)},r.wbg.__wbg_jsSendMediaPlaylistRequestError_aa45aaff70c402fb=function(e,t,n,a,o,i,s){jsSendMediaPlaylistRequestError(e!==0,M(t,n),a>>>0,o>>>0,i===0?void 0:s>>>0)},r.wbg.__wbg_jsSendSourceBufferCreationError_d94025a0cba923e4=function(e,t,n,a,o){jsSendSourceBufferCreationError(e!==0,t>>>0,n>>>0,M(a,o))},r.wbg.__wbg_jsSendMultivariantPlaylistParsingError_ff71dc2c62511fe2=function(e,t,n,a){jsSendMultivariantPlaylistParsingError(e!==0,t>>>0,M(n,a))},r.wbg.__wbg_jsSendMediaPlaylistParsingError_59fdc8a634b94680=function(e,t,n,a,o){jsSendMediaPlaylistParsingError(e!==0,t>>>0,n>>>0,M(a,o))},r.wbg.__wbg_jsSendSegmentParsingError_a943854347a9c2eb=function(e,t,n,a,o){jsSendSegmentParsingError(e!==0,t>>>0,n>>>0,M(a,o))},r.wbg.__wbg_jsSendPushedSegmentError_8c677c89a22d394c=function(e,t,n,a,o){jsSendPushedSegmentError(e!==0,t>>>0,n>>>0,M(a,o))},r.wbg.__wbg_jsSendRemovedBufferError_9c2dce7c76cd222b=function(e,t,n,a){jsSendRemovedBufferError(e!==0,t>>>0,M(n,a))},r.wbg.__wbg_jsSendOtherError_b41c02aa1ff76f2e=function(e,t,n,a){jsSendOtherError(e!==0,t>>>0,M(n,a))},r.wbg.__wbindgen_throw=function(e,t){throw new Error(M(e,t))},r}function Sr(r,e){return d=r.exports,kt.__wbindgen_wasm_module=e,me=null,pe=null,ge=null,fe=null,d}async function kt(r){typeof r>"u"&&(r=new URL("wasp_hls_bg.wasm",vr.url));let e=xr();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));let{instance:t,module:n}=await yr(await r,e);return Sr(t,n)}var Tt=kt;var Je=class{constructor(){this._instanceInfo=null}hasMseInWorker(){return this._instanceInfo?.hasMseInWorker}canDemuxMpeg2Ts(){return this._instanceInfo?.canDemuxMpeg2Ts}start(e,t,n){let a=new $(n.initialBandwidth);et(a,t),this._instanceInfo={wasm:e,dispatcher:a,content:null,hasMseInWorker:n.hasMseInWorker,canDemuxMpeg2Ts:n.canDemuxMpeg2Ts}}dispose(){this._instanceInfo?.dispatcher.free(),V.freeEverything(),H.freeEverything()}changeContent(e){if(this._instanceInfo===null){p.error("Worker: Cannot call `changeContent`: `PlayerInstance` not started.");return}V.freeEverything(),H.freeEverything(),this._instanceInfo.content=e}getDispatcher(){return this._instanceInfo?.dispatcher??null}getCurrentWasmMemory(){return this._instanceInfo?.wasm.memory??null}getContentInfo(){return this._instanceInfo?.content??null}},De=class{constructor(){this._generateId=yt(),this._store={}}create(e){let t=this._generateId();return this._store[t]=e,t}delete(e){delete this._store[e]}get(e){return this._store[e]}freeEverything(){this._store={}}},Q=new Map,l=new Je,V=new De,H=new De,Ze=2147483647;function et(r,e){if(e.bufferGoal!==void 0&&r.set_buffer_goal(e.bufferGoal),e.segmentMaxRetry!==void 0){let t=Math.min(e.segmentMaxRetry,Ze);t=Math.max(e.segmentMaxRetry,-1),r.set_segment_request_max_retry(t)}if(e.segmentRequestTimeout!==void 0&&r.set_segment_request_timeout(e.segmentRequestTimeout),e.segmentBackoffBase!==void 0&&r.set_segment_backoff_base(e.segmentBackoffBase),e.segmentBackoffMax!==void 0&&r.set_segment_backoff_max(e.segmentBackoffMax),e.multiVariantPlaylistMaxRetry!==void 0){let t=Math.min(e.multiVariantPlaylistMaxRetry,Ze);t=Math.max(e.multiVariantPlaylistMaxRetry,-1),r.set_multi_variant_playlist_request_max_retry(t)}if(e.multiVariantPlaylistRequestTimeout!==void 0&&r.set_multi_variant_playlist_request_timeout(e.multiVariantPlaylistRequestTimeout),e.multiVariantPlaylistBackoffBase!==void 0&&r.set_multi_variant_playlist_backoff_base(e.multiVariantPlaylistBackoffBase),e.multiVariantPlaylistBackoffMax!==void 0&&r.set_multi_variant_playlist_backoff_max(e.multiVariantPlaylistBackoffMax),e.mediaPlaylistMaxRetry!==void 0){let t=Math.min(e.mediaPlaylistMaxRetry,Ze);t=Math.max(e.mediaPlaylistMaxRetry,-1),r.set_media_playlist_request_max_retry(t)}e.mediaPlaylistRequestTimeout!==void 0&&r.set_media_playlist_request_timeout(e.mediaPlaylistRequestTimeout),e.mediaPlaylistBackoffBase!==void 0&&r.set_media_playlist_backoff_base(e.mediaPlaylistBackoffBase),e.mediaPlaylistBackoffMax!==void 0&&r.set_media_playlist_backoff_max(e.mediaPlaylistBackoffMax)}function Le(){let r=l.getContentInfo();if(r===null)return;let{mediaSourceObj:e}=r;if(e!==null)return e}function It(r){let e=Tr(r);if(e===null)return;let t=z(e,1952867444);if(t===null)return;let n=t[0];return n===1?At(t,4):n===0?Y(t,4):void 0}function Pt(r){let e=Ir(r);if(e.length===0)return;let t=0;for(let n of e){let a=z(n,1953658222);if(a===null)return;let o=0,i=a[o];if(o+=1,i>1)return;let s=wt(a,o);o+=3;let u=(s&256)>0,c=0;if(!u&&(c=kr(n),c===void 0))return;let f=(s&1)>0,g=(s&4)>0,I=(s&512)>0,w=(s&1024)>0,v=(s&2048)>0,S=Y(a,o);o+=4,f&&(o+=4),g&&(o+=4);let A=S,P=0;for(;A-- >0;)u?(P+=Y(a,o),o+=4):P+=c,I&&(o+=4),w&&(o+=4),v&&(o+=4);t+=P}return t}function Mt(r){let e=Pr(r);if(e===null)return;let t=z(e,1835296868);if(t===null)return;let n=0,a=t[n];return n+=4,a===1?Y(t,n+16):a===0?Y(t,n+8):void 0}function kr(r){let e=z(r,1952868452);if(e===null)return;let t=1,n=wt(e,t);t+=3;let a=(n&1)>0,o=(n&2)>0;return(n&8)>0?(t+=4,a&&(t+=8),o&&(t+=4),Y(e,t)):void 0}function Tr(r){let e=z(r,1836019558);return e===null?null:z(e,1953653094)}function Ir(r){return Mr(r,1836019558).reduce((t,n)=>{let a=z(n,1953653094);return a!==null&&t.push(a),t},[])}function Pr(r){let e=z(r,1836019574);if(e===null)return null;let t=z(e,1953653099);return t===null?null:z(t,1835297121)}function z(r,e){let t=Et(r,e);return t!==null?r.subarray(t[1],t[2]):null}function Mr(r,e){let t=[],n=r;for(;;){let a=Et(n,e);if(a===null)return t;if(a[2]===0||n.length===0)throw new Error("Error while parsing ISOBMFF box");t.push(n.subarray(a[1],a[2])),n=n.subarray(a[2])}}function Et(r,e){let t=r.length,n=0,a,o=0,i;for(;n+8<=t;){if(i=n,o=Y(r,i),i+=4,a=Y(r,i),i+=4,o===0)o=t-n;else if(o===1){if(i+8>t)return null;o=At(r,i),i+=8}if(o<0)throw new Error("ISOBMFF: Size out of range");if(a===e)return e===1970628964&&(i+=16),[n,i,n+o];n+=o}return null}function wt(r,e){return r[e+0]*65536+r[e+1]*256+r[e+2]}function Y(r,e){return r[e+0]*16777216+r[e+1]*65536+r[e+2]*256+r[e+3]}function At(r,e){return(r[e+0]*16777216+r[e+1]*65536+r[e+2]*256+r[e+3])*4294967296+r[e+4]*16777216+r[e+5]*65536+r[e+6]*256+r[e+7]}function m(r,e){p.debug("<-- sending to main:",r.type),e===void 0?postMessage(r):postMessage(r,e)}function tt(r,e){let t=r[e+6]<<21|r[e+7]<<14|r[e+8]<<7|r[e+9],a=(r[e+5]&16)>>4;return t=t>=0?t:0,a?t+20:t+10}function Ut(r,e){if(r.length-e<10||r[e]!=="I".charCodeAt(0)||r[e+1]!=="D".charCodeAt(0)||r[e+2]!=="3".charCodeAt(0))return e;let t=e+tt(r,e);return Ut(r,t)}function Ct(r){let e=Ut(r,0);return r.length>=e+2&&(r[e]&255)===255&&(r[e+1]&240)===240&&(r[e+1]&22)===16}function Bt(r,e){let t=(r[e+5]&224)>>5,n=r[e+4]<<3;return r[e+3]&3<<11|n|t}function Er(r){return r*9e4}function wr(r,e){return r*e}function Rt(r){return r/9e4}function Ar(r,e){return r/e}function Ot(r,e){return Er(Ar(r,e))}function Dt(r,e){return wr(Rt(r),e)}function je(r,e,t){return Rt(t?r:r-e)}var Lt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];function jt(r,e,t){p.warn(`Transmux: adts skiping bytes ${r} to ${e} in frame ${t} outside syncword`)}var ae=class{constructor(){this._buffer=null}parsePacket(e){let t=this._buffer,n=[];if(e.type!=="audio")return[];let a=0;if(t!==null&&t.length>0){let s=t;t=new Uint8Array(s.byteLength+e.data.byteLength),t.set(s),t.set(e.data,s.byteLength)}else t=e.data;let o,i=0;for(;i+7<t.length;){if(t[i]!==255||(t[i+1]&246)!==240){typeof o!="number"&&(o=i),i++;continue}typeof o=="number"&&(jt(o,i,a),o=void 0);let s=(~t[i+1]&1)*2,u=(t[i+3]&3)<<11|t[i+4]<<3|(t[i+5]&224)>>5,c=((t[i+6]&3)+1)*1024,f=c*9e4/Lt[(t[i+2]&60)>>>2];if(t.byteLength-i<u)break;n.push({pts:e.pts+a*f,dts:e.dts+a*f,sampleCount:c,audioobjecttype:(t[i+2]>>>6&3)+1,channelcount:(t[i+2]&1)<<2|(t[i+3]&192)>>>6,samplerate:Lt[(t[i+2]&60)>>>2],samplingfrequencyindex:(t[i+2]&60)>>>2,samplesize:16,data:t.subarray(i+7+s,i+u)}),a++,i+=u}return typeof o=="number"&&jt(o,i,a),this._buffer=t.subarray(i),t.byteLength===0&&(this._buffer=null),n}reset(){this._buffer=null}};var ye=class{constructor(){this._segmentHadPmt=!1,this._video={data:[],size:0},this._audio={data:[],size:0},this._timedMetadata={data:[],size:0},this._programMapTable=null}readNextPacket(e){switch(e.type){case"pat":break;case"pes":{let t,n;switch(e.streamType){case 27:t=this._video,n="video";break;case 15:t=this._audio,n="audio";break;case 21:t=this._timedMetadata,n="timed-metadata";break;default:return null}let a=null;return e.payloadUnitStartIndicator&&(a=this._flushStream(t,n,!0)),t.data.push(e),t.size+=e.data.byteLength,a}case"pmt":{let t={type:"metadata",tracks:[]},n=e.programMapTable;return this._programMapTable=n,n.video!==null&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+n.video,codec:"avc",type:"video"}),n.audio!==null&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+n.audio,codec:"adts",type:"audio"}),this._segmentHadPmt=!0,t}}return null}reset(){this._video.size=0,this._video.data.length=0,this._audio.size=0,this._audio.data.length=0}_parsePes(e,t){if((e[0]<<16|e[1]<<8|e[2])!==1)return;t.packetLength=6+(e[4]<<8|e[5]),t.dataAlignmentIndicator=(e[6]&4)!==0;let a=e[7];a&192&&(t.pts=(e[9]&14)<<27|(e[10]&255)<<20|(e[11]&254)<<12|(e[12]&255)<<5|(e[13]&254)>>>3,t.pts*=4,t.pts+=(e[13]&6)>>>1,t.dts=t.pts,a&64&&(t.dts=(e[14]&14)<<27|(e[15]&255)<<20|(e[16]&254)<<12|(e[17]&255)<<5|(e[18]&254)>>>3,t.dts*=4,t.dts+=(e[18]&6)>>>1)),t.data=e.subarray(9+e[8])}_flushStream(e,t,n){let a=0,o=!1;if(e.data.length===0||e.size<9)return null;let i={type:t,data:new Uint8Array,trackId:e.data[0].pid},s=new Uint8Array(e.size);return e.data.forEach(u=>{s.set(u.data,a),a+=u.data.byteLength}),this._parsePes(s,i),o=t==="video"||i.packetLength!==void 0&&i.packetLength<=e.size,(n===!0||o)&&(e.size=0,e.data.length=0),o?i:null}_flushStreams(){let e=[],t=this._flushStream(this._video,"video");t!==null&&e.push(t);let n=this._flushStream(this._audio,"audio");n!==null&&e.push(n);let a=this._flushStream(this._timedMetadata,"timed-metadata");return a!==null&&e.push(a),e}flush(){let e=null;if(!this._segmentHadPmt&&this._programMapTable!==null){let t=this._programMapTable,n={type:"metadata",tracks:[]};t.video!==null&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.video,codec:"avc",type:"video"}),t.audio!==null&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.audio,codec:"adts",type:"audio"}),e=n}return this._segmentHadPmt=!1,e!==null?[e,...this._flushStreams()]:this._flushStreams()}};var Wt=Math.pow(2,32),h={avc1:[97,118,99,49],avcC:[97,118,99,67],btrt:[98,116,114,116],dinf:[100,105,110,102],dref:[100,114,101,102],esds:[101,115,100,115],ftyp:[102,116,121,112],hdlr:[104,100,108,114],mdat:[109,100,97,116],mdhd:[109,100,104,100],mdia:[109,100,105,97],mfhd:[109,102,104,100],minf:[109,105,110,102],moof:[109,111,111,102],moov:[109,111,111,118],mp4a:[109,112,52,97],mvex:[109,118,101,120],mvhd:[109,118,104,100],pasp:[112,97,115,112],sdtp:[115,100,116,112],smhd:[115,109,104,100],stbl:[115,116,98,108],stco:[115,116,99,111],stsc:[115,116,115,99],stsd:[115,116,115,100],stsz:[115,116,115,122],stts:[115,116,116,115],styp:[115,116,121,112],tfdt:[116,102,100,116],tfhd:[116,102,104,100],traf:[116,114,97,102],trak:[116,114,97,107],trun:[116,114,117,110],trex:[116,114,101,120],tkhd:[116,107,104,100],vmhd:[118,109,104,100]},Nt=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),Cr=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),Br=new Uint8Array([0,0,0,1]),Rr=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),Or=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),Dr={video:Rr,audio:Or},Lr=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),jr=new Uint8Array([0,0,0,0,0,0,0,0]),nt=new Uint8Array([0,0,0,0,0,0,0,0]),Wr=nt,Nr=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Fr=nt,zr=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);function _(r,...e){let t=[];for(let s of e)t.push(s);let n=t.length-1,a=0;for(;n>=0;)a+=t[n].byteLength,n--;let o=new Uint8Array(a+8);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,o.byteLength),o.set(r,4);for(let s=0,u=8;s<t.length;s++)o.set(t[s],u),u+=t[s].byteLength;return o}function qr(){return _(h.dinf,_(h.dref,Lr))}function Gr(r){return _(h.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,r.audioobjecttype<<3|r.samplingfrequencyindex>>>1,r.samplingfrequencyindex<<7|r.channelcount<<3,6,1,2]))}function Vr(){return _(h.ftyp,Nt,Br,Nt,Cr)}function Hr(r){return _(h.hdlr,Dr[r])}function Fe(r){return _(h.mdat,r)}function Qr(r){let e=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,r.duration>>>24&255,r.duration>>>16&255,r.duration>>>8&255,r.duration&255,85,196,0,0]);return r.samplerate&&(e[12]=r.samplerate>>>24&255,e[13]=r.samplerate>>>16&255,e[14]=r.samplerate>>>8&255,e[15]=r.samplerate&255),_(h.mdhd,e)}function Yr(r){return _(h.mdia,Qr(r),Hr(r.type),$r(r))}function Xr(r){return _(h.mfhd,new Uint8Array([0,0,0,0,(r&4278190080)>>24,(r&16711680)>>16,(r&65280)>>8,r&255]))}function $r(r){return _(h.minf,r.type==="video"?_(h.vmhd,zr):_(h.smhd,jr),qr(),tn(r))}function ze(r,e){let t=e.map(n=>sn(n));return _(h.moof,Xr(r),...t)}function Kr(r){let e=r.map(t=>un(t));return _(h.moov,Jr(4294967295),...e,Zr(r))}function Zr(r){let e=r.map(t=>cn(t));return _(h.mvex,...e)}function Jr(r){let e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(r&4278190080)>>24,(r&16711680)>>16,(r&65280)>>8,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return _(h.mvhd,e)}function en(r){let e=r.samples??[],t=new Uint8Array(4+e.length);for(let n=0;n<e.length;n++){let a=e[n].flags;a!==void 0&&(t[n+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy)}return _(h.sdtp,t)}function tn(r){return _(h.stbl,rn(r),_(h.stts,Fr),_(h.stsc,Wr),_(h.stsz,Nr),_(h.stco,nt))}function rn(r){return _(h.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),r.type==="video"?nn(r):an(r))}function nn(r){let e=r.sps??[],t=r.pps??[],n=[],a=[];for(let i of e)n.push((i.byteLength&65280)>>>8),n.push(i.byteLength&255),n=n.concat(Array.prototype.slice.call(i));for(let i of t)a.push((i.byteLength&65280)>>>8),a.push(i.byteLength&255),a=a.concat(Array.prototype.slice.call(i));let o=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(r.width&65280)>>8,r.width&255,(r.height&65280)>>8,r.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),_(h.avcC,new Uint8Array([1,r.profileIdc,r.profileCompatibility,r.levelIdc,255].concat([e.length],n,[t.length],a))),_(h.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))];if(r.sarRatio!==void 0){let i=r.sarRatio[0],s=r.sarRatio[1];o.push(_(h.pasp,new Uint8Array([(i&4278190080)>>24,(i&16711680)>>16,(i&65280)>>8,i&255,(s&4278190080)>>24,(s&16711680)>>16,(s&65280)>>8,s&255])))}return _(h.avc1,...o)}function an(r){return _(h.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(r.channelcount&65280)>>8,r.channelcount&255,(r.samplesize&65280)>>8,r.samplesize&255,0,0,0,0,(r.samplerate&65280)>>8,r.samplerate&255,0,0]),Gr(r))}function on(r){return _(h.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(r.id&4278190080)>>24,(r.id&16711680)>>16,(r.id&65280)>>8,r.id&255,0,0,0,0,(r.duration&4278190080)>>24,(r.duration&16711680)>>16,(r.duration&65280)>>8,r.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(r.width&65280)>>8,r.width&255,0,0,(r.height&65280)>>8,r.height&255,0,0]))}function sn(r){let e=_(h.tfhd,new Uint8Array([0,0,0,58,(r.id&4278190080)>>24,(r.id&16711680)>>16,(r.id&65280)>>8,r.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),t=Math.floor(r.baseMediaDecodeTime/Wt),n=Math.floor(r.baseMediaDecodeTime%Wt),a=_(h.tfdt,new Uint8Array([1,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,t&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255])),o=32+20+8+16+8+8;if(r.type==="audio"){let u=Ft(r,o);return _(h.traf,e,a,u)}let i=en(r),s=Ft(r,i.length+o);return _(h.traf,e,a,s,i)}function un(r){return r.duration=r.duration||4294967295,_(h.trak,on(r),Yr(r))}function cn(r){let e=new Uint8Array([0,0,0,0,(r.id&4278190080)>>24,(r.id&16711680)>>16,(r.id&65280)>>8,r.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return r.type!=="video"&&(e[e.length-1]=0),_(h.trex,e)}function zt(r,e){let t=0,n=0,a=0,o=0;return r.length&&(r[0].duration!==void 0&&(t=1),r[0].size!==void 0&&(n=2),r[0].flags!==void 0&&(a=4),r[0].compositionTimeOffset!==void 0&&(o=8)),[0,0,t|n|a|o,1,(r.length&4278190080)>>>24,(r.length&16711680)>>>16,(r.length&65280)>>>8,r.length&255,(e&4278190080)>>>24,(e&16711680)>>>16,(e&65280)>>>8,e&255]}function dn(r,e){let t=r.samples??[],n=e+8+12+16*t.length,a=zt(t,n),o=new Uint8Array(a.length+t.length*16);o.set(a);let i=a.length;for(let s of t){o[i++]=(s.duration&4278190080)>>>24,o[i++]=(s.duration&16711680)>>>16,o[i++]=(s.duration&65280)>>>8,o[i++]=s.duration&255,o[i++]=(s.size&4278190080)>>>24,o[i++]=(s.size&16711680)>>>16,o[i++]=(s.size&65280)>>>8,o[i++]=s.size&255,s.flags!==void 0?(o[i++]=s.flags.isLeading<<2|s.flags.dependsOn,o[i++]=s.flags.isDependedOn<<6|s.flags.hasRedundancy<<4|s.flags.paddingValue<<1|s.flags.isNonSyncSample,o[i++]=s.flags.degradationPriority&240<<8,o[i++]=s.flags.degradationPriority&15):i+=4;let u=s.compositionTimeOffset??0;o[i++]=(u&4278190080)>>>24,o[i++]=(u&16711680)>>>16,o[i++]=(u&65280)>>>8,o[i++]=u&255}return _(h.trun,o)}function ln(r,e){let t=r.samples??[],n=e+8+12+8*t.length,a=zt(t,n),o=new Uint8Array(a.length+t.length*8);o.set(a);let i=a.length;for(let s of t)o[i++]=(s.duration&4278190080)>>>24,o[i++]=(s.duration&16711680)>>>16,o[i++]=(s.duration&65280)>>>8,o[i++]=s.duration&255,o[i++]=(s.size&4278190080)>>>24,o[i++]=(s.size&16711680)>>>16,o[i++]=(s.size&65280)>>>8,o[i++]=s.size&255;return _(h.trun,o)}function Ft(r,e){return r.type==="audio"?ln(r,e):dn(r,e)}function qt(r){let e=Vr(),t=Kr(r),n=new Uint8Array(e.byteLength+t.byteLength);return n.set(e),n.set(t,e.byteLength),n}var oe=class{constructor(e,t){this.metadataDispatchType=t,this.keepOriginalTimestamps=e,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.audioTrack=null}pushSegment(e){if(e.text!=null){this.pendingCaptions.push(e);return}if(e.frames!=null){this.pendingMetadata.push(e);return}this.pendingTracks.push(e.trackInfo),this.pendingBytes+=e.boxes.byteLength,e.trackInfo.type==="video"&&(this.videoTrack=e.trackInfo,this.pendingBoxes.push(e.boxes)),e.trackInfo.type==="audio"&&(this.audioTrack=e.trackInfo,this.pendingBoxes.unshift(e.boxes))}finishSegment(){let e=0,t={type:void 0,captions:[],captionStreams:{},metadata:[],info:{},initSegment:null,data:null},n=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],a=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],o;if(this.videoTrack!=null?(o=this.videoTrack.timelineStartInfo.pts,a.forEach(i=>{t.info[i]=this.videoTrack[i]},this)):this.audioTrack!=null&&(o=this.audioTrack.timelineStartInfo.pts,n.forEach(i=>{t.info[i]=this.audioTrack[i]},this)),this.videoTrack!=null||this.audioTrack!=null){this.pendingTracks.length===1?t.type=this.pendingTracks[0].type:t.type="combined";let i=qt(this.pendingTracks);if(t.initSegment=new Uint8Array(i.byteLength),t.initSegment.set(i),t.data=this.pendingBoxes.reduce((s,u)=>(s.set(u,e),e+=u.byteLength,s),new Uint8Array(this.pendingBytes)),o!==void 0){let s=o;t.captions=this.pendingCaptions.map(u=>(u.startTime=je(u.startPts,s,this.keepOriginalTimestamps),u.endTime=je(u.endPts,s,this.keepOriginalTimestamps),t.captionStreams[u.stream]=!0,u)),t.metadata=this.pendingMetadata.map(u=>(u.cueTime=je(u.pts,s,this.keepOriginalTimestamps),u))}return t.metadata.dispatchType=this.metadataDispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.audioTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,t}return null}cancel(){this.pendingTracks.length=0,this.videoTrack=null,this.audioTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0}};var at=class{constructor(e){this._workingData=e,this._workingBytesAvailable=e.byteLength,this._workingWord=0,this._workingBitsAvailable=0,this.loadWord()}length(){return 8*this._workingBytesAvailable}bitsAvailable(){return 8*this._workingBytesAvailable+this._workingBitsAvailable}loadWord(){let e=this._workingData.byteLength-this._workingBytesAvailable,t=new Uint8Array(4),n=Math.min(4,this._workingBytesAvailable);if(n===0)throw new Error("no bytes available");t.set(this._workingData.subarray(e,e+n)),this._workingWord=new DataView(t.buffer).getUint32(0),this._workingBitsAvailable=n*8,this._workingBytesAvailable-=n}skipBits(e){if(this._workingBitsAvailable>e)this._workingWord<<=e,this._workingBitsAvailable-=e;else{let t=e;t-=this._workingBitsAvailable;let n=Math.floor(t/8);t-=n*8,this._workingBytesAvailable-=n,this.loadWord(),this._workingWord<<=t,this._workingBitsAvailable-=t}}readBits(e){let t=Math.min(this._workingBitsAvailable,e),n=this._workingWord>>>32-t;return this._workingBitsAvailable-=t,this._workingBitsAvailable>0?this._workingWord<<=t:this._workingBytesAvailable>0&&this.loadWord(),t=e-t,t>0?n<<t|this.readBits(t):n}skipLeadingZeros(){let e=0;for(;e<this._workingBitsAvailable;++e)if(this._workingWord&2147483648>>>e)return this._workingWord<<=e,this._workingBitsAvailable-=e,e;return this.loadWord(),e+this.skipLeadingZeros()}skipUnsignedExpGolomb(){this.skipBits(1+this.skipLeadingZeros())}skipExpGolomb(){this.skipBits(1+this.skipLeadingZeros())}readUnsignedExpGolomb(){let e=this.skipLeadingZeros();return this.readBits(e+1)-1}readExpGolomb(){let e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUnsignedByte(){return this.readBits(8)}},Gt=at;var it=class{constructor(){this._syncPoint=0,this._buffer=null,this._cursor=void 0}findNext(e){if(this._buffer===null)this._buffer=e;else{let o=new Uint8Array(this._buffer.byteLength+e.byteLength);o.set(this._buffer),o.set(e,this._buffer.byteLength),this._buffer=o}let t=this._buffer.byteLength,n=[];for(;this._syncPoint<t-3;this._syncPoint++)if(this._buffer[this._syncPoint+2]===1){this._cursor=this._syncPoint+5;break}let a=this._buffer;for(;this._cursor!==void 0&&this._cursor<t;)switch(a[this._cursor]){case 0:if(a[this._cursor-1]!==0){this._cursor+=2;break}else if(a[this._cursor-2]!==0){this._cursor++;break}this._syncPoint+3!==this._cursor-2&&n.push(a.subarray(this._syncPoint+3,this._cursor-2));do this._cursor++;while(a[this._cursor]!==1&&this._cursor<t);this._syncPoint=this._cursor-2,this._cursor+=3;break;case 1:if(a[this._cursor-1]!==0||a[this._cursor-2]!==0){this._cursor+=3;break}n.push(a.subarray(this._syncPoint+3,this._cursor-2)),this._syncPoint=this._cursor-2,this._cursor+=3;break;default:this._cursor+=3;break}return this._syncPoint<this._buffer.length?this._buffer=this._buffer.subarray(this._syncPoint):this._buffer=null,this._cursor!==void 0&&(this._cursor-=this._syncPoint),this._syncPoint=0,n}reset(){this._buffer=null,this._cursor=void 0,this._syncPoint=0}flush(){let e=null;return this._buffer!==null&&this._buffer.byteLength>3&&(e=this._buffer.subarray(this._syncPoint+3)),this._buffer=null,this._syncPoint=0,this._cursor=void 0,e}},fn=[100,110,122,244,44,83,86,118,128,138,139,134];var xe=class{constructor(){this._nalUnitFinder=new it,this._lastTrackId=void 0,this._lastPts=void 0,this._lastDts=void 0}pushPacket(e){if(e.type!=="video")return[];let t=e.trackId,n=e.pts,a=e.dts;return this._lastTrackId=t,this._lastPts=n,this._lastDts=a,this._nalUnitFinder.findNext(e.data).map(i=>this._onNalUnit(i,t,n,a))}_onNalUnit(e,t,n,a){let o={trackId:t,pts:n,dts:a,data:e};switch(e[0]&31){case 5:return Object.assign(o,{nalUnitType:0});case 6:return Object.assign(o,{nalUnitType:1,escapedRBSP:this._discardEmulationPreventionBytes(e.subarray(1))});case 7:let s=this._discardEmulationPreventionBytes(e.subarray(1));return Object.assign(o,{nalUnitType:2,escapedRBSP:s,config:this._readSequenceParameterSet(s)});case 8:return Object.assign(o,{nalUnitType:3});case 9:return Object.assign(o,{nalUnitType:4});default:return Object.assign(o,{nalUnitType:5})}}flush(){let e=this._nalUnitFinder.flush();return e!==null&&this._lastTrackId!==void 0&&this._lastDts!==void 0&&this._lastPts!==void 0?this._onNalUnit(e,this._lastTrackId,this._lastPts,this._lastDts):null}reset(){this._nalUnitFinder.reset()}_skipScalingList(e,t){let n=8,a=8;for(let o=0;o<e;o++){if(a!==0){let i=t.readExpGolomb();a=(n+i+256)%256}n=a===0?n:a}}_discardEmulationPreventionBytes(e){let t=e.byteLength,n=[],a=1;for(;a<t-2;)e[a]===0&&e[a+1]===0&&e[a+2]===3?(n.push(a+2),a+=2):a++;if(n.length===0)return e;let o=t-n.length,i=new Uint8Array(o),s=0;for(a=0;a<o;s++,a++)s===n[0]&&(s++,n.shift()),i[a]=e[s];return i}_readSequenceParameterSet(e){let t=0,n=0,a=0,o=0,i=[1,1],s=new Gt(e),u=s.readUnsignedByte(),c=s.readUnsignedByte(),f=s.readUnsignedByte();if(s.skipUnsignedExpGolomb(),fn.includes(u)){let S=s.readUnsignedExpGolomb();if(S===3&&s.skipBits(1),s.skipUnsignedExpGolomb(),s.skipUnsignedExpGolomb(),s.skipBits(1),s.readBoolean()){let A=S!==3?8:12;for(let P=0;P<A;P++)s.readBoolean()&&(P<6?this._skipScalingList(16,s):this._skipScalingList(64,s))}}s.skipUnsignedExpGolomb();let g=s.readUnsignedExpGolomb();if(g===0)s.readUnsignedExpGolomb();else if(g===1){s.skipBits(1),s.skipExpGolomb(),s.skipExpGolomb();let S=s.readUnsignedExpGolomb();for(let A=0;A<S;A++)s.skipExpGolomb()}s.skipUnsignedExpGolomb(),s.skipBits(1);let I=s.readUnsignedExpGolomb(),w=s.readUnsignedExpGolomb(),v=s.readBits(1);if(v===0&&s.skipBits(1),s.skipBits(1),s.readBoolean()&&(t=s.readUnsignedExpGolomb(),n=s.readUnsignedExpGolomb(),a=s.readUnsignedExpGolomb(),o=s.readUnsignedExpGolomb()),s.readBoolean()&&s.readBoolean())switch(s.readUnsignedByte()){case 1:i=[1,1];break;case 2:i=[12,11];break;case 3:i=[10,11];break;case 4:i=[16,11];break;case 5:i=[40,33];break;case 6:i=[24,11];break;case 7:i=[20,11];break;case 8:i=[32,11];break;case 9:i=[80,33];break;case 10:i=[18,11];break;case 11:i=[15,11];break;case 12:i=[64,33];break;case 13:i=[160,99];break;case 14:i=[4,3];break;case 15:i=[3,2];break;case 16:i=[2,1];break;case 255:{i=[s.readUnsignedByte()<<8|s.readUnsignedByte(),s.readUnsignedByte()<<8|s.readUnsignedByte()];break}}return{profileIdc:u,levelIdc:f,profileCompatibility:c,width:(I+1)*16-t*2-n*2,height:(2-v)*(w+1)*16-a*2-o*2,sarRatio:i}}};var X=[33,16,5,32,164,27],ot=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252];function b(r){let e=[];for(let t=0;t<r;t++)e.push(0);return e}var st;function ut(){return st||(st={96e3:new Uint8Array([...X,227,64,...b(154),56]),88200:new Uint8Array([...X,231,...b(170),56]),64e3:new Uint8Array([...X,248,192,...b(240),56]),48e3:new Uint8Array([...X,255,192,...b(268),55,148,128,...b(54),112]),44100:new Uint8Array([...X,255,192,...b(268),55,163,128,...b(84),112]),32e3:new Uint8Array([...X,255,192,...b(268),55,234,...b(226),112]),24e3:new Uint8Array([...X,255,192,...b(268),55,255,128,...b(268),111,112,...b(126),224]),16e3:new Uint8Array([...X,255,192,...b(268),55,255,128,...b(268),111,255,...b(269),223,108,...b(195),1,192]),12e3:new Uint8Array([...ot,...b(268),3,127,248,...b(268),6,255,240,...b(268),13,255,224,...b(268),27,253,128,...b(259),56]),11025:new Uint8Array([...ot,...b(268),3,127,248,...b(268),6,255,240,...b(268),13,255,224,...b(268),27,255,192,...b(268),55,175,128,...b(108),112]),8e3:new Uint8Array([...ot,...b(268),3,121,16,...b(47),7])}),st}function pn(r){return r.reduce((e,t)=>e+t.data.byteLength,0)}function Vt(r,e,t,n){let a=0,o=0,i=0;if(!e.length)return;let s=Ot(r.baseMediaDecodeTime,r.samplerate),u=Math.ceil(9e4/(r.samplerate/1024));if(t&&n&&(a=s-Math.max(t,n),o=Math.floor(a/u),i=o*u),o<1||i>9e4/2)return;let c=ut()[r.samplerate]??e[0].data;for(let f=0;f<o;f++){let g=e[0];e.splice(0,0,{data:c,dts:g.dts-u,pts:g.pts-u})}return r.baseMediaDecodeTime-=Math.floor(Dt(i,r.samplerate)),i}function Ht(r,e,t){return e.minSegmentDts>=t?r:(e.minSegmentDts=1/0,r.filter(function(n){return n.dts>=t?(e.minSegmentDts=Math.min(e.minSegmentDts,n.dts),e.minSegmentPts=e.minSegmentDts,!0):!1}))}function Qt(r){let e=[];for(let t of r)e.push({size:t.data.byteLength,duration:1024});return e}function Yt(r){let e=0,t=new Uint8Array(pn(r));for(let n of r)t.set(n.data,e),e+=n.data.byteLength;return t}function Se(r,e){r.timelineStartInfo===void 0&&(r.timelineStartInfo={}),typeof e.pts=="number"&&(r.timelineStartInfo.pts===void 0&&(r.timelineStartInfo.pts=e.pts),r.minSegmentPts===void 0?r.minSegmentPts=e.pts:r.minSegmentPts=Math.min(r.minSegmentPts,e.pts),r.maxSegmentPts===void 0?r.maxSegmentPts=e.pts:r.maxSegmentPts=Math.max(r.maxSegmentPts,e.pts)),typeof e.dts=="number"&&(r.timelineStartInfo.dts===void 0&&(r.timelineStartInfo.dts=e.dts),r.minSegmentDts===void 0?r.minSegmentDts=e.dts:r.minSegmentDts=Math.min(r.minSegmentDts,e.dts),r.maxSegmentDts===void 0?r.maxSegmentDts=e.dts:r.maxSegmentDts=Math.max(r.maxSegmentDts,e.dts))}function se(r){r.minSegmentDts=void 0,r.maxSegmentDts=void 0,r.minSegmentPts=void 0,r.maxSegmentPts=void 0}function qe(r,e){let t=r.minSegmentDts;!e&&r.timelineStartInfo.dts!==void 0&&(t-=r.timelineStartInfo.dts);let n=r.timelineStartInfo.baseMediaDecodeTime;if(n!==void 0?n+=t:(n=t,r.timelineStartInfo.baseMediaDecodeTime=n),n=Math.max(0,n),r.type==="audio"){let a=r.samplerate/9e4;n*=a,n=Math.floor(n)}return n}var ve=class{constructor(e,t){this._aacFrames=[],this._sequenceNumber=t??0,this._trackInfo=e}pushAacFrame(e){Se(this._trackInfo,e),this._trackInfo.audioobjecttype=e.audioobjecttype,this._trackInfo.channelcount=e.channelcount,this._trackInfo.samplerate=e.samplerate,this._trackInfo.samplingfrequencyindex=e.samplingfrequencyindex,this._trackInfo.samplesize=e.samplesize,this._aacFrames.push(e)}generateBoxes(e){if(this._aacFrames.length===0)return null;let{keepOriginalTimestamps:t,earliestAllowedDts:n,videoBaseMediaDecodeTime:a,audioAppendStartTs:o}=e,i=Ht(this._aacFrames,this._trackInfo,n);this._trackInfo.baseMediaDecodeTime=qe(this._trackInfo,t),a!==void 0&&Vt(this._trackInfo,i,o,a),this._trackInfo.samples=Qt(i);let s=Fe(Yt(i));this._aacFrames=[];let u=ze(this._sequenceNumber,[this._trackInfo]),c=new Uint8Array(u.byteLength+s.byteLength);return this._sequenceNumber++,c.set(u),c.set(s,u.byteLength),se(this._trackInfo),{trackInfo:this._trackInfo,boxes:c}}cancel(){se(this._trackInfo),this._aacFrames=[]}};function Xt(r){let e=[],t=[];t.byteLength=0,t.nalCount=0,t.duration=0,e.byteLength=0;for(let n of r)n.nalUnitType===4?(e.length>0&&(e.duration=n.dts-e.dts,t.byteLength+=e.byteLength,t.nalCount+=e.length,t.duration+=e.duration,t.push(e)),e=[n],e.byteLength=n.data.byteLength,e.pts=n.pts,e.dts=n.dts):(n.nalUnitType===0&&(e.keyFrame=!0),e.duration=n.dts-e.dts,e.byteLength+=n.data.byteLength,e.push(n));return t.length>0&&(e.duration==null||e.duration<=0)&&(e.duration=t[t.length-1].duration),t.byteLength+=e.byteLength,t.nalCount+=e.length,t.duration+=e.duration,t.push(e),t}function $t(r){let e=[],t=[];e.byteLength=0,e.nalCount=0,e.duration=0,e.pts=r[0].pts,e.dts=r[0].dts,t.byteLength=0,t.nalCount=0,t.duration=0,t.pts=r[0].pts,t.dts=r[0].dts;for(let n of r)n.keyFrame!==!0?(e.length>0&&(t.push(e),t.byteLength+=e.byteLength,t.nalCount+=e.nalCount,t.duration+=e.duration),e=[n],e.nalCount=n.length,e.byteLength=n.byteLength,e.pts=n.pts,e.dts=n.dts,e.duration=n.duration):(e.duration+=n.duration,e.nalCount+=n.length,e.byteLength+=n.byteLength,e.push(n));return t.length>0&&e.duration<=0&&(e.duration=t[t.length-1].duration),t.byteLength+=e.byteLength,t.nalCount+=e.nalCount,t.duration+=e.duration,t.push(e),t}function Kt(r){if(r[0][0].keyFrame!==!0&&r.length>1){let e=r.shift();r.byteLength-=e.byteLength,r.nalCount-=e.nalCount,r[0][0].dts=e.dts,r[0][0].pts=e.pts,r[0][0].duration+=e.duration}return r}function gn(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}}function hn(r,e){let t=gn();return t.dataOffset=e,t.compositionTimeOffset=r.pts-r.dts,t.duration=r.duration,t.size=4*r.length,t.size+=r.byteLength,r.keyFrame===!0&&(t.flags.dependsOn=2,t.flags.isNonSyncSample=0),t}function Zt(r,e){let t=e??0,n=[];for(let a of r)for(let o of a){let i=hn(o,t);t+=i.size,n.push(i)}return n}function Jt(r){let e=0,t=r.byteLength,n=r.nalCount,a=t+4*n,o=new Uint8Array(a),i=new DataView(o.buffer);for(let s of r)for(let u of s)for(let c of u)i.setUint32(e,c.data.byteLength),e+=4,o.set(c.data,e),e+=c.data.byteLength;return o}function er(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}var ke=class{constructor(e,t){this._sequenceNumber=t.firstSequenceNumber??0,this._shouldAlignGopsAtEnd=t.alignGopsAtEnd===!0,this._keepOriginalTimestamps=t.keepOriginalTimestamps===!0,this._nalUnits=[],this._gopsToAlignWith=[],this._hasParsedTrackInfo=!1,this._pps=void 0,this._gopCache=[],this._trackInfo=e}pushNalUnit(e){Se(this._trackInfo,e),e.nalUnitType===2&&!this._hasParsedTrackInfo&&(this._trackInfo.sps=[e.data],this._trackInfo.width=e.config.width,this._trackInfo.height=e.config.height,this._trackInfo.profileIdc=e.config.profileIdc,this._trackInfo.levelIdc=e.config.levelIdc,this._trackInfo.profileCompatibility=e.config.profileCompatibility,this._trackInfo.sarRatio=e.config.sarRatio),e.nalUnitType===3&&this._pps===void 0&&(this._pps=e.data,this._trackInfo.pps=[e.data]),this._nalUnits.push(e)}generateBoxes(){for(;this._nalUnits.length>0&&this._nalUnits[0].nalUnitType!==4;)this._nalUnits.shift();if(this._nalUnits.length===0)return this.resetStream_(),null;let e=Xt(this._nalUnits),t=$t(e);if(!t[0][0].keyFrame){let s=this._getGopForFusion(this._nalUnits[0]);s!==null?(t.unshift(s),t.byteLength+=s.byteLength,t.nalCount+=s.nalCount,t.pts=s.pts,t.dts=s.dts,t.duration+=s.duration):t=Kt(t)}if(this._gopsToAlignWith.length){let s;if(this._shouldAlignGopsAtEnd?s=this._alignGopsAtEnd(t):s=this._alignGopsAtStart(t),s===null)return this._gopCache.unshift({gop:t.pop(),pps:this._trackInfo.pps,sps:this._trackInfo.sps}),this._gopCache.length=Math.min(6,this._gopCache.length),this._nalUnits=[],this.resetStream_(),null;se(this._trackInfo),t=s}Se(this._trackInfo,t),this._trackInfo.samples=Zt(t);let n=Fe(Jt(t));this._trackInfo.baseMediaDecodeTime=qe(this._trackInfo,this._keepOriginalTimestamps),this._gopCache.unshift({gop:t.pop(),pps:this._trackInfo.pps,sps:this._trackInfo.sps}),this._gopCache.length=Math.min(6,this._gopCache.length),this._nalUnits=[];let a=ze(this._sequenceNumber,[this._trackInfo]),o=new Uint8Array(a.byteLength+n.byteLength);this._sequenceNumber++,o.set(a),o.set(n,a.byteLength);let i={...this._trackInfo};return this.resetStream_(),{trackInfo:i,boxes:o}}cancel(){this.resetStream_(),this._nalUnits=[],this._gopCache.length=0,this._gopsToAlignWith.length=0}resetStream_(){se(this._trackInfo),this._hasParsedTrackInfo=!1,this._pps=void 0}_getGopForFusion(e){let a=1/0,o;return this._gopCache.forEach(i=>{let s=i.gop;if(!(this._trackInfo.pps!=null&&er(this._trackInfo.pps[0],i.pps[0]))||!(this._trackInfo.sps!=null&&er(this._trackInfo.sps[0],i.sps[0]))||s.dts<this._trackInfo.timelineStartInfo.dts)return;let u=e.dts-s.dts-s.duration;u>=-1e4&&u<=45e3&&(o===void 0||a>u)&&(o=i,a=u)}),o!==void 0?o.gop:null}_alignGopsAtStart(e){let t=e.byteLength,n=e.nalCount,a=e.duration,o=0,i=0;for(;o<this._gopsToAlignWith.length&&i<e.length;){let u=this._gopsToAlignWith[o],c=e[i];if(u.pts===c.pts)break;if(c.pts>u.pts){o++;continue}i++,t-=c.byteLength,n-=c.nalCount,a-=c.duration}if(i===0)return e;if(i===e.length)return null;let s=e.slice(i);return s.byteLength=t,s.duration=a,s.nalCount=n,s.pts=s[0].pts,s.dts=s[0].dts,s}_alignGopsAtEnd(e){let t=this._gopsToAlignWith.length-1,n=e.length-1,a=null,o=!1;for(;t>=0&&n>=0;){let c=this._gopsToAlignWith[t],f=e[n];if(c.pts===f.pts){o=!0;break}if(c.pts>f.pts){t--;continue}t===this._gopsToAlignWith.length-1&&(a=n),n--}if(!o&&a===null)return null;let i;if(o?i=n:i=a,i===0)return e;let s=e.slice(i),u=s.reduce((c,f)=>(c.byteLength+=f.byteLength,c.duration+=f.duration,c.nalCount+=f.nalCount,c),{byteLength:0,duration:0,nalCount:0});return s.byteLength=u.byteLength,s.duration=u.duration,s.nalCount=u.nalCount,s.pts=s[0].pts,s.dts=s[0].dts,s}alignGopsWith(e){this._gopsToAlignWith=e}};function tr(r,e){let t=0,n=0;for(;r.length-n>=3;){if(r[n]==="I".charCodeAt(0)&&r[n+1]==="D".charCodeAt(0)&&r[n+2]==="3".charCodeAt(0)){if(r.length-n<10||(t=tt(r,n),n+t>r.length))break;let o={type:"timed-metadata",data:r.subarray(n,n+t)};return n+=t,r.length-n>0?[o,r.subarray(n)]:[o,null]}else if((r[n]&255)===255&&(r[n+1]&240)===240){if(r.length-n<7||(t=Bt(r,n),n+t>r.length))break;let o={type:"audio",data:r.subarray(n,n+t),pts:e,dts:e};return n+=t,r.length-n>0?[o,r.subarray(n)]:[o,null]}n++}return r.length-n>0?[null,r.subarray(n)]:[null,null]}function Ge(r,e,t){if(r===null)return-1;let n=t;for(;n<r.length;n++)if(r[n]===e)return n;return-1}function Ve(r){let e=r.indexOf("\0");return e<0?r:r.substring(0,e)}var He={Iso88591:0,Utf16:1,Utf16be:2,Utf8:3};function rr(r,e,t){let n="";for(let a=e;a<t;a++)n+="%"+("00"+r[a].toString(16)).slice(-2);return n}function Te(r,e,t){return decodeURIComponent(rr(r,e,t))}function Ie(r,e,t){return unescape(rr(r,e,t))}function Pe(r){return r[0]<<21|r[1]<<14|r[2]<<7|r[3]}var Me={APIC(r){let e=1,t="-->";if(r.data[0]!==He.Utf8)return;let n=Ge(r.data,0,e);if(n<0)return;r.mimeType=Ie(r.data,e,n),e=n+1,r.pictureType=r.data[e],e++;let a=Ge(r.data,0,e);a<0||(r.description=Te(r.data,e,a),e=a+1,r.mimeType===t?r.url=Ie(r.data,e,r.data.length):r.pictureData=r.data.subarray(e,r.data.length))},"T*":function(r){r.data[0]===He.Utf8&&(r.value=Ve(Te(r.data,1,r.data.length)),r.values=r.value.split("\0"))},TXXX:function(r){if(r.data[0]!==He.Utf8)return;let e=Ge(r.data,0,1);e!==-1&&(r.description=Te(r.data,1,e),r.value=Ve(Te(r.data,e+1,r.data.length)),r.data=r.value)},"W*":function(r){r.url=Ve(Ie(r.data,0,r.data.length))},WXXX:function(r){if(r.data[0]!==He.Utf8)return;let e=Ge(r.data,0,1);e!==-1&&(r.description=Te(r.data,1,e),r.url=Ve(Ie(r.data,e+1,r.data.length)))},PRIV:function(r){let e;for(e=0;e<r.data.length;e++)if(r.data[e]===0){r.owner=Ie(r.data,0,e);break}r.privateData=r.data.subarray(e+1),r.data=r.privateData}};var _n=21,ue=class{constructor(e,t){this._onTimestamp=e,this._descriptor=t?.descriptor,this._tagSize=0,this._buffer=[],this._bufferSize=0,this.dispatchType=_n.toString(16),this._descriptor!==void 0&&this._descriptor.forEach(n=>{this.dispatchType+=("00"+n.toString(16)).slice(-2)})}parsePacket(e){if(e.dataAlignmentIndicator===!0&&(this._bufferSize=0,this._buffer.length=0),this._buffer.length===0&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))return p.warn("Transmuxer: Skipping unrecognized metadata packet"),null;if(this._buffer.push(e),this._bufferSize+=e.data.byteLength,this._buffer.length===1&&(this._tagSize=Pe(e.data.subarray(6,10)),this._tagSize+=10),this._bufferSize<this._tagSize)return null;let t={data:new Uint8Array(this._tagSize),frames:[],pts:this._buffer[0].pts,dts:this._buffer[0].dts};for(let o=0;o<this._tagSize;)t.data.set(this._buffer[0].data.subarray(0,this._tagSize-o),o),o+=this._buffer[0].data.byteLength,this._bufferSize-=this._buffer[0].data.byteLength,this._buffer.shift();let n=10;t.data[5]&64&&(n+=4,n+=Pe(t.data.subarray(10,14)),this._tagSize-=Pe(t.data.subarray(16,20)));let a;do{if(a=Pe(t.data.subarray(n+4,n+8)),a<1){p.warn("Transmuxer: ","Malformed ID3 frame encountered. Skipping remaining metadata parsing.");break}let o=String.fromCharCode(t.data[n],t.data[n+1],t.data[n+2],t.data[n+3]),i={id:o,data:t.data.subarray(n+10,n+a+10),key:o};if(Me[i.id]!==void 0?Me[i.id](i):i.id[0]==="T"?Me["T*"](i):i.id[0]==="W"&&Me["W*"](i),i.owner==="com.apple.streaming.transportStreamTimestamp"){let s=i.data,u=(s[3]&1)<<30|s[4]<<22|s[5]<<14|s[6]<<6|s[7]>>>2;u*=4,u+=s[7]&3,i.timeStamp=u,t.pts===void 0&&t.dts===void 0&&(t.pts=i.timeStamp,t.dts=i.timeStamp),this._onTimestamp!==null&&this._onTimestamp(i)}t.frames.push(i),n+=10,n+=a}while(n<this._tagSize);return t}reset(){this._tagSize=0,this._buffer=[],this._bufferSize=0}};function nr(r,e){let t=1,n=r;for(n>e&&(t=-1);Math.abs(e-n)>4294967296;)n+=t*8589934592;return n}var Z=class{constructor(){this._lastDts=null,this._referenceDts=null}correctTimestamps(e){e.dts!==void 0&&(this._referenceDts===null&&(this._referenceDts=e.dts),e.pts!==void 0&&(e.pts=nr(e.pts,this._referenceDts)),e.dts=nr(e.dts,this._referenceDts),this._lastDts=e.dts)}signalEndOfSegment(){this._referenceDts=this._lastDts}};var Ee=class{constructor(){this.packetsWaitingForPmt=[],this.programMapTable=null}parse(e){let t=4,n=!!(e[1]&64),a=e[1]&31;if(a<<=8,a|=e[2],(e[3]&48)>>>4>1&&(t+=e[t]+1),a===0){let o={type:"pat",pid:a,payloadUnitStartIndicator:n};return[this._parsePsi(e.subarray(t),o)]}else if(a===this.pmtPid){let o={type:"pmt",pid:a,payloadUnitStartIndicator:n},i=this._parsePsi(e.subarray(t),o);if(i===null)return[];let s=[i];for(;this.packetsWaitingForPmt.length;){let u=this.packetsWaitingForPmt.shift();u!==void 0&&s.push(this._processPes(u[0],u[1],u[2]))}return s}else return this.programMapTable===null?(this.packetsWaitingForPmt.push([e,t,{pid:a,payloadUnitStartIndicator:n}]),[]):[this._processPes(e,t,{pid:a,payloadUnitStartIndicator:n})]}reset(){this.packetsWaitingForPmt=[],this.programMapTable=null}_parsePsi(e,t){let n=0;return t.payloadUnitStartIndicator&&(n+=e[n]+1),t.type==="pat"?this._parsePat(e.subarray(n),t):this._parsePmt(e.subarray(n),t)}_parsePat(e,t){let n=Object.assign(t,{sectionNumber:e[7],lastSectionNumber:e[8],pmtPid:(e[10]&31)<<8|e[11]});return this.pmtPid=n.pmtPid,n}_parsePmt(e,t){if(!(e[5]&1))return null;this.programMapTable={video:null,audio:null,"timed-metadata":{}};let a=3+((e[1]&15)<<8|e[2])-4,i=12+((e[10]&15)<<8|e[11]);for(;i<a;){let s=e[i],u=(e[i+1]&31)<<8|e[i+2];s===27&&this.programMapTable.video===null?this.programMapTable.video=u:s===15&&this.programMapTable.audio===null?this.programMapTable.audio=u:s===21&&(this.programMapTable["timed-metadata"][u]=s),i+=((e[i+3]&15)<<8|e[i+4])+5}return Object.assign(t,{programMapTable:this.programMapTable})}_processPes(e,t,n){let a;return n.pid===this.programMapTable?.video?a=27:n.pid===this.programMapTable?.audio?a=15:a=this.programMapTable?.["timed-metadata"][n.pid],{pid:n.pid,payloadUnitStartIndicator:n.payloadUnitStartIndicator,streamType:a,type:"pes",data:e.subarray(t)}}};var we=class{constructor(){this._input=null,this._incompletePacketBuffer=new Uint8Array(188),this._bytesInIncompletePacketBuffer=0,this._startIndex=0,this._endIndex=188}feed(e){if(this._bytesInIncompletePacketBuffer>0){let t=new Uint8Array(e.byteLength+this._bytesInIncompletePacketBuffer);t.set(this._incompletePacketBuffer.subarray(0,this._bytesInIncompletePacketBuffer)),t.set(e,this._bytesInIncompletePacketBuffer),this._input=t,this._bytesInIncompletePacketBuffer=0}else this._input=e;this._startIndex=0,this._endIndex=188}readNextPacket(){if(this._input===null)return[null,!0];for(;this._endIndex<this._input.byteLength;){if(this._input[this._startIndex]===71&&this._input[this._endIndex]===71){let e=this._input.subarray(this._startIndex,this._endIndex);this._startIndex+=188,this._endIndex+=188;let t=this._startIndex>=this._input.byteLength;return[e,t]}this._startIndex++,this._endIndex++}return this._startIndex<this._input.byteLength&&(this._incompletePacketBuffer.set(this._input.subarray(this._startIndex),0),this._bytesInIncompletePacketBuffer=this._input.byteLength-this._startIndex),this._bytesInIncompletePacketBuffer===188&&this._incompletePacketBuffer[0]===71?(this._bytesInIncompletePacketBuffer=0,this._input=null,[this._incompletePacketBuffer,!0]):[null,!0]}reset(){this._input=null,this._bytesInIncompletePacketBuffer=0,this._startIndex=0,this._endIndex=188}};var Ae=class{constructor(e){this._options=e??{},this._baseMediaDecodeTime=e?.baseMediaDecodeTime??0,this._currentPipeline=null,this._videoTrack=null,this._audioTrack=null}transmuxSegment(e){let t=Ct(e);return t&&this._currentPipeline?.name!=="aac"?this._setupAacPipeline():!t&&this._currentPipeline?.name!=="ts"&&this._setupTsPipeline(),this._currentPipeline?.name==="aac"?this.pushAacSegment(e):this.pushTsSegment(e)}pushTsSegment(e){let t=this._currentPipeline;for((t===null||t.name!=="ts")&&(t=this._setupTsPipeline()),t.transportStreamSplitter.feed(e);;){let[n,a]=t.transportStreamSplitter.readNextPacket(),o=n===null?[]:t.transportPacketParser.parse(n);for(let i of o){let s=t.elementaryPacketParser.readNextPacket(i);s!==null&&this._onElementaryStreamTsPacket(s,t)}if(a){let i=t.elementaryPacketParser.flush();t.elementaryPacketParser.reset();for(let u of i)this._onElementaryStreamTsPacket(u,t);let s=t.h264NalUnitProducer.flush();return s!==null&&t.mp4VideoSegmentGenerator!==null&&t.mp4VideoSegmentGenerator.pushNalUnit(s),t.adtsParser.reset(),t.elementaryPacketParser.reset(),t.h264NalUnitProducer.reset(),t.metadataParser.reset(),t.timestampRolloverHandler.signalEndOfSegment(),t.transportPacketParser.reset(),t.transportStreamSplitter.reset(),this._buildSegment()}}}pushAacSegment(e){let t=this._currentPipeline;(t===null||t.name!=="aac")&&(t=this._setupAacPipeline());let n=()=>t===null||t.name!=="aac"?null:(t.adtsParser.reset(),t.audioTimestampRolloverHandler.signalEndOfSegment(),t.metadataParser.reset(),t.timedMetadataRolloverHandler.signalEndOfSegment(),this._buildSegment()),a=e;for(;;){if(a===null)return n();let[o,i]=tr(a,t.getAdtsTimestamp());if(a=i,o===null)return n();if(o.type==="timed-metadata"){t.timedMetadataRolloverHandler.correctTimestamps(o);let s=t.metadataParser.parsePacket(o);t.mp4SegmentConstructor.pushSegment(s)}else{t.audioTimestampRolloverHandler.correctTimestamps(o);let s=t.adtsParser.parsePacket(o);t.mp4AudioSegmentGenerator===null&&(this._audioTrack=this._audioTrack??{timelineStartInfo:{baseMediaDecodeTime:this._baseMediaDecodeTime},codec:"adts",type:"audio"},t.mp4AudioSegmentGenerator=new ve(this._audioTrack,this._options.firstSequenceNumber));for(let u of s)t.mp4AudioSegmentGenerator.pushAacFrame(u)}}}_setupTsPipeline(){let e=new Z,t=new ae,n=new ue(null),a=new oe(this._options.keepOriginalTimestamps===!0,n.dispatchType),o=new ye,i=new we,s=new xe,u=new Ee;return this._currentPipeline={name:"ts",timestampRolloverHandler:e,adtsParser:t,metadataParser:n,mp4SegmentConstructor:a,mp4AudioSegmentGenerator:null,mp4VideoSegmentGenerator:null,transportStreamSplitter:i,elementaryPacketParser:o,h264NalUnitProducer:s,transportPacketParser:u},this._currentPipeline}_setupAacPipeline(){let e=0,t=new Z,n=new Z,a=new ae,o=new ue(s=>{e=s.timeStamp}),i=new oe(this._options.keepOriginalTimestamps===!0,o.dispatchType);return this._currentPipeline={name:"aac",getAdtsTimestamp(){return e},audioTimestampRolloverHandler:t,timedMetadataRolloverHandler:n,adtsParser:a,metadataParser:o,mp4SegmentConstructor:i,mp4AudioSegmentGenerator:null},this._currentPipeline}_buildSegment(){let e=this._currentPipeline,t,n=0;if(e?.name==="ts"&&e.mp4VideoSegmentGenerator!==null){let a=e.mp4VideoSegmentGenerator.generateBoxes();if(a!==null){let{trackInfo:o}=a;if(t=o.baseMediaDecodeTime,this._options.keepOriginalTimestamps!==!0){let{timelineStartInfo:i}=o;this._audioTrack!==null&&(this._audioTrack.timelineStartInfo=i,i.dts!==void 0&&(n=i.dts-this._baseMediaDecodeTime))}e.mp4SegmentConstructor.pushSegment(a)}}if(e!==null&&e.mp4AudioSegmentGenerator!==null){let a=e.mp4AudioSegmentGenerator.generateBoxes({audioAppendStartTs:0,keepOriginalTimestamps:this._options.keepOriginalTimestamps===!0,earliestAllowedDts:n,videoBaseMediaDecodeTime:t});a!==null&&e.mp4SegmentConstructor.pushSegment(a)}if(e?.mp4SegmentConstructor!==void 0){let a=e.mp4SegmentConstructor.finishSegment();if(a===null)return null;let o=a.initSegment?.byteLength??0,i=new Uint8Array(o+(a.data?.length??0));return i.byteLength===0?null:(a.initSegment!==null&&i.set(a.initSegment,0),a.data!==null&&i.set(a.data,o),i)}return null}_onElementaryStreamTsPacket(e,t){if(e.type!=="metadata"){if(t.timestampRolloverHandler.correctTimestamps(e),e.type==="video"){let n=t.h264NalUnitProducer.pushPacket(e);if(t.mp4VideoSegmentGenerator!==null)for(let a of n)t.mp4VideoSegmentGenerator.pushNalUnit(a)}else if(e.type==="audio"){if(t.mp4AudioSegmentGenerator!==null){let n=t.adtsParser.parsePacket(e);for(let a of n)t.mp4AudioSegmentGenerator.pushAacFrame(a)}}else if(e.type==="timed-metadata"){let n=t.metadataParser.parsePacket(e);t.mp4SegmentConstructor.pushSegment(n)}}else{let n=e.tracks.length;for(;n--;)this._videoTrack===null&&e.tracks[n].type==="video"?(this._videoTrack=e.tracks[n],this._videoTrack.timelineStartInfo.baseMediaDecodeTime=this._baseMediaDecodeTime):this._audioTrack===null&&e.tracks[n].type==="audio"&&(this._audioTrack=e.tracks[n],this._audioTrack.timelineStartInfo.baseMediaDecodeTime=this._baseMediaDecodeTime);this._videoTrack!==null&&t.mp4VideoSegmentGenerator===null&&(t.mp4VideoSegmentGenerator=new ke(this._videoTrack,this._options)),this._audioTrack!==null&&t.mp4AudioSegmentGenerator===null&&(t.mp4AudioSegmentGenerator=new ve(this._audioTrack,this._options.firstSequenceNumber))}}};var ar=Ae;function J(r,e){return r instanceof Error?r.name+": "+r.message:e}var bn=/^[a-z]+\/mp2t;/i,yn=/^audio\/aac;/i;function xn(r){return bn.test(r)}function Sn(r){return yn.test(r)}function ct(r){return dt(r)?typeof MediaSource>"u"?Q.get(r)!==!0:!MediaSource.isTypeSupported(r):!1}function dt(r){return xn(r)||Sn(r)}function lt(r,e){if(!dt(r))return r;if(r.startsWith("audio/aac;"))return r.replace(/^audio\/aac;/i,"audio/mp4;");let t=r.replace(/mp2t/i,"mp4");e===F.Audio&&(t=t.replace(/video/i,"audio"));let n=/avc1\.(66|77|100)\.(\d+)/.exec(t);if(n){let a=n[1],o;a==="66"?o="4200":a==="77"?o="4d00":(a!=="100"&&p.error("Impossible regex catch"),o="6400");let i=Number(n[2]);i>=256&&p.error("Invalid legacy avc1 level number.");let s=(i>>4).toString(16)+(i&15).toString(16);t=`avc1.${o}${s}`}return t}function ft(){return new ar}var ht=typeof performance!="object"||performance===null||typeof performance.now!="function"?Date.now.bind(Date):performance.now.bind(performance),ir=Xe(),pt=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});function kn(r,e,t,n,a,o,i){let s=l.getContentInfo()?.contentId;if(s===void 0){p.error("Cannot send error, no contentId");return}m({type:r?"err":"warn",value:{contentId:s,errorInfo:{type:"segment-request",value:{url:e,isInit:t,start:n?.[0],duration:n?.[1],mediaType:a,reason:o,status:i}}}})}function Tn(r,e,t,n){let a=l.getContentInfo()?.contentId;if(a===void 0){p.error("Cannot send error, no contentId");return}m({type:r?"err":"warn",value:{contentId:a,errorInfo:{type:"multi-var-playlist-request",value:{url:e,reason:t,status:n}}}})}function In(r,e,t,n,a){let o=l.getContentInfo()?.contentId;if(o===void 0){p.error("Cannot send error, no contentId");return}m({type:r?"err":"warn",value:{contentId:o,errorInfo:{type:"media-playlist-request",value:{url:e,reason:t,mediaType:n,status:a}}}})}function Pn(r,e,t,n){let a=l.getContentInfo()?.contentId;if(a===void 0){p.error("Cannot send error, no contentId");return}m({type:r?"err":"warn",value:{contentId:a,message:n,errorInfo:{type:"push-segment-error",value:{code:e,mediaType:t}}}})}function Mn(r,e,t){let n=l.getContentInfo()?.contentId;if(n===void 0){p.error("Cannot send error, no contentId");return}m({type:r?"err":"warn",value:{contentId:n,message:t,errorInfo:{type:"remove-buffer-error",value:{mediaType:e}}}})}function En(r,e,t){let n=l.getContentInfo()?.contentId;if(n===void 0){p.error("Cannot send error, no contentId");return}m({type:r?"err":"warn",value:{contentId:n,message:t,errorInfo:{type:"other-error",value:{code:e}}}})}function wn(r,e,t){let n=l.getContentInfo()?.contentId;if(n===void 0){p.error("Cannot send error, no contentId");return}m({type:r?"err":"warn",value:{contentId:n,message:t,errorInfo:{type:"multi-var-playlist-parse",value:{code:e}}}})}function An(r,e,t,n){let a=l.getContentInfo()?.contentId;if(a===void 0){p.error("Cannot send error, no contentId");return}m({type:r?"err":"warn",value:{contentId:a,message:n,errorInfo:{type:"media-playlist-parse",value:{code:e,mediaType:t}}}})}function Un(r,e,t,n){let a=l.getContentInfo()?.contentId;if(a===void 0){p.error("Cannot send error, no contentId");return}m({type:r?"err":"warn",value:{contentId:a,message:n,errorInfo:{type:"sb-creation",value:{code:e,mediaType:t}}}})}function Cn(r,e,t,n){let a=l.getContentInfo()?.contentId;if(a===void 0){p.error("Cannot send error, no contentId");return}m({type:r?"err":"warn",value:{contentId:a,message:n,errorInfo:{type:"segment-parse",value:{code:e,mediaType:t}}}})}function Bn(r){return V.get(r)}function Rn(r,e){let t=ht().toFixed(2);switch(r){case _e.Error:p.error(t,e);break;case _e.Warn:p.warn(t,e);break;case _e.Info:p.info(t,e);break;case _e.Debug:p.debug(t,e);break}}function On(r,e){let t=self.setTimeout(()=>{let n=l.getDispatcher();n!==null&&n.on_timer_ended(t,e)},r);return t}function Dn(r){clearTimeout(r)}function Ln(r,e,t,n){let a=!1,o=new AbortController,i=H.create({abortController:o}),s=ht(),u;n>=0&&(u=setTimeout(()=>{a=!0,o.abort()},n));let c=[];return e!==void 0&&c.push(["Range",`bytes=${e}-${t??""}`]),fetch(r,{signal:o.signal,headers:c}).then(async f=>{u!==void 0&&clearTimeout(u);let g=l.getDispatcher();if(f.status>=300){g?.on_request_failed(i,!1,f.status);return}let I=await f.arrayBuffer(),w=ht()-s;if(H.delete(i),g!==null){let v=new Uint8Array(I),S=V.create(v);g.on_request_finished(i,S,v.byteLength,f.url,w)}}).catch(f=>{H.delete(i);let g=l.getDispatcher();if(a){g?.on_request_failed(i,!0,void 0);return}f instanceof Error&&f.name==="AbortError"||g?.on_request_failed(i,!1,void 0)}),i}function jn(r){let e=H.get(r);return e!==void 0?(e.abortController.abort(),Promise.resolve().then(()=>{H.delete(r)}),!0):!1}function Wn(r){let e=l.getContentInfo();if(e===null||e.mediaSourceObj===null){p.error("Attempting to seek when no MediaSource is created");return}m({type:"seek",value:{mediaSourceId:e.mediaSourceObj.mediaSourceId,position:r}})}function Nn(){let r=l.getContentInfo();if(r===null||r.mediaSourceObj===null){p.error("Attempting to flush when no MediaSource is created");return}m({type:"flush",value:{mediaSourceId:r.mediaSourceObj.mediaSourceId}})}function Fn(r){let e=l.getContentInfo();if(e===null||e.mediaSourceObj===null){p.error("Attempting to set playback rate when no MediaSource is created");return}m({type:"upd-pbr",value:{mediaSourceId:e.mediaSourceObj.mediaSourceId,playbackRate:r}})}function zn(){let r=l.getContentInfo();if(r===null)return D.error($e.NoContentLoaded);try{let a=function(){l.getDispatcher()?.on_media_source_state_change(be.Ended)},o=function(){l.getDispatcher()?.on_media_source_state_change(be.Open)},i=function(){l.getDispatcher()?.on_media_source_state_change(be.Closed)};var e=a,t=o,n=i;if(l.hasMseInWorker()!==!0){let s=ir();r.mediaSourceObj={nextSourceBufferId:0,sourceBuffers:[],type:"main",mediaSourceId:s},m({type:"create-ms",value:{contentId:r.contentId,mediaSourceId:s}})}else{let s=new MediaSource;s.addEventListener("sourceclose",i),s.addEventListener("sourceended",a),s.addEventListener("sourceopen",o);let u=()=>{s.removeEventListener("sourceclose",i),s.removeEventListener("sourceended",a),s.removeEventListener("sourceopen",o)},c=s.handle,f;c==null&&(f=URL.createObjectURL(s));let g=ir();r.mediaSourceObj={type:"worker",mediaSourceId:g,mediaSource:s,removeEventListeners:u,sourceBuffers:[],nextSourceBufferId:0},m({type:"attach-ms",value:{contentId:r.contentId,handle:c,src:f,mediaSourceId:g}},c!==void 0?[c]:[])}}catch{return D.error($e.UnknownError)}return D.success()}function qn(){let r=l.getContentInfo();if(r===null)return O.error(Be.NoMediaSourceAttached);if(r.mediaSourceObj===null)return O.error(Be.NoMediaSourceAttached);if(r.mediaSourceObj.type==="worker"){let{mediaSource:e,removeEventListeners:t}=r.mediaSourceObj;if(t(),e!==null&&e.readyState!=="closed"){let{readyState:n,sourceBuffers:a}=e;for(let o=a.length-1;o>=0;o--){let i=a[o];if(!i.updating)try{n==="open"&&i.abort(),e.removeSourceBuffer(i)}catch(s){let u=J(s,"Unknown error while removing SourceBuffer");return p.error("Could not remove SourceBuffer: "+u),O.error(Be.UnknownError,u)}}}}return m({type:"clear-ms",value:{mediaSourceId:r.mediaSourceObj.mediaSourceId}}),O.success()}function Gn(r){let e=l.getContentInfo();if(e===null)return C.error(Re.NoMediaSourceAttached);if(e.mediaSourceObj===null)return C.error(Re.NoMediaSourceAttached);if(e.mediaSourceObj.type==="worker")try{return e.mediaSourceObj.mediaSource.duration=r,C.success()}catch{return C.error(Re.UnknownError)}else return m({type:"upd-ms-dur",value:{mediaSourceId:e.mediaSourceObj.mediaSourceId,duration:r}}),C.success()}function Vn(r,e){let t=l.getContentInfo();if(t===null)return x.error(N.NoMediaSourceAttached);if(t.mediaSourceObj===null)return x.error(N.NoMediaSourceAttached);if(t.mediaSourceObj.type==="main"){let{sourceBuffers:n,nextSourceBufferId:a}=t.mediaSourceObj;try{let o=e;ct(e)&&(o=lt(e,r));let i=a;return n.push({lastInitTimescale:void 0,id:i,transmuxer:o===e?null:ft(),sourceBuffer:null,mediaType:r}),t.mediaSourceObj.nextSourceBufferId++,m({type:"creat-sb",value:{mediaSourceId:t.mediaSourceObj.mediaSourceId,sourceBufferId:i,contentType:o}}),x.success(i)}catch(o){let i=J(o,"Unknown error while creating Sourcebuffer");return x.error(N.UnknownError,i)}}else{let{mediaSource:n,sourceBuffers:a,nextSourceBufferId:o}=t.mediaSourceObj;if(n.readyState==="closed")return x.error(N.MediaSourceIsClosed);if(e==="")return x.error(N.EmptyMimeType);try{let i=e;ct(e)&&(i=lt(e,r));let s=n.addSourceBuffer(i),u=o,c=new le(s);return a.push({lastInitTimescale:void 0,id:u,sourceBuffer:c,transmuxer:i===e?null:ft(),mediaType:r}),t.mediaSourceObj.nextSourceBufferId++,x.success(u)}catch(i){let s=J(i,"Unknown error while creating Sourcebuffer");return i instanceof Error?i.name==="QuotaExceededError"?x.error(N.QuotaExceededError,s):i.name==="NotSupportedError"?x.error(N.TypeNotSupportedError,s):x.error(N.UnknownError,s):x.error(N.UnknownError,s)}}}function Hn(r,e,t){let n=V.get(e),a=Le();if(n===void 0)return E.error(K.NoResource,"Segment preparation error: No resource with the given `resourceId`");if(a===void 0)return E.error(K.NoSourceBuffer,"Segment preparation error: No MediaSource attached");let o=a.sourceBuffers.findIndex(({id:c})=>c===r);if(o<-1)return E.error(K.NoSourceBuffer,"Segment preparation error: No SourceBuffer with the given `SourceBufferId`");let i=a.sourceBuffers[o];if(i.transmuxer!==null)try{let c=i.transmuxer.transmuxSegment(n);if(c!==null)n=c;else return E.error(K.TransmuxerError,"Segment preparation error: the transmuxer couldn't process the segment")}catch(c){let f=J(c,"Unknown error while transmuxing segment");return E.error(K.TransmuxerError,f)}let s=Mt(n);s!==void 0?i.lastInitTimescale=s:s=i.lastInitTimescale;let u;t===!0&&s!==void 0&&(u=Zn(n,s));try{if(i.sourceBuffer!==null)i.sourceBuffer.push(n).then(()=>{try{let c=i.sourceBuffer.getBufferedRanges(),f=new k(ee(c));l.getDispatcher()?.on_source_buffer_update(r,f)}catch(c){let f=c instanceof Error?c:"Unknown Error";p.error("Error when calling `on_source_buffer_update`",f)}}).catch(c=>{try{c instanceof Error&&c.name==="QuotaExceededError"?l.getDispatcher()?.on_append_buffer_error(r,ne.BufferFull):l.getDispatcher()?.on_append_buffer_error(r,ne.UnknownError)}catch(f){let g=f instanceof Error?f:"Unknown Error";p.error("Error when calling `on_append_buffer_error`",g)}});else{let c=n.buffer;m({type:"push-sb",value:{mediaSourceId:a.mediaSourceId,sourceBufferId:r,data:c}},[c])}}catch{return E.error(K.UnknownError)}return E.success(u?.time,u?.duration)}function Qn(r,e,t){try{let n=Le();if(n===void 0)return R.error(Oe.SourceBufferNotFound,"No MediaSource created.");if(n.type==="worker"){let a=n.sourceBuffers.find(({id:o})=>o===r);if(a===void 0)return R.error(Oe.SourceBufferNotFound,"SourceBuffer linked to the given id not found.");a.sourceBuffer.removeBuffer(e,t).then(()=>{try{let o=a.sourceBuffer.getBufferedRanges(),i=new k(ee(o));l.getDispatcher()?.on_source_buffer_update(r,i)}catch(o){let i=o instanceof Error?o:"Unknown Error";p.error("Error when calling `on_source_buffer_update`",i)}}).catch(()=>{try{l.getDispatcher()?.on_remove_buffer_error(r)}catch(o){let i=o instanceof Error?o:"Unknown Error";p.error("Error when calling `on_remove_buffer_error`",i)}})}else m({type:"rem-sb",value:{mediaSourceId:n.mediaSourceId,sourceBufferId:r,start:e,end:t}})}catch(n){let a=J(n,"Unknown error while removing buffer");return R.error(Oe.UnknownError,a)}return R.success()}function Yn(){try{let r=Le();if(r===void 0)return L.error(Ke.NoMediaSourceAttached,"There's no MediaSource attached currently.");r.type==="worker"?r.mediaSource.endOfStream():m({type:"eos",value:{mediaSourceId:r.mediaSourceId}})}catch(r){let e=J(r,"Unknown error while calling endOfStream");return L.error(Ke.UnknownError,e)}return L.success()}function Xn(){let r=l.getContentInfo();if(r!==null){if(r.mediaSourceObj===null){p.error("Cannot start observing playback: No MediaSource Attached");return}m({type:"start-obs",value:{mediaSourceId:r.mediaSourceObj.mediaSourceId}})}}function _t(){let r=l.getContentInfo();r!==null&&r.mediaSourceObj!==null&&m({type:"stop-obs",value:{mediaSourceId:r.mediaSourceObj.mediaSourceId}})}function $n(r){let e=l.getContentInfo();e!==null&&m({type:"media-off-upd",value:{contentId:e.contentId,offset:r}})}function Kn(r){return V.get(r)===void 0?!1:(V.delete(r),!0)}function Zn(r,e){let t=It(r);if(t===void 0)return null;let n=Pt(r);return{time:t/e,duration:n===void 0?void 0:n/e}}function Jn(r,e,t){let n=l.getContentInfo();n!==null&&m({type:"content-upd",value:{contentId:n.contentId,minimumPosition:r,maximumPosition:e,playlistType:t}})}function ea(r,e){let t=l.getContentInfo(),n=l.getCurrentWasmMemory();if(t===null||n===null)return;let a=[];{let i=0;for(i++;i<r.length;){let s=r[i];i++;let u=r[i];i++;let c=r[i];i++;let f=r[i];i++;let g=r[i];i++,a.push({id:s,height:u===0?void 0:u,width:c===0?void 0:c,frameRate:f===0?void 0:f,bandwidth:g===0?void 0:g})}}let o=[];{let i=0;for(i++;i<e.length;){let s=e[i];i++;let u=e[i];i++;let c=new Uint8Array(n.buffer,e[i],u);i++;let f=pt.decode(c),g=e[i];i++;let I=new Uint8Array(n.buffer,e[i],g);i++;let w=pt.decode(I),v=e[i];i++;let S=new Uint8Array(n.buffer,e[i],v);i++;let A=pt.decode(S),P=e[i];i++,o.push({id:s,language:f===""?void 0:f,assocLanguage:w===""?void 0:w,name:A,channels:P})}}m({type:"m-playlist",value:{contentId:t.contentId,variants:a,audioTracks:o}})}function ta(r,e,t){let n=l.getContentInfo(),a=l.getCurrentWasmMemory();n===null||a===null||m({type:"track-upd",value:{mediaType:r,contentId:n.contentId,audioTrack:e?{current:e,isSelected:t}:void 0}})}function ra(r){let e=l.getContentInfo();e!==null&&m({type:"variant-upd",value:{contentId:e.contentId,variantId:r}})}function na(){let r=l.getContentInfo();if(r===null||r.mediaSourceObj===null){p.error("Attempting to start rebuffering when no MediaSource is created");return}m({type:"rebuf-start",value:{mediaSourceId:r.mediaSourceObj.mediaSourceId,updatePlaybackRate:!0}})}function aa(){let r=l.getContentInfo();if(r===null||r.mediaSourceObj===null){p.error("Attempting to stop rebuffering when no MediaSource is created");return}m({type:"rebuf-end",value:{mediaSourceId:r.mediaSourceObj.mediaSourceId}})}function ia(){return Math.random()}var mt=new Set,gt=!1;function oa(r,e){let t=[],n;switch(r){case F.Audio:n="audio/";break;case F.Video:n="video/";break;default:return p.error("Unknown MediaType"),!1}if(l.canDemuxMpeg2Ts()===!0&&t.push(`${n}mp2t;codecs="${e}"`),t.push(`${n}mp4;codecs="${e}"`),l.hasMseInWorker()===!0)return t.some(o=>MediaSource.isTypeSupported(o));let a=t.map(o=>Q.get(o)).filter(o=>o!==void 0);if(a.length>0)return a.some(o=>o);t.forEach(o=>mt.add(o)),!gt&&(gt=!0,Promise.resolve().then(()=>{gt=!1,m({type:"are-types-supp",value:{mimeTypes:Array.from(mt.keys())}}),mt.clear()}).catch(()=>{}))}function sa(r){let e=l.getContentInfo();e!==null&&m({type:"variant-lck-upd",value:{contentId:e.contentId,lockedVariant:r??null}})}var or=!1;function bt(){let r;onmessage=e;function e(t){if(t.origin!==""){p.error("Unexpected trans-origin message");return}let{data:n}=t;if(typeof n!="object"||n===null||typeof n.type>"u"){p.error("unexpected main message");return}if(n.type!=="init"&&n.type!=="dispose"&&r!==void 0){r.then(()=>{e(t)}).catch(B);return}switch(n.type){case"init":if(or)return sr("Worker initialization already done",0);p.setLevel(n.value.logLevel),or=!0;let{wasmUrl:a,hasMseInWorker:o,canDemuxMpeg2Ts:i,initialBandwidth:s}=n.value;r=ua(a,n.value.initialConfig,{hasMseInWorker:o,canDemuxMpeg2Ts:i,initialBandwidth:s}).then(()=>{r=void 0}).catch(u=>{r=void 0,sr(u,1)});break;case"dispose":ca();break;case"load":{let u=l.getDispatcher();if(u===null)return Qe(n.value.contentId);let c={contentId:n.value.contentId,mediaSourceObj:null,observationsObj:null};l.changeContent(c);let f;n.value.startingPosition!==void 0&&(f=new G(n.value.startingPosition.startingType,n.value.startingPosition.position)),u.load_content(n.value.url,f);break}case"stop":{let u=l.getDispatcher();if(u===null)return Qe(n.value.contentId);let c=l.getContentInfo();if(c===null||c.contentId!==n.value.contentId)return;try{u.stop()}catch(f){let g=f instanceof Error?f:"Unknown Error";p.error("Error: when stopping the content:",g)}m({type:"ctnt-stop",value:{contentId:n.value.contentId}});break}case"ms-state":{let u=l.getDispatcher(),c=l.getContentInfo();if(u===null||c===null||c.mediaSourceObj?.mediaSourceId!==n.value.mediaSourceId)return;u.on_media_source_state_change(n.value.state);break}case"sb-s":{let u=l.getDispatcher(),c=l.getContentInfo();if(u===null||c===null||c.mediaSourceObj?.mediaSourceId!==n.value.mediaSourceId)return;let f=new k(n.value.buffered);u.on_source_buffer_update(n.value.sourceBufferId,f);break}case"obs":{let u=l.getDispatcher(),c=l.getContentInfo();if(u===null||c===null||c.mediaSourceObj?.mediaSourceId!==n.value.mediaSourceId)return;let f,g;if(l.hasMseInWorker()===!0)for(let v of c.mediaSourceObj.sourceBuffers){let S=v.sourceBuffer?.getBufferedRanges();if(S!==void 0){let A=ee(S),P=new k(A);v.mediaType===F.Audio?f=P:v.mediaType===F.Video&&(g=P)}}else if(n.value.sourceBuffersBuffered!==null){let v=n.value.sourceBuffersBuffered;for(let S of c.mediaSourceObj.sourceBuffers){let A=v[S.id];if(A!==void 0){let P=new k(A);S.mediaType===F.Audio?f=P:S.mediaType===F.Video&&(g=P)}}}let I=new k(n.value.buffered),w=new q(n.value.reason,n.value.currentTime,n.value.readyState,I,n.value.paused,n.value.seeking,n.value.ended,n.value.duration,f,g);u.on_playback_tick(w);break}case"create-ms":{let u=l.getDispatcher(),c=l.getContentInfo();if(u===null||c===null||c.mediaSourceObj?.mediaSourceId!==n.value.mediaSourceId)return;u.stop(),m({type:"err",value:{contentId:c.contentId,message:"Error while creating the `MediaSource`: "+n.value.message,errorInfo:{type:"other-error",value:{code:vt.MediaSourceAttachmentError}}}});break}case"update-ms-dur-err":{let u=l.getDispatcher(),c=l.getContentInfo();if(u===null||c===null||c.mediaSourceObj?.mediaSourceId!==n.value.mediaSourceId)return;p.error("Error: when setting the MediaSource's duration");break}case"create-sb":{let u=l.getDispatcher(),c=l.getContentInfo();if(u===null||c===null||c.mediaSourceObj?.mediaSourceId!==n.value.mediaSourceId)return;u.on_source_buffer_creation_error(n.value.sourceBufferId,n.value.code,n.value.message);break}case"upd-speed":{let u=l.getDispatcher(),c=l.getContentInfo();if(u===null||c===null||c.mediaSourceObj?.mediaSourceId!==n.value.mediaSourceId)return;u.set_wanted_speed(n.value.wantedSpeed);break}case"upd-log":p.setLevel(n.value);break;case"upd-conf":{let u=l.getDispatcher();if(u===null)return;et(u,n.value);break}case"set-audio":{let u=l.getDispatcher();if(u===null)return Qe(n.value.contentId);let c=l.getContentInfo();if(c===null||c.contentId!==n.value.contentId)return;u.set_audio_track(n.value.trackId??void 0);break}case"lock-var":{let u=l.getDispatcher();if(u===null)return Qe(n.value.contentId);let c=l.getContentInfo();if(c===null||c.contentId!==n.value.contentId)return;n.value.variantId===null?u.unlock_variant():u.lock_variant(n.value.variantId);break}case"codecs-support-upd":{let{mimeTypes:u}=n.value,c=Object.keys(u);Q.size+c.length>50&&Q.clear();for(let g of c){let I=u[g];I!==void 0&&Q.set(g,I)}let f=l.getDispatcher();f!==null&&f.on_codecs_support_update()}break;case"sb-err":{let u=l.getDispatcher(),c=l.getContentInfo();if(u===null||c===null||c.mediaSourceObj?.mediaSourceId!==n.value.mediaSourceId)return;n.value.operation===1?u.on_remove_buffer_error(n.value.sourceBufferId):n.value.isBufferFull?u.on_append_buffer_error(n.value.sourceBufferId,ne.BufferFull):u.on_append_buffer_error(n.value.sourceBufferId,ne.UnknownError)}break;default:de(n)}}}function sr(r,e){let t;typeof r=="string"?t=r:r instanceof Error&&(t=r.message),m({type:"init-err",value:{code:e,message:t}})}function Qe(r){m({type:"err",value:{contentId:r,message:"Error: Worker not initialized.",errorInfo:{type:"unitialized",value:{}}}})}function ua(r,e,t){return Tt(fetch(r)).then(n=>{l.start(n,e,t),m({type:"init",value:null})}).catch(n=>{throw n})}function ca(){_t(),l.dispose()}Object.keys(Ue).forEach(r=>{let e=self;r==="doFetch"&&(e.jsFetch=Ue[r]);let t=r.charAt(0).toUpperCase()+r.slice(1);e[`js${t}`]=Ue[r]});bt();})();
