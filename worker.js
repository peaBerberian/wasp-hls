(()=>{var Ps=Object.create;var xr=Object.defineProperty;var Us=Object.getOwnPropertyDescriptor;var ks=Object.getOwnPropertyNames;var Fs=Object.getPrototypeOf,Ds=Object.prototype.hasOwnProperty;var ei=(d,a)=>()=>(a||d((a={exports:{}}).exports,a),a.exports),Os=(d,a)=>{for(var f in a)xr(d,f,{get:a[f],enumerable:!0})},Rs=(d,a,f,c)=>{if(a&&typeof a=="object"||typeof a=="function")for(let g of ks(a))!Ds.call(d,g)&&g!==f&&xr(d,g,{get:()=>a[g],enumerable:!(c=Us(a,g))||c.enumerable});return d};var Ls=(d,a,f)=>(f=d!=null?Ps(Fs(d)):{},Rs(a||!d||!d.__esModule?xr(f,"default",{value:d,enumerable:!0}):f,d));var hi=ei((Du,pi)=>{var ft;typeof window<"u"?ft=window:typeof global<"u"?ft=global:typeof self<"u"?ft=self:ft={};pi.exports=ft});var mi=ei((wr,Ir)=>{(function(d,a){typeof wr=="object"&&typeof Ir<"u"?Ir.exports=a(hi()):typeof define=="function"&&define.amd?define(["global/window"],a):(d=typeof globalThis<"u"?globalThis:d||self,d.muxjs=a(d.window))})(wr,function(d){"use strict";function a(o){return o&&typeof o=="object"&&"default"in o?o:{default:o}}var f=a(d),c=function(){this.init=function(){var e={};this.on=function(t,r){e[t]||(e[t]=[]),e[t]=e[t].concat(r)},this.off=function(t,r){var n;return e[t]?(n=e[t].indexOf(r),e[t]=e[t].slice(),e[t].splice(n,1),n>-1):!1},this.trigger=function(t){var r,n,i,s;if(r=e[t],!!r)if(arguments.length===2)for(i=r.length,n=0;n<i;++n)r[n].call(this,arguments[1]);else{for(s=[],n=arguments.length,n=1;n<arguments.length;++n)s.push(arguments[n]);for(i=r.length,n=0;n<i;++n)r[n].apply(this,s)}},this.dispose=function(){e={}}}};c.prototype.pipe=function(o){return this.on("data",function(e){o.push(e)}),this.on("done",function(e){o.flush(e)}),this.on("partialdone",function(e){o.partialFlush(e)}),this.on("endedtimeline",function(e){o.endTimeline(e)}),this.on("reset",function(e){o.reset(e)}),o},c.prototype.push=function(o){this.trigger("data",o)},c.prototype.flush=function(o){this.trigger("done",o)},c.prototype.partialFlush=function(o){this.trigger("partialdone",o)},c.prototype.endTimeline=function(o){this.trigger("endedtimeline",o)},c.prototype.reset=function(o){this.trigger("reset",o)};var g=c,y=9e4,b,M,w,I,P,D,J;b=function(e){return e*y},M=function(e,t){return e*t},w=function(e){return e/y},I=function(e,t){return e/t},P=function(e,t){return b(I(e,t))},D=function(e,t){return M(w(e),t)},J=function(e,t,r){return w(r?e:e-t)};var B={ONE_SECOND_IN_TS:y,secondsToVideoTs:b,secondsToAudioTs:M,videoTsToSeconds:w,audioTsToSeconds:I,audioTsToVideoTs:P,videoTsToAudioTs:D,metadataTsToSeconds:J},ee=B.ONE_SECOND_IN_TS,Y,ge=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];Y=function(e){var t,r=0;Y.prototype.init.call(this),this.skipWarn_=function(n,i){this.trigger("log",{level:"warn",message:"adts skiping bytes "+n+" to "+i+" in frame "+r+" outside syncword"})},this.push=function(n){var i=0,s,u,l,h,p;if(e||(r=0),n.type==="audio"){t&&t.length?(l=t,t=new Uint8Array(l.byteLength+n.data.byteLength),t.set(l),t.set(n.data,l.byteLength)):t=n.data;for(var m;i+7<t.length;){if(t[i]!==255||(t[i+1]&246)!==240){typeof m!="number"&&(m=i),i++;continue}if(typeof m=="number"&&(this.skipWarn_(m,i),m=null),u=(~t[i+1]&1)*2,s=(t[i+3]&3)<<11|t[i+4]<<3|(t[i+5]&224)>>5,h=((t[i+6]&3)+1)*1024,p=h*ee/ge[(t[i+2]&60)>>>2],t.byteLength-i<s)break;this.trigger("data",{pts:n.pts+r*p,dts:n.dts+r*p,sampleCount:h,audioobjecttype:(t[i+2]>>>6&3)+1,channelcount:(t[i+2]&1)<<2|(t[i+3]&192)>>>6,samplerate:ge[(t[i+2]&60)>>>2],samplingfrequencyindex:(t[i+2]&60)>>>2,samplesize:16,data:t.subarray(i+7+u,i+s)}),r++,i+=s}typeof m=="number"&&(this.skipWarn_(m,i),m=null),t=t.subarray(i)}},this.flush=function(){r=0,this.trigger("done")},this.reset=function(){t=void 0,this.trigger("reset")},this.endTimeline=function(){t=void 0,this.trigger("endedtimeline")}},Y.prototype=new g;var X=Y,Rr;Rr=function(e){var t=e.byteLength,r=0,n=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+n},this.loadWord=function(){var i=e.byteLength-t,s=new Uint8Array(4),u=Math.min(4,t);if(u===0)throw new Error("no bytes available");s.set(e.subarray(i,i+u)),r=new DataView(s.buffer).getUint32(0),n=u*8,t-=u},this.skipBits=function(i){var s;n>i?(r<<=i,n-=i):(i-=n,s=Math.floor(i/8),i-=s*8,t-=s,this.loadWord(),r<<=i,n-=i)},this.readBits=function(i){var s=Math.min(n,i),u=r>>>32-s;return n-=s,n>0?r<<=s:t>0&&this.loadWord(),s=i-s,s>0?u<<s|this.readBits(s):u},this.skipLeadingZeros=function(){var i;for(i=0;i<n;++i)if((r&2147483648>>>i)!==0)return r<<=i,n-=i,i;return this.loadWord(),i+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var i=this.skipLeadingZeros();return this.readBits(i+1)-1},this.readExpGolomb=function(){var i=this.readUnsignedExpGolomb();return 1&i?1+i>>>1:-1*(i>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var _i=Rr,lt,Ke,Lr;Ke=function(){var e=0,t,r;Ke.prototype.init.call(this),this.push=function(n){var i;r?(i=new Uint8Array(r.byteLength+n.data.byteLength),i.set(r),i.set(n.data,r.byteLength),r=i):r=n.data;for(var s=r.byteLength;e<s-3;e++)if(r[e+2]===1){t=e+5;break}for(;t<s;)switch(r[t]){case 0:if(r[t-1]!==0){t+=2;break}else if(r[t-2]!==0){t++;break}e+3!==t-2&&this.trigger("data",r.subarray(e+3,t-2));do t++;while(r[t]!==1&&t<s);e=t-2,t+=3;break;case 1:if(r[t-1]!==0||r[t-2]!==0){t+=3;break}this.trigger("data",r.subarray(e+3,t-2)),e=t-2,t+=3;break;default:t+=3;break}r=r.subarray(e),t-=e,e=0},this.reset=function(){r=null,e=0,this.trigger("reset")},this.flush=function(){r&&r.byteLength>3&&this.trigger("data",r.subarray(e+3)),r=null,e=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},Ke.prototype=new g,Lr={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},lt=function(){var e=new Ke,t,r,n,i,s,u,l;lt.prototype.init.call(this),t=this,this.push=function(h){h.type==="video"&&(r=h.trackId,n=h.pts,i=h.dts,e.push(h))},e.on("data",function(h){var p={trackId:r,pts:n,dts:i,data:h,nalUnitTypeCode:h[0]&31};switch(p.nalUnitTypeCode){case 5:p.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:p.nalUnitType="sei_rbsp",p.escapedRBSP=s(h.subarray(1));break;case 7:p.nalUnitType="seq_parameter_set_rbsp",p.escapedRBSP=s(h.subarray(1)),p.config=u(p.escapedRBSP);break;case 8:p.nalUnitType="pic_parameter_set_rbsp";break;case 9:p.nalUnitType="access_unit_delimiter_rbsp";break}t.trigger("data",p)}),e.on("done",function(){t.trigger("done")}),e.on("partialdone",function(){t.trigger("partialdone")}),e.on("reset",function(){t.trigger("reset")}),e.on("endedtimeline",function(){t.trigger("endedtimeline")}),this.flush=function(){e.flush()},this.partialFlush=function(){e.partialFlush()},this.reset=function(){e.reset()},this.endTimeline=function(){e.endTimeline()},l=function(p,m){var x=8,_=8,S,v;for(S=0;S<p;S++)_!==0&&(v=m.readExpGolomb(),_=(x+v+256)%256),x=_===0?x:_},s=function(p){for(var m=p.byteLength,x=[],_=1,S,v;_<m-2;)p[_]===0&&p[_+1]===0&&p[_+2]===3?(x.push(_+2),_+=2):_++;if(x.length===0)return p;S=m-x.length,v=new Uint8Array(S);var C=0;for(_=0;_<S;C++,_++)C===x[0]&&(C++,x.shift()),v[_]=p[C];return v},u=function(p){var m=0,x=0,_=0,S=0,v,C,W,q,Be,mr,Yn,Xn,Kn,gr,Zn,$=[1,1],Jn,Ne;if(v=new _i(p),C=v.readUnsignedByte(),q=v.readUnsignedByte(),W=v.readUnsignedByte(),v.skipUnsignedExpGolomb(),Lr[C]&&(Be=v.readUnsignedExpGolomb(),Be===3&&v.skipBits(1),v.skipUnsignedExpGolomb(),v.skipUnsignedExpGolomb(),v.skipBits(1),v.readBoolean()))for(Zn=Be!==3?8:12,Ne=0;Ne<Zn;Ne++)v.readBoolean()&&(Ne<6?l(16,v):l(64,v));if(v.skipUnsignedExpGolomb(),mr=v.readUnsignedExpGolomb(),mr===0)v.readUnsignedExpGolomb();else if(mr===1)for(v.skipBits(1),v.skipExpGolomb(),v.skipExpGolomb(),Yn=v.readUnsignedExpGolomb(),Ne=0;Ne<Yn;Ne++)v.skipExpGolomb();if(v.skipUnsignedExpGolomb(),v.skipBits(1),Xn=v.readUnsignedExpGolomb(),Kn=v.readUnsignedExpGolomb(),gr=v.readBits(1),gr===0&&v.skipBits(1),v.skipBits(1),v.readBoolean()&&(m=v.readUnsignedExpGolomb(),x=v.readUnsignedExpGolomb(),_=v.readUnsignedExpGolomb(),S=v.readUnsignedExpGolomb()),v.readBoolean()&&v.readBoolean()){switch(Jn=v.readUnsignedByte(),Jn){case 1:$=[1,1];break;case 2:$=[12,11];break;case 3:$=[10,11];break;case 4:$=[16,11];break;case 5:$=[40,33];break;case 6:$=[24,11];break;case 7:$=[20,11];break;case 8:$=[32,11];break;case 9:$=[80,33];break;case 10:$=[18,11];break;case 11:$=[15,11];break;case 12:$=[64,33];break;case 13:$=[160,99];break;case 14:$=[4,3];break;case 15:$=[3,2];break;case 16:$=[2,1];break;case 255:{$=[v.readUnsignedByte()<<8|v.readUnsignedByte(),v.readUnsignedByte()<<8|v.readUnsignedByte()];break}}$&&$[0]/$[1]}return{profileIdc:C,levelIdc:W,profileCompatibility:q,width:(Xn+1)*16-m*2-x*2,height:(2-gr)*(Kn+1)*16-_*2-S*2,sarRatio:$}}},lt.prototype=new g;var $t={H264Stream:lt,NalByteStream:Ke},Qt={Adts:X,h264:$t},Br=Math.pow(2,32),Si=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r;return t.getBigUint64?(r=t.getBigUint64(0),r<Number.MAX_SAFE_INTEGER?Number(r):r):t.getUint32(0)*Br+t.getUint32(4)},Ze={getUint64:Si,MAX_UINT32:Br},Nr=Ze.MAX_UINT32,F,Wr,jr,Yt,Vr,zr,Gr,qr,Xt,Hr,$r,Qr,Yr,Xr,Kr,Zr,Jr,en,tn,rn,nn,Kt,U,Zt,an,sn,on,un,dn,fn,cn,ln,pt,pn,hn,mn;(function(){var o;if(U={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(o in U)U.hasOwnProperty(o)&&(U[o]=[o.charCodeAt(0),o.charCodeAt(1),o.charCodeAt(2),o.charCodeAt(3)]);Zt=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),sn=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),an=new Uint8Array([0,0,0,1]),on=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),un=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),dn={video:on,audio:un},ln=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),cn=new Uint8Array([0,0,0,0,0,0,0,0]),pt=new Uint8Array([0,0,0,0,0,0,0,0]),pn=pt,hn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),mn=pt,fn=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),F=function(e){var t=[],r=0,n,i,s;for(n=1;n<arguments.length;n++)t.push(arguments[n]);for(n=t.length;n--;)r+=t[n].byteLength;for(i=new Uint8Array(r+8),s=new DataView(i.buffer,i.byteOffset,i.byteLength),s.setUint32(0,i.byteLength),i.set(e,4),n=0,r=8;n<t.length;n++)i.set(t[n],r),r+=t[n].byteLength;return i},Wr=function(){return F(U.dinf,F(U.dref,ln))},jr=function(e){return F(U.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},Yt=function(){return F(U.ftyp,Zt,an,Zt,sn)},Zr=function(e){return F(U.hdlr,dn[e])},Vr=function(e){return F(U.mdat,e)},Kr=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,e.duration&255,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=e.samplerate&255),F(U.mdhd,t)},Xr=function(e){return F(U.mdia,Kr(e),Zr(e.type),Gr(e))},zr=function(e){return F(U.mfhd,new Uint8Array([0,0,0,0,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255]))},Gr=function(e){return F(U.minf,e.type==="video"?F(U.vmhd,fn):F(U.smhd,cn),Wr(),en(e))},qr=function(e,t){for(var r=[],n=t.length;n--;)r[n]=rn(t[n]);return F.apply(null,[U.moof,zr(e)].concat(r))},Xt=function(e){for(var t=e.length,r=[];t--;)r[t]=Qr(e[t]);return F.apply(null,[U.moov,$r(4294967295)].concat(r).concat(Hr(e)))},Hr=function(e){for(var t=e.length,r=[];t--;)r[t]=nn(e[t]);return F.apply(null,[U.mvex].concat(r))},$r=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return F(U.mvhd,t)},Jr=function(e){var t=e.samples||[],r=new Uint8Array(4+t.length),n,i;for(i=0;i<t.length;i++)n=t[i].flags,r[i+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return F(U.sdtp,r)},en=function(e){return F(U.stbl,tn(e),F(U.stts,mn),F(U.stsc,pn),F(U.stsz,hn),F(U.stco,pt))},function(){var o,e;tn=function(r){return F(U.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),r.type==="video"?o(r):e(r))},o=function(r){var n=r.sps||[],i=r.pps||[],s=[],u=[],l,h;for(l=0;l<n.length;l++)s.push((n[l].byteLength&65280)>>>8),s.push(n[l].byteLength&255),s=s.concat(Array.prototype.slice.call(n[l]));for(l=0;l<i.length;l++)u.push((i[l].byteLength&65280)>>>8),u.push(i[l].byteLength&255),u=u.concat(Array.prototype.slice.call(i[l]));if(h=[U.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(r.width&65280)>>8,r.width&255,(r.height&65280)>>8,r.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),F(U.avcC,new Uint8Array([1,r.profileIdc,r.profileCompatibility,r.levelIdc,255].concat([n.length],s,[i.length],u))),F(U.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],r.sarRatio){var p=r.sarRatio[0],m=r.sarRatio[1];h.push(F(U.pasp,new Uint8Array([(p&4278190080)>>24,(p&16711680)>>16,(p&65280)>>8,p&255,(m&4278190080)>>24,(m&16711680)>>16,(m&65280)>>8,m&255])))}return F.apply(null,h)},e=function(r){return F(U.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(r.channelcount&65280)>>8,r.channelcount&255,(r.samplesize&65280)>>8,r.samplesize&255,0,0,0,0,(r.samplerate&65280)>>8,r.samplerate&255,0,0]),jr(r))}}(),Yr=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,0,(e.duration&4278190080)>>24,(e.duration&16711680)>>16,(e.duration&65280)>>8,e.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(e.width&65280)>>8,e.width&255,0,0,(e.height&65280)>>8,e.height&255,0,0]);return F(U.tkhd,t)},rn=function(e){var t,r,n,i,s,u,l;return t=F(U.tfhd,new Uint8Array([0,0,0,58,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),u=Math.floor(e.baseMediaDecodeTime/Nr),l=Math.floor(e.baseMediaDecodeTime%Nr),r=F(U.tfdt,new Uint8Array([1,0,0,0,u>>>24&255,u>>>16&255,u>>>8&255,u&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255])),s=32+20+8+16+8+8,e.type==="audio"?(n=Kt(e,s),F(U.traf,t,r,n)):(i=Jr(e),n=Kt(e,i.length+s),F(U.traf,t,r,n,i))},Qr=function(e){return e.duration=e.duration||4294967295,F(U.trak,Yr(e),Xr(e))},nn=function(e){var t=new Uint8Array([0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.type!=="video"&&(t[t.length-1]=0),F(U.trex,t)},function(){var o,e,t;t=function(n,i){var s=0,u=0,l=0,h=0;return n.length&&(n[0].duration!==void 0&&(s=1),n[0].size!==void 0&&(u=2),n[0].flags!==void 0&&(l=4),n[0].compositionTimeOffset!==void 0&&(h=8)),[0,0,s|u|l|h,1,(n.length&4278190080)>>>24,(n.length&16711680)>>>16,(n.length&65280)>>>8,n.length&255,(i&4278190080)>>>24,(i&16711680)>>>16,(i&65280)>>>8,i&255]},e=function(n,i){var s,u,l,h,p,m;for(h=n.samples||[],i+=8+12+16*h.length,l=t(h,i),u=new Uint8Array(l.length+h.length*16),u.set(l),s=l.length,m=0;m<h.length;m++)p=h[m],u[s++]=(p.duration&4278190080)>>>24,u[s++]=(p.duration&16711680)>>>16,u[s++]=(p.duration&65280)>>>8,u[s++]=p.duration&255,u[s++]=(p.size&4278190080)>>>24,u[s++]=(p.size&16711680)>>>16,u[s++]=(p.size&65280)>>>8,u[s++]=p.size&255,u[s++]=p.flags.isLeading<<2|p.flags.dependsOn,u[s++]=p.flags.isDependedOn<<6|p.flags.hasRedundancy<<4|p.flags.paddingValue<<1|p.flags.isNonSyncSample,u[s++]=p.flags.degradationPriority&240<<8,u[s++]=p.flags.degradationPriority&15,u[s++]=(p.compositionTimeOffset&4278190080)>>>24,u[s++]=(p.compositionTimeOffset&16711680)>>>16,u[s++]=(p.compositionTimeOffset&65280)>>>8,u[s++]=p.compositionTimeOffset&255;return F(U.trun,u)},o=function(n,i){var s,u,l,h,p,m;for(h=n.samples||[],i+=8+12+8*h.length,l=t(h,i),s=new Uint8Array(l.length+h.length*8),s.set(l),u=l.length,m=0;m<h.length;m++)p=h[m],s[u++]=(p.duration&4278190080)>>>24,s[u++]=(p.duration&16711680)>>>16,s[u++]=(p.duration&65280)>>>8,s[u++]=p.duration&255,s[u++]=(p.size&4278190080)>>>24,s[u++]=(p.size&16711680)>>>16,s[u++]=(p.size&65280)>>>8,s[u++]=p.size&255;return F(U.trun,s)},Kt=function(n,i){return n.type==="audio"?o(n,i):e(n,i)}}();var de={ftyp:Yt,mdat:Vr,moof:qr,moov:Xt,initSegment:function(e){var t=Yt(),r=Xt(e),n;return n=new Uint8Array(t.byteLength+r.byteLength),n.set(t),n.set(r,t.byteLength),n}},Ti=function(e){return e>>>0},wi=function(e){return("00"+e.toString(16)).slice(-2)},ht={toUnsigned:Ti,toHexString:wi},Ii=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3]),t},fe=Ii,Ei=ht.toUnsigned,Mi=function o(e,t){var r=[],n,i,s,u,l;if(!t.length)return null;for(n=0;n<e.byteLength;)i=Ei(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]),s=fe(e.subarray(n+4,n+8)),u=i>1?n+i:e.byteLength,s===t[0]&&(t.length===1?r.push(e.subarray(n+8,u)):(l=o(e.subarray(n+8,u),t.slice(1)),l.length&&(r=r.concat(l)))),n=u;return r},j=Mi,Ci=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4)},n=r.flags[2]&1,i=r.flags[2]&2,s=r.flags[2]&8,u=r.flags[2]&16,l=r.flags[2]&32,h=r.flags[0]&65536,p=r.flags[0]&131072,m;return m=8,n&&(m+=4,r.baseDataOffset=t.getUint32(12),m+=4),i&&(r.sampleDescriptionIndex=t.getUint32(m),m+=4),s&&(r.defaultSampleDuration=t.getUint32(m),m+=4),u&&(r.defaultSampleSize=t.getUint32(m),m+=4),l&&(r.defaultSampleFlags=t.getUint32(m)),h&&(r.durationIsEmpty=!0),!n&&p&&(r.baseDataOffsetIsMoof=!0),r},Jt=Ci,Ai=function(e){return{isLeading:(e[0]&12)>>>2,dependsOn:e[0]&3,isDependedOn:(e[1]&192)>>>6,hasRedundancy:(e[1]&48)>>>4,paddingValue:(e[1]&14)>>>1,isNonSyncSample:e[1]&1,degradationPriority:e[2]<<8|e[3]}},gn=Ai,Pi=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},r=new DataView(e.buffer,e.byteOffset,e.byteLength),n=t.flags[2]&1,i=t.flags[2]&4,s=t.flags[1]&1,u=t.flags[1]&2,l=t.flags[1]&4,h=t.flags[1]&8,p=r.getUint32(4),m=8,x;for(n&&(t.dataOffset=r.getInt32(m),m+=4),i&&p&&(x={flags:gn(e.subarray(m,m+4))},m+=4,s&&(x.duration=r.getUint32(m),m+=4),u&&(x.size=r.getUint32(m),m+=4),h&&(t.version===1?x.compositionTimeOffset=r.getInt32(m):x.compositionTimeOffset=r.getUint32(m),m+=4),t.samples.push(x),p--);p--;)x={},s&&(x.duration=r.getUint32(m),m+=4),u&&(x.size=r.getUint32(m),m+=4),l&&(x.flags=gn(e.subarray(m,m+4)),m+=4),h&&(t.version===1?x.compositionTimeOffset=r.getInt32(m):x.compositionTimeOffset=r.getUint32(m),m+=4),t.samples.push(x);return t},er=Pi,Ui=ht.toUnsigned,ki=Ze.getUint64,Fi=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4))};return t.version===1?t.baseMediaDecodeTime=ki(e.subarray(4)):t.baseMediaDecodeTime=Ui(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),t},tr=Fi,mt=ht.toUnsigned,Je=ht.toHexString,Di=Ze.getUint64,xn,yn,bn,vn,_n,rr;xn=function(e){var t={},r=j(e,["moov","trak"]);return r.reduce(function(n,i){var s,u,l,h,p;return s=j(i,["tkhd"])[0],!s||(u=s[0],l=u===0?12:20,h=mt(s[l]<<24|s[l+1]<<16|s[l+2]<<8|s[l+3]),p=j(i,["mdia","mdhd"])[0],!p)?null:(u=p[0],l=u===0?12:20,n[h]=mt(p[l]<<24|p[l+1]<<16|p[l+2]<<8|p[l+3]),n)},t)},yn=function(e,t){var r;r=j(t,["moof","traf"]);var n=r.reduce(function(i,s){var u=j(s,["tfhd"])[0],l=mt(u[4]<<24|u[5]<<16|u[6]<<8|u[7]),h=e[l]||9e4,p=j(s,["tfdt"])[0],m=new DataView(p.buffer,p.byteOffset,p.byteLength),x;p[0]===1?x=Di(p.subarray(4,12)):x=m.getUint32(4);var _;return typeof x=="bigint"?_=x/f.default.BigInt(h):typeof x=="number"&&!isNaN(x)&&(_=x/h),_<Number.MAX_SAFE_INTEGER&&(_=Number(_)),_<i&&(i=_),i},1/0);return typeof n=="bigint"||isFinite(n)?n:0},bn=function(e,t){var r=j(t,["moof","traf"]),n=0,i=0,s;if(r&&r.length){var u=j(r[0],["tfhd"])[0],l=j(r[0],["trun"])[0],h=j(r[0],["tfdt"])[0];if(u){var p=Jt(u);s=p.trackId}if(h){var m=tr(h);n=m.baseMediaDecodeTime}if(l){var x=er(l);x.samples&&x.samples.length&&(i=x.samples[0].compositionTimeOffset||0)}}var _=e[s]||9e4;typeof n=="bigint"&&(i=f.default.BigInt(i),_=f.default.BigInt(_));var S=(n+i)/_;return typeof S=="bigint"&&S<Number.MAX_SAFE_INTEGER&&(S=Number(S)),S},vn=function(e){var t=j(e,["moov","trak"]),r=[];return t.forEach(function(n){var i=j(n,["mdia","hdlr"]),s=j(n,["tkhd"]);i.forEach(function(u,l){var h=fe(u.subarray(8,12)),p=s[l],m,x,_;h==="vide"&&(m=new DataView(p.buffer,p.byteOffset,p.byteLength),x=m.getUint8(0),_=x===0?m.getUint32(12):m.getUint32(20),r.push(_))})}),r},rr=function(e){var t=e[0],r=t===0?12:20;return mt(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])},_n=function(e){var t=j(e,["moov","trak"]),r=[];return t.forEach(function(n){var i={},s=j(n,["tkhd"])[0],u,l;s&&(u=new DataView(s.buffer,s.byteOffset,s.byteLength),l=u.getUint8(0),i.id=l===0?u.getUint32(12):u.getUint32(20));var h=j(n,["mdia","hdlr"])[0];if(h){var p=fe(h.subarray(8,12));p==="vide"?i.type="video":p==="soun"?i.type="audio":i.type=p}var m=j(n,["mdia","minf","stbl","stsd"])[0];if(m){var x=m.subarray(8);i.codec=fe(x.subarray(4,8));var _=j(x,[i.codec])[0],S,v;_&&(/^[asm]vc[1-9]$/i.test(i.codec)?(S=_.subarray(78),v=fe(S.subarray(4,8)),v==="avcC"&&S.length>11?(i.codec+=".",i.codec+=Je(S[9]),i.codec+=Je(S[10]),i.codec+=Je(S[11])):i.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(i.codec)?(S=_.subarray(28),v=fe(S.subarray(4,8)),v==="esds"&&S.length>20&&S[19]!==0?(i.codec+="."+Je(S[19]),i.codec+="."+Je(S[20]>>>2&63).replace(/^0/,"")):i.codec="mp4a.40.2"):i.codec=i.codec.toLowerCase())}var C=j(n,["mdia","mdhd"])[0];C&&(i.timescale=rr(C)),r.push(i)}),r};var Oi={findBox:j,parseType:fe,timescale:xn,startTime:yn,compositionStartTime:bn,videoTrackIds:vn,tracks:_n,getTimescaleFromMediaHeader:rr},Ri=function(e){var t,r,n=[],i=[];for(i.byteLength=0,i.nalCount=0,i.duration=0,n.byteLength=0,t=0;t<e.length;t++)r=e[t],r.nalUnitType==="access_unit_delimiter_rbsp"?(n.length&&(n.duration=r.dts-n.dts,i.byteLength+=n.byteLength,i.nalCount+=n.length,i.duration+=n.duration,i.push(n)),n=[r],n.byteLength=r.data.byteLength,n.pts=r.pts,n.dts=r.dts):(r.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(n.keyFrame=!0),n.duration=r.dts-n.dts,n.byteLength+=r.data.byteLength,n.push(r));return i.length&&(!n.duration||n.duration<=0)&&(n.duration=i[i.length-1].duration),i.byteLength+=n.byteLength,i.nalCount+=n.length,i.duration+=n.duration,i.push(n),i},Li=function(e){var t,r,n=[],i=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=e[0].pts,n.dts=e[0].dts,i.byteLength=0,i.nalCount=0,i.duration=0,i.pts=e[0].pts,i.dts=e[0].dts,t=0;t<e.length;t++)r=e[t],r.keyFrame?(n.length&&(i.push(n),i.byteLength+=n.byteLength,i.nalCount+=n.nalCount,i.duration+=n.duration),n=[r],n.nalCount=r.length,n.byteLength=r.byteLength,n.pts=r.pts,n.dts=r.dts,n.duration=r.duration):(n.duration+=r.duration,n.nalCount+=r.length,n.byteLength+=r.byteLength,n.push(r));return i.length&&n.duration<=0&&(n.duration=i[i.length-1].duration),i.byteLength+=n.byteLength,i.nalCount+=n.nalCount,i.duration+=n.duration,i.push(n),i},Bi=function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},Ni=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},Sn=function(e,t){var r=Ni();return r.dataOffset=t,r.compositionTimeOffset=e.pts-e.dts,r.duration=e.duration,r.size=4*e.length,r.size+=e.byteLength,e.keyFrame&&(r.flags.dependsOn=2,r.flags.isNonSyncSample=0),r},Wi=function(e,t){var r,n,i,s,u,l=t||0,h=[];for(r=0;r<e.length;r++)for(s=e[r],n=0;n<s.length;n++)u=s[n],i=Sn(u,l),l+=i.size,h.push(i);return h},ji=function(e){var t,r,n,i,s,u,l=0,h=e.byteLength,p=e.nalCount,m=h+4*p,x=new Uint8Array(m),_=new DataView(x.buffer);for(t=0;t<e.length;t++)for(i=e[t],r=0;r<i.length;r++)for(s=i[r],n=0;n<s.length;n++)u=s[n],_.setUint32(l,u.data.byteLength),l+=4,x.set(u.data,l),l+=u.data.byteLength;return x},Vi=function(e,t){var r,n=t||0,i=[];return r=Sn(e,n),i.push(r),i},zi=function(e){var t,r,n=0,i=e.byteLength,s=e.length,u=i+4*s,l=new Uint8Array(u),h=new DataView(l.buffer);for(t=0;t<e.length;t++)r=e[t],h.setUint32(n,r.data.byteLength),n+=4,l.set(r.data,n),n+=r.data.byteLength;return l},be={groupNalsIntoFrames:Ri,groupFramesIntoGops:Li,extendFirstKeyFrame:Bi,generateSampleTable:Wi,concatenateNalData:ji,generateSampleTableForFrame:Vi,concatenateNalDataForFrame:zi},Me=[33,16,5,32,164,27],nr=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],R=function(e){for(var t=[];e--;)t.push(0);return t},Gi=function(e){return Object.keys(e).reduce(function(t,r){return t[r]=new Uint8Array(e[r].reduce(function(n,i){return n.concat(i)},[])),t},{})},ir,qi=function(){if(!ir){var e={96e3:[Me,[227,64],R(154),[56]],88200:[Me,[231],R(170),[56]],64e3:[Me,[248,192],R(240),[56]],48e3:[Me,[255,192],R(268),[55,148,128],R(54),[112]],44100:[Me,[255,192],R(268),[55,163,128],R(84),[112]],32e3:[Me,[255,192],R(268),[55,234],R(226),[112]],24e3:[Me,[255,192],R(268),[55,255,128],R(268),[111,112],R(126),[224]],16e3:[Me,[255,192],R(268),[55,255,128],R(268),[111,255],R(269),[223,108],R(195),[1,192]],12e3:[nr,R(268),[3,127,248],R(268),[6,255,240],R(268),[13,255,224],R(268),[27,253,128],R(259),[56]],11025:[nr,R(268),[3,127,248],R(268),[6,255,240],R(268),[13,255,224],R(268),[27,255,192],R(268),[55,175,128],R(108),[112]],8e3:[nr,R(268),[3,121,16],R(47),[7]]};ir=Gi(e)}return ir},Hi=function(e){var t,r,n=0;for(t=0;t<e.length;t++)r=e[t],n+=r.data.byteLength;return n},$i=function(e,t,r,n){var i,s=0,u=0,l=0,h=0,p,m,x;if(!!t.length&&(i=B.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),s=Math.ceil(B.ONE_SECOND_IN_TS/(e.samplerate/1024)),r&&n&&(u=i-Math.max(r,n),l=Math.floor(u/s),h=l*s),!(l<1||h>B.ONE_SECOND_IN_TS/2))){for(p=qi()[e.samplerate],p||(p=t[0].data),m=0;m<l;m++)x=t[0],t.splice(0,0,{data:p,dts:x.dts-s,pts:x.pts-s});return e.baseMediaDecodeTime-=Math.floor(B.videoTsToAudioTs(h,e.samplerate)),h}},Qi=function(e,t,r){return t.minSegmentDts>=r?e:(t.minSegmentDts=1/0,e.filter(function(n){return n.dts>=r?(t.minSegmentDts=Math.min(t.minSegmentDts,n.dts),t.minSegmentPts=t.minSegmentDts,!0):!1}))},Yi=function(e){var t,r,n=[];for(t=0;t<e.length;t++)r=e[t],n.push({size:r.data.byteLength,duration:1024});return n},Xi=function(e){var t,r,n=0,i=new Uint8Array(Hi(e));for(t=0;t<e.length;t++)r=e[t],i.set(r.data,n),n+=r.data.byteLength;return i},Ce={prefixWithSilence:$i,trimAdtsFramesByEarliestDts:Qi,generateSampleTable:Yi,concatenateFrameData:Xi},Ki=B.ONE_SECOND_IN_TS,Zi=function(e,t){typeof t.pts=="number"&&(e.timelineStartInfo.pts===void 0&&(e.timelineStartInfo.pts=t.pts),e.minSegmentPts===void 0?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),e.maxSegmentPts===void 0?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),typeof t.dts=="number"&&(e.timelineStartInfo.dts===void 0&&(e.timelineStartInfo.dts=t.dts),e.minSegmentDts===void 0?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),e.maxSegmentDts===void 0?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))},Ji=function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},ea=function(e,t){var r,n,i=e.minSegmentDts;return t||(i-=e.timelineStartInfo.dts),r=e.timelineStartInfo.baseMediaDecodeTime,r+=i,r=Math.max(0,r),e.type==="audio"&&(n=e.samplerate/Ki,r*=n,r=Math.floor(r)),r},H={clearDtsInfo:Ji,calculateTrackBaseMediaDecodeTime:ea,collectDtsInfo:Zi},Tn=4,ta=128,ra=function(e){for(var t=0,r={payloadType:-1,payloadSize:0},n=0,i=0;t<e.byteLength&&e[t]!==ta;){for(;e[t]===255;)n+=255,t++;for(n+=e[t++];e[t]===255;)i+=255,t++;if(i+=e[t++],!r.payload&&n===Tn){var s=String.fromCharCode(e[t+3],e[t+4],e[t+5],e[t+6]);if(s==="GA94"){r.payloadType=n,r.payloadSize=i,r.payload=e.subarray(t,t+i);break}else r.payload=void 0}t+=i,n=0,i=0}return r},na=function(e){return e.payload[0]!==181||(e.payload[1]<<8|e.payload[2])!==49||String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])!=="GA94"||e.payload[7]!==3?null:e.payload.subarray(8,e.payload.length-1)},ia=function(e,t){var r=[],n,i,s,u;if(!(t[0]&64))return r;for(i=t[0]&31,n=0;n<i;n++)s=n*3,u={type:t[s+2]&3,pts:e},t[s+2]&4&&(u.ccData=t[s+3]<<8|t[s+4],r.push(u));return r},aa=function(e){for(var t=e.byteLength,r=[],n=1,i,s;n<t-2;)e[n]===0&&e[n+1]===0&&e[n+2]===3?(r.push(n+2),n+=2):n++;if(r.length===0)return e;i=t-r.length,s=new Uint8Array(i);var u=0;for(n=0;n<i;u++,n++)u===r[0]&&(u++,r.shift()),s[n]=e[u];return s},et={parseSei:ra,parseUserData:na,parseCaptionPackets:ia,discardEmulationPreventionBytes:aa,USER_DATA_REGISTERED_ITU_T_T35:Tn},oe=function o(e){e=e||{},o.prototype.init.call(this),this.parse708captions_=typeof e.parse708captions=="boolean"?e.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new G(0,0),new G(0,1),new G(1,0),new G(1,1)],this.parse708captions_&&(this.cc708Stream_=new V({captionServices:e.captionServices})),this.reset(),this.ccStreams_.forEach(function(t){t.on("data",this.trigger.bind(this,"data")),t.on("partialdone",this.trigger.bind(this,"partialdone")),t.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};oe.prototype=new g,oe.prototype.push=function(o){var e,t,r;if(o.nalUnitType==="sei_rbsp"&&(e=et.parseSei(o.escapedRBSP),!!e.payload&&e.payloadType===et.USER_DATA_REGISTERED_ITU_T_T35&&(t=et.parseUserData(e),!!t))){if(o.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(o.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}r=et.parseCaptionPackets(o.pts,t),this.captionPackets_=this.captionPackets_.concat(r),this.latestDts_!==o.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=o.dts}},oe.prototype.flushCCStreams=function(o){this.ccStreams_.forEach(function(e){return o==="flush"?e.flush():e.partialFlush()},this)},oe.prototype.flushStream=function(o){if(!this.captionPackets_.length){this.flushCCStreams(o);return}this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2?this.dispatchCea608Packet(e):this.dispatchCea708Packet(e)},this),this.captionPackets_.length=0,this.flushCCStreams(o)},oe.prototype.flush=function(){return this.flushStream("flush")},oe.prototype.partialFlush=function(){return this.flushStream("partialFlush")},oe.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(o){o.reset()})},oe.prototype.dispatchCea608Packet=function(o){this.setsTextOrXDSActive(o)?this.activeCea608Channel_[o.type]=null:this.setsChannel1Active(o)?this.activeCea608Channel_[o.type]=0:this.setsChannel2Active(o)&&(this.activeCea608Channel_[o.type]=1),this.activeCea608Channel_[o.type]!==null&&this.ccStreams_[(o.type<<1)+this.activeCea608Channel_[o.type]].push(o)},oe.prototype.setsChannel1Active=function(o){return(o.ccData&30720)===4096},oe.prototype.setsChannel2Active=function(o){return(o.ccData&30720)===6144},oe.prototype.setsTextOrXDSActive=function(o){return(o.ccData&28928)===256||(o.ccData&30974)===4138||(o.ccData&30974)===6186},oe.prototype.dispatchCea708Packet=function(o){this.parse708captions_&&this.cc708Stream_.push(o)};var sa={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},oa=function(e){var t=sa[e]||e;return e&4096&&e===t?"":String.fromCharCode(t)},gt=function(e){return 32<=e&&e<=127||160<=e&&e<=255},Ee=function(e){this.windowNum=e,this.reset()};Ee.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},Ee.prototype.getText=function(){return this.rows.join(`
`)},Ee.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},Ee.prototype.newLine=function(o){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(o),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},Ee.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},Ee.prototype.addText=function(o){this.rows[this.rowIdx]+=o},Ee.prototype.backspace=function(){if(!this.isEmpty()){var o=this.rows[this.rowIdx];this.rows[this.rowIdx]=o.substr(0,o.length-1)}};var xt=function(e,t,r){this.serviceNum=e,this.text="",this.currentWindow=new Ee(-1),this.windows=[],this.stream=r,typeof t=="string"&&this.createTextDecoder(t)};xt.prototype.init=function(o,e){this.startPts=o;for(var t=0;t<8;t++)this.windows[t]=new Ee(t),typeof e=="function"&&(this.windows[t].beforeRowOverflow=e)},xt.prototype.setCurrentWindow=function(o){this.currentWindow=this.windows[o]},xt.prototype.createTextDecoder=function(o){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(o)}catch(e){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+o+" encoding. "+e})}};var V=function o(e){e=e||{},o.prototype.init.call(this);var t=this,r=e.captionServices||{},n={},i;Object.keys(r).forEach(function(s){i=r[s],/^SERVICE/.test(s)&&(n[s]=i.encoding)}),this.serviceEncodings=n,this.current708Packet=null,this.services={},this.push=function(s){s.type===3?(t.new708Packet(),t.add708Bytes(s)):(t.current708Packet===null&&t.new708Packet(),t.add708Bytes(s))}};V.prototype=new g,V.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},V.prototype.add708Bytes=function(o){var e=o.ccData,t=e>>>8,r=e&255;this.current708Packet.ptsVals.push(o.pts),this.current708Packet.data.push(t),this.current708Packet.data.push(r)},V.prototype.push708Packet=function(){var o=this.current708Packet,e=o.data,t=null,r=null,n=0,i=e[n++];for(o.seq=i>>6,o.sizeCode=i&63;n<e.length;n++)i=e[n++],t=i>>5,r=i&31,t===7&&r>0&&(i=e[n++],t=i),this.pushServiceBlock(t,n,r),r>0&&(n+=r-1)},V.prototype.pushServiceBlock=function(o,e,t){var r,n=e,i=this.current708Packet.data,s=this.services[o];for(s||(s=this.initService(o,n));n<e+t&&n<i.length;n++)r=i[n],gt(r)?n=this.handleText(n,s):r===24?n=this.multiByteCharacter(n,s):r===16?n=this.extendedCommands(n,s):128<=r&&r<=135?n=this.setCurrentWindow(n,s):152<=r&&r<=159?n=this.defineWindow(n,s):r===136?n=this.clearWindows(n,s):r===140?n=this.deleteWindows(n,s):r===137?n=this.displayWindows(n,s):r===138?n=this.hideWindows(n,s):r===139?n=this.toggleWindows(n,s):r===151?n=this.setWindowAttributes(n,s):r===144?n=this.setPenAttributes(n,s):r===145?n=this.setPenColor(n,s):r===146?n=this.setPenLocation(n,s):r===143?s=this.reset(n,s):r===8?s.currentWindow.backspace():r===12?s.currentWindow.clearText():r===13?s.currentWindow.pendingNewLine=!0:r===14?s.currentWindow.clearText():r===141&&n++},V.prototype.extendedCommands=function(o,e){var t=this.current708Packet.data,r=t[++o];return gt(r)&&(o=this.handleText(o,e,{isExtended:!0})),o},V.prototype.getPts=function(o){return this.current708Packet.ptsVals[Math.floor(o/2)]},V.prototype.initService=function(o,e){var r="SERVICE"+o,t=this,r,n;return r in this.serviceEncodings&&(n=this.serviceEncodings[r]),this.services[o]=new xt(o,n,t),this.services[o].init(this.getPts(e),function(i){t.flushDisplayed(i,t.services[o])}),this.services[o]},V.prototype.handleText=function(o,e,t){var r=t&&t.isExtended,n=t&&t.isMultiByte,i=this.current708Packet.data,s=r?4096:0,u=i[o],l=i[o+1],h=e.currentWindow,p,m;return e.textDecoder_&&!r?(n?(m=[u,l],o++):m=[u],p=e.textDecoder_.decode(new Uint8Array(m))):p=oa(s|u),h.pendingNewLine&&!h.isEmpty()&&h.newLine(this.getPts(o)),h.pendingNewLine=!1,h.addText(p),o},V.prototype.multiByteCharacter=function(o,e){var t=this.current708Packet.data,r=t[o+1],n=t[o+2];return gt(r)&&gt(n)&&(o=this.handleText(++o,e,{isMultiByte:!0})),o},V.prototype.setCurrentWindow=function(o,e){var t=this.current708Packet.data,r=t[o],n=r&7;return e.setCurrentWindow(n),o},V.prototype.defineWindow=function(o,e){var t=this.current708Packet.data,r=t[o],n=r&7;e.setCurrentWindow(n);var i=e.currentWindow;return r=t[++o],i.visible=(r&32)>>5,i.rowLock=(r&16)>>4,i.columnLock=(r&8)>>3,i.priority=r&7,r=t[++o],i.relativePositioning=(r&128)>>7,i.anchorVertical=r&127,r=t[++o],i.anchorHorizontal=r,r=t[++o],i.anchorPoint=(r&240)>>4,i.rowCount=r&15,r=t[++o],i.columnCount=r&63,r=t[++o],i.windowStyle=(r&56)>>3,i.penStyle=r&7,i.virtualRowCount=i.rowCount+1,o},V.prototype.setWindowAttributes=function(o,e){var t=this.current708Packet.data,r=t[o],n=e.currentWindow.winAttr;return r=t[++o],n.fillOpacity=(r&192)>>6,n.fillRed=(r&48)>>4,n.fillGreen=(r&12)>>2,n.fillBlue=r&3,r=t[++o],n.borderType=(r&192)>>6,n.borderRed=(r&48)>>4,n.borderGreen=(r&12)>>2,n.borderBlue=r&3,r=t[++o],n.borderType+=(r&128)>>5,n.wordWrap=(r&64)>>6,n.printDirection=(r&48)>>4,n.scrollDirection=(r&12)>>2,n.justify=r&3,r=t[++o],n.effectSpeed=(r&240)>>4,n.effectDirection=(r&12)>>2,n.displayEffect=r&3,o},V.prototype.flushDisplayed=function(o,e){for(var t=[],r=0;r<8;r++)e.windows[r].visible&&!e.windows[r].isEmpty()&&t.push(e.windows[r].getText());e.endPts=o,e.text=t.join(`

`),this.pushCaption(e),e.startPts=o},V.prototype.pushCaption=function(o){o.text!==""&&(this.trigger("data",{startPts:o.startPts,endPts:o.endPts,text:o.text,stream:"cc708_"+o.serviceNum}),o.text="",o.startPts=o.endPts)},V.prototype.displayWindows=function(o,e){var t=this.current708Packet.data,r=t[++o],n=this.getPts(o);this.flushDisplayed(n,e);for(var i=0;i<8;i++)r&1<<i&&(e.windows[i].visible=1);return o},V.prototype.hideWindows=function(o,e){var t=this.current708Packet.data,r=t[++o],n=this.getPts(o);this.flushDisplayed(n,e);for(var i=0;i<8;i++)r&1<<i&&(e.windows[i].visible=0);return o},V.prototype.toggleWindows=function(o,e){var t=this.current708Packet.data,r=t[++o],n=this.getPts(o);this.flushDisplayed(n,e);for(var i=0;i<8;i++)r&1<<i&&(e.windows[i].visible^=1);return o},V.prototype.clearWindows=function(o,e){var t=this.current708Packet.data,r=t[++o],n=this.getPts(o);this.flushDisplayed(n,e);for(var i=0;i<8;i++)r&1<<i&&e.windows[i].clearText();return o},V.prototype.deleteWindows=function(o,e){var t=this.current708Packet.data,r=t[++o],n=this.getPts(o);this.flushDisplayed(n,e);for(var i=0;i<8;i++)r&1<<i&&e.windows[i].reset();return o},V.prototype.setPenAttributes=function(o,e){var t=this.current708Packet.data,r=t[o],n=e.currentWindow.penAttr;return r=t[++o],n.textTag=(r&240)>>4,n.offset=(r&12)>>2,n.penSize=r&3,r=t[++o],n.italics=(r&128)>>7,n.underline=(r&64)>>6,n.edgeType=(r&56)>>3,n.fontStyle=r&7,o},V.prototype.setPenColor=function(o,e){var t=this.current708Packet.data,r=t[o],n=e.currentWindow.penColor;return r=t[++o],n.fgOpacity=(r&192)>>6,n.fgRed=(r&48)>>4,n.fgGreen=(r&12)>>2,n.fgBlue=r&3,r=t[++o],n.bgOpacity=(r&192)>>6,n.bgRed=(r&48)>>4,n.bgGreen=(r&12)>>2,n.bgBlue=r&3,r=t[++o],n.edgeRed=(r&48)>>4,n.edgeGreen=(r&12)>>2,n.edgeBlue=r&3,o},V.prototype.setPenLocation=function(o,e){var t=this.current708Packet.data,r=t[o],n=e.currentWindow.penLoc;return e.currentWindow.pendingNewLine=!0,r=t[++o],n.row=r&15,r=t[++o],n.column=r&63,o},V.prototype.reset=function(o,e){var t=this.getPts(o);return this.flushDisplayed(t,e),this.initService(e.serviceNum,o)};var ua={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},yt=function(e){return e===null?"":(e=ua[e]||e,String.fromCharCode(e))},bt=14,da=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Oe=function(){for(var e=[],t=bt+1;t--;)e.push("");return e},G=function o(e,t){o.prototype.init.call(this),this.field_=e||0,this.dataChannel_=t||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(r){var n,i,s,u,l;if(n=r.ccData&32639,n===this.lastControlCode_){this.lastControlCode_=null;return}if((n&61440)===4096?this.lastControlCode_=n:n!==this.PADDING_&&(this.lastControlCode_=null),s=n>>>8,u=n&255,n!==this.PADDING_)if(n===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(n===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(r.pts),this.flushDisplayed(r.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=r.pts;else if(n===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(r.pts);else if(n===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(r.pts);else if(n===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(r.pts);else if(n===this.CARRIAGE_RETURN_)this.clearFormatting(r.pts),this.flushDisplayed(r.pts),this.shiftRowsUp_(),this.startPts_=r.pts;else if(n===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(n===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(r.pts),this.displayed_=Oe();else if(n===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Oe();else if(n===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(r.pts),this.displayed_=Oe()),this.mode_="paintOn",this.startPts_=r.pts;else if(this.isSpecialCharacter(s,u))s=(s&3)<<8,l=yt(s|u),this[this.mode_](r.pts,l),this.column_++;else if(this.isExtCharacter(s,u))this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),s=(s&3)<<8,l=yt(s|u),this[this.mode_](r.pts,l),this.column_++;else if(this.isMidRowCode(s,u))this.clearFormatting(r.pts),this[this.mode_](r.pts," "),this.column_++,(u&14)===14&&this.addFormatting(r.pts,["i"]),(u&1)===1&&this.addFormatting(r.pts,["u"]);else if(this.isOffsetControlCode(s,u))this.column_+=u&3;else if(this.isPAC(s,u)){var h=da.indexOf(n&7968);this.mode_==="rollUp"&&(h-this.rollUpRows_+1<0&&(h=this.rollUpRows_-1),this.setRollUp(r.pts,h)),h!==this.row_&&(this.clearFormatting(r.pts),this.row_=h),u&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(r.pts,["u"]),(n&16)===16&&(this.column_=((n&14)>>1)*4),this.isColorPAC(u)&&(u&14)===14&&this.addFormatting(r.pts,["i"])}else this.isNormalChar(s)&&(u===0&&(u=null),l=yt(s),l+=yt(u),this[this.mode_](r.pts,l),this.column_+=l.length)}};G.prototype=new g,G.prototype.flushDisplayed=function(o){var e=this.displayed_.map(function(t,r){try{return t.trim()}catch{return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+r+"."}),""}},this).join(`
`).replace(/^\n+|\n+$/g,"");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:o,text:e,stream:this.name_})},G.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Oe(),this.nonDisplayed_=Oe(),this.lastControlCode_=null,this.column_=0,this.row_=bt,this.rollUpRows_=2,this.formatting_=[]},G.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},G.prototype.isSpecialCharacter=function(o,e){return o===this.EXT_&&e>=48&&e<=63},G.prototype.isExtCharacter=function(o,e){return(o===this.EXT_+1||o===this.EXT_+2)&&e>=32&&e<=63},G.prototype.isMidRowCode=function(o,e){return o===this.EXT_&&e>=32&&e<=47},G.prototype.isOffsetControlCode=function(o,e){return o===this.OFFSET_&&e>=33&&e<=35},G.prototype.isPAC=function(o,e){return o>=this.BASE_&&o<this.BASE_+8&&e>=64&&e<=127},G.prototype.isColorPAC=function(o){return o>=64&&o<=79||o>=96&&o<=127},G.prototype.isNormalChar=function(o){return o>=32&&o<=127},G.prototype.setRollUp=function(o,e){if(this.mode_!=="rollUp"&&(this.row_=bt,this.mode_="rollUp",this.flushDisplayed(o),this.nonDisplayed_=Oe(),this.displayed_=Oe()),e!==void 0&&e!==this.row_)for(var t=0;t<this.rollUpRows_;t++)this.displayed_[e-t]=this.displayed_[this.row_-t],this.displayed_[this.row_-t]="";e===void 0&&(e=this.row_),this.topRow_=e-this.rollUpRows_+1},G.prototype.addFormatting=function(o,e){this.formatting_=this.formatting_.concat(e);var t=e.reduce(function(r,n){return r+"<"+n+">"},"");this[this.mode_](o,t)},G.prototype.clearFormatting=function(o){if(!!this.formatting_.length){var e=this.formatting_.reverse().reduce(function(t,r){return t+"</"+r+">"},"");this.formatting_=[],this[this.mode_](o,e)}},G.prototype.popOn=function(o,e){var t=this.nonDisplayed_[this.row_];t+=e,this.nonDisplayed_[this.row_]=t},G.prototype.rollUp=function(o,e){var t=this.displayed_[this.row_];t+=e,this.displayed_[this.row_]=t},G.prototype.shiftRowsUp_=function(){var o;for(o=0;o<this.topRow_;o++)this.displayed_[o]="";for(o=this.row_+1;o<bt+1;o++)this.displayed_[o]="";for(o=this.topRow_;o<this.row_;o++)this.displayed_[o]=this.displayed_[o+1];this.displayed_[this.row_]=""},G.prototype.paintOn=function(o,e){var t=this.displayed_[this.row_];t+=e,this.displayed_[this.row_]=t};var vt={CaptionStream:oe,Cea608Stream:G,Cea708Stream:V},K={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},fa=8589934592,ca=4294967296,wn="shared",ar=function(e,t){var r=1;for(e>t&&(r=-1);Math.abs(t-e)>ca;)e+=r*fa;return e},In=function o(e){var t,r;o.prototype.init.call(this),this.type_=e||wn,this.push=function(n){this.type_!==wn&&n.type!==this.type_||(r===void 0&&(r=n.dts),n.dts=ar(n.dts,r),n.pts=ar(n.pts,r),t=n.dts,this.trigger("data",n))},this.flush=function(){r=t,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){r=void 0,t=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};In.prototype=new g;var En={TimestampRolloverStream:In,handleRollover:ar},Mn=function(e,t,r){var n,i="";for(n=t;n<r;n++)i+="%"+("00"+e[n].toString(16)).slice(-2);return i},_t=function(e,t,r){return decodeURIComponent(Mn(e,t,r))},la=function(e,t,r){return unescape(Mn(e,t,r))},St=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Cn={TXXX:function(e){var t;if(e.data[0]===3){for(t=1;t<e.data.length;t++)if(e.data[t]===0){e.description=_t(e.data,1,t),e.value=_t(e.data,t+1,e.data.length).replace(/\0*$/,"");break}e.data=e.value}},WXXX:function(e){var t;if(e.data[0]===3){for(t=1;t<e.data.length;t++)if(e.data[t]===0){e.description=_t(e.data,1,t),e.url=_t(e.data,t+1,e.data.length);break}}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(e.data[t]===0){e.owner=la(e.data,0,t);break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}},Tt;Tt=function(e){var t={descriptor:e&&e.descriptor},r=0,n=[],i=0,s;if(Tt.prototype.init.call(this),this.dispatchType=K.METADATA_STREAM_TYPE.toString(16),t.descriptor)for(s=0;s<t.descriptor.length;s++)this.dispatchType+=("00"+t.descriptor[s].toString(16)).slice(-2);this.push=function(u){var l,h,p,m,x,_;if(u.type==="timed-metadata"){if(u.dataAlignmentIndicator&&(i=0,n.length=0),n.length===0&&(u.data.length<10||u.data[0]!=="I".charCodeAt(0)||u.data[1]!=="D".charCodeAt(0)||u.data[2]!=="3".charCodeAt(0))){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(n.push(u),i+=u.data.byteLength,n.length===1&&(r=St(u.data.subarray(6,10)),r+=10),!(i<r)){for(l={data:new Uint8Array(r),frames:[],pts:n[0].pts,dts:n[0].dts},x=0;x<r;)l.data.set(n[0].data.subarray(0,r-x),x),x+=n[0].data.byteLength,i-=n[0].data.byteLength,n.shift();h=10,l.data[5]&64&&(h+=4,h+=St(l.data.subarray(10,14)),r-=St(l.data.subarray(16,20)));do{if(p=St(l.data.subarray(h+4,h+8)),p<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(_=String.fromCharCode(l.data[h],l.data[h+1],l.data[h+2],l.data[h+3]),m={id:_,data:l.data.subarray(h+10,h+p+10)},m.key=m.id,Cn[m.id]&&(Cn[m.id](m),m.owner==="com.apple.streaming.transportStreamTimestamp")){var S=m.data,v=(S[3]&1)<<30|S[4]<<22|S[5]<<14|S[6]<<6|S[7]>>>2;v*=4,v+=S[7]&3,m.timeStamp=v,l.pts===void 0&&l.dts===void 0&&(l.pts=m.timeStamp,l.dts=m.timeStamp),this.trigger("timestamp",m)}l.frames.push(m),h+=10,h+=p}while(h<r);this.trigger("data",l)}}}},Tt.prototype=new g;var pa=Tt,ha=En.TimestampRolloverStream,wt,tt,It,Ge=188,sr=71;wt=function(){var e=new Uint8Array(Ge),t=0;wt.prototype.init.call(this),this.push=function(r){var n=0,i=Ge,s;for(t?(s=new Uint8Array(r.byteLength+t),s.set(e.subarray(0,t)),s.set(r,t),t=0):s=r;i<s.byteLength;){if(s[n]===sr&&s[i]===sr){this.trigger("data",s.subarray(n,i)),n+=Ge,i+=Ge;continue}n++,i++}n<s.byteLength&&(e.set(s.subarray(n),0),t=s.byteLength-n)},this.flush=function(){t===Ge&&e[0]===sr&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}},wt.prototype=new g,tt=function(){var e,t,r,n;tt.prototype.init.call(this),n=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(s,u){var l=0;u.payloadUnitStartIndicator&&(l+=s[l]+1),u.type==="pat"?t(s.subarray(l),u):r(s.subarray(l),u)},t=function(s,u){u.section_number=s[7],u.last_section_number=s[8],n.pmtPid=(s[10]&31)<<8|s[11],u.pmtPid=n.pmtPid},r=function(s,u){var l,h,p,m;if(!!(s[5]&1)){for(n.programMapTable={video:null,audio:null,"timed-metadata":{}},l=(s[1]&15)<<8|s[2],h=3+l-4,p=(s[10]&15)<<8|s[11],m=12+p;m<h;){var x=s[m],_=(s[m+1]&31)<<8|s[m+2];x===K.H264_STREAM_TYPE&&n.programMapTable.video===null?n.programMapTable.video=_:x===K.ADTS_STREAM_TYPE&&n.programMapTable.audio===null?n.programMapTable.audio=_:x===K.METADATA_STREAM_TYPE&&(n.programMapTable["timed-metadata"][_]=x),m+=((s[m+3]&15)<<8|s[m+4])+5}u.programMapTable=n.programMapTable}},this.push=function(i){var s={},u=4;if(s.payloadUnitStartIndicator=!!(i[1]&64),s.pid=i[1]&31,s.pid<<=8,s.pid|=i[2],(i[3]&48)>>>4>1&&(u+=i[u]+1),s.pid===0)s.type="pat",e(i.subarray(u),s),this.trigger("data",s);else if(s.pid===this.pmtPid)for(s.type="pmt",e(i.subarray(u),s),this.trigger("data",s);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([i,u,s]):this.processPes_(i,u,s)},this.processPes_=function(i,s,u){u.pid===this.programMapTable.video?u.streamType=K.H264_STREAM_TYPE:u.pid===this.programMapTable.audio?u.streamType=K.ADTS_STREAM_TYPE:u.streamType=this.programMapTable["timed-metadata"][u.pid],u.type="pes",u.data=i.subarray(s),this.trigger("data",u)}},tt.prototype=new g,tt.STREAM_TYPES={h264:27,adts:15},It=function(){var e=this,t=!1,r={data:[],size:0},n={data:[],size:0},i={data:[],size:0},s,u=function(p,m){var x,_=p[0]<<16|p[1]<<8|p[2];m.data=new Uint8Array,_===1&&(m.packetLength=6+(p[4]<<8|p[5]),m.dataAlignmentIndicator=(p[6]&4)!==0,x=p[7],x&192&&(m.pts=(p[9]&14)<<27|(p[10]&255)<<20|(p[11]&254)<<12|(p[12]&255)<<5|(p[13]&254)>>>3,m.pts*=4,m.pts+=(p[13]&6)>>>1,m.dts=m.pts,x&64&&(m.dts=(p[14]&14)<<27|(p[15]&255)<<20|(p[16]&254)<<12|(p[17]&255)<<5|(p[18]&254)>>>3,m.dts*=4,m.dts+=(p[18]&6)>>>1)),m.data=p.subarray(9+p[8]))},l=function(p,m,x){var _=new Uint8Array(p.size),S={type:m},v=0,C=0,W=!1,q;if(!(!p.data.length||p.size<9)){for(S.trackId=p.data[0].pid,v=0;v<p.data.length;v++)q=p.data[v],_.set(q.data,C),C+=q.data.byteLength;u(_,S),W=m==="video"||S.packetLength<=p.size,(x||W)&&(p.size=0,p.data.length=0),W&&e.trigger("data",S)}};It.prototype.init.call(this),this.push=function(h){({pat:function(){},pes:function(){var m,x;switch(h.streamType){case K.H264_STREAM_TYPE:m=r,x="video";break;case K.ADTS_STREAM_TYPE:m=n,x="audio";break;case K.METADATA_STREAM_TYPE:m=i,x="timed-metadata";break;default:return}h.payloadUnitStartIndicator&&l(m,x,!0),m.data.push(h),m.size+=h.data.byteLength},pmt:function(){var m={type:"metadata",tracks:[]};s=h.programMapTable,s.video!==null&&m.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.video,codec:"avc",type:"video"}),s.audio!==null&&m.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.audio,codec:"adts",type:"audio"}),t=!0,e.trigger("data",m)}})[h.type]()},this.reset=function(){r.size=0,r.data.length=0,n.size=0,n.data.length=0,this.trigger("reset")},this.flushStreams_=function(){l(r,"video"),l(n,"audio"),l(i,"timed-metadata")},this.flush=function(){if(!t&&s){var h={type:"metadata",tracks:[]};s.video!==null&&h.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.video,codec:"avc",type:"video"}),s.audio!==null&&h.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.audio,codec:"adts",type:"audio"}),e.trigger("data",h)}t=!1,this.flushStreams_(),this.trigger("done")}},It.prototype=new g;var An={PAT_PID:0,MP2T_PACKET_LENGTH:Ge,TransportPacketStream:wt,TransportParseStream:tt,ElementaryStream:It,TimestampRolloverStream:ha,CaptionStream:vt.CaptionStream,Cea608Stream:vt.Cea608Stream,Cea708Stream:vt.Cea708Stream,MetadataStream:pa};for(var or in K)K.hasOwnProperty(or)&&(An[or]=K[or]);var N=An,ma=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Pn=function(e,t){var r=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],n=e[t+5],i=(n&16)>>4;return r=r>=0?r:0,i?r+20:r+10},ga=function o(e,t){return e.length-t<10||e[t]!=="I".charCodeAt(0)||e[t+1]!=="D".charCodeAt(0)||e[t+2]!=="3".charCodeAt(0)?t:(t+=Pn(e,t),o(e,t))},xa=function(e){var t=ga(e,0);return e.length>=t+2&&(e[t]&255)===255&&(e[t+1]&240)===240&&(e[t+1]&22)===16},Un=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},ya=function(e,t,r){var n,i="";for(n=t;n<r;n++)i+="%"+("00"+e[n].toString(16)).slice(-2);return i},ba=function(e,t,r){return unescape(ya(e,t,r))},va=function(e,t){var r=(e[t+5]&224)>>5,n=e[t+4]<<3,i=e[t+3]&3<<11;return i|n|r},_a=function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":e[t]&!0&&(e[t+1]&240)===240?"audio":null},Sa=function(e){for(var t=0;t+5<e.length;){if(e[t]!==255||(e[t+1]&246)!==240){t++;continue}return ma[(e[t+2]&60)>>>2]}return null},Ta=function(e){var t,r,n,i;t=10,e[5]&64&&(t+=4,t+=Un(e.subarray(10,14)));do{if(r=Un(e.subarray(t+4,t+8)),r<1)return null;if(i=String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3]),i==="PRIV"){n=e.subarray(t+10,t+r+10);for(var s=0;s<n.byteLength;s++)if(n[s]===0){var u=ba(n,0,s);if(u==="com.apple.streaming.transportStreamTimestamp"){var l=n.subarray(s+1),h=(l[3]&1)<<30|l[4]<<22|l[5]<<14|l[6]<<6|l[7]>>>2;return h*=4,h+=l[7]&3,h}break}}t+=10,t+=r}while(t<e.byteLength);return null},rt={isLikelyAacData:xa,parseId3TagSize:Pn,parseAdtsSize:va,parseType:_a,parseSampleRate:Sa,parseAacTimestamp:Ta},Et;Et=function(){var e=new Uint8Array,t=0;Et.prototype.init.call(this),this.setTimestamp=function(r){t=r},this.push=function(r){var n=0,i=0,s,u,l,h;for(e.length?(h=e.length,e=new Uint8Array(r.byteLength+h),e.set(e.subarray(0,h)),e.set(r,h)):e=r;e.length-i>=3;){if(e[i]==="I".charCodeAt(0)&&e[i+1]==="D".charCodeAt(0)&&e[i+2]==="3".charCodeAt(0)){if(e.length-i<10||(n=rt.parseId3TagSize(e,i),i+n>e.length))break;u={type:"timed-metadata",data:e.subarray(i,i+n)},this.trigger("data",u),i+=n;continue}else if((e[i]&255)===255&&(e[i+1]&240)===240){if(e.length-i<7||(n=rt.parseAdtsSize(e,i),i+n>e.length))break;l={type:"audio",data:e.subarray(i,i+n),pts:t,dts:t},this.trigger("data",l),i+=n;continue}i++}s=e.length-i,s>0?e=e.subarray(i):e=new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}},Et.prototype=new g;var kn=Et,wa=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Mt=wa,Ia=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Ct=Ia,Ea=$t.H264Stream,Ma=rt.isLikelyAacData,Ca=B.ONE_SECOND_IN_TS,nt,qe,At,Re,Aa=function(e,t){t.stream=e,this.trigger("log",t)},Fn=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;n++){var i=r[n];i==="headOfPipeline"||!t[i].on||t[i].on("log",Aa.bind(e,i))}},Dn=function(e,t){var r;if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},ur=function(e,t,r,n,i,s){var u=r-t,l=n-t,h=i-r;return{start:{dts:e,pts:e+u},end:{dts:e+l,pts:e+h},prependedContentDuration:s,baseMediaDecodeTime:e}};qe=function(e,t){var r=[],n,i=0,s=0,u=1/0;t=t||{},n=t.firstSequenceNumber||0,qe.prototype.init.call(this),this.push=function(l){H.collectDtsInfo(e,l),e&&Mt.forEach(function(h){e[h]=l[h]}),r.push(l)},this.setEarliestDts=function(l){i=l},this.setVideoBaseMediaDecodeTime=function(l){u=l},this.setAudioAppendStart=function(l){s=l},this.flush=function(){var l,h,p,m,x,_,S;if(r.length===0){this.trigger("done","AudioSegmentStream");return}l=Ce.trimAdtsFramesByEarliestDts(r,e,i),e.baseMediaDecodeTime=H.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),S=Ce.prefixWithSilence(e,l,s,u),e.samples=Ce.generateSampleTable(l),p=de.mdat(Ce.concatenateFrameData(l)),r=[],h=de.moof(n,[e]),m=new Uint8Array(h.byteLength+p.byteLength),n++,m.set(h),m.set(p,h.byteLength),H.clearDtsInfo(e),x=Math.ceil(Ca*1024/e.samplerate),l.length&&(_=l.length*x,this.trigger("segmentTimingInfo",ur(B.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),l[0].dts,l[0].pts,l[0].dts+_,l[0].pts+_,S||0)),this.trigger("timingInfo",{start:l[0].pts,end:l[0].pts+_})),this.trigger("data",{track:e,boxes:m}),this.trigger("done","AudioSegmentStream")},this.reset=function(){H.clearDtsInfo(e),r=[],this.trigger("reset")}},qe.prototype=new g,nt=function(e,t){var r,n=[],i=[],s,u;t=t||{},r=t.firstSequenceNumber||0,nt.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(l){H.collectDtsInfo(e,l),l.nalUnitType==="seq_parameter_set_rbsp"&&!s&&(s=l.config,e.sps=[l.data],Ct.forEach(function(h){e[h]=s[h]},this)),l.nalUnitType==="pic_parameter_set_rbsp"&&!u&&(u=l.data,e.pps=[l.data]),n.push(l)},this.flush=function(){for(var l,h,p,m,x,_,S=0,v,C;n.length&&n[0].nalUnitType!=="access_unit_delimiter_rbsp";)n.shift();if(n.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(l=be.groupNalsIntoFrames(n),p=be.groupFramesIntoGops(l),p[0][0].keyFrame||(h=this.getGopForFusion_(n[0],e),h?(S=h.duration,p.unshift(h),p.byteLength+=h.byteLength,p.nalCount+=h.nalCount,p.pts=h.pts,p.dts=h.dts,p.duration+=h.duration):p=be.extendFirstKeyFrame(p)),i.length){var W;if(t.alignGopsAtEnd?W=this.alignGopsAtEnd_(p):W=this.alignGopsAtStart_(p),!W){this.gopCache_.unshift({gop:p.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),n=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}H.clearDtsInfo(e),p=W}H.collectDtsInfo(e,p),e.samples=be.generateSampleTable(p),x=de.mdat(be.concatenateNalData(p)),e.baseMediaDecodeTime=H.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",p.map(function(q){return{pts:q.pts,dts:q.dts,byteLength:q.byteLength}})),v=p[0],C=p[p.length-1],this.trigger("segmentTimingInfo",ur(e.baseMediaDecodeTime,v.dts,v.pts,C.dts+C.duration,C.pts+C.duration,S)),this.trigger("timingInfo",{start:p[0].pts,end:p[p.length-1].pts+p[p.length-1].duration}),this.gopCache_.unshift({gop:p.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),n=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),m=de.moof(r,[e]),_=new Uint8Array(m.byteLength+x.byteLength),r++,_.set(m),_.set(x,m.byteLength),this.trigger("data",{track:e,boxes:_}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),n=[],this.gopCache_.length=0,i.length=0,this.trigger("reset")},this.resetStream_=function(){H.clearDtsInfo(e),s=void 0,u=void 0},this.getGopForFusion_=function(l){var h=45e3,p=1e4,m=1/0,x,_,S,v,C;for(C=0;C<this.gopCache_.length;C++)v=this.gopCache_[C],S=v.gop,!(!(e.pps&&Dn(e.pps[0],v.pps[0]))||!(e.sps&&Dn(e.sps[0],v.sps[0])))&&(S.dts<e.timelineStartInfo.dts||(x=l.dts-S.dts-S.duration,x>=-p&&x<=h&&(!_||m>x)&&(_=v,m=x)));return _?_.gop:null},this.alignGopsAtStart_=function(l){var h,p,m,x,_,S,v,C;for(_=l.byteLength,S=l.nalCount,v=l.duration,h=p=0;h<i.length&&p<l.length&&(m=i[h],x=l[p],m.pts!==x.pts);){if(x.pts>m.pts){h++;continue}p++,_-=x.byteLength,S-=x.nalCount,v-=x.duration}return p===0?l:p===l.length?null:(C=l.slice(p),C.byteLength=_,C.duration=v,C.nalCount=S,C.pts=C[0].pts,C.dts=C[0].dts,C)},this.alignGopsAtEnd_=function(l){var h,p,m,x,_,S;for(h=i.length-1,p=l.length-1,_=null,S=!1;h>=0&&p>=0;){if(m=i[h],x=l[p],m.pts===x.pts){S=!0;break}if(m.pts>x.pts){h--;continue}h===i.length-1&&(_=p),p--}if(!S&&_===null)return null;var v;if(S?v=p:v=_,v===0)return l;var C=l.slice(v),W=C.reduce(function(q,Be){return q.byteLength+=Be.byteLength,q.duration+=Be.duration,q.nalCount+=Be.nalCount,q},{byteLength:0,duration:0,nalCount:0});return C.byteLength=W.byteLength,C.duration=W.duration,C.nalCount=W.nalCount,C.pts=C[0].pts,C.dts=C[0].dts,C},this.alignGopsWith=function(l){i=l}},nt.prototype=new g,Re=function(e,t){this.numberOfTracks=0,this.metadataStream=t,e=e||{},typeof e.remux<"u"?this.remuxTracks=!!e.remux:this.remuxTracks=!0,typeof e.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=e.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,Re.prototype.init.call(this),this.push=function(r){if(r.text)return this.pendingCaptions.push(r);if(r.frames)return this.pendingMetadata.push(r);this.pendingTracks.push(r.track),this.pendingBytes+=r.boxes.byteLength,r.track.type==="video"&&(this.videoTrack=r.track,this.pendingBoxes.push(r.boxes)),r.track.type==="audio"&&(this.audioTrack=r.track,this.pendingBoxes.unshift(r.boxes))}},Re.prototype=new g,Re.prototype.flush=function(o){var e=0,t={captions:[],captionStreams:{},metadata:[],info:{}},r,n,i,s=0,u;if(this.pendingTracks.length<this.numberOfTracks){if(o!=="VideoSegmentStream"&&o!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(s=this.videoTrack.timelineStartInfo.pts,Ct.forEach(function(l){t.info[l]=this.videoTrack[l]},this)):this.audioTrack&&(s=this.audioTrack.timelineStartInfo.pts,Mt.forEach(function(l){t.info[l]=this.audioTrack[l]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?t.type=this.pendingTracks[0].type:t.type="combined",this.emittedTracks+=this.pendingTracks.length,i=de.initSegment(this.pendingTracks),t.initSegment=new Uint8Array(i.byteLength),t.initSegment.set(i),t.data=new Uint8Array(this.pendingBytes),u=0;u<this.pendingBoxes.length;u++)t.data.set(this.pendingBoxes[u],e),e+=this.pendingBoxes[u].byteLength;for(u=0;u<this.pendingCaptions.length;u++)r=this.pendingCaptions[u],r.startTime=B.metadataTsToSeconds(r.startPts,s,this.keepOriginalTimestamps),r.endTime=B.metadataTsToSeconds(r.endPts,s,this.keepOriginalTimestamps),t.captionStreams[r.stream]=!0,t.captions.push(r);for(u=0;u<this.pendingMetadata.length;u++)n=this.pendingMetadata[u],n.cueTime=B.metadataTsToSeconds(n.pts,s,this.keepOriginalTimestamps),t.metadata.push(n);for(t.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",t),u=0;u<t.captions.length;u++)r=t.captions[u],this.trigger("caption",r);for(u=0;u<t.metadata.length;u++)n=t.metadata[u],this.trigger("id3Frame",n)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},Re.prototype.setRemux=function(o){this.remuxTracks=o},At=function(e){var t=this,r=!0,n,i;At.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var s={};this.transmuxPipeline_=s,s.type="aac",s.metadataStream=new N.MetadataStream,s.aacStream=new kn,s.audioTimestampRolloverStream=new N.TimestampRolloverStream("audio"),s.timedMetadataTimestampRolloverStream=new N.TimestampRolloverStream("timed-metadata"),s.adtsStream=new X,s.coalesceStream=new Re(e,s.metadataStream),s.headOfPipeline=s.aacStream,s.aacStream.pipe(s.audioTimestampRolloverStream).pipe(s.adtsStream),s.aacStream.pipe(s.timedMetadataTimestampRolloverStream).pipe(s.metadataStream).pipe(s.coalesceStream),s.metadataStream.on("timestamp",function(u){s.aacStream.setTimestamp(u.timeStamp)}),s.aacStream.on("data",function(u){u.type!=="timed-metadata"&&u.type!=="audio"||s.audioSegmentStream||(i=i||{timelineStartInfo:{baseMediaDecodeTime:t.baseMediaDecodeTime},codec:"adts",type:"audio"},s.coalesceStream.numberOfTracks++,s.audioSegmentStream=new qe(i,e),s.audioSegmentStream.on("log",t.getLogTrigger_("audioSegmentStream")),s.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),s.adtsStream.pipe(s.audioSegmentStream).pipe(s.coalesceStream),t.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!n}))}),s.coalesceStream.on("data",this.trigger.bind(this,"data")),s.coalesceStream.on("done",this.trigger.bind(this,"done")),Fn(this,s)},this.setupTsPipeline=function(){var s={};this.transmuxPipeline_=s,s.type="ts",s.metadataStream=new N.MetadataStream,s.packetStream=new N.TransportPacketStream,s.parseStream=new N.TransportParseStream,s.elementaryStream=new N.ElementaryStream,s.timestampRolloverStream=new N.TimestampRolloverStream,s.adtsStream=new X,s.h264Stream=new Ea,s.captionStream=new N.CaptionStream(e),s.coalesceStream=new Re(e,s.metadataStream),s.headOfPipeline=s.packetStream,s.packetStream.pipe(s.parseStream).pipe(s.elementaryStream).pipe(s.timestampRolloverStream),s.timestampRolloverStream.pipe(s.h264Stream),s.timestampRolloverStream.pipe(s.adtsStream),s.timestampRolloverStream.pipe(s.metadataStream).pipe(s.coalesceStream),s.h264Stream.pipe(s.captionStream).pipe(s.coalesceStream),s.elementaryStream.on("data",function(u){var l;if(u.type==="metadata"){for(l=u.tracks.length;l--;)!n&&u.tracks[l].type==="video"?(n=u.tracks[l],n.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime):!i&&u.tracks[l].type==="audio"&&(i=u.tracks[l],i.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime);n&&!s.videoSegmentStream&&(s.coalesceStream.numberOfTracks++,s.videoSegmentStream=new nt(n,e),s.videoSegmentStream.on("log",t.getLogTrigger_("videoSegmentStream")),s.videoSegmentStream.on("timelineStartInfo",function(h){i&&!e.keepOriginalTimestamps&&(i.timelineStartInfo=h,s.audioSegmentStream.setEarliestDts(h.dts-t.baseMediaDecodeTime))}),s.videoSegmentStream.on("processedGopsInfo",t.trigger.bind(t,"gopInfo")),s.videoSegmentStream.on("segmentTimingInfo",t.trigger.bind(t,"videoSegmentTimingInfo")),s.videoSegmentStream.on("baseMediaDecodeTime",function(h){i&&s.audioSegmentStream.setVideoBaseMediaDecodeTime(h)}),s.videoSegmentStream.on("timingInfo",t.trigger.bind(t,"videoTimingInfo")),s.h264Stream.pipe(s.videoSegmentStream).pipe(s.coalesceStream)),i&&!s.audioSegmentStream&&(s.coalesceStream.numberOfTracks++,s.audioSegmentStream=new qe(i,e),s.audioSegmentStream.on("log",t.getLogTrigger_("audioSegmentStream")),s.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),s.audioSegmentStream.on("segmentTimingInfo",t.trigger.bind(t,"audioSegmentTimingInfo")),s.adtsStream.pipe(s.audioSegmentStream).pipe(s.coalesceStream)),t.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!n})}}),s.coalesceStream.on("data",this.trigger.bind(this,"data")),s.coalesceStream.on("id3Frame",function(u){u.dispatchType=s.metadataStream.dispatchType,t.trigger("id3Frame",u)}),s.coalesceStream.on("caption",this.trigger.bind(this,"caption")),s.coalesceStream.on("done",this.trigger.bind(this,"done")),Fn(this,s)},this.setBaseMediaDecodeTime=function(s){var u=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=s),i&&(i.timelineStartInfo.dts=void 0,i.timelineStartInfo.pts=void 0,H.clearDtsInfo(i),u.audioTimestampRolloverStream&&u.audioTimestampRolloverStream.discontinuity()),n&&(u.videoSegmentStream&&(u.videoSegmentStream.gopCache_=[]),n.timelineStartInfo.dts=void 0,n.timelineStartInfo.pts=void 0,H.clearDtsInfo(n),u.captionStream.reset()),u.timestampRolloverStream&&u.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(s){i&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(s)},this.setRemux=function(s){var u=this.transmuxPipeline_;e.remux=s,u&&u.coalesceStream&&u.coalesceStream.setRemux(s)},this.alignGopsWith=function(s){n&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(s)},this.getLogTrigger_=function(s){var u=this;return function(l){l.stream=s,u.trigger("log",l)}},this.push=function(s){if(r){var u=Ma(s);u&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!u&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),r=!1}this.transmuxPipeline_.headOfPipeline.push(s)},this.flush=function(){r=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},At.prototype=new g;var dr={Transmuxer:At,VideoSegmentStream:nt,AudioSegmentStream:qe,AUDIO_PROPERTIES:Mt,VIDEO_PROPERTIES:Ct,generateSegmentTimingInfo:ur},Pa=et.discardEmulationPreventionBytes,Ua=vt.CaptionStream,ka=function(e,t){for(var r=e,n=0;n<t.length;n++){var i=t[n];if(r<i.size)return i;r-=i.size}return null},Fa=function(e,t,r){var n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={logs:[],seiNals:[]},s,u,l,h;for(u=0;u+4<e.length;u+=l)if(l=n.getUint32(u),u+=4,!(l<=0))switch(e[u]&31){case 6:var p=e.subarray(u+1,u+1+l),m=ka(u,t);if(s={nalUnitType:"sei_rbsp",size:l,data:p,escapedRBSP:Pa(p),trackId:r},m)s.pts=m.pts,s.dts=m.dts,h=m;else if(h)s.pts=h.pts,s.dts=h.dts;else{i.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+u+" for trackId "+r+". See mux.js#223."});break}i.seiNals.push(s);break}return i},Da=function(e,t,r){var n=t,i=r.defaultSampleDuration||0,s=r.defaultSampleSize||0,u=r.trackId,l=[];return e.forEach(function(h){var p=er(h),m=p.samples;m.forEach(function(x){x.duration===void 0&&(x.duration=i),x.size===void 0&&(x.size=s),x.trackId=u,x.dts=n,x.compositionTimeOffset===void 0&&(x.compositionTimeOffset=0),typeof n=="bigint"?(x.pts=n+f.default.BigInt(x.compositionTimeOffset),n+=f.default.BigInt(x.duration)):(x.pts=n+x.compositionTimeOffset,n+=x.duration)}),l=l.concat(m)}),l},Oa=function(e,t){var r=j(e,["moof","traf"]),n=j(e,["mdat"]),i={},s=[];return n.forEach(function(u,l){var h=r[l];s.push({mdat:u,traf:h})}),s.forEach(function(u){var l=u.mdat,h=u.traf,p=j(h,["tfhd"]),m=Jt(p[0]),x=m.trackId,_=j(h,["tfdt"]),S=_.length>0?tr(_[0]).baseMediaDecodeTime:0,v=j(h,["trun"]),C,W;t===x&&v.length>0&&(C=Da(v,S,m),W=Fa(l,C,x),i[x]||(i[x]={seiNals:[],logs:[]}),i[x].seiNals=i[x].seiNals.concat(W.seiNals),i[x].logs=i[x].logs.concat(W.logs))}),i},Ra=function(e,t,r){var n;if(t===null)return null;n=Oa(e,t);var i=n[t]||{};return{seiNals:i.seiNals,logs:i.logs,timescale:r}},La=function(){var e=!1,t,r,n,i,s,u;this.isInitialized=function(){return e},this.init=function(l){t=new Ua,e=!0,u=l?l.isPartial:!1,t.on("data",function(h){h.startTime=h.startPts/i,h.endTime=h.endPts/i,s.captions.push(h),s.captionStreams[h.stream]=!0}),t.on("log",function(h){s.logs.push(h)})},this.isNewInit=function(l,h){return l&&l.length===0||h&&typeof h=="object"&&Object.keys(h).length===0?!1:n!==l[0]||i!==h[n]},this.parse=function(l,h,p){var m;if(this.isInitialized()){if(!h||!p)return null;if(this.isNewInit(h,p))n=h[0],i=p[n];else if(n===null||!i)return r.push(l),null}else return null;for(;r.length>0;){var x=r.shift();this.parse(x,h,p)}return m=Ra(l,n,i),m&&m.logs&&(s.logs=s.logs.concat(m.logs)),m===null||!m.seiNals?s.logs.length?{logs:s.logs,captions:[],captionStreams:[]}:null:(this.pushNals(m.seiNals),this.flushStream(),s)},this.pushNals=function(l){if(!this.isInitialized()||!l||l.length===0)return null;l.forEach(function(h){t.push(h)})},this.flushStream=function(){if(!this.isInitialized())return null;u?t.partialFlush():t.flush()},this.clearParsedCaptions=function(){s.captions=[],s.captionStreams={},s.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;t.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){r=[],n=null,i=null,s?this.clearParsedCaptions():s={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},Ba=La,Na={generator:de,probe:Oi,Transmuxer:dr.Transmuxer,AudioSegmentStream:dr.AudioSegmentStream,VideoSegmentStream:dr.VideoSegmentStream,CaptionParser:Ba},O;O=function(e,t){var r=0,n=16384,i=function(m,x){var _,S=m.position+x;S<m.bytes.byteLength||(_=new Uint8Array(S*2),_.set(m.bytes.subarray(0,m.position),0),m.bytes=_,m.view=new DataView(m.bytes.buffer))},s=O.widthBytes||new Uint8Array(5),u=O.heightBytes||new Uint8Array(6),l=O.videocodecidBytes||new Uint8Array(12),h;if(!O.widthBytes){for(h=0;h<5;h++)s[h]="width".charCodeAt(h);for(h=0;h<6;h++)u[h]="height".charCodeAt(h);for(h=0;h<12;h++)l[h]="videocodecid".charCodeAt(h);O.widthBytes=s,O.heightBytes=u,O.videocodecidBytes=l}switch(this.keyFrame=!1,e){case O.VIDEO_TAG:this.length=16,n*=6;break;case O.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case O.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(n),this.view=new DataView(this.bytes.buffer),this.bytes[0]=e,this.position=this.length,this.keyFrame=t,this.pts=0,this.dts=0,this.writeBytes=function(p,m,x){var _=m||0,S;x=x||p.byteLength,S=_+x,i(this,x),this.bytes.set(p.subarray(_,S),this.position),this.position+=x,this.length=Math.max(this.length,this.position)},this.writeByte=function(p){i(this,1),this.bytes[this.position]=p,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(p){i(this,2),this.view.setUint16(this.position,p),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(p){return this.bytes[this.length-p]},this.nalUnitSize=function(){return r===0?0:this.length-(r+4)},this.startNalUnit=function(){if(r>0)throw new Error("Attempted to create new NAL wihout closing the old one");r=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(p){var m,x;this.length===r+4?this.length-=4:r>0&&(m=r+4,x=this.length-m,this.position=r,this.view.setUint32(this.position,x),this.position=this.length,p&&p.push(this.bytes.subarray(m,m+x))),r=0},this.writeMetaDataDouble=function(p,m){var x;if(i(this,2+p.length+9),this.view.setUint16(this.position,p.length),this.position+=2,p==="width")this.bytes.set(s,this.position),this.position+=5;else if(p==="height")this.bytes.set(u,this.position),this.position+=6;else if(p==="videocodecid")this.bytes.set(l,this.position),this.position+=12;else for(x=0;x<p.length;x++)this.bytes[this.position]=p.charCodeAt(x),this.position++;this.position++,this.view.setFloat64(this.position,m),this.position+=8,this.length=Math.max(this.length,this.position),++r},this.writeMetaDataBoolean=function(p,m){var x;for(i(this,2),this.view.setUint16(this.position,p.length),this.position+=2,x=0;x<p.length;x++)i(this,1),this.bytes[this.position]=p.charCodeAt(x),this.position++;i(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,m?1:0),this.position++,this.length=Math.max(this.length,this.position),++r},this.finalize=function(){var p,m;switch(this.bytes[0]){case O.VIDEO_TAG:this.bytes[11]=(this.keyFrame||t?16:32)|7,this.bytes[12]=t?0:1,p=this.pts-this.dts,this.bytes[13]=(p&16711680)>>>16,this.bytes[14]=(p&65280)>>>8,this.bytes[15]=(p&255)>>>0;break;case O.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=t?0:1;break;case O.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,r),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position;break}return m=this.length-11,this.bytes[1]=(m&16711680)>>>16,this.bytes[2]=(m&65280)>>>8,this.bytes[3]=(m&255)>>>0,this.bytes[4]=(this.dts&16711680)>>>16,this.bytes[5]=(this.dts&65280)>>>8,this.bytes[6]=(this.dts&255)>>>0,this.bytes[7]=(this.dts&4278190080)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,i(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=O.frameTime(this.bytes),this}},O.AUDIO_TAG=8,O.VIDEO_TAG=9,O.METADATA_TAG=18,O.isAudioFrame=function(o){return O.AUDIO_TAG===o[0]},O.isVideoFrame=function(o){return O.VIDEO_TAG===o[0]},O.isMetaData=function(o){return O.METADATA_TAG===o[0]},O.isKeyFrame=function(o){return O.isVideoFrame(o)?o[11]===23:!!(O.isAudioFrame(o)||O.isMetaData(o))},O.frameTime=function(o){var e=o[4]<<16;return e|=o[5]<<8,e|=o[6]<<0,e|=o[7]<<24,e};var ne=O,fr=function o(e){this.numberOfTracks=0,this.metadataStream=e.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,o.prototype.init.call(this),this.push=function(t){if(t.text)return this.pendingCaptions.push(t);if(t.frames)return this.pendingMetadata.push(t);t.track.type==="video"&&(this.videoTrack=t.track,this.videoTags=t.tags,this.pendingTracks++),t.track.type==="audio"&&(this.audioTrack=t.track,this.audioTags=t.tags,this.pendingTracks++)}};fr.prototype=new g,fr.prototype.flush=function(o){var e,t,r,n,i={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if(o!=="VideoSegmentStream"&&o!=="AudioSegmentStream")return;if(this.pendingTracks===0&&(this.processedTracks++,this.processedTracks<this.numberOfTracks))return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?n=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(n=this.audioTrack.timelineStartInfo.pts),i.tags.videoTags=this.videoTags,i.tags.audioTags=this.audioTags,r=0;r<this.pendingCaptions.length;r++)t=this.pendingCaptions[r],t.startTime=t.startPts-n,t.startTime/=9e4,t.endTime=t.endPts-n,t.endTime/=9e4,i.captionStreams[t.stream]=!0,i.captions.push(t);for(r=0;r<this.pendingMetadata.length;r++)e=this.pendingMetadata[r],e.cueTime=e.pts-n,e.cueTime/=9e4,i.metadata.push(e);i.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",i),this.trigger("done")}};var Wa=fr,ja=function(){var e=this;this.list=[],this.push=function(t){this.list.push({bytes:t.bytes,dts:t.dts,pts:t.pts,keyFrame:t.keyFrame,metaDataTag:t.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return e.list.length}})},On=ja,Va=$t.H264Stream,Pt,Ut,kt,cr,Rn,Ln;cr=function(e,t){typeof t.pts=="number"&&(e.timelineStartInfo.pts===void 0?e.timelineStartInfo.pts=t.pts:e.timelineStartInfo.pts=Math.min(e.timelineStartInfo.pts,t.pts)),typeof t.dts=="number"&&(e.timelineStartInfo.dts===void 0?e.timelineStartInfo.dts=t.dts:e.timelineStartInfo.dts=Math.min(e.timelineStartInfo.dts,t.dts))},Rn=function(e,t){var r=new ne(ne.METADATA_TAG);return r.dts=t,r.pts=t,r.writeMetaDataDouble("videocodecid",7),r.writeMetaDataDouble("width",e.width),r.writeMetaDataDouble("height",e.height),r},Ln=function(e,t){var r,n=new ne(ne.VIDEO_TAG,!0);for(n.dts=t,n.pts=t,n.writeByte(1),n.writeByte(e.profileIdc),n.writeByte(e.profileCompatibility),n.writeByte(e.levelIdc),n.writeByte(255),n.writeByte(225),n.writeShort(e.sps[0].length),n.writeBytes(e.sps[0]),n.writeByte(e.pps.length),r=0;r<e.pps.length;++r)n.writeShort(e.pps[r].length),n.writeBytes(e.pps[r]);return n},kt=function(e){var t=[],r=[],n;kt.prototype.init.call(this),this.push=function(i){cr(e,i),e&&(e.audioobjecttype=i.audioobjecttype,e.channelcount=i.channelcount,e.samplerate=i.samplerate,e.samplingfrequencyindex=i.samplingfrequencyindex,e.samplesize=i.samplesize,e.extraData=e.audioobjecttype<<11|e.samplingfrequencyindex<<7|e.channelcount<<3),i.pts=Math.round(i.pts/90),i.dts=Math.round(i.dts/90),t.push(i)},this.flush=function(){var i,s,u,l=new On;if(t.length===0){this.trigger("done","AudioSegmentStream");return}for(u=-1/0;t.length;)i=t.shift(),r.length&&i.pts>=r[0]&&(u=r.shift(),this.writeMetaDataTags(l,u)),(e.extraData!==n||i.pts-u>=1e3)&&(this.writeMetaDataTags(l,i.pts),n=e.extraData,u=i.pts),s=new ne(ne.AUDIO_TAG),s.pts=i.pts,s.dts=i.dts,s.writeBytes(i.data),l.push(s.finalize());r.length=0,n=null,this.trigger("data",{track:e,tags:l.list}),this.trigger("done","AudioSegmentStream")},this.writeMetaDataTags=function(i,s){var u;u=new ne(ne.METADATA_TAG),u.pts=s,u.dts=s,u.writeMetaDataDouble("audiocodecid",10),u.writeMetaDataBoolean("stereo",e.channelcount===2),u.writeMetaDataDouble("audiosamplerate",e.samplerate),u.writeMetaDataDouble("audiosamplesize",16),i.push(u.finalize()),u=new ne(ne.AUDIO_TAG,!0),u.pts=s,u.dts=s,u.view.setUint16(u.position,e.extraData),u.position+=2,u.length=Math.max(u.length,u.position),i.push(u.finalize())},this.onVideoKeyFrame=function(i){r.push(i)}},kt.prototype=new g,Ut=function(e){var t=[],r,n;Ut.prototype.init.call(this),this.finishFrame=function(i,s){if(!!s){if(r&&e&&e.newMetadata&&(s.keyFrame||i.length===0)){var u=Rn(r,s.dts).finalize(),l=Ln(e,s.dts).finalize();u.metaDataTag=l.metaDataTag=!0,i.push(u),i.push(l),e.newMetadata=!1,this.trigger("keyframe",s.dts)}s.endNalUnit(),i.push(s.finalize()),n=null}},this.push=function(i){cr(e,i),i.pts=Math.round(i.pts/90),i.dts=Math.round(i.dts/90),t.push(i)},this.flush=function(){for(var i,s=new On;t.length&&t[0].nalUnitType!=="access_unit_delimiter_rbsp";)t.shift();if(t.length===0){this.trigger("done","VideoSegmentStream");return}for(;t.length;)i=t.shift(),i.nalUnitType==="seq_parameter_set_rbsp"?(e.newMetadata=!0,r=i.config,e.width=r.width,e.height=r.height,e.sps=[i.data],e.profileIdc=r.profileIdc,e.levelIdc=r.levelIdc,e.profileCompatibility=r.profileCompatibility,n.endNalUnit()):i.nalUnitType==="pic_parameter_set_rbsp"?(e.newMetadata=!0,e.pps=[i.data],n.endNalUnit()):i.nalUnitType==="access_unit_delimiter_rbsp"?(n&&this.finishFrame(s,n),n=new ne(ne.VIDEO_TAG),n.pts=i.pts,n.dts=i.dts):(i.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(n.keyFrame=!0),n.endNalUnit()),n.startNalUnit(),n.writeBytes(i.data);n&&this.finishFrame(s,n),this.trigger("data",{track:e,tags:s.list}),this.trigger("done","VideoSegmentStream")}},Ut.prototype=new g,Pt=function(e){var t=this,r,n,i,s,u,l,h,p,m,x,_,S;Pt.prototype.init.call(this),e=e||{},this.metadataStream=new N.MetadataStream,e.metadataStream=this.metadataStream,r=new N.TransportPacketStream,n=new N.TransportParseStream,i=new N.ElementaryStream,s=new N.TimestampRolloverStream("video"),u=new N.TimestampRolloverStream("audio"),l=new N.TimestampRolloverStream("timed-metadata"),h=new X,p=new Va,S=new Wa(e),r.pipe(n).pipe(i),i.pipe(s).pipe(p),i.pipe(u).pipe(h),i.pipe(l).pipe(this.metadataStream).pipe(S),_=new N.CaptionStream(e),p.pipe(_).pipe(S),i.on("data",function(v){var C,W,q;if(v.type==="metadata"){for(C=v.tracks.length;C--;)v.tracks[C].type==="video"?W=v.tracks[C]:v.tracks[C].type==="audio"&&(q=v.tracks[C]);W&&!m&&(S.numberOfTracks++,m=new Ut(W),p.pipe(m).pipe(S)),q&&!x&&(S.numberOfTracks++,x=new kt(q),h.pipe(x).pipe(S),m&&m.on("keyframe",x.onVideoKeyFrame))}}),this.push=function(v){r.push(v)},this.flush=function(){r.flush()},this.resetCaptions=function(){_.reset()},S.on("data",function(v){t.trigger("data",v)}),S.on("done",function(){t.trigger("done")})},Pt.prototype=new g;var za=Pt,Ga=function(e,t,r){var n=new Uint8Array(9),i=new DataView(n.buffer),s,u,l;return e=e||0,t=t===void 0?!0:t,r=r===void 0?!0:r,i.setUint8(0,70),i.setUint8(1,76),i.setUint8(2,86),i.setUint8(3,1),i.setUint8(4,(t?4:0)|(r?1:0)),i.setUint32(5,n.byteLength),e<=0?(u=new Uint8Array(n.byteLength+4),u.set(n),u.set([0,0,0,0],n.byteLength),u):(s=new ne(ne.METADATA_TAG),s.pts=s.dts=0,s.writeMetaDataDouble("duration",e),l=s.finalize().length,u=new Uint8Array(n.byteLength+l),u.set(n),u.set(i.byteLength,l),u)},qa=Ga,Ha={tag:ne,Transmuxer:za,getFlvHeader:qa},$a=N,Qa=B.ONE_SECOND_IN_TS,Bn=function o(e,t){var r=[],n=0,i=0,s=0,u=1/0,l=null,h=null;t=t||{},o.prototype.init.call(this),this.push=function(p){H.collectDtsInfo(e,p),e&&Mt.forEach(function(m){e[m]=p[m]}),r.push(p)},this.setEarliestDts=function(p){i=p},this.setVideoBaseMediaDecodeTime=function(p){u=p},this.setAudioAppendStart=function(p){s=p},this.processFrames_=function(){var p,m,x,_,S;r.length!==0&&(p=Ce.trimAdtsFramesByEarliestDts(r,e,i),p.length!==0&&(e.baseMediaDecodeTime=H.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),Ce.prefixWithSilence(e,p,s,u),e.samples=Ce.generateSampleTable(p),x=de.mdat(Ce.concatenateFrameData(p)),r=[],m=de.moof(n,[e]),n++,e.initSegment=de.initSegment([e]),_=new Uint8Array(m.byteLength+x.byteLength),_.set(m),_.set(x,m.byteLength),H.clearDtsInfo(e),l===null&&(h=l=p[0].pts),h+=p.length*(Qa*1024/e.samplerate),S={start:l},this.trigger("timingInfo",S),this.trigger("data",{track:e,boxes:_})))},this.flush=function(){this.processFrames_(),this.trigger("timingInfo",{start:l,end:h}),this.resetTiming_(),this.trigger("done","AudioSegmentStream")},this.partialFlush=function(){this.processFrames_(),this.trigger("partialdone","AudioSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","AudioSegmentStream")},this.resetTiming_=function(){H.clearDtsInfo(e),l=null,h=null},this.reset=function(){this.resetTiming_(),r=[],this.trigger("reset")}};Bn.prototype=new g;var Nn=Bn,Wn=function o(e,t){var r=0,n=[],i=[],s,u,l=null,h=null,p,m=!0;t=t||{},o.prototype.init.call(this),this.push=function(x){H.collectDtsInfo(e,x),typeof e.timelineStartInfo.dts>"u"&&(e.timelineStartInfo.dts=x.dts),x.nalUnitType==="seq_parameter_set_rbsp"&&!s&&(s=x.config,e.sps=[x.data],Ct.forEach(function(_){e[_]=s[_]},this)),x.nalUnitType==="pic_parameter_set_rbsp"&&!u&&(u=x.data,e.pps=[x.data]),n.push(x)},this.processNals_=function(x){var _;for(n=i.concat(n);n.length&&n[0].nalUnitType!=="access_unit_delimiter_rbsp";)n.shift();if(n.length!==0){var S=be.groupNalsIntoFrames(n);if(!!S.length){if(i=S[S.length-1],x&&(S.pop(),S.duration-=i.duration,S.nalCount-=i.length,S.byteLength-=i.byteLength),!S.length){n=[];return}if(this.trigger("timelineStartInfo",e.timelineStartInfo),m){if(p=be.groupFramesIntoGops(S),!p[0][0].keyFrame){if(p=be.extendFirstKeyFrame(p),!p[0][0].keyFrame){n=[].concat.apply([],S).concat(i),i=[];return}S=[].concat.apply([],p),S.duration=p.duration}m=!1}for(l===null&&(l=S[0].pts,h=l),h+=S.duration,this.trigger("timingInfo",{start:l,end:h}),_=0;_<S.length;_++){var v=S[_];e.samples=be.generateSampleTableForFrame(v);var C=de.mdat(be.concatenateNalDataForFrame(v));H.clearDtsInfo(e),H.collectDtsInfo(e,v),e.baseMediaDecodeTime=H.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps);var W=de.moof(r,[e]);r++,e.initSegment=de.initSegment([e]);var q=new Uint8Array(W.byteLength+C.byteLength);q.set(W),q.set(C,W.byteLength),this.trigger("data",{track:e,boxes:q,sequence:r,videoFrameDts:v.dts,videoFramePts:v.pts})}n=[]}}},this.resetTimingAndConfig_=function(){s=void 0,u=void 0,l=null,h=null},this.partialFlush=function(){this.processNals_(!0),this.trigger("partialdone","VideoSegmentStream")},this.flush=function(){this.processNals_(!1),this.resetTimingAndConfig_(),this.trigger("done","VideoSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","VideoSegmentStream")},this.reset=function(){this.resetTimingAndConfig_(),i=[],n=[],m=!0,this.trigger("reset")}};Wn.prototype=new g;var Ya=Wn,Xa=rt.isLikelyAacData,jn=function(e){return e.prototype=new g,e.prototype.init.call(e),e},Ka=function(e){var t={type:"ts",tracks:{audio:null,video:null},packet:new N.TransportPacketStream,parse:new N.TransportParseStream,elementary:new N.ElementaryStream,timestampRollover:new N.TimestampRolloverStream,adts:new Qt.Adts,h264:new Qt.h264.H264Stream,captionStream:new N.CaptionStream(e),metadataStream:new N.MetadataStream};return t.headOfPipeline=t.packet,t.packet.pipe(t.parse).pipe(t.elementary).pipe(t.timestampRollover),t.timestampRollover.pipe(t.h264),t.h264.pipe(t.captionStream),t.timestampRollover.pipe(t.metadataStream),t.timestampRollover.pipe(t.adts),t.elementary.on("data",function(r){if(r.type==="metadata"){for(var n=0;n<r.tracks.length;n++)t.tracks[r.tracks[n].type]||(t.tracks[r.tracks[n].type]=r.tracks[n],t.tracks[r.tracks[n].type].timelineStartInfo.baseMediaDecodeTime=e.baseMediaDecodeTime);t.tracks.video&&!t.videoSegmentStream&&(t.videoSegmentStream=new Ya(t.tracks.video,e),t.videoSegmentStream.on("timelineStartInfo",function(i){t.tracks.audio&&!e.keepOriginalTimestamps&&t.audioSegmentStream.setEarliestDts(i.dts-e.baseMediaDecodeTime)}),t.videoSegmentStream.on("timingInfo",t.trigger.bind(t,"videoTimingInfo")),t.videoSegmentStream.on("data",function(i){t.trigger("data",{type:"video",data:i})}),t.videoSegmentStream.on("done",t.trigger.bind(t,"done")),t.videoSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.videoSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.h264.pipe(t.videoSegmentStream)),t.tracks.audio&&!t.audioSegmentStream&&(t.audioSegmentStream=new Nn(t.tracks.audio,e),t.audioSegmentStream.on("data",function(i){t.trigger("data",{type:"audio",data:i})}),t.audioSegmentStream.on("done",t.trigger.bind(t,"done")),t.audioSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.audioSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),t.adts.pipe(t.audioSegmentStream)),t.trigger("trackinfo",{hasAudio:!!t.tracks.audio,hasVideo:!!t.tracks.video})}}),t.captionStream.on("data",function(r){var n;t.tracks.video?n=t.tracks.video.timelineStartInfo.pts||0:n=0,r.startTime=B.metadataTsToSeconds(r.startPts,n,e.keepOriginalTimestamps),r.endTime=B.metadataTsToSeconds(r.endPts,n,e.keepOriginalTimestamps),t.trigger("caption",r)}),t=jn(t),t.metadataStream.on("data",t.trigger.bind(t,"id3Frame")),t},Za=function(e){var t={type:"aac",tracks:{audio:null},metadataStream:new N.MetadataStream,aacStream:new kn,audioRollover:new N.TimestampRolloverStream("audio"),timedMetadataRollover:new N.TimestampRolloverStream("timed-metadata"),adtsStream:new X(!0)};return t.headOfPipeline=t.aacStream,t.aacStream.pipe(t.audioRollover).pipe(t.adtsStream),t.aacStream.pipe(t.timedMetadataRollover).pipe(t.metadataStream),t.metadataStream.on("timestamp",function(r){t.aacStream.setTimestamp(r.timeStamp)}),t.aacStream.on("data",function(r){r.type!=="timed-metadata"&&r.type!=="audio"||t.audioSegmentStream||(t.tracks.audio=t.tracks.audio||{timelineStartInfo:{baseMediaDecodeTime:e.baseMediaDecodeTime},codec:"adts",type:"audio"},t.audioSegmentStream=new Nn(t.tracks.audio,e),t.audioSegmentStream.on("data",function(n){t.trigger("data",{type:"audio",data:n})}),t.audioSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.audioSegmentStream.on("done",t.trigger.bind(t,"done")),t.audioSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),t.adtsStream.pipe(t.audioSegmentStream),t.trigger("trackinfo",{hasAudio:!!t.tracks.audio,hasVideo:!!t.tracks.video}))}),t=jn(t),t.metadataStream.on("data",t.trigger.bind(t,"id3Frame")),t},Vn=function(e,t){e.on("data",t.trigger.bind(t,"data")),e.on("done",t.trigger.bind(t,"done")),e.on("partialdone",t.trigger.bind(t,"partialdone")),e.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),e.on("audioTimingInfo",t.trigger.bind(t,"audioTimingInfo")),e.on("videoTimingInfo",t.trigger.bind(t,"videoTimingInfo")),e.on("trackinfo",t.trigger.bind(t,"trackinfo")),e.on("id3Frame",function(r){r.dispatchType=e.metadataStream.dispatchType,r.cueTime=B.videoTsToSeconds(r.pts),t.trigger("id3Frame",r)}),e.on("caption",function(r){t.trigger("caption",r)})},zn=function o(e){var t=null,r=!0;e=e||{},o.prototype.init.call(this),e.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.push=function(n){if(r){var i=Xa(n);i&&(!t||t.type!=="aac")?(t=Za(e),Vn(t,this)):!i&&(!t||t.type!=="ts")&&(t=Ka(e),Vn(t,this)),r=!1}t.headOfPipeline.push(n)},this.flush=function(){!t||(r=!0,t.headOfPipeline.flush())},this.partialFlush=function(){!t||t.headOfPipeline.partialFlush()},this.endTimeline=function(){!t||t.headOfPipeline.endTimeline()},this.reset=function(){!t||t.headOfPipeline.reset()},this.setBaseMediaDecodeTime=function(n){e.keepOriginalTimestamps||(e.baseMediaDecodeTime=n),t&&(t.tracks.audio&&(t.tracks.audio.timelineStartInfo.dts=void 0,t.tracks.audio.timelineStartInfo.pts=void 0,H.clearDtsInfo(t.tracks.audio),t.audioRollover&&t.audioRollover.discontinuity()),t.tracks.video&&(t.videoSegmentStream&&(t.videoSegmentStream.gopCache_=[]),t.tracks.video.timelineStartInfo.dts=void 0,t.tracks.video.timelineStartInfo.pts=void 0,H.clearDtsInfo(t.tracks.video)),t.timestampRollover&&t.timestampRollover.discontinuity())},this.setRemux=function(n){e.remux=n,t&&t.coalesceStream&&t.coalesceStream.setRemux(n)},this.setAudioAppendStart=function(n){!t||!t.tracks.audio||!t.audioSegmentStream||t.audioSegmentStream.setAudioAppendStart(n)},this.alignGopsWith=function(n){}};zn.prototype=new g;var Ja=zn,es={Transmuxer:Ja},Gn=Ze.getUint64,ts=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:t.getUint32(4),timescale:t.getUint32(8)},n=12;r.version===0?(r.earliestPresentationTime=t.getUint32(n),r.firstOffset=t.getUint32(n+4),n+=8):(r.earliestPresentationTime=Gn(e.subarray(n)),r.firstOffset=Gn(e.subarray(n+8)),n+=16),n+=2;var i=t.getUint16(n);for(n+=2;i>0;n+=12,i--)r.references.push({referenceType:(e[n]&128)>>>7,referencedSize:t.getUint32(n)&2147483647,subsegmentDuration:t.getUint32(n+4),startsWithSap:!!(e[n+8]&128),sapType:(e[n+8]&112)>>>4,sapDeltaTime:t.getUint32(n+8)&268435455});return r},rs=ts,qn=Ze.getUint64,te,lr,ce=function(e){return new Date(e*1e3-20828448e5)},ns=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=[],n,i;for(n=0;n+4<e.length;n+=i){if(i=t.getUint32(n),n+=4,i<=0){r.push("<span style='color:red;'>MALFORMED DATA</span>");continue}switch(e[n]&31){case 1:r.push("slice_layer_without_partitioning_rbsp");break;case 5:r.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:r.push("sei_rbsp");break;case 7:r.push("seq_parameter_set_rbsp");break;case 8:r.push("pic_parameter_set_rbsp");break;case 9:r.push("access_unit_delimiter_rbsp");break;default:r.push("UNKNOWN NAL - "+e[n]&31);break}}return r},Ae={avc1:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{dataReferenceIndex:t.getUint16(6),width:t.getUint16(24),height:t.getUint16(26),horizresolution:t.getUint16(28)+t.getUint16(30)/16,vertresolution:t.getUint16(32)+t.getUint16(34)/16,frameCount:t.getUint16(40),depth:t.getUint16(74),config:te(e.subarray(78,e.byteLength))}},avcC:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={configurationVersion:e[0],avcProfileIndication:e[1],profileCompatibility:e[2],avcLevelIndication:e[3],lengthSizeMinusOne:e[4]&3,sps:[],pps:[]},n=e[5]&31,i,s,u,l;for(u=6,l=0;l<n;l++)s=t.getUint16(u),u+=2,r.sps.push(new Uint8Array(e.subarray(u,u+s))),u+=s;for(i=e[u],u++,l=0;l<i;l++)s=t.getUint16(u),u+=2,r.pps.push(new Uint8Array(e.subarray(u,u+s))),u+=s;return r},btrt:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{bufferSizeDB:t.getUint32(0),maxBitrate:t.getUint32(4),avgBitrate:t.getUint32(8)}},edts:function(e){return{boxes:te(e)}},elst:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),edits:[]},n=t.getUint32(4),i;for(i=8;n;n--)r.version===0?(r.edits.push({segmentDuration:t.getUint32(i),mediaTime:t.getInt32(i+4),mediaRate:t.getUint16(i+8)+t.getUint16(i+10)/(256*256)}),i+=12):(r.edits.push({segmentDuration:qn(e.subarray(i)),mediaTime:qn(e.subarray(i+8)),mediaRate:t.getUint16(i+16)+t.getUint16(i+18)/(256*256)}),i+=20);return r},esds:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),esId:e[6]<<8|e[7],streamPriority:e[8]&31,decoderConfig:{objectProfileIndication:e[11],streamType:e[12]>>>2&63,bufferSize:e[13]<<16|e[14]<<8|e[15],maxBitrate:e[16]<<24|e[17]<<16|e[18]<<8|e[19],avgBitrate:e[20]<<24|e[21]<<16|e[22]<<8|e[23],decoderConfigDescriptor:{tag:e[24],length:e[25],audioObjectType:e[26]>>>3&31,samplingFrequencyIndex:(e[26]&7)<<1|e[27]>>>7&1,channelConfiguration:e[27]>>>3&15}}}},ftyp:function(e){for(var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={majorBrand:fe(e.subarray(0,4)),minorVersion:t.getUint32(4),compatibleBrands:[]},n=8;n<e.byteLength;)r.compatibleBrands.push(fe(e.subarray(n,n+4))),n+=4;return r},dinf:function(e){return{boxes:te(e)}},dref:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),dataReferences:te(e.subarray(8))}},hdlr:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:fe(e.subarray(8,12)),name:""},n=8;for(n=24;n<e.byteLength;n++){if(e[n]===0){n++;break}r.name+=String.fromCharCode(e[n])}return r.name=decodeURIComponent(escape(r.name)),r},mdat:function(e){return{byteLength:e.byteLength,nals:ns(e)}},mdhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=4,n,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),language:""};return i.version===1?(r+=4,i.creationTime=ce(t.getUint32(r)),r+=8,i.modificationTime=ce(t.getUint32(r)),r+=4,i.timescale=t.getUint32(r),r+=8,i.duration=t.getUint32(r)):(i.creationTime=ce(t.getUint32(r)),r+=4,i.modificationTime=ce(t.getUint32(r)),r+=4,i.timescale=t.getUint32(r),r+=4,i.duration=t.getUint32(r)),r+=4,n=t.getUint16(r),i.language+=String.fromCharCode((n>>10)+96),i.language+=String.fromCharCode(((n&992)>>5)+96),i.language+=String.fromCharCode((n&31)+96),i},mdia:function(e){return{boxes:te(e)}},mfhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sequenceNumber:e[4]<<24|e[5]<<16|e[6]<<8|e[7]}},minf:function(e){return{boxes:te(e)}},mp4a:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={dataReferenceIndex:t.getUint16(6),channelcount:t.getUint16(16),samplesize:t.getUint16(18),samplerate:t.getUint16(24)+t.getUint16(26)/65536};return e.byteLength>28&&(r.streamDescriptor=te(e.subarray(28))[0]),r},moof:function(e){return{boxes:te(e)}},moov:function(e){return{boxes:te(e)}},mvex:function(e){return{boxes:te(e)}},mvhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=4,n={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return n.version===1?(r+=4,n.creationTime=ce(t.getUint32(r)),r+=8,n.modificationTime=ce(t.getUint32(r)),r+=4,n.timescale=t.getUint32(r),r+=8,n.duration=t.getUint32(r)):(n.creationTime=ce(t.getUint32(r)),r+=4,n.modificationTime=ce(t.getUint32(r)),r+=4,n.timescale=t.getUint32(r),r+=4,n.duration=t.getUint32(r)),r+=4,n.rate=t.getUint16(r)+t.getUint16(r+2)/16,r+=4,n.volume=t.getUint8(r)+t.getUint8(r+1)/8,r+=2,r+=2,r+=2*4,n.matrix=new Uint32Array(e.subarray(r,r+9*4)),r+=9*4,r+=6*4,n.nextTrackId=t.getUint32(r),n},pdin:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),rate:t.getUint32(4),initialDelay:t.getUint32(8)}},sdtp:function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},r;for(r=4;r<e.byteLength;r++)t.samples.push({dependsOn:(e[r]&48)>>4,isDependedOn:(e[r]&12)>>2,hasRedundancy:e[r]&3});return t},sidx:rs,smhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),balance:e[4]+e[5]/256}},stbl:function(e){return{boxes:te(e)}},ctts:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),compositionOffsets:[]},n=t.getUint32(4),i;for(i=8;n;i+=8,n--)r.compositionOffsets.push({sampleCount:t.getUint32(i),sampleOffset:t[r.version===0?"getUint32":"getInt32"](i+4)});return r},stss:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),syncSamples:[]},n=t.getUint32(4),i;for(i=8;n;i+=4,n--)r.syncSamples.push(t.getUint32(i));return r},stco:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),chunkOffsets:[]},n=t.getUint32(4),i;for(i=8;n;i+=4,n--)r.chunkOffsets.push(t.getUint32(i));return r},stsc:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=t.getUint32(4),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleToChunks:[]},i;for(i=8;r;i+=12,r--)n.sampleToChunks.push({firstChunk:t.getUint32(i),samplesPerChunk:t.getUint32(i+4),sampleDescriptionIndex:t.getUint32(i+8)});return n},stsd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleDescriptions:te(e.subarray(8))}},stsz:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleSize:t.getUint32(4),entries:[]},n;for(n=12;n<e.byteLength;n+=4)r.entries.push(t.getUint32(n));return r},stts:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),timeToSamples:[]},n=t.getUint32(4),i;for(i=8;n;i+=8,n--)r.timeToSamples.push({sampleCount:t.getUint32(i),sampleDelta:t.getUint32(i+4)});return r},styp:function(e){return Ae.ftyp(e)},tfdt:tr,tfhd:Jt,tkhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=4,n={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return n.version===1?(r+=4,n.creationTime=ce(t.getUint32(r)),r+=8,n.modificationTime=ce(t.getUint32(r)),r+=4,n.trackId=t.getUint32(r),r+=4,r+=8,n.duration=t.getUint32(r)):(n.creationTime=ce(t.getUint32(r)),r+=4,n.modificationTime=ce(t.getUint32(r)),r+=4,n.trackId=t.getUint32(r),r+=4,r+=4,n.duration=t.getUint32(r)),r+=4,r+=2*4,n.layer=t.getUint16(r),r+=2,n.alternateGroup=t.getUint16(r),r+=2,n.volume=t.getUint8(r)+t.getUint8(r+1)/8,r+=2,r+=2,n.matrix=new Uint32Array(e.subarray(r,r+9*4)),r+=9*4,n.width=t.getUint16(r)+t.getUint16(r+2)/65536,r+=4,n.height=t.getUint16(r)+t.getUint16(r+2)/65536,n},traf:function(e){return{boxes:te(e)}},trak:function(e){return{boxes:te(e)}},trex:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4),defaultSampleDescriptionIndex:t.getUint32(8),defaultSampleDuration:t.getUint32(12),defaultSampleSize:t.getUint32(16),sampleDependsOn:e[20]&3,sampleIsDependedOn:(e[21]&192)>>6,sampleHasRedundancy:(e[21]&48)>>4,samplePaddingValue:(e[21]&14)>>1,sampleIsDifferenceSample:!!(e[21]&1),sampleDegradationPriority:t.getUint16(22)}},trun:er,"url ":function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4))}},vmhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),graphicsmode:t.getUint16(4),opcolor:new Uint16Array([t.getUint16(6),t.getUint16(8),t.getUint16(10)])}}};te=function(e){for(var t=0,r=[],n,i,s,u,l,h=new ArrayBuffer(e.length),p=new Uint8Array(h),m=0;m<e.length;++m)p[m]=e[m];for(n=new DataView(h);t<e.byteLength;)i=n.getUint32(t),s=fe(e.subarray(t+4,t+8)),u=i>1?t+i:e.byteLength,l=(Ae[s]||function(x){return{data:x}})(e.subarray(t+8,u)),l.size=i,l.type=s,r.push(l),t=u;return r},lr=function(e,t){var r;return t=t||0,r=new Array(t*2+1).join(" "),e.map(function(n,i){return r+n.type+`
`+Object.keys(n).filter(function(s){return s!=="type"&&s!=="boxes"}).map(function(s){var u=r+"  "+s+": ",l=n[s];if(l instanceof Uint8Array||l instanceof Uint32Array){var h=Array.prototype.slice.call(new Uint8Array(l.buffer,l.byteOffset,l.byteLength)).map(function(p){return" "+("00"+p.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return h?h.length===1?u+"<"+h.join("").slice(1)+">":u+`<
`+h.map(function(p){return r+"  "+p}).join(`
`)+`
`+r+"  >":u+"<>"}return u+JSON.stringify(l,null,2).split(`
`).map(function(p,m){return m===0?p:r+"  "+p}).join(`
`)}).join(`
`)+(n.boxes?`
`+lr(n.boxes,t+1):"")}).join(`
`)};var is={inspect:te,textify:lr,parseType:fe,findBox:j,parseTraf:Ae.traf,parseTfdt:Ae.tfdt,parseHdlr:Ae.hdlr,parseTfhd:Ae.tfhd,parseTrun:Ae.trun,parseSidx:Ae.sidx},as={8:"audio",9:"video",18:"metadata"},ss=function(e){return"0x"+("00"+e.toString(16)).slice(-2).toUpperCase()},pr=function(e){for(var t=[],r;e.byteLength>0;)r=0,t.push(ss(e[r++])),e=e.subarray(r);return t.join(" ")},os=function(e,t){var r=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"],n=e[1]&parseInt("01111111",2)<<16|e[2]<<8|e[3];return t=t||{},t.avcPacketType=r[e[0]],t.CompositionTime=e[1]&parseInt("10000000",2)?-n:n,e[0]===1?t.nalUnitTypeRaw=pr(e.subarray(4,100)):t.data=pr(e.subarray(4)),t},us=function(e,t){var r=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"],n=e[0]&parseInt("00001111",2);return t=t||{},t.frameType=r[(e[0]&parseInt("11110000",2))>>>4],t.codecID=n,n===7?os(e.subarray(1),t):t},ds=function(e,t){var r=["AAC Sequence Header","AAC Raw"];return t=t||{},t.aacPacketType=r[e[0]],t.data=pr(e.subarray(1)),t},fs=function(e,t){var r=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"],n=["5.5-kHz","11-kHz","22-kHz","44-kHz"],i=(e[0]&parseInt("11110000",2))>>>4;return t=t||{},t.soundFormat=r[i],t.soundRate=n[(e[0]&parseInt("00001100",2))>>>2],t.soundSize=(e[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",t.soundType=e[0]&parseInt("00000001",2)?"Stereo":"Mono",i===10?ds(e.subarray(1),t):t},cs=function(e){return{tagType:as[e[0]],dataSize:e[1]<<16|e[2]<<8|e[3],timestamp:e[7]<<24|e[4]<<16|e[5]<<8|e[6],streamID:e[8]<<16|e[9]<<8|e[10]}},Hn=function(e){var t=cs(e);switch(e[0]){case 8:fs(e.subarray(11),t);break;case 9:us(e.subarray(11),t);break}return t},ls=function(e){var t=9,r,n=[],i;for(t+=4;t<e.byteLength;)r=e[t+1]<<16,r|=e[t+2]<<8,r|=e[t+3],r+=11,i=e.subarray(t,t+r),n.push(Hn(i)),t+=r+4;return n},ps=function(e){return JSON.stringify(e,null,2)},hs={inspectTag:Hn,inspect:ls,textify:ps},$n=function(e){var t=e[1]&31;return t<<=8,t|=e[2],t},Ft=function(e){return!!(e[1]&64)},Dt=function(e){var t=0;return(e[3]&48)>>>4>1&&(t+=e[4]+1),t},ms=function(e,t){var r=$n(e);return r===0?"pat":r===t?"pmt":t?"pes":null},gs=function(e){var t=Ft(e),r=4+Dt(e);return t&&(r+=e[r]+1),(e[r+10]&31)<<8|e[r+11]},xs=function(e){var t={},r=Ft(e),n=4+Dt(e);if(r&&(n+=e[n]+1),!!(e[n+5]&1)){var i,s,u;i=(e[n+1]&15)<<8|e[n+2],s=3+i-4,u=(e[n+10]&15)<<8|e[n+11];for(var l=12+u;l<s;){var h=n+l;t[(e[h+1]&31)<<8|e[h+2]]=e[h],l+=((e[h+3]&15)<<8|e[h+4])+5}return t}},ys=function(e,t){var r=$n(e),n=t[r];switch(n){case K.H264_STREAM_TYPE:return"video";case K.ADTS_STREAM_TYPE:return"audio";case K.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},bs=function(e){var t=Ft(e);if(!t)return null;var r=4+Dt(e);if(r>=e.byteLength)return null;var n=null,i;return i=e[r+7],i&192&&(n={},n.pts=(e[r+9]&14)<<27|(e[r+10]&255)<<20|(e[r+11]&254)<<12|(e[r+12]&255)<<5|(e[r+13]&254)>>>3,n.pts*=4,n.pts+=(e[r+13]&6)>>>1,n.dts=n.pts,i&64&&(n.dts=(e[r+14]&14)<<27|(e[r+15]&255)<<20|(e[r+16]&254)<<12|(e[r+17]&255)<<5|(e[r+18]&254)>>>3,n.dts*=4,n.dts+=(e[r+18]&6)>>>1)),n},hr=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},vs=function(e){for(var t=4+Dt(e),r=e.subarray(t),n=0,i=0,s=!1,u;i<r.byteLength-3;i++)if(r[i+2]===1){n=i+5;break}for(;n<r.byteLength;)switch(r[n]){case 0:if(r[n-1]!==0){n+=2;break}else if(r[n-2]!==0){n++;break}i+3!==n-2&&(u=hr(r[i+3]&31),u==="slice_layer_without_partitioning_rbsp_idr"&&(s=!0));do n++;while(r[n]!==1&&n<r.length);i=n-2,n+=3;break;case 1:if(r[n-1]!==0||r[n-2]!==0){n+=3;break}u=hr(r[i+3]&31),u==="slice_layer_without_partitioning_rbsp_idr"&&(s=!0),i=n-2,n+=3;break;default:n+=3;break}return r=r.subarray(i),n-=i,i=0,r&&r.byteLength>3&&(u=hr(r[i+3]&31),u==="slice_layer_without_partitioning_rbsp_idr"&&(s=!0)),s},_s={parseType:ms,parsePat:gs,parsePmt:xs,parsePayloadUnitStartIndicator:Ft,parsePesType:ys,parsePesTime:bs,videoPacketContainsKeyFrame:vs},He=En.handleRollover,L={};L.ts=_s,L.aac=rt;var Le=B.ONE_SECOND_IN_TS,ie=188,ve=71,Ss=function(e,t){for(var r=0,n=ie,i,s;n<e.byteLength;){if(e[r]===ve&&e[n]===ve){switch(i=e.subarray(r,n),s=L.ts.parseType(i,t.pid),s){case"pat":t.pid=L.ts.parsePat(i);break;case"pmt":var u=L.ts.parsePmt(i);t.table=t.table||{},Object.keys(u).forEach(function(l){t.table[l]=u[l]});break}r+=ie,n+=ie;continue}r++,n++}},Qn=function(e,t,r){for(var n=0,i=ie,s,u,l,h,p,m=!1;i<=e.byteLength;){if(e[n]===ve&&(e[i]===ve||i===e.byteLength)){switch(s=e.subarray(n,i),u=L.ts.parseType(s,t.pid),u){case"pes":l=L.ts.parsePesType(s,t.table),h=L.ts.parsePayloadUnitStartIndicator(s),l==="audio"&&h&&(p=L.ts.parsePesTime(s),p&&(p.type="audio",r.audio.push(p),m=!0));break}if(m)break;n+=ie,i+=ie;continue}n++,i++}for(i=e.byteLength,n=i-ie,m=!1;n>=0;){if(e[n]===ve&&(e[i]===ve||i===e.byteLength)){switch(s=e.subarray(n,i),u=L.ts.parseType(s,t.pid),u){case"pes":l=L.ts.parsePesType(s,t.table),h=L.ts.parsePayloadUnitStartIndicator(s),l==="audio"&&h&&(p=L.ts.parsePesTime(s),p&&(p.type="audio",r.audio.push(p),m=!0));break}if(m)break;n-=ie,i-=ie;continue}n--,i--}},Ts=function(e,t,r){for(var n=0,i=ie,s,u,l,h,p,m,x,_,S=!1,v={data:[],size:0};i<e.byteLength;){if(e[n]===ve&&e[i]===ve){switch(s=e.subarray(n,i),u=L.ts.parseType(s,t.pid),u){case"pes":if(l=L.ts.parsePesType(s,t.table),h=L.ts.parsePayloadUnitStartIndicator(s),l==="video"&&(h&&!S&&(p=L.ts.parsePesTime(s),p&&(p.type="video",r.video.push(p),S=!0)),!r.firstKeyFrame)){if(h&&v.size!==0){for(m=new Uint8Array(v.size),x=0;v.data.length;)_=v.data.shift(),m.set(_,x),x+=_.byteLength;if(L.ts.videoPacketContainsKeyFrame(m)){var C=L.ts.parsePesTime(m);C?(r.firstKeyFrame=C,r.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}v.size=0}v.data.push(s),v.size+=s.byteLength}break}if(S&&r.firstKeyFrame)break;n+=ie,i+=ie;continue}n++,i++}for(i=e.byteLength,n=i-ie,S=!1;n>=0;){if(e[n]===ve&&e[i]===ve){switch(s=e.subarray(n,i),u=L.ts.parseType(s,t.pid),u){case"pes":l=L.ts.parsePesType(s,t.table),h=L.ts.parsePayloadUnitStartIndicator(s),l==="video"&&h&&(p=L.ts.parsePesTime(s),p&&(p.type="video",r.video.push(p),S=!0));break}if(S)break;n-=ie,i-=ie;continue}n--,i--}},ws=function(e,t){if(e.audio&&e.audio.length){var r=t;(typeof r>"u"||isNaN(r))&&(r=e.audio[0].dts),e.audio.forEach(function(s){s.dts=He(s.dts,r),s.pts=He(s.pts,r),s.dtsTime=s.dts/Le,s.ptsTime=s.pts/Le})}if(e.video&&e.video.length){var n=t;if((typeof n>"u"||isNaN(n))&&(n=e.video[0].dts),e.video.forEach(function(s){s.dts=He(s.dts,n),s.pts=He(s.pts,n),s.dtsTime=s.dts/Le,s.ptsTime=s.pts/Le}),e.firstKeyFrame){var i=e.firstKeyFrame;i.dts=He(i.dts,n),i.pts=He(i.pts,n),i.dtsTime=i.dts/Le,i.ptsTime=i.pts/Le}}},Is=function(e){for(var t=!1,r=0,n=null,i=null,s=0,u=0,l;e.length-u>=3;){var h=L.aac.parseType(e,u);switch(h){case"timed-metadata":if(e.length-u<10){t=!0;break}if(s=L.aac.parseId3TagSize(e,u),s>e.length){t=!0;break}i===null&&(l=e.subarray(u,u+s),i=L.aac.parseAacTimestamp(l)),u+=s;break;case"audio":if(e.length-u<7){t=!0;break}if(s=L.aac.parseAdtsSize(e,u),s>e.length){t=!0;break}n===null&&(l=e.subarray(u,u+s),n=L.aac.parseSampleRate(l)),r++,u+=s;break;default:u++;break}if(t)return null}if(n===null||i===null)return null;var p=Le/n,m={audio:[{type:"audio",dts:i,pts:i},{type:"audio",dts:i+r*1024*p,pts:i+r*1024*p}]};return m},Es=function(e){var t={pid:null,table:null},r={};Ss(e,t);for(var n in t.table)if(t.table.hasOwnProperty(n)){var i=t.table[n];switch(i){case K.H264_STREAM_TYPE:r.video=[],Ts(e,t,r),r.video.length===0&&delete r.video;break;case K.ADTS_STREAM_TYPE:r.audio=[],Qn(e,t,r),r.audio.length===0&&delete r.audio;break}}return r},Ms=function(e,t){var r=L.aac.isLikelyAacData(e),n;return r?n=Is(e):n=Es(e),!n||!n.audio&&!n.video?null:(ws(n,t),n)},Cs={inspect:Ms,parseAudioPes_:Qn},Ot={codecs:Qt,mp4:Na,flv:Ha,mp2t:$a,partial:es};Ot.mp4.tools=is,Ot.flv.tools=hs,Ot.mp2t.tools=Cs;var As=Ot;return As})});var ct={};Os(ct,{abortRequest:()=>_o,addSourceBuffer:()=>Co,announceFetchedContent:()=>Lo,announceTrackUpdate:()=>Bo,announceVariantLockStatusChange:()=>Go,announceVariantUpdate:()=>No,appendBuffer:()=>Ao,attachMediaSource:()=>Io,clearTimer:()=>bo,doFetch:()=>vo,endOfStream:()=>Uo,flush:()=>To,freeResource:()=>Do,getRandom:()=>Vo,getResourceData:()=>go,isTypeSupported:()=>zo,log:()=>xo,removeBuffer:()=>Po,removeMediaSource:()=>Eo,seek:()=>So,sendMediaPlaylistParsingError:()=>po,sendMediaPlaylistRequestError:()=>oo,sendMultivariantPlaylistParsingError:()=>lo,sendMultivariantPlaylistRequestError:()=>so,sendOtherError:()=>co,sendPushedSegmentError:()=>uo,sendRemoveBufferError:()=>fo,sendSegmentParsingError:()=>mo,sendSegmentRequestError:()=>ao,sendSourceBufferCreationError:()=>ho,setMediaOffset:()=>Fo,setMediaSourceDuration:()=>Mo,setPlaybackRate:()=>wo,startObservingPlayback:()=>ko,startRebuffering:()=>Wo,stopObservingPlayback:()=>Dr,stopRebuffering:()=>jo,timer:()=>yo,updateContentInfo:()=>Ro});var it=class{constructor(){this._listeners={}}addEventListener(a,f){let c=this._listeners[a];Array.isArray(c)?c.push(f):this._listeners[a]=[f]}removeEventListener(a,f){if(a===void 0){this._listeners={};return}let c=this._listeners[a];if(!Array.isArray(c))return;if(f===void 0){delete this._listeners[a];return}let g=c.indexOf(f);g!==-1&&c.splice(g,1),c.length===0&&delete this._listeners[a]}trigger(a,f){let c=this._listeners[a];!Array.isArray(c)||c.slice().forEach(g=>{try{g(f)}catch(y){A.error("EventEmitter: listener error",y instanceof Error?y:null)}})}};function le(){}var Bs=0,yr=class extends it{constructor(){super();this.error=le,this.warn=le,this.info=le,this.debug=le,this._currentLevel=Bs}setLevel(f){let c=f<0||f>4?0:f;this._currentLevel=c,this.error=c>=1?console.error.bind(console):le,this.warn=c>=2?console.warn.bind(console):le,this.info=c>=3?console.info.bind(console):le,this.debug=c>=4?console.debug.bind(console):le,this.trigger("onLogLevelChange",c)}getLevel(){return this._currentLevel}hasLevel(f){return f>=this._currentLevel}},Ns=new yr,A=Ns;function br(){let d="",a=-1;return function(){return a++,a>=Number.MAX_SAFE_INTEGER&&(d+="0",a=0),d+String(a)}}var Ws=4294967295;function ti(){let d=-1;return function(){return d++,d>=Ws&&(A.warn("Exceeding `numberIdGenerator` limit. Collisions may occur"),d=0),d}}function at(d){throw new Error("Unreachable path taken")}var st=class{constructor(a){this._sourceBuffer=a,this._queue=[],this._pendingTask=null;let f=setInterval(()=>{this._flush()},2e3),c=this._onPendingTaskError.bind(this),g=()=>{this._flush()};a.addEventListener("error",c),a.addEventListener("updateend",g),this._dispose=[()=>{clearInterval(f),a.removeEventListener("error",c),a.removeEventListener("updateend",g)}]}push(a){return A.debug("QSB: receiving order to push data to the SourceBuffer"),this._addToQueue({type:0,value:a})}removeBuffer(a,f){return A.debug("QSB: receiving order to remove data from the SourceBuffer",a,f),this._addToQueue({type:1,value:{start:a,end:f}})}getBufferedRanges(){return this._sourceBuffer.buffered}dispose(){for(this._dispose.forEach(a=>a()),this._pendingTask!==null&&(this._pendingTask.reject(new Error("QueuedSourceBuffer Cancelled")),this._pendingTask=null);this._queue.length>0;){let a=this._queue.shift();a!==void 0&&a.reject(new Error("QueuedSourceBuffer Cancelled"))}}_onPendingTaskError(a){let f=a instanceof Error?a:new Error("An unknown error occured when doing operations on the SourceBuffer");this._pendingTask!=null&&this._pendingTask.reject(f)}_addToQueue(a){return new Promise((f,c)=>{let g=this._queue.length===0&&this._pendingTask===null,y={resolve:f,reject:c,...a};this._queue.push(y),g&&this._flush()})}_flush(){if(!this._sourceBuffer.updating){if(this._pendingTask!==null){let a=this._pendingTask,{resolve:f}=a;return this._pendingTask=null,f(),this._flush()}else{let a=this._queue.shift();if(a===void 0)return;this._pendingTask=a}try{switch(this._pendingTask.type){case 0:let a=this._pendingTask.value;if(a===void 0){this._flush();return}A.debug("QSB: pushing data"),this._sourceBuffer.appendBuffer(a);break;case 1:let{start:f,end:c}=this._pendingTask.value;A.debug("QSB: removing data from SourceBuffer",f,c),this._sourceBuffer.remove(f,c);break;default:at(this._pendingTask)}}catch(a){this._onPendingTaskError(a)}}}};function $e(d){let a=new Float64Array(d.length*2);for(let f=0;f<d.length;f++){let c=f*2;a[c]=d.start(f),a[c+1]=d.end(f)}return a}var Xs={},T,ni=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});ni.decode();var Rt=new Uint8Array;function ot(){return Rt.byteLength===0&&(Rt=new Uint8Array(T.memory.buffer)),Rt}function ae(d,a){return ni.decode(ot().subarray(d,d+a))}var re=0,Lt=new TextEncoder("utf-8"),js=typeof Lt.encodeInto=="function"?function(d,a){return Lt.encodeInto(d,a)}:function(d,a){let f=Lt.encode(d);return a.set(f),{read:d.length,written:f.length}};function Se(d,a,f){if(f===void 0){let M=Lt.encode(d),w=a(M.length);return ot().subarray(w,w+M.length).set(M),re=M.length,w}let c=d.length,g=a(c),y=ot(),b=0;for(;b<c;b++){let M=d.charCodeAt(b);if(M>127)break;y[g+b]=M}if(b!==c){b!==0&&(d=d.slice(b)),g=f(g,c,c=b+d.length*3);let M=ot().subarray(g+b,g+c);b+=js(d,M).written}return re=b,g}var Bt=new Int32Array;function Qe(){return Bt.byteLength===0&&(Bt=new Int32Array(T.memory.buffer)),Bt}var Nt=new Float64Array;function Ye(){return Nt.byteLength===0&&(Nt=new Float64Array(T.memory.buffer)),Nt}function z(d){return d==null}function pe(d,a){if(!(d instanceof a))throw new Error(`expected instance of ${a.name}`);return d.ptr}function Vs(d,a){let f=a(d.length*8);return Ye().set(d,f/8),re=d.length,f}function _e(d){return()=>{throw new Error(`${d} is not defined`)}}function zs(d,a){let f=a(d.length*1);return ot().set(d,f/1),re=d.length,f}var Wt=new Uint32Array;function Gs(){return Wt.byteLength===0&&(Wt=new Uint32Array(T.memory.buffer)),Wt}function ri(d,a){return Gs().subarray(d/4,d/4+a)}function qs(d,a){return Ye().subarray(d/8,d/8+a)}var Hs=Object.freeze({Init:0,0:"Init",RegularInterval:1,1:"RegularInterval",Seeking:2,2:"Seeking",Seeked:3,3:"Seeked",LoadedData:4,4:"LoadedData",LoadedMetadata:5,5:"LoadedMetadata",CanPlay:6,6:"CanPlay",CanPlayThrough:7,7:"CanPlayThrough",Ended:8,8:"Ended",Pause:9,9:"Pause",Play:10,10:"Play",RateChange:11,11:"RateChange",Stalled:12,12:"Stalled"}),ou=Object.freeze({MultivariantPlaylist:0,0:"MultivariantPlaylist",MediaPlaylist:1,1:"MediaPlaylist"}),ii=Object.freeze({NoSupportedVariant:0,0:"NoSupportedVariant",UnfoundLockedVariant:1,1:"UnfoundLockedVariant",MediaSourceAttachmentError:2,2:"MediaSourceAttachmentError",Unknown:3,3:"Unknown"}),uu=Object.freeze({AlreadyCreatedWithSameType:0,0:"AlreadyCreatedWithSameType",CantPlayType:1,1:"CantPlayType",EmptyMimeType:2,2:"EmptyMimeType",MediaSourceIsClosed:3,3:"MediaSourceIsClosed",NoMediaSourceAttached:4,4:"NoMediaSourceAttached",QuotaExceededError:5,5:"QuotaExceededError",Unknown:6,6:"Unknown"}),du=Object.freeze({Timeout:0,0:"Timeout",Status:1,1:"Status",Error:2,2:"Error",Other:3,3:"Other"}),jt=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",UnknownError:1,1:"UnknownError"}),Vt=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",UnknownError:1,1:"UnknownError"}),vr=Object.freeze({UnknownError:0,0:"UnknownError",NoContentLoaded:1,1:"NoContentLoaded"}),zt=Object.freeze({SourceBufferNotFound:0,0:"SourceBufferNotFound",UnknownError:1,1:"UnknownError"}),_r=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",UnknownError:1,1:"UnknownError"}),fu=Object.freeze({MissingExtM3uHeader:0,0:"MissingExtM3uHeader",MultivariantPlaylistWithoutVariant:1,1:"MultivariantPlaylistWithoutVariant",MissingUriLineAfterVariant:2,2:"MissingUriLineAfterVariant",UnableToReadVariantUri:3,3:"UnableToReadVariantUri",VariantMissingBandwidth:4,4:"VariantMissingBandwidth",InvalidValue:5,5:"InvalidValue",MediaTagMissingType:6,6:"MediaTagMissingType",MediaTagMissingName:7,7:"MediaTagMissingName",MediaTagMissingGroupId:8,8:"MediaTagMissingGroupId",UnableToReadLine:9,9:"UnableToReadLine",Unknown:10,10:"Unknown"}),cu=Object.freeze({UnparsableExtInf:0,0:"UnparsableExtInf",UriMissingInMap:1,1:"UriMissingInMap",MissingTargetDuration:2,2:"MissingTargetDuration",UriWithoutExtInf:3,3:"UriWithoutExtInf",UnparsableByteRange:4,4:"UnparsableByteRange",Unknown:5,5:"Unknown"}),Te=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",MediaSourceIsClosed:1,1:"MediaSourceIsClosed",QuotaExceededError:2,2:"QuotaExceededError",TypeNotSupportedError:3,3:"TypeNotSupportedError",EmptyMimeType:4,4:"EmptyMimeType",UnknownError:5,5:"UnknownError"}),je=Object.freeze({NoResource:0,0:"NoResource",NoSourceBuffer:1,1:"NoSourceBuffer",TransmuxerError:2,2:"TransmuxerError",UnknownError:3,3:"UnknownError"}),Xe=Object.freeze({BufferFull:0,0:"BufferFull",UnknownError:1,1:"UnknownError"}),lu=Object.freeze({Init:0,0:"Init",Seeked:1,1:"Seeked",Seeking:2,2:"Seeking",Ended:3,3:"Ended",ReadyStateChanged:4,4:"ReadyStateChanged",RegularInterval:5,5:"RegularInterval",Error:6,6:"Error"}),pu=Object.freeze({MediaPlaylistRefresh:0,0:"MediaPlaylistRefresh",RetryRequest:1,1:"RetryRequest"}),ut=Object.freeze({Error:0,0:"Error",Warn:1,1:"Warn",Info:2,2:"Info",Debug:3,3:"Debug"}),we=Object.freeze({Audio:0,0:"Audio",Video:1,1:"Video"}),dt=Object.freeze({Closed:0,0:"Closed",Ended:1,1:"Ended",Open:2,2:"Open"}),Q=class{static __wrap(a){let f=Object.create(Q.prototype);return f.ptr=a,f}__destroy_into_raw(){let a=this.ptr;return this.ptr=0,a}free(){let a=this.__destroy_into_raw();T.__wbg_addsourcebufferresult_free(a)}static success(a){let f=T.addsourcebufferresult_success(a);return Q.__wrap(f)}static error(a,f){var c=z(f)?0:Se(f,T.__wbindgen_malloc,T.__wbindgen_realloc),g=re;let y=T.addsourcebufferresult_error(a,c,g);return Q.__wrap(y)}},se=class{static __wrap(a){let f=Object.create(se.prototype);return f.ptr=a,f}__destroy_into_raw(){let a=this.ptr;return this.ptr=0,a}free(){let a=this.__destroy_into_raw();T.__wbg_appendbufferresult_free(a)}static success(a,f){let c=T.appendbufferresult_success(!z(a),z(a)?0:a,!z(f),z(f)?0:f);return se.__wrap(c)}static error(a,f){var c=z(f)?0:Se(f,T.__wbindgen_malloc,T.__wbindgen_realloc),g=re;let y=T.appendbufferresult_error(a,c,g);return se.__wrap(y)}},xe=class{static __wrap(a){let f=Object.create(xe.prototype);return f.ptr=a,f}__destroy_into_raw(){let a=this.ptr;return this.ptr=0,a}free(){let a=this.__destroy_into_raw();T.__wbg_attachmediasourceresult_free(a)}static success(){let a=T.attachmediasourceresult_success();return xe.__wrap(a)}static error(a,f){var c=z(f)?0:Se(f,T.__wbindgen_malloc,T.__wbindgen_realloc),g=re;let y=T.attachmediasourceresult_error(a,c,g);return xe.__wrap(y)}},We=class{static __wrap(a){let f=Object.create(We.prototype);return f.ptr=a,f}__destroy_into_raw(){let a=this.ptr;return this.ptr=0,a}free(){let a=this.__destroy_into_raw();T.__wbg_dispatcher_free(a)}constructor(a){let f=T.dispatcher_new(a);return We.__wrap(f)}load_content(a){let f=Se(a,T.__wbindgen_malloc,T.__wbindgen_realloc),c=re;T.dispatcher_load_content(this.ptr,f,c)}flush_buffer(a){T.dispatcher_flush_buffer(this.ptr,a)}minimum_position(){try{let c=T.__wbindgen_add_to_stack_pointer(-16);T.dispatcher_minimum_position(c,this.ptr);var a=Qe()[c/4+0],f=Ye()[c/8+1];return a===0?void 0:f}finally{T.__wbindgen_add_to_stack_pointer(16)}}maximum_position(){try{let c=T.__wbindgen_add_to_stack_pointer(-16);T.dispatcher_maximum_position(c,this.ptr);var a=Qe()[c/4+0],f=Ye()[c/8+1];return a===0?void 0:f}finally{T.__wbindgen_add_to_stack_pointer(16)}}set_wanted_speed(a){T.dispatcher_set_wanted_speed(this.ptr,a)}set_buffer_goal(a){T.dispatcher_set_buffer_goal(this.ptr,a)}stop(){T.dispatcher_stop(this.ptr)}lock_variant(a){T.dispatcher_lock_variant(this.ptr,a)}unlock_variant(){T.dispatcher_unlock_variant(this.ptr)}set_audio_track(a){T.dispatcher_set_audio_track(this.ptr,!z(a),z(a)?0:a)}set_segment_request_timeout(a){T.dispatcher_set_segment_request_timeout(this.ptr,!z(a),z(a)?0:a)}set_segment_backoff_base(a){T.dispatcher_set_segment_backoff_base(this.ptr,a)}set_segment_backoff_max(a){T.dispatcher_set_segment_backoff_max(this.ptr,a)}set_multi_variant_playlist_request_timeout(a){T.dispatcher_set_multi_variant_playlist_request_timeout(this.ptr,!z(a),z(a)?0:a)}set_multi_variant_playlist_backoff_base(a){T.dispatcher_set_multi_variant_playlist_backoff_base(this.ptr,a)}set_multi_variant_playlist_backoff_max(a){T.dispatcher_set_multi_variant_playlist_backoff_max(this.ptr,a)}set_media_playlist_request_timeout(a){T.dispatcher_set_media_playlist_request_timeout(this.ptr,!z(a),z(a)?0:a)}set_media_playlist_backoff_base(a){T.dispatcher_set_media_playlist_backoff_base(this.ptr,a)}set_media_playlist_backoff_max(a){T.dispatcher_set_media_playlist_backoff_max(this.ptr,a)}on_request_finished(a,f,c,g,y){let b=Se(g,T.__wbindgen_malloc,T.__wbindgen_realloc),M=re;T.dispatcher_on_request_finished(this.ptr,a,f,c,b,M,y)}on_request_failed(a,f,c){T.dispatcher_on_request_failed(this.ptr,a,f,!z(c),z(c)?0:c)}on_media_source_state_change(a){T.dispatcher_on_media_source_state_change(this.ptr,a)}on_source_buffer_update(a,f){pe(f,Z);var c=f.ptr;f.ptr=0,T.dispatcher_on_source_buffer_update(this.ptr,a,c)}on_source_buffer_creation_error(a,f,c){let g=Se(c,T.__wbindgen_malloc,T.__wbindgen_realloc),y=re;T.dispatcher_on_source_buffer_creation_error(this.ptr,a,f,g,y)}on_append_buffer_error(a,f){T.dispatcher_on_append_buffer_error(this.ptr,a,f)}on_remove_buffer_error(a){T.dispatcher_on_remove_buffer_error(this.ptr,a)}on_playback_tick(a){pe(a,Pe);var f=a.ptr;a.ptr=0,T.dispatcher_on_playback_tick(this.ptr,f)}on_timer_ended(a,f){T.dispatcher_on_timer_ended(this.ptr,a,f)}on_codecs_support_update(){T.dispatcher_on_codecs_support_update(this.ptr)}},ye=class{static __wrap(a){let f=Object.create(ye.prototype);return f.ptr=a,f}__destroy_into_raw(){let a=this.ptr;return this.ptr=0,a}free(){let a=this.__destroy_into_raw();T.__wbg_endofstreamresult_free(a)}static success(){let a=T.attachmediasourceresult_success();return ye.__wrap(a)}static error(a,f){var c=z(f)?0:Se(f,T.__wbindgen_malloc,T.__wbindgen_realloc),g=re;let y=T.attachmediasourceresult_error(a,c,g);return ye.__wrap(y)}},Z=class{static __wrap(a){let f=Object.create(Z.prototype);return f.ptr=a,f}__destroy_into_raw(){let a=this.ptr;return this.ptr=0,a}free(){let a=this.__destroy_into_raw();T.__wbg_jstimeranges_free(a)}constructor(a){let f=Vs(a,T.__wbindgen_malloc),c=re,g=T.jstimeranges_new(f,c);return Z.__wrap(g)}len(){return T.jstimeranges_len(this.ptr)>>>0}start(a){try{let g=T.__wbindgen_add_to_stack_pointer(-16);T.jstimeranges_start(g,this.ptr,a);var f=Qe()[g/4+0],c=Ye()[g/8+1];return f===0?void 0:c}finally{T.__wbindgen_add_to_stack_pointer(16)}}start_unchecked(a){return T.jstimeranges_start_unchecked(this.ptr,a)}end(a){try{let g=T.__wbindgen_add_to_stack_pointer(-16);T.jstimeranges_end(g,this.ptr,a);var f=Qe()[g/4+0],c=Ye()[g/8+1];return f===0?void 0:c}finally{T.__wbindgen_add_to_stack_pointer(16)}}end_unchecked(a){return T.jstimeranges_end_unchecked(this.ptr,a)}},Pe=class{static __wrap(a){let f=Object.create(Pe.prototype);return f.ptr=a,f}__destroy_into_raw(){let a=this.ptr;return this.ptr=0,a}free(){let a=this.__destroy_into_raw();T.__wbg_mediaobservation_free(a)}constructor(a,f,c,g,y,b,M,w,I,P){pe(g,Z);var D=g.ptr;g.ptr=0;let J=0;z(I)||(pe(I,Z),J=I.ptr,I.ptr=0);let B=0;z(P)||(pe(P,Z),B=P.ptr,P.ptr=0);let ee=T.mediaobservation_new(a,f,c,D,y,b,M,w,J,B);return Pe.__wrap(ee)}},ue=class{static __wrap(a){let f=Object.create(ue.prototype);return f.ptr=a,f}__destroy_into_raw(){let a=this.ptr;return this.ptr=0,a}free(){let a=this.__destroy_into_raw();T.__wbg_mediasourcedurationupdateresult_free(a)}static success(){let a=T.attachmediasourceresult_success();return ue.__wrap(a)}static error(a,f){var c=z(f)?0:Se(f,T.__wbindgen_malloc,T.__wbindgen_realloc),g=re;let y=T.attachmediasourceresult_error(a,c,g);return ue.__wrap(y)}};var he=class{static __wrap(a){let f=Object.create(he.prototype);return f.ptr=a,f}__destroy_into_raw(){let a=this.ptr;return this.ptr=0,a}free(){let a=this.__destroy_into_raw();T.__wbg_removebufferresult_free(a)}static success(){let a=T.attachmediasourceresult_success();return he.__wrap(a)}static error(a,f){var c=z(f)?0:Se(f,T.__wbindgen_malloc,T.__wbindgen_realloc),g=re;let y=T.attachmediasourceresult_error(a,c,g);return he.__wrap(y)}},me=class{static __wrap(a){let f=Object.create(me.prototype);return f.ptr=a,f}__destroy_into_raw(){let a=this.ptr;return this.ptr=0,a}free(){let a=this.__destroy_into_raw();T.__wbg_removemediasourceresult_free(a)}static success(){let a=T.attachmediasourceresult_success();return me.__wrap(a)}static error(a,f){var c=z(f)?0:Se(f,T.__wbindgen_malloc,T.__wbindgen_realloc),g=re;let y=T.attachmediasourceresult_error(a,c,g);return me.__wrap(y)}};async function $s(d,a){if(typeof Response=="function"&&d instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(d,a)}catch(c){if(d.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",c);else throw c}let f=await d.arrayBuffer();return await WebAssembly.instantiate(f,a)}else{let f=await WebAssembly.instantiate(d,a);return f instanceof WebAssembly.Instance?{instance:f,module:d}:f}}function Qs(){let d={};return d.wbg={},d.wbg.__wbg_jsClearTimer_8c0c0ae173bd59ca=typeof jsClearTimer=="function"?jsClearTimer:_e("jsClearTimer"),d.wbg.__wbg_jsLog_da12411f674ee50f=function(a,f,c){jsLog(a>>>0,ae(f,c))},d.wbg.__wbg_jsAddSourceBuffer_f769ac5dd28e087f=function(a,f,c){let g=jsAddSourceBuffer(a>>>0,ae(f,c));pe(g,Q);var y=g.ptr;return g.ptr=0,y},d.wbg.__wbg_jsAppendBuffer_1c43e16b9b4bc73f=function(a,f,c){let g=jsAppendBuffer(a>>>0,f>>>0,c!==0);pe(g,se);var y=g.ptr;return g.ptr=0,y},d.wbg.__wbg_jsFreeResource_efd8cc10a164752b=function(a){return jsFreeResource(a>>>0)},d.wbg.__wbg_jsRemoveBuffer_7c8602dd25fa17ac=function(a,f,c){let g=jsRemoveBuffer(a>>>0,f,c);pe(g,he);var y=g.ptr;return g.ptr=0,y},d.wbg.__wbg_jsFlush_6979bb2739e93013=typeof jsFlush=="function"?jsFlush:_e("jsFlush"),d.wbg.__wbg_jsRemoveMediaSource_bfd555f14dbd804d=function(){let a=jsRemoveMediaSource();pe(a,me);var f=a.ptr;return a.ptr=0,f},d.wbg.__wbg_jsSetPlaybackRate_de156f1496b14d47=typeof jsSetPlaybackRate=="function"?jsSetPlaybackRate:_e("jsSetPlaybackRate"),d.wbg.__wbg_jsAttachMediaSource_69fcab1c5cd6f603=function(){let a=jsAttachMediaSource();pe(a,xe);var f=a.ptr;return a.ptr=0,f},d.wbg.__wbg_jsSeek_264e96c2a274615f=typeof jsSeek=="function"?jsSeek:_e("jsSeek"),d.wbg.__wbg_jsSetMediaOffset_b84e1bab99ac5cad=typeof jsSetMediaOffset=="function"?jsSetMediaOffset:_e("jsSetMediaOffset"),d.wbg.__wbg_jsStartRebuffering_ff24142a3cf4d30c=typeof jsStartRebuffering=="function"?jsStartRebuffering:_e("jsStartRebuffering"),d.wbg.__wbg_jsStopRebuffering_c74903de694ec3b1=typeof jsStopRebuffering=="function"?jsStopRebuffering:_e("jsStopRebuffering"),d.wbg.__wbg_jsEndOfStream_d21dc02fa7e95e93=function(){let a=jsEndOfStream();pe(a,ye);var f=a.ptr;return a.ptr=0,f},d.wbg.__wbg_jsGetResourceData_1a5580de201a7896=function(a,f){let c=jsGetResourceData(f>>>0);var g=z(c)?0:zs(c,T.__wbindgen_malloc),y=re;Qe()[a/4+1]=y,Qe()[a/4+0]=g},d.wbg.__wbg_jsTimer_13ace9ec5780a1dd=function(a,f){return jsTimer(a,f>>>0)},d.wbg.__wbg_jsFetch_1c0faf7eaeeec79c=function(a,f,c,g,y,b,M,w){return jsFetch(ae(a,f),c===0?void 0:g>>>0,y===0?void 0:b>>>0,M===0?void 0:w)},d.wbg.__wbg_jsAbortRequest_3ad497cfce2a4eb6=function(a){return jsAbortRequest(a>>>0)},d.wbg.__wbg_jsSetMediaSourceDuration_4c22750bc2e2b8b6=function(a){let f=jsSetMediaSourceDuration(a);pe(f,ue);var c=f.ptr;return f.ptr=0,c},d.wbg.__wbg_jsIsTypeSupported_cc39ec5e3b1d710b=function(a,f,c){let g=jsIsTypeSupported(a>>>0,ae(f,c));return z(g)?16777215:g?1:0},d.wbg.__wbg_jsStartObservingPlayback_39e965722ac389f3=typeof jsStartObservingPlayback=="function"?jsStartObservingPlayback:_e("jsStartObservingPlayback"),d.wbg.__wbg_jsStopObservingPlayback_6ba8aea701a8a72e=typeof jsStopObservingPlayback=="function"?jsStopObservingPlayback:_e("jsStopObservingPlayback"),d.wbg.__wbg_jsUpdateContentInfo_e4cbd198194c3a1a=function(a,f,c,g){jsUpdateContentInfo(a===0?void 0:f,c===0?void 0:g)},d.wbg.__wbg_jsAnnounceFetchedContent_a0a421e7a9036854=function(a,f,c,g){var y=ri(a,f).slice();T.__wbindgen_free(a,f*4);var b=ri(c,g).slice();T.__wbindgen_free(c,g*4),jsAnnounceFetchedContent(y,b)},d.wbg.__wbg_jsAnnounceVariantUpdate_a50003c5ef2c1dc1=function(a,f){jsAnnounceVariantUpdate(a===0?void 0:f>>>0)},d.wbg.__wbg_jsAnnounceTrackUpdate_4e8069a8bd9aafb1=function(a,f,c,g){jsAnnounceTrackUpdate(a>>>0,f===0?void 0:c>>>0,g!==0)},d.wbg.__wbg_jsAnnounceVariantLockStatusChange_75b068f7344b2e6c=function(a,f){jsAnnounceVariantLockStatusChange(a===0?void 0:f>>>0)},d.wbg.__wbg_jsGetRandom_3867cb77f6e082d0=typeof jsGetRandom=="function"?jsGetRandom:_e("jsGetRandom"),d.wbg.__wbg_jsSendSegmentRequestError_0455bb1653666d65=function(a,f,c,g,y,b,M,w,I,P){let D;y!==0&&(D=qs(y,b).slice(),T.__wbindgen_free(y,b*8)),jsSendSegmentRequestError(a!==0,ae(f,c),g!==0,D,M>>>0,w>>>0,I===0?void 0:P>>>0)},d.wbg.__wbg_jsSendMultivariantPlaylistRequestError_f0db92d5b4dbda5c=function(a,f,c,g,y,b){jsSendMultivariantPlaylistRequestError(a!==0,ae(f,c),g>>>0,y===0?void 0:b>>>0)},d.wbg.__wbg_jsSendMediaPlaylistRequestError_87768af8e637b2e7=function(a,f,c,g,y,b,M){jsSendMediaPlaylistRequestError(a!==0,ae(f,c),g>>>0,y>>>0,b===0?void 0:M>>>0)},d.wbg.__wbg_jsSendSourceBufferCreationError_1ee543731598bb5a=function(a,f,c,g,y){jsSendSourceBufferCreationError(a!==0,f>>>0,c>>>0,ae(g,y))},d.wbg.__wbg_jsSendMultivariantPlaylistParsingError_6b1d07b94dc1374d=function(a,f,c,g){jsSendMultivariantPlaylistParsingError(a!==0,f>>>0,ae(c,g))},d.wbg.__wbg_jsSendMediaPlaylistParsingError_0e35e3abcc6f53a3=function(a,f,c,g,y){jsSendMediaPlaylistParsingError(a!==0,f>>>0,c>>>0,ae(g,y))},d.wbg.__wbg_jsSendSegmentParsingError_975bbf9310481404=function(a,f,c,g,y){jsSendSegmentParsingError(a!==0,f>>>0,c>>>0,ae(g,y))},d.wbg.__wbg_jsSendPushedSegmentError_900fff826115ca5c=function(a,f,c,g,y){jsSendPushedSegmentError(a!==0,f>>>0,c>>>0,ae(g,y))},d.wbg.__wbg_jsSendRemovedBufferError_d3012772e13f20d4=function(a,f,c,g){jsSendRemovedBufferError(a!==0,f>>>0,ae(c,g))},d.wbg.__wbg_jsSendOtherError_0a8a2a484be8df74=function(a,f,c,g){jsSendOtherError(a!==0,f>>>0,ae(c,g))},d.wbg.__wbindgen_throw=function(a,f){throw new Error(ae(a,f))},d}function Ys(d,a){return T=d.exports,ai.__wbindgen_wasm_module=a,Nt=new Float64Array,Bt=new Int32Array,Wt=new Uint32Array,Rt=new Uint8Array,T}async function ai(d){typeof d>"u"&&(d=new URL("wasp_hls_bg.wasm",Xs.url));let a=Qs();(typeof d=="string"||typeof Request=="function"&&d instanceof Request||typeof URL=="function"&&d instanceof URL)&&(d=fetch(d));let{instance:f,module:c}=await $s(await d,a);return Ys(f,c)}var si=ai;var Sr=class{constructor(){this._instanceInfo=null}hasMseInWorker(){return this._instanceInfo?.hasMseInWorker}canDemuxMpeg2Ts(){return this._instanceInfo?.canDemuxMpeg2Ts}start(a,f,c){let g=new We(c.initialBandwidth);Tr(g,f),this._instanceInfo={wasm:a,dispatcher:g,content:null,hasMseInWorker:c.hasMseInWorker,canDemuxMpeg2Ts:c.canDemuxMpeg2Ts}}dispose(){this._instanceInfo?.dispatcher.free(),Ue.freeEverything(),ke.freeEverything()}changeContent(a){if(this._instanceInfo===null){A.error("Worker: Cannot call `changeContent`: `PlayerInstance` not started.");return}Ue.freeEverything(),ke.freeEverything(),this._instanceInfo.content=a}getDispatcher(){return this._instanceInfo?.dispatcher??null}getCurrentWasmMemory(){return this._instanceInfo?.wasm.memory??null}getContentInfo(){return this._instanceInfo?.content??null}},Gt=class{constructor(){this._generateId=ti(),this._store={}}create(a){let f=this._generateId();return this._store[f]=a,f}delete(a){delete this._store[a]}get(a){return this._store[a]}freeEverything(){this._store={}}},Fe=new Map,E=new Sr,Ue=new Gt,ke=new Gt;function Tr(d,a){a.bufferGoal!==void 0&&d.set_buffer_goal(a.bufferGoal),a.segmentRequestTimeout!==void 0&&d.set_segment_request_timeout(a.segmentRequestTimeout??void 0),a.segmentBackoffBase!==void 0&&d.set_segment_backoff_base(a.segmentBackoffBase),a.segmentBackoffMax!==void 0&&d.set_segment_backoff_max(a.segmentBackoffMax),a.multiVariantPlaylistRequestTimeout!==void 0&&d.set_multi_variant_playlist_request_timeout(a.multiVariantPlaylistRequestTimeout??void 0),a.multiVariantPlaylistBackoffBase!==void 0&&d.set_multi_variant_playlist_backoff_base(a.multiVariantPlaylistBackoffBase),a.multiVariantPlaylistBackoffMax!==void 0&&d.set_multi_variant_playlist_backoff_max(a.multiVariantPlaylistBackoffMax),a.multiVariantPlaylistRequestTimeout!==void 0&&d.set_media_playlist_request_timeout(a.multiVariantPlaylistRequestTimeout??void 0),a.multiVariantPlaylistBackoffBase!==void 0&&d.set_media_playlist_backoff_base(a.multiVariantPlaylistBackoffBase),a.multiVariantPlaylistBackoffMax!==void 0&&d.set_media_playlist_backoff_max(a.multiVariantPlaylistBackoffMax)}function qt(){let d=E.getContentInfo();if(d===null)return;let{mediaSourceObj:a}=d;if(a!==null)return a}function oi(d){let a=Zs(d);if(a===null)return;let f=Ie(a,1952867444);if(f===null)return;let c=f[0];return c===1?li(f,4):c===0?De(f,4):void 0}function ui(d){let a=Js(d);if(a.length===0)return;let f=0;for(let c of a){let g=Ie(c,1953658222);if(g===null)return;let y=0,b=g[y];if(y+=1,b>1)return;let M=ci(g,y);y+=3;let w=(M&256)>0,I=0;if(!w&&(I=Ks(c),I===void 0))return;let P=(M&1)>0,D=(M&4)>0,J=(M&512)>0,B=(M&1024)>0,ee=(M&2048)>0,Y=De(g,y);y+=4,P&&(y+=4),D&&(y+=4);let ge=Y,X=0;for(;ge-- >0;)w?(X+=De(g,y),y+=4):X+=I,J&&(y+=4),B&&(y+=4),ee&&(y+=4);f+=X}return f}function di(d){let a=eo(d);if(a===null)return;let f=Ie(a,1835296868);if(f===null)return;let c=0,g=f[c];return c+=4,g===1?De(f,c+16):g===0?De(f,c+8):void 0}function Ks(d){let a=Ie(d,1952868452);if(a===null)return;let f=1,c=ci(a,f);f+=3;let g=(c&1)>0,y=(c&2)>0;return(c&8)>0?(f+=4,g&&(f+=8),y&&(f+=4),De(a,f)):void 0}function Zs(d){let a=Ie(d,1836019558);return a===null?null:Ie(a,1953653094)}function Js(d){return to(d,1836019558).reduce((f,c)=>{let g=Ie(c,1953653094);return g!==null&&f.push(g),f},[])}function eo(d){let a=Ie(d,1836019574);if(a===null)return null;let f=Ie(a,1953653099);return f===null?null:Ie(f,1835297121)}function Ie(d,a){let f=fi(d,a);return f!==null?d.subarray(f[1],f[2]):null}function to(d,a){let f=[],c=d;for(;;){let g=fi(c,a);if(g===null)return f;if(g[2]===0||c.length===0)throw new Error("Error while parsing ISOBMFF box");f.push(c.subarray(g[1],g[2])),c=c.subarray(g[2])}}function fi(d,a){let f=d.length,c=0,g,y=0,b;for(;c+8<=f;){if(b=c,y=De(d,b),b+=4,g=De(d,b),b+=4,y===0)y=f-c;else if(y===1){if(b+8>f)return null;y=li(d,b),b+=8}if(y<0)throw new Error("ISOBMFF: Size out of range");if(g===a)return a===1970628964&&(b+=16),[c,b,c+y];c+=y}return null}function ci(d,a){return d[a+0]*65536+d[a+1]*256+d[a+2]}function De(d,a){return d[a+0]*16777216+d[a+1]*65536+d[a+2]*256+d[a+3]}function li(d,a){return(d[a+0]*16777216+d[a+1]*65536+d[a+2]*256+d[a+3])*4294967296+d[a+4]*16777216+d[a+5]*65536+d[a+6]*256+d[a+7]}function k(d,a){A.debug("<-- sending to main:",d.type),a===void 0?postMessage(d):postMessage(d,a)}var gi=Ls(mi());function Ve(d,a){return d instanceof Error?d.name+": "+d.message:a}var ro=/^[a-z]+\/mp2t;/i;function no(d){return ro.test(d)}function Er(d){return Mr(d)?typeof MediaSource>"u"?Fe.get(d)!==!0:!MediaSource.isTypeSupported(d):!1}function Mr(d){return no(d)&&globalThis.hasTransmuxer}globalThis.hasTransmuxer=!0;var ze;function Cr(d,a){if(!Mr(d))return d;let f=d.replace(/mp2t/i,"mp4");a===we.Audio&&(f=d.replace(/video/i,"audio"));let c=/avc1\.(66|77|100)\.(\d+)/.exec(f);if(c){let g=c[1],y;g==="66"?y="4200":g==="77"?y="4d00":(g!=="100"&&A.error("Impossible regex catch"),y="6400");let b=Number(c[2]);b>=256&&A.error("Invalid legacy avc1 level number.");let M=(b>>4).toString(16)+(b&15).toString(16);f=`avc1.${y}${M}`}return f}function xi(){ze=void 0}function Ar(d){ze===void 0&&(ze=new gi.default.mp4.Transmuxer);let a=[];if(ze.on("data",f),ze.push(d),ze.flush(),ze.off("data",f),a.length===0)return null;if(a.length===1)return a[0];{let c=a.reduce((b,M)=>b+M.byteLength,0),g=new Uint8Array(c),y=0;for(let b of a)g.set(b,y),y+=b.byteLength;return g}function f(c){let g=new Uint8Array(c.initSegment.byteLength+c.data.byteLength);g.set(c.initSegment,0),g.set(c.data,c.initSegment.byteLength),a.push(g)}}var Fr=typeof performance!="object"||performance===null||typeof performance.now!="function"?Date.now.bind(Date):performance.now.bind(performance),yi=br(),Pr=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});function ao(d,a,f,c,g,y,b){let M=E.getContentInfo()?.contentId;if(M===void 0){A.error("Cannot send error, no contentId");return}k({type:d?"err":"warn",value:{contentId:M,errorInfo:{type:"segment-request",value:{url:a,isInit:f,start:c?.[0],duration:c?.[1],mediaType:g,reason:y,status:b}}}})}function so(d,a,f,c){let g=E.getContentInfo()?.contentId;if(g===void 0){A.error("Cannot send error, no contentId");return}k({type:d?"err":"warn",value:{contentId:g,errorInfo:{type:"multi-var-playlist-request",value:{url:a,reason:f,status:c}}}})}function oo(d,a,f,c,g){let y=E.getContentInfo()?.contentId;if(y===void 0){A.error("Cannot send error, no contentId");return}k({type:d?"err":"warn",value:{contentId:y,errorInfo:{type:"media-playlist-request",value:{url:a,reason:f,mediaType:c,status:g}}}})}function uo(d,a,f,c){let g=E.getContentInfo()?.contentId;if(g===void 0){A.error("Cannot send error, no contentId");return}k({type:d?"err":"warn",value:{contentId:g,message:c,errorInfo:{type:"push-segment-error",value:{code:a,mediaType:f}}}})}function fo(d,a,f){let c=E.getContentInfo()?.contentId;if(c===void 0){A.error("Cannot send error, no contentId");return}k({type:d?"err":"warn",value:{contentId:c,message:f,errorInfo:{type:"remove-buffer-error",value:{mediaType:a}}}})}function co(d,a,f){let c=E.getContentInfo()?.contentId;if(c===void 0){A.error("Cannot send error, no contentId");return}k({type:d?"err":"warn",value:{contentId:c,message:f,errorInfo:{type:"other-error",value:{code:a}}}})}function lo(d,a,f){let c=E.getContentInfo()?.contentId;if(c===void 0){A.error("Cannot send error, no contentId");return}k({type:d?"err":"warn",value:{contentId:c,message:f,errorInfo:{type:"multi-var-playlist-parse",value:{code:a}}}})}function po(d,a,f,c){let g=E.getContentInfo()?.contentId;if(g===void 0){A.error("Cannot send error, no contentId");return}k({type:d?"err":"warn",value:{contentId:g,message:c,errorInfo:{type:"media-playlist-parse",value:{code:a,mediaType:f}}}})}function ho(d,a,f,c){let g=E.getContentInfo()?.contentId;if(g===void 0){A.error("Cannot send error, no contentId");return}k({type:d?"err":"warn",value:{contentId:g,message:c,errorInfo:{type:"sb-creation",value:{code:a,mediaType:f}}}})}function mo(d,a,f,c){let g=E.getContentInfo()?.contentId;if(g===void 0){A.error("Cannot send error, no contentId");return}k({type:d?"err":"warn",value:{contentId:g,message:c,errorInfo:{type:"segment-parse",value:{code:a,mediaType:f}}}})}function go(d){return Ue.get(d)}function xo(d,a){let f=Fr().toFixed(2);switch(d){case ut.Error:A.error(f,a);break;case ut.Warn:A.warn(f,a);break;case ut.Info:A.info(f,a);break;case ut.Debug:A.debug(f,a);break}}function yo(d,a){let f=self.setTimeout(()=>{let c=E.getDispatcher();c!==null&&c.on_timer_ended(f,a)},d);return f}function bo(d){clearTimeout(d)}function vo(d,a,f,c){let g=!1,y=new AbortController,b=ke.create({abortController:y}),M=Fr(),w;c!==void 0&&(w=setTimeout(()=>{g=!0,y.abort()},c));let I=[];return a!==void 0&&I.push(["Range",`${a}-${f??""}`]),fetch(d,{signal:y.signal,headers:I}).then(async P=>{w!==void 0&&clearTimeout(w);let D=E.getDispatcher();if(P.status>=300){D?.on_request_failed(b,!1,P.status);return}let J=await P.arrayBuffer(),B=Fr()-M;if(ke.delete(b),D!==null){let ee=new Uint8Array(J),Y=Ue.create(ee);D.on_request_finished(b,Y,ee.byteLength,P.url,B)}}).catch(P=>{ke.delete(b);let D=E.getDispatcher();if(g){D?.on_request_failed(b,!0,void 0);return}P instanceof Error&&P.name==="AbortError"||D?.on_request_failed(b,!1,void 0)}),b}function _o(d){let a=ke.get(d);return a!==void 0?(a.abortController.abort(),Promise.resolve().then(()=>{ke.delete(d)}),!0):!1}function So(d){let a=E.getContentInfo();if(a===null||a.mediaSourceObj===null){A.error("Attempting to seek when no MediaSource is created");return}k({type:"seek",value:{mediaSourceId:a.mediaSourceObj.mediaSourceId,position:d}})}function To(){let d=E.getContentInfo();if(d===null||d.mediaSourceObj===null){A.error("Attempting to flush when no MediaSource is created");return}k({type:"flush",value:{mediaSourceId:d.mediaSourceObj.mediaSourceId}})}function wo(d){let a=E.getContentInfo();if(a===null||a.mediaSourceObj===null){A.error("Attempting to set playback rate when no MediaSource is created");return}k({type:"upd-pbr",value:{mediaSourceId:a.mediaSourceObj.mediaSourceId,playbackRate:d}})}function Io(){let d=E.getContentInfo();if(d===null)return xe.error(vr.NoContentLoaded);try{let a=function(){E.getDispatcher()?.on_media_source_state_change(dt.Ended)},f=function(){E.getDispatcher()?.on_media_source_state_change(dt.Open)},c=function(){E.getDispatcher()?.on_media_source_state_change(dt.Closed)};if(E.hasMseInWorker()!==!0){let g=yi();d.mediaSourceObj={nextSourceBufferId:0,sourceBuffers:[],type:"main",mediaSourceId:g},k({type:"create-ms",value:{contentId:d.contentId,mediaSourceId:g}})}else{let g=new MediaSource;g.addEventListener("sourceclose",c),g.addEventListener("sourceended",a),g.addEventListener("sourceopen",f);let y=()=>{g.removeEventListener("sourceclose",c),g.removeEventListener("sourceended",a),g.removeEventListener("sourceopen",f)},b=g.handle,M;b==null&&(M=URL.createObjectURL(g));let w=yi();d.mediaSourceObj={type:"worker",mediaSourceId:w,mediaSource:g,removeEventListeners:y,sourceBuffers:[],nextSourceBufferId:0},k({type:"attach-ms",value:{contentId:d.contentId,handle:b,src:M,mediaSourceId:w}},b!==void 0?[b]:[])}}catch{return xe.error(vr.UnknownError)}return xe.success()}function Eo(){let d=E.getContentInfo();if(d===null)return me.error(jt.NoMediaSourceAttached);if(d.mediaSourceObj===null)return me.error(jt.NoMediaSourceAttached);if(d.mediaSourceObj.type==="worker"){let{mediaSource:a,removeEventListeners:f}=d.mediaSourceObj;if(f(),a!==null&&a.readyState!=="closed"){let{readyState:c,sourceBuffers:g}=a;for(let y=g.length-1;y>=0;y--){let b=g[y];if(!b.updating)try{c==="open"&&b.abort(),a.removeSourceBuffer(b)}catch(M){let w=Ve(M,"Unknown error while removing SourceBuffer");return A.error("Could not remove SourceBuffer: "+w),me.error(jt.UnknownError,w)}}}}return k({type:"clear-ms",value:{mediaSourceId:d.mediaSourceObj.mediaSourceId}}),me.success()}function Mo(d){let a=E.getContentInfo();if(a===null)return ue.error(Vt.NoMediaSourceAttached);if(a.mediaSourceObj===null)return ue.error(Vt.NoMediaSourceAttached);if(a.mediaSourceObj.type==="worker")try{return a.mediaSourceObj.mediaSource.duration=d,ue.success()}catch{return ue.error(Vt.UnknownError)}else return k({type:"upd-ms-dur",value:{mediaSourceId:a.mediaSourceObj.mediaSourceId,duration:d}}),ue.success()}function Co(d,a){let f=E.getContentInfo();if(f===null)return Q.error(Te.NoMediaSourceAttached);if(f.mediaSourceObj===null)return Q.error(Te.NoMediaSourceAttached);if(f.mediaSourceObj.type==="main"){let{sourceBuffers:c,nextSourceBufferId:g}=f.mediaSourceObj;try{let y=a;Er(a)&&(y=Cr(a,d));let b=g;return c.push({lastInitTimescale:void 0,id:b,transmuxer:y===a?null:Ar,sourceBuffer:null,mediaType:d}),f.mediaSourceObj.nextSourceBufferId++,k({type:"creat-sb",value:{mediaSourceId:f.mediaSourceObj.mediaSourceId,sourceBufferId:b,contentType:y}}),Q.success(b)}catch(y){let b=Ve(y,"Unknown error while creating Sourcebuffer");return Q.error(Te.UnknownError,b)}}else{let{mediaSource:c,sourceBuffers:g,nextSourceBufferId:y}=f.mediaSourceObj;if(c.readyState==="closed")return Q.error(Te.MediaSourceIsClosed);if(a==="")return Q.error(Te.EmptyMimeType);try{let b=a;Er(a)&&(b=Cr(a,d));let M=c.addSourceBuffer(b),w=y,I=new st(M);return g.push({lastInitTimescale:void 0,id:w,sourceBuffer:I,transmuxer:b===a?null:Ar,mediaType:d}),f.mediaSourceObj.nextSourceBufferId++,Q.success(w)}catch(b){let M=Ve(b,"Unknown error while creating Sourcebuffer");return b instanceof Error?b.name==="QuotaExceededError"?Q.error(Te.QuotaExceededError,M):b.name==="NotSupportedError"?Q.error(Te.TypeNotSupportedError,M):Q.error(Te.UnknownError,M):Q.error(Te.UnknownError,M)}}}function Ao(d,a,f){let c=Ue.get(a),g=qt();if(c===void 0)return se.error(je.NoResource,"Segment preparation error: No resource with the given `resourceId`");if(g===void 0)return se.error(je.NoSourceBuffer,"Segment preparation error: No MediaSource attached");let y=g.sourceBuffers.findIndex(({id:I})=>I===d);if(y<-1)return se.error(je.NoSourceBuffer,"Segment preparation error: No SourceBuffer with the given `SourceBufferId`");let b=g.sourceBuffers[y];if(b.transmuxer!==null)try{let I=b.transmuxer(c);if(I!==null)c=I;else return se.error(je.TransmuxerError,"Segment preparation error: the transmuxer couldn't process the segment")}catch(I){let P=Ve(I,"Unknown error while transmuxing segment");return se.error(je.TransmuxerError,P)}let M=di(c);M!==void 0?b.lastInitTimescale=M:M=b.lastInitTimescale;let w;f===!0&&M!==void 0&&(w=Oo(c,M));try{if(b.sourceBuffer!==null)b.sourceBuffer.push(c).then(()=>{try{let I=b.sourceBuffer.getBufferedRanges(),P=new Z($e(I));E.getDispatcher()?.on_source_buffer_update(d,P)}catch(I){let P=I instanceof Error?I:"Unknown Error";A.error("Error when calling `on_source_buffer_update`",P)}}).catch(I=>{try{I instanceof Error&&I.name==="QuotaExceededError"?E.getDispatcher()?.on_append_buffer_error(d,Xe.BufferFull):E.getDispatcher()?.on_append_buffer_error(d,Xe.UnknownError)}catch(P){let D=P instanceof Error?P:"Unknown Error";A.error("Error when calling `on_append_buffer_error`",D)}});else{let I=c.buffer;k({type:"push-sb",value:{mediaSourceId:g.mediaSourceId,sourceBufferId:d,data:I}},[I])}}catch{return se.error(je.UnknownError)}return se.success(w?.time,w?.duration)}function Po(d,a,f){try{let c=qt();if(c===void 0)return he.error(zt.SourceBufferNotFound,"No MediaSource created.");if(c.type==="worker"){let g=c.sourceBuffers.find(({id:y})=>y===d);if(g===void 0)return he.error(zt.SourceBufferNotFound,"SourceBuffer linked to the given id not found.");g.sourceBuffer.removeBuffer(a,f).then(()=>{try{let y=g.sourceBuffer.getBufferedRanges(),b=new Z($e(y));E.getDispatcher()?.on_source_buffer_update(d,b)}catch(y){let b=y instanceof Error?y:"Unknown Error";A.error("Error when calling `on_source_buffer_update`",b)}}).catch(()=>{try{E.getDispatcher()?.on_remove_buffer_error(d)}catch(y){let b=y instanceof Error?y:"Unknown Error";A.error("Error when calling `on_remove_buffer_error`",b)}})}else k({type:"rem-sb",value:{mediaSourceId:c.mediaSourceId,sourceBufferId:d,start:a,end:f}})}catch(c){let g=Ve(c,"Unknown error while removing buffer");return he.error(zt.UnknownError,g)}return he.success()}function Uo(){try{let d=qt();if(d===void 0)return ye.error(_r.NoMediaSourceAttached,"There's no MediaSource attached currently.");d.type==="worker"?d.mediaSource.endOfStream():k({type:"eos",value:{mediaSourceId:d.mediaSourceId}})}catch(d){let a=Ve(d,"Unknown error while calling endOfStream");return ye.error(_r.UnknownError,a)}return ye.success()}function ko(){let d=E.getContentInfo();if(d!==null){if(d.mediaSourceObj===null){A.error("Cannot start observing playback: No MediaSource Attached");return}k({type:"start-obs",value:{mediaSourceId:d.mediaSourceObj.mediaSourceId}})}}function Dr(){let d=E.getContentInfo();d!==null&&d.mediaSourceObj!==null&&k({type:"stop-obs",value:{mediaSourceId:d.mediaSourceObj.mediaSourceId}})}function Fo(d){let a=E.getContentInfo();a!==null&&k({type:"media-off-upd",value:{contentId:a.contentId,offset:d}})}function Do(d){return Ue.get(d)===void 0?!1:(Ue.delete(d),!0)}function Oo(d,a){let f=oi(d);if(f===void 0)return null;let c=ui(d);return{time:f/a,duration:c===void 0?void 0:c/a}}function Ro(d,a){let f=E.getContentInfo();f!==null&&k({type:"time-upd",value:{contentId:f.contentId,minimumPosition:d,maximumPosition:a}})}function Lo(d,a){let f=E.getContentInfo(),c=E.getCurrentWasmMemory();if(f===null||c===null)return;let g=[];{let b=0;for(b++;b<d.length;){let M=d[b];b++;let w=d[b];b++;let I=d[b];b++;let P=d[b];b++;let D=d[b];b++,g.push({id:M,height:w,width:I,frameRate:P,bandwidth:D})}}let y=[];{let b=0;for(b++;b<a.length;){let M=a[b];b++;let w=a[b];b++;let I=new Uint8Array(c.buffer,a[b],w);b++;let P=Pr.decode(I),D=a[b];b++;let J=new Uint8Array(c.buffer,a[b],D);b++;let B=Pr.decode(J),ee=a[b];b++;let Y=new Uint8Array(c.buffer,a[b],ee);b++;let ge=Pr.decode(Y),X=a[b];b++,y.push({id:M,language:P===""?void 0:P,assocLanguage:B===""?void 0:B,name:ge,channels:X})}}k({type:"m-playlist",value:{contentId:f.contentId,variants:g,audioTracks:y}})}function Bo(d,a,f){let c=E.getContentInfo(),g=E.getCurrentWasmMemory();c===null||g===null||k({type:"track-upd",value:{mediaType:d,contentId:c.contentId,audioTrack:a?{current:a,isSelected:f}:void 0}})}function No(d){let a=E.getContentInfo();a!==null&&k({type:"variant-upd",value:{contentId:a.contentId,variantId:d}})}function Wo(){let d=E.getContentInfo();if(d===null||d.mediaSourceObj===null){A.error("Attempting to start rebuffering when no MediaSource is created");return}k({type:"rebuf-start",value:{mediaSourceId:d.mediaSourceObj.mediaSourceId,updatePlaybackRate:!0}})}function jo(){let d=E.getContentInfo();if(d===null||d.mediaSourceObj===null){A.error("Attempting to stop rebuffering when no MediaSource is created");return}k({type:"rebuf-end",value:{mediaSourceId:d.mediaSourceObj.mediaSourceId}})}function Vo(){return Math.random()}var Ur=new Set,kr=!1;function zo(d,a){let f=[],c;switch(d){case we.Audio:c="audio/";break;case we.Video:c="video/";break;default:return A.error("Unknown MediaType"),!1}if(E.canDemuxMpeg2Ts()===!0&&f.push(`${c}mp2t;codecs="${a}"`),f.push(`${c}mp4;codecs="${a}"`),E.hasMseInWorker()===!0)return f.some(y=>MediaSource.isTypeSupported(y));let g=f.map(y=>Fe.get(y)).filter(y=>y!==void 0);if(g.length>0)return g.some(y=>y);f.forEach(y=>Ur.add(y)),!kr&&(kr=!0,Promise.resolve().then(()=>{kr=!1,k({type:"are-types-supp",value:{mimeTypes:Array.from(Ur.keys())}}),Ur.clear()}).catch(()=>{}))}function Go(d){let a=E.getContentInfo();a!==null&&k({type:"variant-lck-upd",value:{contentId:a.contentId,lockedVariant:d??null}})}var bi=!1;function Or(){let d;onmessage=a;function a(f){if(f.origin!==""){A.error("Unexpected trans-origin message");return}let{data:c}=f;if(typeof c!="object"||c===null||typeof c.type>"u"){A.error("unexpected main message");return}if(c.type!=="init"&&c.type!=="dispose"&&d!==void 0){d.then(()=>{a(f)}).catch(le);return}switch(c.type){case"init":if(bi)return vi("Worker initialization already done",0);A.setLevel(c.value.logLevel),bi=!0;let{wasmUrl:g,hasMseInWorker:y,canDemuxMpeg2Ts:b,initialBandwidth:M}=c.value;d=qo(g,c.value.initialConfig,{hasMseInWorker:y,canDemuxMpeg2Ts:b,initialBandwidth:M}).then(()=>{d=void 0}).catch(w=>{d=void 0,vi(w,1)});break;case"dispose":Ho();break;case"load":{let w=E.getDispatcher();if(w===null)return Ht(c.value.contentId);let I={contentId:c.value.contentId,mediaSourceObj:null,observationsObj:null};E.changeContent(I),xi(),w.load_content(c.value.url);break}case"stop":{let w=E.getDispatcher();if(w===null)return Ht(c.value.contentId);let I=E.getContentInfo();if(I===null||I.contentId!==c.value.contentId)return;try{w.stop()}catch(P){let D=P instanceof Error?P:"Unknown Error";A.error("Error: when stopping the content:",D)}k({type:"ctnt-stop",value:{contentId:c.value.contentId}});break}case"ms-state":{let w=E.getDispatcher(),I=E.getContentInfo();if(w===null||I===null||I.mediaSourceObj?.mediaSourceId!==c.value.mediaSourceId)return;w.on_media_source_state_change(c.value.state);break}case"sb-s":{let w=E.getDispatcher(),I=E.getContentInfo();if(w===null||I===null||I.mediaSourceObj?.mediaSourceId!==c.value.mediaSourceId)return;let P=new Z(c.value.buffered);w.on_source_buffer_update(c.value.sourceBufferId,P);break}case"obs":{let w=E.getDispatcher(),I=E.getContentInfo();if(w===null||I===null||I.mediaSourceObj?.mediaSourceId!==c.value.mediaSourceId)return;let P,D;if(E.hasMseInWorker()===!0)for(let ee of I.mediaSourceObj.sourceBuffers){let Y=ee.sourceBuffer?.getBufferedRanges();if(Y!==void 0){let ge=$e(Y),X=new Z(ge);ee.mediaType===we.Audio?P=X:ee.mediaType===we.Video&&(D=X)}}else if(c.value.sourceBuffersBuffered!==null){let ee=c.value.sourceBuffersBuffered;for(let Y of I.mediaSourceObj.sourceBuffers){let ge=ee[Y.id];if(ge!==void 0){let X=new Z(ge);Y.mediaType===we.Audio?P=X:Y.mediaType===we.Video&&(D=X)}}}let J=new Z(c.value.buffered),B=new Pe(c.value.reason,c.value.currentTime,c.value.readyState,J,c.value.paused,c.value.seeking,c.value.ended,c.value.duration,P,D);w.on_playback_tick(B);break}case"create-ms":{let w=E.getDispatcher(),I=E.getContentInfo();if(w===null||I===null||I.mediaSourceObj?.mediaSourceId!==c.value.mediaSourceId)return;w.stop(),k({type:"err",value:{contentId:I.contentId,message:"Error while creating the `MediaSource`: "+c.value.message,errorInfo:{type:"other-error",value:{code:ii.MediaSourceAttachmentError}}}});break}case"update-ms-dur-err":{let w=E.getDispatcher(),I=E.getContentInfo();if(w===null||I===null||I.mediaSourceObj?.mediaSourceId!==c.value.mediaSourceId)return;A.error("Error: when setting the MediaSource's duration");break}case"create-sb":{let w=E.getDispatcher(),I=E.getContentInfo();if(w===null||I===null||I.mediaSourceObj?.mediaSourceId!==c.value.mediaSourceId)return;w.on_source_buffer_creation_error(c.value.sourceBufferId,c.value.code,c.value.message);break}case"upd-speed":{let w=E.getDispatcher(),I=E.getContentInfo();if(w===null||I===null||I.mediaSourceObj?.mediaSourceId!==c.value.mediaSourceId)return;w.set_wanted_speed(c.value.wantedSpeed);break}case"upd-log":A.setLevel(c.value);break;case"upd-conf":{let w=E.getDispatcher();if(w===null)return;Tr(w,c.value);break}case"set-audio":{let w=E.getDispatcher();if(w===null)return Ht(c.value.contentId);let I=E.getContentInfo();if(I===null||I.contentId!==c.value.contentId)return;w.set_audio_track(c.value.trackId??void 0);break}case"lock-var":{let w=E.getDispatcher();if(w===null)return Ht(c.value.contentId);let I=E.getContentInfo();if(I===null||I.contentId!==c.value.contentId)return;c.value.variantId===null?w.unlock_variant():w.lock_variant(c.value.variantId);break}case"codecs-support-upd":{let{mimeTypes:w}=c.value,I=Object.keys(w);Fe.size+I.length>50&&Fe.clear();for(let D of I){let J=w[D];J!==void 0&&Fe.set(D,J)}let P=E.getDispatcher();P!==null&&P.on_codecs_support_update()}break;case"sb-err":{let w=E.getDispatcher(),I=E.getContentInfo();if(w===null||I===null||I.mediaSourceObj?.mediaSourceId!==c.value.mediaSourceId)return;c.value.operation===1?w.on_remove_buffer_error(c.value.sourceBufferId):c.value.isBufferFull?w.on_append_buffer_error(c.value.sourceBufferId,Xe.BufferFull):w.on_append_buffer_error(c.value.sourceBufferId,Xe.UnknownError)}break;default:at(c)}}}function vi(d,a){let f;typeof d=="string"?f=d:d instanceof Error&&(f=d.message),k({type:"init-err",value:{code:a,message:f}})}function Ht(d){k({type:"err",value:{contentId:d,message:"Error: Worker not initialized.",errorInfo:{type:"unitialized",value:{}}}})}function qo(d,a,f){return si(fetch(d)).then(c=>{E.start(c,a,f),k({type:"init",value:null})}).catch(c=>{throw c})}function Ho(){Dr(),E.dispose()}Object.keys(ct).forEach(d=>{let a=self;d==="doFetch"&&(a.jsFetch=ct[d]);let f=d.charAt(0).toUpperCase()+d.slice(1);a[`js${f}`]=ct[d]});Or();})();
/*! @name mux.js @version 6.1.0 @license Apache-2.0 */
