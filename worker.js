(()=>{var xs=Object.create;var Nn=Object.defineProperty;var ys=Object.getOwnPropertyDescriptor;var vs=Object.getOwnPropertyNames;var bs=Object.getPrototypeOf,Ss=Object.prototype.hasOwnProperty;var jn=(c,o)=>()=>(o||c((o={exports:{}}).exports,o),o.exports);var _s=(c,o,p,x)=>{if(o&&typeof o=="object"||typeof o=="function")for(let m of vs(o))!Ss.call(c,m)&&m!==p&&Nn(c,m,{get:()=>o[m],enumerable:!(x=ys(o,m))||x.enumerable});return c};var Ts=(c,o,p)=>(p=c!=null?xs(bs(c)):{},_s(o||!c||!c.__esModule?Nn(p,"default",{value:c,enumerable:!0}):p,c));var Jn=jn((Oo,Zn)=>{var Ze;typeof window<"u"?Ze=window:typeof global<"u"?Ze=global:typeof self<"u"?Ze=self:Ze={};Zn.exports=Ze});var ei=jn((hr,mr)=>{(function(c,o){typeof hr=="object"&&typeof mr<"u"?mr.exports=o(Jn()):typeof define=="function"&&define.amd?define(["global/window"],o):(c=typeof globalThis<"u"?globalThis:c||self,c.muxjs=o(c.window))})(hr,function(c){"use strict";function o(s){return s&&typeof s=="object"&&"default"in s?s:{default:s}}var p=o(c),x=function(){this.init=function(){var e={};this.on=function(t,r){e[t]||(e[t]=[]),e[t]=e[t].concat(r)},this.off=function(t,r){var n;return e[t]?(n=e[t].indexOf(r),e[t]=e[t].slice(),e[t].splice(n,1),n>-1):!1},this.trigger=function(t){var r,n,i,a;if(r=e[t],!!r)if(arguments.length===2)for(i=r.length,n=0;n<i;++n)r[n].call(this,arguments[1]);else{for(a=[],n=arguments.length,n=1;n<arguments.length;++n)a.push(arguments[n]);for(i=r.length,n=0;n<i;++n)r[n].apply(this,a)}},this.dispose=function(){e={}}}};x.prototype.pipe=function(s){return this.on("data",function(e){s.push(e)}),this.on("done",function(e){s.flush(e)}),this.on("partialdone",function(e){s.partialFlush(e)}),this.on("endedtimeline",function(e){s.endTimeline(e)}),this.on("reset",function(e){s.reset(e)}),s},x.prototype.push=function(s){this.trigger("data",s)},x.prototype.flush=function(s){this.trigger("done",s)},x.prototype.partialFlush=function(s){this.trigger("partialdone",s)},x.prototype.endTimeline=function(s){this.trigger("endedtimeline",s)},x.prototype.reset=function(s){this.trigger("reset",s)};var m=x,y=9e4,_,I,M,O,Le,Je,et;_=function(e){return e*y},I=function(e,t){return e*t},M=function(e){return e/y},O=function(e,t){return e/t},Le=function(e,t){return _(O(e,t))},Je=function(e,t){return I(M(e),t)},et=function(e,t,r){return M(r?e:e-t)};var H={ONE_SECOND_IN_TS:y,secondsToVideoTs:_,secondsToAudioTs:I,videoTsToSeconds:M,audioTsToSeconds:O,audioTsToVideoTs:Le,videoTsToAudioTs:Je,metadataTsToSeconds:et},Rt=H.ONE_SECOND_IN_TS,Re,tt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];Re=function(e){var t,r=0;Re.prototype.init.call(this),this.skipWarn_=function(n,i){this.trigger("log",{level:"warn",message:"adts skiping bytes "+n+" to "+i+" in frame "+r+" outside syncword"})},this.push=function(n){var i=0,a,u,d,l,f;if(e||(r=0),n.type==="audio"){t&&t.length?(d=t,t=new Uint8Array(d.byteLength+n.data.byteLength),t.set(d),t.set(n.data,d.byteLength)):t=n.data;for(var h;i+7<t.length;){if(t[i]!==255||(t[i+1]&246)!==240){typeof h!="number"&&(h=i),i++;continue}if(typeof h=="number"&&(this.skipWarn_(h,i),h=null),u=(~t[i+1]&1)*2,a=(t[i+3]&3)<<11|t[i+4]<<3|(t[i+5]&224)>>5,l=((t[i+6]&3)+1)*1024,f=l*Rt/tt[(t[i+2]&60)>>>2],t.byteLength-i<a)break;this.trigger("data",{pts:n.pts+r*f,dts:n.dts+r*f,sampleCount:l,audioobjecttype:(t[i+2]>>>6&3)+1,channelcount:(t[i+2]&1)<<2|(t[i+3]&192)>>>6,samplerate:tt[(t[i+2]&60)>>>2],samplingfrequencyindex:(t[i+2]&60)>>>2,samplesize:16,data:t.subarray(i+7+u,i+a)}),r++,i+=a}typeof h=="number"&&(this.skipWarn_(h,i),h=null),t=t.subarray(i)}},this.flush=function(){r=0,this.trigger("done")},this.reset=function(){t=void 0,this.trigger("reset")},this.endTimeline=function(){t=void 0,this.trigger("endedtimeline")}},Re.prototype=new m;var ge=Re,Sr;Sr=function(e){var t=e.byteLength,r=0,n=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+n},this.loadWord=function(){var i=e.byteLength-t,a=new Uint8Array(4),u=Math.min(4,t);if(u===0)throw new Error("no bytes available");a.set(e.subarray(i,i+u)),r=new DataView(a.buffer).getUint32(0),n=u*8,t-=u},this.skipBits=function(i){var a;n>i?(r<<=i,n-=i):(i-=n,a=Math.floor(i/8),i-=a*8,t-=a,this.loadWord(),r<<=i,n-=i)},this.readBits=function(i){var a=Math.min(n,i),u=r>>>32-a;return n-=a,n>0?r<<=a:t>0&&this.loadWord(),a=i-a,a>0?u<<a|this.readBits(a):u},this.skipLeadingZeros=function(){var i;for(i=0;i<n;++i)if((r&2147483648>>>i)!==0)return r<<=i,n-=i,i;return this.loadWord(),i+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var i=this.skipLeadingZeros();return this.readBits(i+1)-1},this.readExpGolomb=function(){var i=this.readUnsignedExpGolomb();return 1&i?1+i>>>1:-1*(i>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var ui=Sr,rt,We,_r;We=function(){var e=0,t,r;We.prototype.init.call(this),this.push=function(n){var i;r?(i=new Uint8Array(r.byteLength+n.data.byteLength),i.set(r),i.set(n.data,r.byteLength),r=i):r=n.data;for(var a=r.byteLength;e<a-3;e++)if(r[e+2]===1){t=e+5;break}for(;t<a;)switch(r[t]){case 0:if(r[t-1]!==0){t+=2;break}else if(r[t-2]!==0){t++;break}e+3!==t-2&&this.trigger("data",r.subarray(e+3,t-2));do t++;while(r[t]!==1&&t<a);e=t-2,t+=3;break;case 1:if(r[t-1]!==0||r[t-2]!==0){t+=3;break}this.trigger("data",r.subarray(e+3,t-2)),e=t-2,t+=3;break;default:t+=3;break}r=r.subarray(e),t-=e,e=0},this.reset=function(){r=null,e=0,this.trigger("reset")},this.flush=function(){r&&r.byteLength>3&&this.trigger("data",r.subarray(e+3)),r=null,e=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},We.prototype=new m,_r={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},rt=function(){var e=new We,t,r,n,i,a,u,d;rt.prototype.init.call(this),t=this,this.push=function(l){l.type==="video"&&(r=l.trackId,n=l.pts,i=l.dts,e.push(l))},e.on("data",function(l){var f={trackId:r,pts:n,dts:i,data:l,nalUnitTypeCode:l[0]&31};switch(f.nalUnitTypeCode){case 5:f.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:f.nalUnitType="sei_rbsp",f.escapedRBSP=a(l.subarray(1));break;case 7:f.nalUnitType="seq_parameter_set_rbsp",f.escapedRBSP=a(l.subarray(1)),f.config=u(f.escapedRBSP);break;case 8:f.nalUnitType="pic_parameter_set_rbsp";break;case 9:f.nalUnitType="access_unit_delimiter_rbsp";break}t.trigger("data",f)}),e.on("done",function(){t.trigger("done")}),e.on("partialdone",function(){t.trigger("partialdone")}),e.on("reset",function(){t.trigger("reset")}),e.on("endedtimeline",function(){t.trigger("endedtimeline")}),this.flush=function(){e.flush()},this.partialFlush=function(){e.partialFlush()},this.reset=function(){e.reset()},this.endTimeline=function(){e.endTimeline()},d=function(f,h){var g=8,b=8,S,v;for(S=0;S<f;S++)b!==0&&(v=h.readExpGolomb(),b=(g+v+256)%256),g=b===0?g:b},a=function(f){for(var h=f.byteLength,g=[],b=1,S,v;b<h-2;)f[b]===0&&f[b+1]===0&&f[b+2]===3?(g.push(b+2),b+=2):b++;if(g.length===0)return f;S=h-g.length,v=new Uint8Array(S);var w=0;for(b=0;b<S;w++,b++)w===g[0]&&(w++,g.shift()),v[b]=f[w];return v},u=function(f){var h=0,g=0,b=0,S=0,v,w,L,j,Ee,sr,On,kn,Ln,or,Rn,z=[1,1],Bn,De;if(v=new ui(f),w=v.readUnsignedByte(),j=v.readUnsignedByte(),L=v.readUnsignedByte(),v.skipUnsignedExpGolomb(),_r[w]&&(Ee=v.readUnsignedExpGolomb(),Ee===3&&v.skipBits(1),v.skipUnsignedExpGolomb(),v.skipUnsignedExpGolomb(),v.skipBits(1),v.readBoolean()))for(Rn=Ee!==3?8:12,De=0;De<Rn;De++)v.readBoolean()&&(De<6?d(16,v):d(64,v));if(v.skipUnsignedExpGolomb(),sr=v.readUnsignedExpGolomb(),sr===0)v.readUnsignedExpGolomb();else if(sr===1)for(v.skipBits(1),v.skipExpGolomb(),v.skipExpGolomb(),On=v.readUnsignedExpGolomb(),De=0;De<On;De++)v.skipExpGolomb();if(v.skipUnsignedExpGolomb(),v.skipBits(1),kn=v.readUnsignedExpGolomb(),Ln=v.readUnsignedExpGolomb(),or=v.readBits(1),or===0&&v.skipBits(1),v.skipBits(1),v.readBoolean()&&(h=v.readUnsignedExpGolomb(),g=v.readUnsignedExpGolomb(),b=v.readUnsignedExpGolomb(),S=v.readUnsignedExpGolomb()),v.readBoolean()&&v.readBoolean()){switch(Bn=v.readUnsignedByte(),Bn){case 1:z=[1,1];break;case 2:z=[12,11];break;case 3:z=[10,11];break;case 4:z=[16,11];break;case 5:z=[40,33];break;case 6:z=[24,11];break;case 7:z=[20,11];break;case 8:z=[32,11];break;case 9:z=[80,33];break;case 10:z=[18,11];break;case 11:z=[15,11];break;case 12:z=[64,33];break;case 13:z=[160,99];break;case 14:z=[4,3];break;case 15:z=[3,2];break;case 16:z=[2,1];break;case 255:{z=[v.readUnsignedByte()<<8|v.readUnsignedByte(),v.readUnsignedByte()<<8|v.readUnsignedByte()];break}}z&&z[0]/z[1]}return{profileIdc:w,levelIdc:L,profileCompatibility:j,width:(kn+1)*16-h*2-g*2,height:(2-or)*(Ln+1)*16-b*2-S*2,sarRatio:z}}},rt.prototype=new m;var Bt={H264Stream:rt,NalByteStream:We},Nt={Adts:ge,h264:Bt},Tr=Math.pow(2,32),di=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r;return t.getBigUint64?(r=t.getBigUint64(0),r<Number.MAX_SAFE_INTEGER?Number(r):r):t.getUint32(0)*Tr+t.getUint32(4)},ze={getUint64:di,MAX_UINT32:Tr},wr=ze.MAX_UINT32,E,Ir,Ar,jt,Fr,Er,Dr,Mr,Wt,Ur,Cr,Pr,Or,kr,Lr,Rr,Br,Nr,jr,Wr,zr,zt,F,Vt,Vr,Gr,qr,Hr,$r,Yr,Xr,Qr,nt,Kr,Zr,Jr;(function(){var s;if(F={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(s in F)F.hasOwnProperty(s)&&(F[s]=[s.charCodeAt(0),s.charCodeAt(1),s.charCodeAt(2),s.charCodeAt(3)]);Vt=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),Gr=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),Vr=new Uint8Array([0,0,0,1]),qr=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),Hr=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),$r={video:qr,audio:Hr},Qr=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),Xr=new Uint8Array([0,0,0,0,0,0,0,0]),nt=new Uint8Array([0,0,0,0,0,0,0,0]),Kr=nt,Zr=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Jr=nt,Yr=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),E=function(e){var t=[],r=0,n,i,a;for(n=1;n<arguments.length;n++)t.push(arguments[n]);for(n=t.length;n--;)r+=t[n].byteLength;for(i=new Uint8Array(r+8),a=new DataView(i.buffer,i.byteOffset,i.byteLength),a.setUint32(0,i.byteLength),i.set(e,4),n=0,r=8;n<t.length;n++)i.set(t[n],r),r+=t[n].byteLength;return i},Ir=function(){return E(F.dinf,E(F.dref,Qr))},Ar=function(e){return E(F.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},jt=function(){return E(F.ftyp,Vt,Vr,Vt,Gr)},Rr=function(e){return E(F.hdlr,$r[e])},Fr=function(e){return E(F.mdat,e)},Lr=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,e.duration&255,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=e.samplerate&255),E(F.mdhd,t)},kr=function(e){return E(F.mdia,Lr(e),Rr(e.type),Dr(e))},Er=function(e){return E(F.mfhd,new Uint8Array([0,0,0,0,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255]))},Dr=function(e){return E(F.minf,e.type==="video"?E(F.vmhd,Yr):E(F.smhd,Xr),Ir(),Nr(e))},Mr=function(e,t){for(var r=[],n=t.length;n--;)r[n]=Wr(t[n]);return E.apply(null,[F.moof,Er(e)].concat(r))},Wt=function(e){for(var t=e.length,r=[];t--;)r[t]=Pr(e[t]);return E.apply(null,[F.moov,Cr(4294967295)].concat(r).concat(Ur(e)))},Ur=function(e){for(var t=e.length,r=[];t--;)r[t]=zr(e[t]);return E.apply(null,[F.mvex].concat(r))},Cr=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return E(F.mvhd,t)},Br=function(e){var t=e.samples||[],r=new Uint8Array(4+t.length),n,i;for(i=0;i<t.length;i++)n=t[i].flags,r[i+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return E(F.sdtp,r)},Nr=function(e){return E(F.stbl,jr(e),E(F.stts,Jr),E(F.stsc,Kr),E(F.stsz,Zr),E(F.stco,nt))},function(){var s,e;jr=function(r){return E(F.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),r.type==="video"?s(r):e(r))},s=function(r){var n=r.sps||[],i=r.pps||[],a=[],u=[],d,l;for(d=0;d<n.length;d++)a.push((n[d].byteLength&65280)>>>8),a.push(n[d].byteLength&255),a=a.concat(Array.prototype.slice.call(n[d]));for(d=0;d<i.length;d++)u.push((i[d].byteLength&65280)>>>8),u.push(i[d].byteLength&255),u=u.concat(Array.prototype.slice.call(i[d]));if(l=[F.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(r.width&65280)>>8,r.width&255,(r.height&65280)>>8,r.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),E(F.avcC,new Uint8Array([1,r.profileIdc,r.profileCompatibility,r.levelIdc,255].concat([n.length],a,[i.length],u))),E(F.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],r.sarRatio){var f=r.sarRatio[0],h=r.sarRatio[1];l.push(E(F.pasp,new Uint8Array([(f&4278190080)>>24,(f&16711680)>>16,(f&65280)>>8,f&255,(h&4278190080)>>24,(h&16711680)>>16,(h&65280)>>8,h&255])))}return E.apply(null,l)},e=function(r){return E(F.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(r.channelcount&65280)>>8,r.channelcount&255,(r.samplesize&65280)>>8,r.samplesize&255,0,0,0,0,(r.samplerate&65280)>>8,r.samplerate&255,0,0]),Ar(r))}}(),Or=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,0,(e.duration&4278190080)>>24,(e.duration&16711680)>>16,(e.duration&65280)>>8,e.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(e.width&65280)>>8,e.width&255,0,0,(e.height&65280)>>8,e.height&255,0,0]);return E(F.tkhd,t)},Wr=function(e){var t,r,n,i,a,u,d;return t=E(F.tfhd,new Uint8Array([0,0,0,58,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),u=Math.floor(e.baseMediaDecodeTime/wr),d=Math.floor(e.baseMediaDecodeTime%wr),r=E(F.tfdt,new Uint8Array([1,0,0,0,u>>>24&255,u>>>16&255,u>>>8&255,u&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255])),a=32+20+8+16+8+8,e.type==="audio"?(n=zt(e,a),E(F.traf,t,r,n)):(i=Br(e),n=zt(e,i.length+a),E(F.traf,t,r,n,i))},Pr=function(e){return e.duration=e.duration||4294967295,E(F.trak,Or(e),kr(e))},zr=function(e){var t=new Uint8Array([0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.type!=="video"&&(t[t.length-1]=0),E(F.trex,t)},function(){var s,e,t;t=function(n,i){var a=0,u=0,d=0,l=0;return n.length&&(n[0].duration!==void 0&&(a=1),n[0].size!==void 0&&(u=2),n[0].flags!==void 0&&(d=4),n[0].compositionTimeOffset!==void 0&&(l=8)),[0,0,a|u|d|l,1,(n.length&4278190080)>>>24,(n.length&16711680)>>>16,(n.length&65280)>>>8,n.length&255,(i&4278190080)>>>24,(i&16711680)>>>16,(i&65280)>>>8,i&255]},e=function(n,i){var a,u,d,l,f,h;for(l=n.samples||[],i+=8+12+16*l.length,d=t(l,i),u=new Uint8Array(d.length+l.length*16),u.set(d),a=d.length,h=0;h<l.length;h++)f=l[h],u[a++]=(f.duration&4278190080)>>>24,u[a++]=(f.duration&16711680)>>>16,u[a++]=(f.duration&65280)>>>8,u[a++]=f.duration&255,u[a++]=(f.size&4278190080)>>>24,u[a++]=(f.size&16711680)>>>16,u[a++]=(f.size&65280)>>>8,u[a++]=f.size&255,u[a++]=f.flags.isLeading<<2|f.flags.dependsOn,u[a++]=f.flags.isDependedOn<<6|f.flags.hasRedundancy<<4|f.flags.paddingValue<<1|f.flags.isNonSyncSample,u[a++]=f.flags.degradationPriority&240<<8,u[a++]=f.flags.degradationPriority&15,u[a++]=(f.compositionTimeOffset&4278190080)>>>24,u[a++]=(f.compositionTimeOffset&16711680)>>>16,u[a++]=(f.compositionTimeOffset&65280)>>>8,u[a++]=f.compositionTimeOffset&255;return E(F.trun,u)},s=function(n,i){var a,u,d,l,f,h;for(l=n.samples||[],i+=8+12+8*l.length,d=t(l,i),a=new Uint8Array(d.length+l.length*8),a.set(d),u=d.length,h=0;h<l.length;h++)f=l[h],a[u++]=(f.duration&4278190080)>>>24,a[u++]=(f.duration&16711680)>>>16,a[u++]=(f.duration&65280)>>>8,a[u++]=f.duration&255,a[u++]=(f.size&4278190080)>>>24,a[u++]=(f.size&16711680)>>>16,a[u++]=(f.size&65280)>>>8,a[u++]=f.size&255;return E(F.trun,a)},zt=function(n,i){return n.type==="audio"?s(n,i):e(n,i)}}();var te={ftyp:jt,mdat:Fr,moof:Mr,moov:Wt,initSegment:function(e){var t=jt(),r=Wt(e),n;return n=new Uint8Array(t.byteLength+r.byteLength),n.set(t),n.set(r,t.byteLength),n}},fi=function(e){return e>>>0},ci=function(e){return("00"+e.toString(16)).slice(-2)},it={toUnsigned:fi,toHexString:ci},li=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3]),t},re=li,pi=it.toUnsigned,hi=function s(e,t){var r=[],n,i,a,u,d;if(!t.length)return null;for(n=0;n<e.byteLength;)i=pi(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]),a=re(e.subarray(n+4,n+8)),u=i>1?n+i:e.byteLength,a===t[0]&&(t.length===1?r.push(e.subarray(n+8,u)):(d=s(e.subarray(n+8,u),t.slice(1)),d.length&&(r=r.concat(d)))),n=u;return r},R=hi,mi=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4)},n=r.flags[2]&1,i=r.flags[2]&2,a=r.flags[2]&8,u=r.flags[2]&16,d=r.flags[2]&32,l=r.flags[0]&65536,f=r.flags[0]&131072,h;return h=8,n&&(h+=4,r.baseDataOffset=t.getUint32(12),h+=4),i&&(r.sampleDescriptionIndex=t.getUint32(h),h+=4),a&&(r.defaultSampleDuration=t.getUint32(h),h+=4),u&&(r.defaultSampleSize=t.getUint32(h),h+=4),d&&(r.defaultSampleFlags=t.getUint32(h)),l&&(r.durationIsEmpty=!0),!n&&f&&(r.baseDataOffsetIsMoof=!0),r},Gt=mi,gi=function(e){return{isLeading:(e[0]&12)>>>2,dependsOn:e[0]&3,isDependedOn:(e[1]&192)>>>6,hasRedundancy:(e[1]&48)>>>4,paddingValue:(e[1]&14)>>>1,isNonSyncSample:e[1]&1,degradationPriority:e[2]<<8|e[3]}},en=gi,xi=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},r=new DataView(e.buffer,e.byteOffset,e.byteLength),n=t.flags[2]&1,i=t.flags[2]&4,a=t.flags[1]&1,u=t.flags[1]&2,d=t.flags[1]&4,l=t.flags[1]&8,f=r.getUint32(4),h=8,g;for(n&&(t.dataOffset=r.getInt32(h),h+=4),i&&f&&(g={flags:en(e.subarray(h,h+4))},h+=4,a&&(g.duration=r.getUint32(h),h+=4),u&&(g.size=r.getUint32(h),h+=4),l&&(t.version===1?g.compositionTimeOffset=r.getInt32(h):g.compositionTimeOffset=r.getUint32(h),h+=4),t.samples.push(g),f--);f--;)g={},a&&(g.duration=r.getUint32(h),h+=4),u&&(g.size=r.getUint32(h),h+=4),d&&(g.flags=en(e.subarray(h,h+4)),h+=4),l&&(t.version===1?g.compositionTimeOffset=r.getInt32(h):g.compositionTimeOffset=r.getUint32(h),h+=4),t.samples.push(g);return t},qt=xi,yi=it.toUnsigned,vi=ze.getUint64,bi=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4))};return t.version===1?t.baseMediaDecodeTime=vi(e.subarray(4)):t.baseMediaDecodeTime=yi(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),t},Ht=bi,at=it.toUnsigned,Ve=it.toHexString,Si=ze.getUint64,tn,rn,nn,an,sn,$t;tn=function(e){var t={},r=R(e,["moov","trak"]);return r.reduce(function(n,i){var a,u,d,l,f;return a=R(i,["tkhd"])[0],!a||(u=a[0],d=u===0?12:20,l=at(a[d]<<24|a[d+1]<<16|a[d+2]<<8|a[d+3]),f=R(i,["mdia","mdhd"])[0],!f)?null:(u=f[0],d=u===0?12:20,n[l]=at(f[d]<<24|f[d+1]<<16|f[d+2]<<8|f[d+3]),n)},t)},rn=function(e,t){var r;r=R(t,["moof","traf"]);var n=r.reduce(function(i,a){var u=R(a,["tfhd"])[0],d=at(u[4]<<24|u[5]<<16|u[6]<<8|u[7]),l=e[d]||9e4,f=R(a,["tfdt"])[0],h=new DataView(f.buffer,f.byteOffset,f.byteLength),g;f[0]===1?g=Si(f.subarray(4,12)):g=h.getUint32(4);var b;return typeof g=="bigint"?b=g/p.default.BigInt(l):typeof g=="number"&&!isNaN(g)&&(b=g/l),b<Number.MAX_SAFE_INTEGER&&(b=Number(b)),b<i&&(i=b),i},1/0);return typeof n=="bigint"||isFinite(n)?n:0},nn=function(e,t){var r=R(t,["moof","traf"]),n=0,i=0,a;if(r&&r.length){var u=R(r[0],["tfhd"])[0],d=R(r[0],["trun"])[0],l=R(r[0],["tfdt"])[0];if(u){var f=Gt(u);a=f.trackId}if(l){var h=Ht(l);n=h.baseMediaDecodeTime}if(d){var g=qt(d);g.samples&&g.samples.length&&(i=g.samples[0].compositionTimeOffset||0)}}var b=e[a]||9e4;typeof n=="bigint"&&(i=p.default.BigInt(i),b=p.default.BigInt(b));var S=(n+i)/b;return typeof S=="bigint"&&S<Number.MAX_SAFE_INTEGER&&(S=Number(S)),S},an=function(e){var t=R(e,["moov","trak"]),r=[];return t.forEach(function(n){var i=R(n,["mdia","hdlr"]),a=R(n,["tkhd"]);i.forEach(function(u,d){var l=re(u.subarray(8,12)),f=a[d],h,g,b;l==="vide"&&(h=new DataView(f.buffer,f.byteOffset,f.byteLength),g=h.getUint8(0),b=g===0?h.getUint32(12):h.getUint32(20),r.push(b))})}),r},$t=function(e){var t=e[0],r=t===0?12:20;return at(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])},sn=function(e){var t=R(e,["moov","trak"]),r=[];return t.forEach(function(n){var i={},a=R(n,["tkhd"])[0],u,d;a&&(u=new DataView(a.buffer,a.byteOffset,a.byteLength),d=u.getUint8(0),i.id=d===0?u.getUint32(12):u.getUint32(20));var l=R(n,["mdia","hdlr"])[0];if(l){var f=re(l.subarray(8,12));f==="vide"?i.type="video":f==="soun"?i.type="audio":i.type=f}var h=R(n,["mdia","minf","stbl","stsd"])[0];if(h){var g=h.subarray(8);i.codec=re(g.subarray(4,8));var b=R(g,[i.codec])[0],S,v;b&&(/^[asm]vc[1-9]$/i.test(i.codec)?(S=b.subarray(78),v=re(S.subarray(4,8)),v==="avcC"&&S.length>11?(i.codec+=".",i.codec+=Ve(S[9]),i.codec+=Ve(S[10]),i.codec+=Ve(S[11])):i.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(i.codec)?(S=b.subarray(28),v=re(S.subarray(4,8)),v==="esds"&&S.length>20&&S[19]!==0?(i.codec+="."+Ve(S[19]),i.codec+="."+Ve(S[20]>>>2&63).replace(/^0/,"")):i.codec="mp4a.40.2"):i.codec=i.codec.toLowerCase())}var w=R(n,["mdia","mdhd"])[0];w&&(i.timescale=$t(w)),r.push(i)}),r};var _i={findBox:R,parseType:re,timescale:tn,startTime:rn,compositionStartTime:nn,videoTrackIds:an,tracks:sn,getTimescaleFromMediaHeader:$t},Ti=function(e){var t,r,n=[],i=[];for(i.byteLength=0,i.nalCount=0,i.duration=0,n.byteLength=0,t=0;t<e.length;t++)r=e[t],r.nalUnitType==="access_unit_delimiter_rbsp"?(n.length&&(n.duration=r.dts-n.dts,i.byteLength+=n.byteLength,i.nalCount+=n.length,i.duration+=n.duration,i.push(n)),n=[r],n.byteLength=r.data.byteLength,n.pts=r.pts,n.dts=r.dts):(r.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(n.keyFrame=!0),n.duration=r.dts-n.dts,n.byteLength+=r.data.byteLength,n.push(r));return i.length&&(!n.duration||n.duration<=0)&&(n.duration=i[i.length-1].duration),i.byteLength+=n.byteLength,i.nalCount+=n.length,i.duration+=n.duration,i.push(n),i},wi=function(e){var t,r,n=[],i=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=e[0].pts,n.dts=e[0].dts,i.byteLength=0,i.nalCount=0,i.duration=0,i.pts=e[0].pts,i.dts=e[0].dts,t=0;t<e.length;t++)r=e[t],r.keyFrame?(n.length&&(i.push(n),i.byteLength+=n.byteLength,i.nalCount+=n.nalCount,i.duration+=n.duration),n=[r],n.nalCount=r.length,n.byteLength=r.byteLength,n.pts=r.pts,n.dts=r.dts,n.duration=r.duration):(n.duration+=r.duration,n.nalCount+=r.length,n.byteLength+=r.byteLength,n.push(r));return i.length&&n.duration<=0&&(n.duration=i[i.length-1].duration),i.byteLength+=n.byteLength,i.nalCount+=n.nalCount,i.duration+=n.duration,i.push(n),i},Ii=function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},Ai=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},on=function(e,t){var r=Ai();return r.dataOffset=t,r.compositionTimeOffset=e.pts-e.dts,r.duration=e.duration,r.size=4*e.length,r.size+=e.byteLength,e.keyFrame&&(r.flags.dependsOn=2,r.flags.isNonSyncSample=0),r},Fi=function(e,t){var r,n,i,a,u,d=t||0,l=[];for(r=0;r<e.length;r++)for(a=e[r],n=0;n<a.length;n++)u=a[n],i=on(u,d),d+=i.size,l.push(i);return l},Ei=function(e){var t,r,n,i,a,u,d=0,l=e.byteLength,f=e.nalCount,h=l+4*f,g=new Uint8Array(h),b=new DataView(g.buffer);for(t=0;t<e.length;t++)for(i=e[t],r=0;r<i.length;r++)for(a=i[r],n=0;n<a.length;n++)u=a[n],b.setUint32(d,u.data.byteLength),d+=4,g.set(u.data,d),d+=u.data.byteLength;return g},Di=function(e,t){var r,n=t||0,i=[];return r=on(e,n),i.push(r),i},Mi=function(e){var t,r,n=0,i=e.byteLength,a=e.length,u=i+4*a,d=new Uint8Array(u),l=new DataView(d.buffer);for(t=0;t<e.length;t++)r=e[t],l.setUint32(n,r.data.byteLength),n+=4,d.set(r.data,n),n+=r.data.byteLength;return d},de={groupNalsIntoFrames:Ti,groupFramesIntoGops:wi,extendFirstKeyFrame:Ii,generateSampleTable:Fi,concatenateNalData:Ei,generateSampleTableForFrame:Di,concatenateNalDataForFrame:Mi},ye=[33,16,5,32,164,27],Yt=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],C=function(e){for(var t=[];e--;)t.push(0);return t},Ui=function(e){return Object.keys(e).reduce(function(t,r){return t[r]=new Uint8Array(e[r].reduce(function(n,i){return n.concat(i)},[])),t},{})},Xt,Ci=function(){if(!Xt){var e={96e3:[ye,[227,64],C(154),[56]],88200:[ye,[231],C(170),[56]],64e3:[ye,[248,192],C(240),[56]],48e3:[ye,[255,192],C(268),[55,148,128],C(54),[112]],44100:[ye,[255,192],C(268),[55,163,128],C(84),[112]],32e3:[ye,[255,192],C(268),[55,234],C(226),[112]],24e3:[ye,[255,192],C(268),[55,255,128],C(268),[111,112],C(126),[224]],16e3:[ye,[255,192],C(268),[55,255,128],C(268),[111,255],C(269),[223,108],C(195),[1,192]],12e3:[Yt,C(268),[3,127,248],C(268),[6,255,240],C(268),[13,255,224],C(268),[27,253,128],C(259),[56]],11025:[Yt,C(268),[3,127,248],C(268),[6,255,240],C(268),[13,255,224],C(268),[27,255,192],C(268),[55,175,128],C(108),[112]],8e3:[Yt,C(268),[3,121,16],C(47),[7]]};Xt=Ui(e)}return Xt},Pi=function(e){var t,r,n=0;for(t=0;t<e.length;t++)r=e[t],n+=r.data.byteLength;return n},Oi=function(e,t,r,n){var i,a=0,u=0,d=0,l=0,f,h,g;if(!!t.length&&(i=H.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),a=Math.ceil(H.ONE_SECOND_IN_TS/(e.samplerate/1024)),r&&n&&(u=i-Math.max(r,n),d=Math.floor(u/a),l=d*a),!(d<1||l>H.ONE_SECOND_IN_TS/2))){for(f=Ci()[e.samplerate],f||(f=t[0].data),h=0;h<d;h++)g=t[0],t.splice(0,0,{data:f,dts:g.dts-a,pts:g.pts-a});return e.baseMediaDecodeTime-=Math.floor(H.videoTsToAudioTs(l,e.samplerate)),l}},ki=function(e,t,r){return t.minSegmentDts>=r?e:(t.minSegmentDts=1/0,e.filter(function(n){return n.dts>=r?(t.minSegmentDts=Math.min(t.minSegmentDts,n.dts),t.minSegmentPts=t.minSegmentDts,!0):!1}))},Li=function(e){var t,r,n=[];for(t=0;t<e.length;t++)r=e[t],n.push({size:r.data.byteLength,duration:1024});return n},Ri=function(e){var t,r,n=0,i=new Uint8Array(Pi(e));for(t=0;t<e.length;t++)r=e[t],i.set(r.data,n),n+=r.data.byteLength;return i},ve={prefixWithSilence:Oi,trimAdtsFramesByEarliestDts:ki,generateSampleTable:Li,concatenateFrameData:Ri},Bi=H.ONE_SECOND_IN_TS,Ni=function(e,t){typeof t.pts=="number"&&(e.timelineStartInfo.pts===void 0&&(e.timelineStartInfo.pts=t.pts),e.minSegmentPts===void 0?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),e.maxSegmentPts===void 0?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),typeof t.dts=="number"&&(e.timelineStartInfo.dts===void 0&&(e.timelineStartInfo.dts=t.dts),e.minSegmentDts===void 0?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),e.maxSegmentDts===void 0?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))},ji=function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},Wi=function(e,t){var r,n,i=e.minSegmentDts;return t||(i-=e.timelineStartInfo.dts),r=e.timelineStartInfo.baseMediaDecodeTime,r+=i,r=Math.max(0,r),e.type==="audio"&&(n=e.samplerate/Bi,r*=n,r=Math.floor(r)),r},W={clearDtsInfo:ji,calculateTrackBaseMediaDecodeTime:Wi,collectDtsInfo:Ni},un=4,zi=128,Vi=function(e){for(var t=0,r={payloadType:-1,payloadSize:0},n=0,i=0;t<e.byteLength&&e[t]!==zi;){for(;e[t]===255;)n+=255,t++;for(n+=e[t++];e[t]===255;)i+=255,t++;if(i+=e[t++],!r.payload&&n===un){var a=String.fromCharCode(e[t+3],e[t+4],e[t+5],e[t+6]);if(a==="GA94"){r.payloadType=n,r.payloadSize=i,r.payload=e.subarray(t,t+i);break}else r.payload=void 0}t+=i,n=0,i=0}return r},Gi=function(e){return e.payload[0]!==181||(e.payload[1]<<8|e.payload[2])!==49||String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])!=="GA94"||e.payload[7]!==3?null:e.payload.subarray(8,e.payload.length-1)},qi=function(e,t){var r=[],n,i,a,u;if(!(t[0]&64))return r;for(i=t[0]&31,n=0;n<i;n++)a=n*3,u={type:t[a+2]&3,pts:e},t[a+2]&4&&(u.ccData=t[a+3]<<8|t[a+4],r.push(u));return r},Hi=function(e){for(var t=e.byteLength,r=[],n=1,i,a;n<t-2;)e[n]===0&&e[n+1]===0&&e[n+2]===3?(r.push(n+2),n+=2):n++;if(r.length===0)return e;i=t-r.length,a=new Uint8Array(i);var u=0;for(n=0;n<i;u++,n++)u===r[0]&&(u++,r.shift()),a[n]=e[u];return a},Ge={parseSei:Vi,parseUserData:Gi,parseCaptionPackets:qi,discardEmulationPreventionBytes:Hi,USER_DATA_REGISTERED_ITU_T_T35:un},J=function s(e){e=e||{},s.prototype.init.call(this),this.parse708captions_=typeof e.parse708captions=="boolean"?e.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new N(0,0),new N(0,1),new N(1,0),new N(1,1)],this.parse708captions_&&(this.cc708Stream_=new B({captionServices:e.captionServices})),this.reset(),this.ccStreams_.forEach(function(t){t.on("data",this.trigger.bind(this,"data")),t.on("partialdone",this.trigger.bind(this,"partialdone")),t.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};J.prototype=new m,J.prototype.push=function(s){var e,t,r;if(s.nalUnitType==="sei_rbsp"&&(e=Ge.parseSei(s.escapedRBSP),!!e.payload&&e.payloadType===Ge.USER_DATA_REGISTERED_ITU_T_T35&&(t=Ge.parseUserData(e),!!t))){if(s.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(s.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}r=Ge.parseCaptionPackets(s.pts,t),this.captionPackets_=this.captionPackets_.concat(r),this.latestDts_!==s.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=s.dts}},J.prototype.flushCCStreams=function(s){this.ccStreams_.forEach(function(e){return s==="flush"?e.flush():e.partialFlush()},this)},J.prototype.flushStream=function(s){if(!this.captionPackets_.length){this.flushCCStreams(s);return}this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2?this.dispatchCea608Packet(e):this.dispatchCea708Packet(e)},this),this.captionPackets_.length=0,this.flushCCStreams(s)},J.prototype.flush=function(){return this.flushStream("flush")},J.prototype.partialFlush=function(){return this.flushStream("partialFlush")},J.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(s){s.reset()})},J.prototype.dispatchCea608Packet=function(s){this.setsTextOrXDSActive(s)?this.activeCea608Channel_[s.type]=null:this.setsChannel1Active(s)?this.activeCea608Channel_[s.type]=0:this.setsChannel2Active(s)&&(this.activeCea608Channel_[s.type]=1),this.activeCea608Channel_[s.type]!==null&&this.ccStreams_[(s.type<<1)+this.activeCea608Channel_[s.type]].push(s)},J.prototype.setsChannel1Active=function(s){return(s.ccData&30720)===4096},J.prototype.setsChannel2Active=function(s){return(s.ccData&30720)===6144},J.prototype.setsTextOrXDSActive=function(s){return(s.ccData&28928)===256||(s.ccData&30974)===4138||(s.ccData&30974)===6186},J.prototype.dispatchCea708Packet=function(s){this.parse708captions_&&this.cc708Stream_.push(s)};var $i={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},Yi=function(e){var t=$i[e]||e;return e&4096&&e===t?"":String.fromCharCode(t)},st=function(e){return 32<=e&&e<=127||160<=e&&e<=255},xe=function(e){this.windowNum=e,this.reset()};xe.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},xe.prototype.getText=function(){return this.rows.join(`
`)},xe.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},xe.prototype.newLine=function(s){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(s),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},xe.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},xe.prototype.addText=function(s){this.rows[this.rowIdx]+=s},xe.prototype.backspace=function(){if(!this.isEmpty()){var s=this.rows[this.rowIdx];this.rows[this.rowIdx]=s.substr(0,s.length-1)}};var ot=function(e,t,r){this.serviceNum=e,this.text="",this.currentWindow=new xe(-1),this.windows=[],this.stream=r,typeof t=="string"&&this.createTextDecoder(t)};ot.prototype.init=function(s,e){this.startPts=s;for(var t=0;t<8;t++)this.windows[t]=new xe(t),typeof e=="function"&&(this.windows[t].beforeRowOverflow=e)},ot.prototype.setCurrentWindow=function(s){this.currentWindow=this.windows[s]},ot.prototype.createTextDecoder=function(s){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(s)}catch(e){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+s+" encoding. "+e})}};var B=function s(e){e=e||{},s.prototype.init.call(this);var t=this,r=e.captionServices||{},n={},i;Object.keys(r).forEach(function(a){i=r[a],/^SERVICE/.test(a)&&(n[a]=i.encoding)}),this.serviceEncodings=n,this.current708Packet=null,this.services={},this.push=function(a){a.type===3?(t.new708Packet(),t.add708Bytes(a)):(t.current708Packet===null&&t.new708Packet(),t.add708Bytes(a))}};B.prototype=new m,B.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},B.prototype.add708Bytes=function(s){var e=s.ccData,t=e>>>8,r=e&255;this.current708Packet.ptsVals.push(s.pts),this.current708Packet.data.push(t),this.current708Packet.data.push(r)},B.prototype.push708Packet=function(){var s=this.current708Packet,e=s.data,t=null,r=null,n=0,i=e[n++];for(s.seq=i>>6,s.sizeCode=i&63;n<e.length;n++)i=e[n++],t=i>>5,r=i&31,t===7&&r>0&&(i=e[n++],t=i),this.pushServiceBlock(t,n,r),r>0&&(n+=r-1)},B.prototype.pushServiceBlock=function(s,e,t){var r,n=e,i=this.current708Packet.data,a=this.services[s];for(a||(a=this.initService(s,n));n<e+t&&n<i.length;n++)r=i[n],st(r)?n=this.handleText(n,a):r===24?n=this.multiByteCharacter(n,a):r===16?n=this.extendedCommands(n,a):128<=r&&r<=135?n=this.setCurrentWindow(n,a):152<=r&&r<=159?n=this.defineWindow(n,a):r===136?n=this.clearWindows(n,a):r===140?n=this.deleteWindows(n,a):r===137?n=this.displayWindows(n,a):r===138?n=this.hideWindows(n,a):r===139?n=this.toggleWindows(n,a):r===151?n=this.setWindowAttributes(n,a):r===144?n=this.setPenAttributes(n,a):r===145?n=this.setPenColor(n,a):r===146?n=this.setPenLocation(n,a):r===143?a=this.reset(n,a):r===8?a.currentWindow.backspace():r===12?a.currentWindow.clearText():r===13?a.currentWindow.pendingNewLine=!0:r===14?a.currentWindow.clearText():r===141&&n++},B.prototype.extendedCommands=function(s,e){var t=this.current708Packet.data,r=t[++s];return st(r)&&(s=this.handleText(s,e,{isExtended:!0})),s},B.prototype.getPts=function(s){return this.current708Packet.ptsVals[Math.floor(s/2)]},B.prototype.initService=function(s,e){var r="SERVICE"+s,t=this,r,n;return r in this.serviceEncodings&&(n=this.serviceEncodings[r]),this.services[s]=new ot(s,n,t),this.services[s].init(this.getPts(e),function(i){t.flushDisplayed(i,t.services[s])}),this.services[s]},B.prototype.handleText=function(s,e,t){var r=t&&t.isExtended,n=t&&t.isMultiByte,i=this.current708Packet.data,a=r?4096:0,u=i[s],d=i[s+1],l=e.currentWindow,f,h;return e.textDecoder_&&!r?(n?(h=[u,d],s++):h=[u],f=e.textDecoder_.decode(new Uint8Array(h))):f=Yi(a|u),l.pendingNewLine&&!l.isEmpty()&&l.newLine(this.getPts(s)),l.pendingNewLine=!1,l.addText(f),s},B.prototype.multiByteCharacter=function(s,e){var t=this.current708Packet.data,r=t[s+1],n=t[s+2];return st(r)&&st(n)&&(s=this.handleText(++s,e,{isMultiByte:!0})),s},B.prototype.setCurrentWindow=function(s,e){var t=this.current708Packet.data,r=t[s],n=r&7;return e.setCurrentWindow(n),s},B.prototype.defineWindow=function(s,e){var t=this.current708Packet.data,r=t[s],n=r&7;e.setCurrentWindow(n);var i=e.currentWindow;return r=t[++s],i.visible=(r&32)>>5,i.rowLock=(r&16)>>4,i.columnLock=(r&8)>>3,i.priority=r&7,r=t[++s],i.relativePositioning=(r&128)>>7,i.anchorVertical=r&127,r=t[++s],i.anchorHorizontal=r,r=t[++s],i.anchorPoint=(r&240)>>4,i.rowCount=r&15,r=t[++s],i.columnCount=r&63,r=t[++s],i.windowStyle=(r&56)>>3,i.penStyle=r&7,i.virtualRowCount=i.rowCount+1,s},B.prototype.setWindowAttributes=function(s,e){var t=this.current708Packet.data,r=t[s],n=e.currentWindow.winAttr;return r=t[++s],n.fillOpacity=(r&192)>>6,n.fillRed=(r&48)>>4,n.fillGreen=(r&12)>>2,n.fillBlue=r&3,r=t[++s],n.borderType=(r&192)>>6,n.borderRed=(r&48)>>4,n.borderGreen=(r&12)>>2,n.borderBlue=r&3,r=t[++s],n.borderType+=(r&128)>>5,n.wordWrap=(r&64)>>6,n.printDirection=(r&48)>>4,n.scrollDirection=(r&12)>>2,n.justify=r&3,r=t[++s],n.effectSpeed=(r&240)>>4,n.effectDirection=(r&12)>>2,n.displayEffect=r&3,s},B.prototype.flushDisplayed=function(s,e){for(var t=[],r=0;r<8;r++)e.windows[r].visible&&!e.windows[r].isEmpty()&&t.push(e.windows[r].getText());e.endPts=s,e.text=t.join(`

`),this.pushCaption(e),e.startPts=s},B.prototype.pushCaption=function(s){s.text!==""&&(this.trigger("data",{startPts:s.startPts,endPts:s.endPts,text:s.text,stream:"cc708_"+s.serviceNum}),s.text="",s.startPts=s.endPts)},B.prototype.displayWindows=function(s,e){var t=this.current708Packet.data,r=t[++s],n=this.getPts(s);this.flushDisplayed(n,e);for(var i=0;i<8;i++)r&1<<i&&(e.windows[i].visible=1);return s},B.prototype.hideWindows=function(s,e){var t=this.current708Packet.data,r=t[++s],n=this.getPts(s);this.flushDisplayed(n,e);for(var i=0;i<8;i++)r&1<<i&&(e.windows[i].visible=0);return s},B.prototype.toggleWindows=function(s,e){var t=this.current708Packet.data,r=t[++s],n=this.getPts(s);this.flushDisplayed(n,e);for(var i=0;i<8;i++)r&1<<i&&(e.windows[i].visible^=1);return s},B.prototype.clearWindows=function(s,e){var t=this.current708Packet.data,r=t[++s],n=this.getPts(s);this.flushDisplayed(n,e);for(var i=0;i<8;i++)r&1<<i&&e.windows[i].clearText();return s},B.prototype.deleteWindows=function(s,e){var t=this.current708Packet.data,r=t[++s],n=this.getPts(s);this.flushDisplayed(n,e);for(var i=0;i<8;i++)r&1<<i&&e.windows[i].reset();return s},B.prototype.setPenAttributes=function(s,e){var t=this.current708Packet.data,r=t[s],n=e.currentWindow.penAttr;return r=t[++s],n.textTag=(r&240)>>4,n.offset=(r&12)>>2,n.penSize=r&3,r=t[++s],n.italics=(r&128)>>7,n.underline=(r&64)>>6,n.edgeType=(r&56)>>3,n.fontStyle=r&7,s},B.prototype.setPenColor=function(s,e){var t=this.current708Packet.data,r=t[s],n=e.currentWindow.penColor;return r=t[++s],n.fgOpacity=(r&192)>>6,n.fgRed=(r&48)>>4,n.fgGreen=(r&12)>>2,n.fgBlue=r&3,r=t[++s],n.bgOpacity=(r&192)>>6,n.bgRed=(r&48)>>4,n.bgGreen=(r&12)>>2,n.bgBlue=r&3,r=t[++s],n.edgeRed=(r&48)>>4,n.edgeGreen=(r&12)>>2,n.edgeBlue=r&3,s},B.prototype.setPenLocation=function(s,e){var t=this.current708Packet.data,r=t[s],n=e.currentWindow.penLoc;return e.currentWindow.pendingNewLine=!0,r=t[++s],n.row=r&15,r=t[++s],n.column=r&63,s},B.prototype.reset=function(s,e){var t=this.getPts(s);return this.flushDisplayed(t,e),this.initService(e.serviceNum,s)};var Xi={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},ut=function(e){return e===null?"":(e=Xi[e]||e,String.fromCharCode(e))},dt=14,Qi=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Ie=function(){for(var e=[],t=dt+1;t--;)e.push("");return e},N=function s(e,t){s.prototype.init.call(this),this.field_=e||0,this.dataChannel_=t||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(r){var n,i,a,u,d;if(n=r.ccData&32639,n===this.lastControlCode_){this.lastControlCode_=null;return}if((n&61440)===4096?this.lastControlCode_=n:n!==this.PADDING_&&(this.lastControlCode_=null),a=n>>>8,u=n&255,n!==this.PADDING_)if(n===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(n===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(r.pts),this.flushDisplayed(r.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=r.pts;else if(n===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(r.pts);else if(n===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(r.pts);else if(n===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(r.pts);else if(n===this.CARRIAGE_RETURN_)this.clearFormatting(r.pts),this.flushDisplayed(r.pts),this.shiftRowsUp_(),this.startPts_=r.pts;else if(n===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(n===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(r.pts),this.displayed_=Ie();else if(n===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Ie();else if(n===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(r.pts),this.displayed_=Ie()),this.mode_="paintOn",this.startPts_=r.pts;else if(this.isSpecialCharacter(a,u))a=(a&3)<<8,d=ut(a|u),this[this.mode_](r.pts,d),this.column_++;else if(this.isExtCharacter(a,u))this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),a=(a&3)<<8,d=ut(a|u),this[this.mode_](r.pts,d),this.column_++;else if(this.isMidRowCode(a,u))this.clearFormatting(r.pts),this[this.mode_](r.pts," "),this.column_++,(u&14)===14&&this.addFormatting(r.pts,["i"]),(u&1)===1&&this.addFormatting(r.pts,["u"]);else if(this.isOffsetControlCode(a,u))this.column_+=u&3;else if(this.isPAC(a,u)){var l=Qi.indexOf(n&7968);this.mode_==="rollUp"&&(l-this.rollUpRows_+1<0&&(l=this.rollUpRows_-1),this.setRollUp(r.pts,l)),l!==this.row_&&(this.clearFormatting(r.pts),this.row_=l),u&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(r.pts,["u"]),(n&16)===16&&(this.column_=((n&14)>>1)*4),this.isColorPAC(u)&&(u&14)===14&&this.addFormatting(r.pts,["i"])}else this.isNormalChar(a)&&(u===0&&(u=null),d=ut(a),d+=ut(u),this[this.mode_](r.pts,d),this.column_+=d.length)}};N.prototype=new m,N.prototype.flushDisplayed=function(s){var e=this.displayed_.map(function(t,r){try{return t.trim()}catch{return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+r+"."}),""}},this).join(`
`).replace(/^\n+|\n+$/g,"");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:s,text:e,stream:this.name_})},N.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Ie(),this.nonDisplayed_=Ie(),this.lastControlCode_=null,this.column_=0,this.row_=dt,this.rollUpRows_=2,this.formatting_=[]},N.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},N.prototype.isSpecialCharacter=function(s,e){return s===this.EXT_&&e>=48&&e<=63},N.prototype.isExtCharacter=function(s,e){return(s===this.EXT_+1||s===this.EXT_+2)&&e>=32&&e<=63},N.prototype.isMidRowCode=function(s,e){return s===this.EXT_&&e>=32&&e<=47},N.prototype.isOffsetControlCode=function(s,e){return s===this.OFFSET_&&e>=33&&e<=35},N.prototype.isPAC=function(s,e){return s>=this.BASE_&&s<this.BASE_+8&&e>=64&&e<=127},N.prototype.isColorPAC=function(s){return s>=64&&s<=79||s>=96&&s<=127},N.prototype.isNormalChar=function(s){return s>=32&&s<=127},N.prototype.setRollUp=function(s,e){if(this.mode_!=="rollUp"&&(this.row_=dt,this.mode_="rollUp",this.flushDisplayed(s),this.nonDisplayed_=Ie(),this.displayed_=Ie()),e!==void 0&&e!==this.row_)for(var t=0;t<this.rollUpRows_;t++)this.displayed_[e-t]=this.displayed_[this.row_-t],this.displayed_[this.row_-t]="";e===void 0&&(e=this.row_),this.topRow_=e-this.rollUpRows_+1},N.prototype.addFormatting=function(s,e){this.formatting_=this.formatting_.concat(e);var t=e.reduce(function(r,n){return r+"<"+n+">"},"");this[this.mode_](s,t)},N.prototype.clearFormatting=function(s){if(!!this.formatting_.length){var e=this.formatting_.reverse().reduce(function(t,r){return t+"</"+r+">"},"");this.formatting_=[],this[this.mode_](s,e)}},N.prototype.popOn=function(s,e){var t=this.nonDisplayed_[this.row_];t+=e,this.nonDisplayed_[this.row_]=t},N.prototype.rollUp=function(s,e){var t=this.displayed_[this.row_];t+=e,this.displayed_[this.row_]=t},N.prototype.shiftRowsUp_=function(){var s;for(s=0;s<this.topRow_;s++)this.displayed_[s]="";for(s=this.row_+1;s<dt+1;s++)this.displayed_[s]="";for(s=this.topRow_;s<this.row_;s++)this.displayed_[s]=this.displayed_[s+1];this.displayed_[this.row_]=""},N.prototype.paintOn=function(s,e){var t=this.displayed_[this.row_];t+=e,this.displayed_[this.row_]=t};var ft={CaptionStream:J,Cea608Stream:N,Cea708Stream:B},$={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Ki=8589934592,Zi=4294967296,dn="shared",Qt=function(e,t){var r=1;for(e>t&&(r=-1);Math.abs(t-e)>Zi;)e+=r*Ki;return e},fn=function s(e){var t,r;s.prototype.init.call(this),this.type_=e||dn,this.push=function(n){this.type_!==dn&&n.type!==this.type_||(r===void 0&&(r=n.dts),n.dts=Qt(n.dts,r),n.pts=Qt(n.pts,r),t=n.dts,this.trigger("data",n))},this.flush=function(){r=t,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){r=void 0,t=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};fn.prototype=new m;var cn={TimestampRolloverStream:fn,handleRollover:Qt},ln=function(e,t,r){var n,i="";for(n=t;n<r;n++)i+="%"+("00"+e[n].toString(16)).slice(-2);return i},ct=function(e,t,r){return decodeURIComponent(ln(e,t,r))},Ji=function(e,t,r){return unescape(ln(e,t,r))},lt=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},pn={TXXX:function(e){var t;if(e.data[0]===3){for(t=1;t<e.data.length;t++)if(e.data[t]===0){e.description=ct(e.data,1,t),e.value=ct(e.data,t+1,e.data.length).replace(/\0*$/,"");break}e.data=e.value}},WXXX:function(e){var t;if(e.data[0]===3){for(t=1;t<e.data.length;t++)if(e.data[t]===0){e.description=ct(e.data,1,t),e.url=ct(e.data,t+1,e.data.length);break}}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(e.data[t]===0){e.owner=Ji(e.data,0,t);break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}},pt;pt=function(e){var t={descriptor:e&&e.descriptor},r=0,n=[],i=0,a;if(pt.prototype.init.call(this),this.dispatchType=$.METADATA_STREAM_TYPE.toString(16),t.descriptor)for(a=0;a<t.descriptor.length;a++)this.dispatchType+=("00"+t.descriptor[a].toString(16)).slice(-2);this.push=function(u){var d,l,f,h,g,b;if(u.type==="timed-metadata"){if(u.dataAlignmentIndicator&&(i=0,n.length=0),n.length===0&&(u.data.length<10||u.data[0]!=="I".charCodeAt(0)||u.data[1]!=="D".charCodeAt(0)||u.data[2]!=="3".charCodeAt(0))){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(n.push(u),i+=u.data.byteLength,n.length===1&&(r=lt(u.data.subarray(6,10)),r+=10),!(i<r)){for(d={data:new Uint8Array(r),frames:[],pts:n[0].pts,dts:n[0].dts},g=0;g<r;)d.data.set(n[0].data.subarray(0,r-g),g),g+=n[0].data.byteLength,i-=n[0].data.byteLength,n.shift();l=10,d.data[5]&64&&(l+=4,l+=lt(d.data.subarray(10,14)),r-=lt(d.data.subarray(16,20)));do{if(f=lt(d.data.subarray(l+4,l+8)),f<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(b=String.fromCharCode(d.data[l],d.data[l+1],d.data[l+2],d.data[l+3]),h={id:b,data:d.data.subarray(l+10,l+f+10)},h.key=h.id,pn[h.id]&&(pn[h.id](h),h.owner==="com.apple.streaming.transportStreamTimestamp")){var S=h.data,v=(S[3]&1)<<30|S[4]<<22|S[5]<<14|S[6]<<6|S[7]>>>2;v*=4,v+=S[7]&3,h.timeStamp=v,d.pts===void 0&&d.dts===void 0&&(d.pts=h.timeStamp,d.dts=h.timeStamp),this.trigger("timestamp",h)}d.frames.push(h),l+=10,l+=f}while(l<r);this.trigger("data",d)}}}},pt.prototype=new m;var ea=pt,ta=cn.TimestampRolloverStream,ht,qe,mt,Be=188,Kt=71;ht=function(){var e=new Uint8Array(Be),t=0;ht.prototype.init.call(this),this.push=function(r){var n=0,i=Be,a;for(t?(a=new Uint8Array(r.byteLength+t),a.set(e.subarray(0,t)),a.set(r,t),t=0):a=r;i<a.byteLength;){if(a[n]===Kt&&a[i]===Kt){this.trigger("data",a.subarray(n,i)),n+=Be,i+=Be;continue}n++,i++}n<a.byteLength&&(e.set(a.subarray(n),0),t=a.byteLength-n)},this.flush=function(){t===Be&&e[0]===Kt&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}},ht.prototype=new m,qe=function(){var e,t,r,n;qe.prototype.init.call(this),n=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(a,u){var d=0;u.payloadUnitStartIndicator&&(d+=a[d]+1),u.type==="pat"?t(a.subarray(d),u):r(a.subarray(d),u)},t=function(a,u){u.section_number=a[7],u.last_section_number=a[8],n.pmtPid=(a[10]&31)<<8|a[11],u.pmtPid=n.pmtPid},r=function(a,u){var d,l,f,h;if(!!(a[5]&1)){for(n.programMapTable={video:null,audio:null,"timed-metadata":{}},d=(a[1]&15)<<8|a[2],l=3+d-4,f=(a[10]&15)<<8|a[11],h=12+f;h<l;){var g=a[h],b=(a[h+1]&31)<<8|a[h+2];g===$.H264_STREAM_TYPE&&n.programMapTable.video===null?n.programMapTable.video=b:g===$.ADTS_STREAM_TYPE&&n.programMapTable.audio===null?n.programMapTable.audio=b:g===$.METADATA_STREAM_TYPE&&(n.programMapTable["timed-metadata"][b]=g),h+=((a[h+3]&15)<<8|a[h+4])+5}u.programMapTable=n.programMapTable}},this.push=function(i){var a={},u=4;if(a.payloadUnitStartIndicator=!!(i[1]&64),a.pid=i[1]&31,a.pid<<=8,a.pid|=i[2],(i[3]&48)>>>4>1&&(u+=i[u]+1),a.pid===0)a.type="pat",e(i.subarray(u),a),this.trigger("data",a);else if(a.pid===this.pmtPid)for(a.type="pmt",e(i.subarray(u),a),this.trigger("data",a);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([i,u,a]):this.processPes_(i,u,a)},this.processPes_=function(i,a,u){u.pid===this.programMapTable.video?u.streamType=$.H264_STREAM_TYPE:u.pid===this.programMapTable.audio?u.streamType=$.ADTS_STREAM_TYPE:u.streamType=this.programMapTable["timed-metadata"][u.pid],u.type="pes",u.data=i.subarray(a),this.trigger("data",u)}},qe.prototype=new m,qe.STREAM_TYPES={h264:27,adts:15},mt=function(){var e=this,t=!1,r={data:[],size:0},n={data:[],size:0},i={data:[],size:0},a,u=function(f,h){var g,b=f[0]<<16|f[1]<<8|f[2];h.data=new Uint8Array,b===1&&(h.packetLength=6+(f[4]<<8|f[5]),h.dataAlignmentIndicator=(f[6]&4)!==0,g=f[7],g&192&&(h.pts=(f[9]&14)<<27|(f[10]&255)<<20|(f[11]&254)<<12|(f[12]&255)<<5|(f[13]&254)>>>3,h.pts*=4,h.pts+=(f[13]&6)>>>1,h.dts=h.pts,g&64&&(h.dts=(f[14]&14)<<27|(f[15]&255)<<20|(f[16]&254)<<12|(f[17]&255)<<5|(f[18]&254)>>>3,h.dts*=4,h.dts+=(f[18]&6)>>>1)),h.data=f.subarray(9+f[8]))},d=function(f,h,g){var b=new Uint8Array(f.size),S={type:h},v=0,w=0,L=!1,j;if(!(!f.data.length||f.size<9)){for(S.trackId=f.data[0].pid,v=0;v<f.data.length;v++)j=f.data[v],b.set(j.data,w),w+=j.data.byteLength;u(b,S),L=h==="video"||S.packetLength<=f.size,(g||L)&&(f.size=0,f.data.length=0),L&&e.trigger("data",S)}};mt.prototype.init.call(this),this.push=function(l){({pat:function(){},pes:function(){var h,g;switch(l.streamType){case $.H264_STREAM_TYPE:h=r,g="video";break;case $.ADTS_STREAM_TYPE:h=n,g="audio";break;case $.METADATA_STREAM_TYPE:h=i,g="timed-metadata";break;default:return}l.payloadUnitStartIndicator&&d(h,g,!0),h.data.push(l),h.size+=l.data.byteLength},pmt:function(){var h={type:"metadata",tracks:[]};a=l.programMapTable,a.video!==null&&h.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+a.video,codec:"avc",type:"video"}),a.audio!==null&&h.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+a.audio,codec:"adts",type:"audio"}),t=!0,e.trigger("data",h)}})[l.type]()},this.reset=function(){r.size=0,r.data.length=0,n.size=0,n.data.length=0,this.trigger("reset")},this.flushStreams_=function(){d(r,"video"),d(n,"audio"),d(i,"timed-metadata")},this.flush=function(){if(!t&&a){var l={type:"metadata",tracks:[]};a.video!==null&&l.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+a.video,codec:"avc",type:"video"}),a.audio!==null&&l.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+a.audio,codec:"adts",type:"audio"}),e.trigger("data",l)}t=!1,this.flushStreams_(),this.trigger("done")}},mt.prototype=new m;var hn={PAT_PID:0,MP2T_PACKET_LENGTH:Be,TransportPacketStream:ht,TransportParseStream:qe,ElementaryStream:mt,TimestampRolloverStream:ta,CaptionStream:ft.CaptionStream,Cea608Stream:ft.Cea608Stream,Cea708Stream:ft.Cea708Stream,MetadataStream:ea};for(var Zt in $)$.hasOwnProperty(Zt)&&(hn[Zt]=$[Zt]);var k=hn,ra=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],mn=function(e,t){var r=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],n=e[t+5],i=(n&16)>>4;return r=r>=0?r:0,i?r+20:r+10},na=function s(e,t){return e.length-t<10||e[t]!=="I".charCodeAt(0)||e[t+1]!=="D".charCodeAt(0)||e[t+2]!=="3".charCodeAt(0)?t:(t+=mn(e,t),s(e,t))},ia=function(e){var t=na(e,0);return e.length>=t+2&&(e[t]&255)===255&&(e[t+1]&240)===240&&(e[t+1]&22)===16},gn=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},aa=function(e,t,r){var n,i="";for(n=t;n<r;n++)i+="%"+("00"+e[n].toString(16)).slice(-2);return i},sa=function(e,t,r){return unescape(aa(e,t,r))},oa=function(e,t){var r=(e[t+5]&224)>>5,n=e[t+4]<<3,i=e[t+3]&3<<11;return i|n|r},ua=function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":e[t]&!0&&(e[t+1]&240)===240?"audio":null},da=function(e){for(var t=0;t+5<e.length;){if(e[t]!==255||(e[t+1]&246)!==240){t++;continue}return ra[(e[t+2]&60)>>>2]}return null},fa=function(e){var t,r,n,i;t=10,e[5]&64&&(t+=4,t+=gn(e.subarray(10,14)));do{if(r=gn(e.subarray(t+4,t+8)),r<1)return null;if(i=String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3]),i==="PRIV"){n=e.subarray(t+10,t+r+10);for(var a=0;a<n.byteLength;a++)if(n[a]===0){var u=sa(n,0,a);if(u==="com.apple.streaming.transportStreamTimestamp"){var d=n.subarray(a+1),l=(d[3]&1)<<30|d[4]<<22|d[5]<<14|d[6]<<6|d[7]>>>2;return l*=4,l+=d[7]&3,l}break}}t+=10,t+=r}while(t<e.byteLength);return null},He={isLikelyAacData:ia,parseId3TagSize:mn,parseAdtsSize:oa,parseType:ua,parseSampleRate:da,parseAacTimestamp:fa},gt;gt=function(){var e=new Uint8Array,t=0;gt.prototype.init.call(this),this.setTimestamp=function(r){t=r},this.push=function(r){var n=0,i=0,a,u,d,l;for(e.length?(l=e.length,e=new Uint8Array(r.byteLength+l),e.set(e.subarray(0,l)),e.set(r,l)):e=r;e.length-i>=3;){if(e[i]==="I".charCodeAt(0)&&e[i+1]==="D".charCodeAt(0)&&e[i+2]==="3".charCodeAt(0)){if(e.length-i<10||(n=He.parseId3TagSize(e,i),i+n>e.length))break;u={type:"timed-metadata",data:e.subarray(i,i+n)},this.trigger("data",u),i+=n;continue}else if((e[i]&255)===255&&(e[i+1]&240)===240){if(e.length-i<7||(n=He.parseAdtsSize(e,i),i+n>e.length))break;d={type:"audio",data:e.subarray(i,i+n),pts:t,dts:t},this.trigger("data",d),i+=n;continue}i++}a=e.length-i,a>0?e=e.subarray(i):e=new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}},gt.prototype=new m;var xn=gt,ca=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],xt=ca,la=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],yt=la,pa=Bt.H264Stream,ha=He.isLikelyAacData,ma=H.ONE_SECOND_IN_TS,$e,Ne,vt,Ae,ga=function(e,t){t.stream=e,this.trigger("log",t)},yn=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;n++){var i=r[n];i==="headOfPipeline"||!t[i].on||t[i].on("log",ga.bind(e,i))}},vn=function(e,t){var r;if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},Jt=function(e,t,r,n,i,a){var u=r-t,d=n-t,l=i-r;return{start:{dts:e,pts:e+u},end:{dts:e+d,pts:e+l},prependedContentDuration:a,baseMediaDecodeTime:e}};Ne=function(e,t){var r=[],n,i=0,a=0,u=1/0;t=t||{},n=t.firstSequenceNumber||0,Ne.prototype.init.call(this),this.push=function(d){W.collectDtsInfo(e,d),e&&xt.forEach(function(l){e[l]=d[l]}),r.push(d)},this.setEarliestDts=function(d){i=d},this.setVideoBaseMediaDecodeTime=function(d){u=d},this.setAudioAppendStart=function(d){a=d},this.flush=function(){var d,l,f,h,g,b,S;if(r.length===0){this.trigger("done","AudioSegmentStream");return}d=ve.trimAdtsFramesByEarliestDts(r,e,i),e.baseMediaDecodeTime=W.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),S=ve.prefixWithSilence(e,d,a,u),e.samples=ve.generateSampleTable(d),f=te.mdat(ve.concatenateFrameData(d)),r=[],l=te.moof(n,[e]),h=new Uint8Array(l.byteLength+f.byteLength),n++,h.set(l),h.set(f,l.byteLength),W.clearDtsInfo(e),g=Math.ceil(ma*1024/e.samplerate),d.length&&(b=d.length*g,this.trigger("segmentTimingInfo",Jt(H.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),d[0].dts,d[0].pts,d[0].dts+b,d[0].pts+b,S||0)),this.trigger("timingInfo",{start:d[0].pts,end:d[0].pts+b})),this.trigger("data",{track:e,boxes:h}),this.trigger("done","AudioSegmentStream")},this.reset=function(){W.clearDtsInfo(e),r=[],this.trigger("reset")}},Ne.prototype=new m,$e=function(e,t){var r,n=[],i=[],a,u;t=t||{},r=t.firstSequenceNumber||0,$e.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(d){W.collectDtsInfo(e,d),d.nalUnitType==="seq_parameter_set_rbsp"&&!a&&(a=d.config,e.sps=[d.data],yt.forEach(function(l){e[l]=a[l]},this)),d.nalUnitType==="pic_parameter_set_rbsp"&&!u&&(u=d.data,e.pps=[d.data]),n.push(d)},this.flush=function(){for(var d,l,f,h,g,b,S=0,v,w;n.length&&n[0].nalUnitType!=="access_unit_delimiter_rbsp";)n.shift();if(n.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(d=de.groupNalsIntoFrames(n),f=de.groupFramesIntoGops(d),f[0][0].keyFrame||(l=this.getGopForFusion_(n[0],e),l?(S=l.duration,f.unshift(l),f.byteLength+=l.byteLength,f.nalCount+=l.nalCount,f.pts=l.pts,f.dts=l.dts,f.duration+=l.duration):f=de.extendFirstKeyFrame(f)),i.length){var L;if(t.alignGopsAtEnd?L=this.alignGopsAtEnd_(f):L=this.alignGopsAtStart_(f),!L){this.gopCache_.unshift({gop:f.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),n=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}W.clearDtsInfo(e),f=L}W.collectDtsInfo(e,f),e.samples=de.generateSampleTable(f),g=te.mdat(de.concatenateNalData(f)),e.baseMediaDecodeTime=W.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",f.map(function(j){return{pts:j.pts,dts:j.dts,byteLength:j.byteLength}})),v=f[0],w=f[f.length-1],this.trigger("segmentTimingInfo",Jt(e.baseMediaDecodeTime,v.dts,v.pts,w.dts+w.duration,w.pts+w.duration,S)),this.trigger("timingInfo",{start:f[0].pts,end:f[f.length-1].pts+f[f.length-1].duration}),this.gopCache_.unshift({gop:f.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),n=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),h=te.moof(r,[e]),b=new Uint8Array(h.byteLength+g.byteLength),r++,b.set(h),b.set(g,h.byteLength),this.trigger("data",{track:e,boxes:b}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),n=[],this.gopCache_.length=0,i.length=0,this.trigger("reset")},this.resetStream_=function(){W.clearDtsInfo(e),a=void 0,u=void 0},this.getGopForFusion_=function(d){var l=45e3,f=1e4,h=1/0,g,b,S,v,w;for(w=0;w<this.gopCache_.length;w++)v=this.gopCache_[w],S=v.gop,!(!(e.pps&&vn(e.pps[0],v.pps[0]))||!(e.sps&&vn(e.sps[0],v.sps[0])))&&(S.dts<e.timelineStartInfo.dts||(g=d.dts-S.dts-S.duration,g>=-f&&g<=l&&(!b||h>g)&&(b=v,h=g)));return b?b.gop:null},this.alignGopsAtStart_=function(d){var l,f,h,g,b,S,v,w;for(b=d.byteLength,S=d.nalCount,v=d.duration,l=f=0;l<i.length&&f<d.length&&(h=i[l],g=d[f],h.pts!==g.pts);){if(g.pts>h.pts){l++;continue}f++,b-=g.byteLength,S-=g.nalCount,v-=g.duration}return f===0?d:f===d.length?null:(w=d.slice(f),w.byteLength=b,w.duration=v,w.nalCount=S,w.pts=w[0].pts,w.dts=w[0].dts,w)},this.alignGopsAtEnd_=function(d){var l,f,h,g,b,S;for(l=i.length-1,f=d.length-1,b=null,S=!1;l>=0&&f>=0;){if(h=i[l],g=d[f],h.pts===g.pts){S=!0;break}if(h.pts>g.pts){l--;continue}l===i.length-1&&(b=f),f--}if(!S&&b===null)return null;var v;if(S?v=f:v=b,v===0)return d;var w=d.slice(v),L=w.reduce(function(j,Ee){return j.byteLength+=Ee.byteLength,j.duration+=Ee.duration,j.nalCount+=Ee.nalCount,j},{byteLength:0,duration:0,nalCount:0});return w.byteLength=L.byteLength,w.duration=L.duration,w.nalCount=L.nalCount,w.pts=w[0].pts,w.dts=w[0].dts,w},this.alignGopsWith=function(d){i=d}},$e.prototype=new m,Ae=function(e,t){this.numberOfTracks=0,this.metadataStream=t,e=e||{},typeof e.remux<"u"?this.remuxTracks=!!e.remux:this.remuxTracks=!0,typeof e.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=e.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,Ae.prototype.init.call(this),this.push=function(r){if(r.text)return this.pendingCaptions.push(r);if(r.frames)return this.pendingMetadata.push(r);this.pendingTracks.push(r.track),this.pendingBytes+=r.boxes.byteLength,r.track.type==="video"&&(this.videoTrack=r.track,this.pendingBoxes.push(r.boxes)),r.track.type==="audio"&&(this.audioTrack=r.track,this.pendingBoxes.unshift(r.boxes))}},Ae.prototype=new m,Ae.prototype.flush=function(s){var e=0,t={captions:[],captionStreams:{},metadata:[],info:{}},r,n,i,a=0,u;if(this.pendingTracks.length<this.numberOfTracks){if(s!=="VideoSegmentStream"&&s!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(a=this.videoTrack.timelineStartInfo.pts,yt.forEach(function(d){t.info[d]=this.videoTrack[d]},this)):this.audioTrack&&(a=this.audioTrack.timelineStartInfo.pts,xt.forEach(function(d){t.info[d]=this.audioTrack[d]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?t.type=this.pendingTracks[0].type:t.type="combined",this.emittedTracks+=this.pendingTracks.length,i=te.initSegment(this.pendingTracks),t.initSegment=new Uint8Array(i.byteLength),t.initSegment.set(i),t.data=new Uint8Array(this.pendingBytes),u=0;u<this.pendingBoxes.length;u++)t.data.set(this.pendingBoxes[u],e),e+=this.pendingBoxes[u].byteLength;for(u=0;u<this.pendingCaptions.length;u++)r=this.pendingCaptions[u],r.startTime=H.metadataTsToSeconds(r.startPts,a,this.keepOriginalTimestamps),r.endTime=H.metadataTsToSeconds(r.endPts,a,this.keepOriginalTimestamps),t.captionStreams[r.stream]=!0,t.captions.push(r);for(u=0;u<this.pendingMetadata.length;u++)n=this.pendingMetadata[u],n.cueTime=H.metadataTsToSeconds(n.pts,a,this.keepOriginalTimestamps),t.metadata.push(n);for(t.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",t),u=0;u<t.captions.length;u++)r=t.captions[u],this.trigger("caption",r);for(u=0;u<t.metadata.length;u++)n=t.metadata[u],this.trigger("id3Frame",n)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},Ae.prototype.setRemux=function(s){this.remuxTracks=s},vt=function(e){var t=this,r=!0,n,i;vt.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var a={};this.transmuxPipeline_=a,a.type="aac",a.metadataStream=new k.MetadataStream,a.aacStream=new xn,a.audioTimestampRolloverStream=new k.TimestampRolloverStream("audio"),a.timedMetadataTimestampRolloverStream=new k.TimestampRolloverStream("timed-metadata"),a.adtsStream=new ge,a.coalesceStream=new Ae(e,a.metadataStream),a.headOfPipeline=a.aacStream,a.aacStream.pipe(a.audioTimestampRolloverStream).pipe(a.adtsStream),a.aacStream.pipe(a.timedMetadataTimestampRolloverStream).pipe(a.metadataStream).pipe(a.coalesceStream),a.metadataStream.on("timestamp",function(u){a.aacStream.setTimestamp(u.timeStamp)}),a.aacStream.on("data",function(u){u.type!=="timed-metadata"&&u.type!=="audio"||a.audioSegmentStream||(i=i||{timelineStartInfo:{baseMediaDecodeTime:t.baseMediaDecodeTime},codec:"adts",type:"audio"},a.coalesceStream.numberOfTracks++,a.audioSegmentStream=new Ne(i,e),a.audioSegmentStream.on("log",t.getLogTrigger_("audioSegmentStream")),a.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),a.adtsStream.pipe(a.audioSegmentStream).pipe(a.coalesceStream),t.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!n}))}),a.coalesceStream.on("data",this.trigger.bind(this,"data")),a.coalesceStream.on("done",this.trigger.bind(this,"done")),yn(this,a)},this.setupTsPipeline=function(){var a={};this.transmuxPipeline_=a,a.type="ts",a.metadataStream=new k.MetadataStream,a.packetStream=new k.TransportPacketStream,a.parseStream=new k.TransportParseStream,a.elementaryStream=new k.ElementaryStream,a.timestampRolloverStream=new k.TimestampRolloverStream,a.adtsStream=new ge,a.h264Stream=new pa,a.captionStream=new k.CaptionStream(e),a.coalesceStream=new Ae(e,a.metadataStream),a.headOfPipeline=a.packetStream,a.packetStream.pipe(a.parseStream).pipe(a.elementaryStream).pipe(a.timestampRolloverStream),a.timestampRolloverStream.pipe(a.h264Stream),a.timestampRolloverStream.pipe(a.adtsStream),a.timestampRolloverStream.pipe(a.metadataStream).pipe(a.coalesceStream),a.h264Stream.pipe(a.captionStream).pipe(a.coalesceStream),a.elementaryStream.on("data",function(u){var d;if(u.type==="metadata"){for(d=u.tracks.length;d--;)!n&&u.tracks[d].type==="video"?(n=u.tracks[d],n.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime):!i&&u.tracks[d].type==="audio"&&(i=u.tracks[d],i.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime);n&&!a.videoSegmentStream&&(a.coalesceStream.numberOfTracks++,a.videoSegmentStream=new $e(n,e),a.videoSegmentStream.on("log",t.getLogTrigger_("videoSegmentStream")),a.videoSegmentStream.on("timelineStartInfo",function(l){i&&!e.keepOriginalTimestamps&&(i.timelineStartInfo=l,a.audioSegmentStream.setEarliestDts(l.dts-t.baseMediaDecodeTime))}),a.videoSegmentStream.on("processedGopsInfo",t.trigger.bind(t,"gopInfo")),a.videoSegmentStream.on("segmentTimingInfo",t.trigger.bind(t,"videoSegmentTimingInfo")),a.videoSegmentStream.on("baseMediaDecodeTime",function(l){i&&a.audioSegmentStream.setVideoBaseMediaDecodeTime(l)}),a.videoSegmentStream.on("timingInfo",t.trigger.bind(t,"videoTimingInfo")),a.h264Stream.pipe(a.videoSegmentStream).pipe(a.coalesceStream)),i&&!a.audioSegmentStream&&(a.coalesceStream.numberOfTracks++,a.audioSegmentStream=new Ne(i,e),a.audioSegmentStream.on("log",t.getLogTrigger_("audioSegmentStream")),a.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),a.audioSegmentStream.on("segmentTimingInfo",t.trigger.bind(t,"audioSegmentTimingInfo")),a.adtsStream.pipe(a.audioSegmentStream).pipe(a.coalesceStream)),t.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!n})}}),a.coalesceStream.on("data",this.trigger.bind(this,"data")),a.coalesceStream.on("id3Frame",function(u){u.dispatchType=a.metadataStream.dispatchType,t.trigger("id3Frame",u)}),a.coalesceStream.on("caption",this.trigger.bind(this,"caption")),a.coalesceStream.on("done",this.trigger.bind(this,"done")),yn(this,a)},this.setBaseMediaDecodeTime=function(a){var u=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=a),i&&(i.timelineStartInfo.dts=void 0,i.timelineStartInfo.pts=void 0,W.clearDtsInfo(i),u.audioTimestampRolloverStream&&u.audioTimestampRolloverStream.discontinuity()),n&&(u.videoSegmentStream&&(u.videoSegmentStream.gopCache_=[]),n.timelineStartInfo.dts=void 0,n.timelineStartInfo.pts=void 0,W.clearDtsInfo(n),u.captionStream.reset()),u.timestampRolloverStream&&u.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(a){i&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(a)},this.setRemux=function(a){var u=this.transmuxPipeline_;e.remux=a,u&&u.coalesceStream&&u.coalesceStream.setRemux(a)},this.alignGopsWith=function(a){n&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(a)},this.getLogTrigger_=function(a){var u=this;return function(d){d.stream=a,u.trigger("log",d)}},this.push=function(a){if(r){var u=ha(a);u&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!u&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),r=!1}this.transmuxPipeline_.headOfPipeline.push(a)},this.flush=function(){r=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},vt.prototype=new m;var er={Transmuxer:vt,VideoSegmentStream:$e,AudioSegmentStream:Ne,AUDIO_PROPERTIES:xt,VIDEO_PROPERTIES:yt,generateSegmentTimingInfo:Jt},xa=Ge.discardEmulationPreventionBytes,ya=ft.CaptionStream,va=function(e,t){for(var r=e,n=0;n<t.length;n++){var i=t[n];if(r<i.size)return i;r-=i.size}return null},ba=function(e,t,r){var n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={logs:[],seiNals:[]},a,u,d,l;for(u=0;u+4<e.length;u+=d)if(d=n.getUint32(u),u+=4,!(d<=0))switch(e[u]&31){case 6:var f=e.subarray(u+1,u+1+d),h=va(u,t);if(a={nalUnitType:"sei_rbsp",size:d,data:f,escapedRBSP:xa(f),trackId:r},h)a.pts=h.pts,a.dts=h.dts,l=h;else if(l)a.pts=l.pts,a.dts=l.dts;else{i.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+u+" for trackId "+r+". See mux.js#223."});break}i.seiNals.push(a);break}return i},Sa=function(e,t,r){var n=t,i=r.defaultSampleDuration||0,a=r.defaultSampleSize||0,u=r.trackId,d=[];return e.forEach(function(l){var f=qt(l),h=f.samples;h.forEach(function(g){g.duration===void 0&&(g.duration=i),g.size===void 0&&(g.size=a),g.trackId=u,g.dts=n,g.compositionTimeOffset===void 0&&(g.compositionTimeOffset=0),typeof n=="bigint"?(g.pts=n+p.default.BigInt(g.compositionTimeOffset),n+=p.default.BigInt(g.duration)):(g.pts=n+g.compositionTimeOffset,n+=g.duration)}),d=d.concat(h)}),d},_a=function(e,t){var r=R(e,["moof","traf"]),n=R(e,["mdat"]),i={},a=[];return n.forEach(function(u,d){var l=r[d];a.push({mdat:u,traf:l})}),a.forEach(function(u){var d=u.mdat,l=u.traf,f=R(l,["tfhd"]),h=Gt(f[0]),g=h.trackId,b=R(l,["tfdt"]),S=b.length>0?Ht(b[0]).baseMediaDecodeTime:0,v=R(l,["trun"]),w,L;t===g&&v.length>0&&(w=Sa(v,S,h),L=ba(d,w,g),i[g]||(i[g]={seiNals:[],logs:[]}),i[g].seiNals=i[g].seiNals.concat(L.seiNals),i[g].logs=i[g].logs.concat(L.logs))}),i},Ta=function(e,t,r){var n;if(t===null)return null;n=_a(e,t);var i=n[t]||{};return{seiNals:i.seiNals,logs:i.logs,timescale:r}},wa=function(){var e=!1,t,r,n,i,a,u;this.isInitialized=function(){return e},this.init=function(d){t=new ya,e=!0,u=d?d.isPartial:!1,t.on("data",function(l){l.startTime=l.startPts/i,l.endTime=l.endPts/i,a.captions.push(l),a.captionStreams[l.stream]=!0}),t.on("log",function(l){a.logs.push(l)})},this.isNewInit=function(d,l){return d&&d.length===0||l&&typeof l=="object"&&Object.keys(l).length===0?!1:n!==d[0]||i!==l[n]},this.parse=function(d,l,f){var h;if(this.isInitialized()){if(!l||!f)return null;if(this.isNewInit(l,f))n=l[0],i=f[n];else if(n===null||!i)return r.push(d),null}else return null;for(;r.length>0;){var g=r.shift();this.parse(g,l,f)}return h=Ta(d,n,i),h&&h.logs&&(a.logs=a.logs.concat(h.logs)),h===null||!h.seiNals?a.logs.length?{logs:a.logs,captions:[],captionStreams:[]}:null:(this.pushNals(h.seiNals),this.flushStream(),a)},this.pushNals=function(d){if(!this.isInitialized()||!d||d.length===0)return null;d.forEach(function(l){t.push(l)})},this.flushStream=function(){if(!this.isInitialized())return null;u?t.partialFlush():t.flush()},this.clearParsedCaptions=function(){a.captions=[],a.captionStreams={},a.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;t.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){r=[],n=null,i=null,a?this.clearParsedCaptions():a={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},Ia=wa,Aa={generator:te,probe:_i,Transmuxer:er.Transmuxer,AudioSegmentStream:er.AudioSegmentStream,VideoSegmentStream:er.VideoSegmentStream,CaptionParser:Ia},U;U=function(e,t){var r=0,n=16384,i=function(h,g){var b,S=h.position+g;S<h.bytes.byteLength||(b=new Uint8Array(S*2),b.set(h.bytes.subarray(0,h.position),0),h.bytes=b,h.view=new DataView(h.bytes.buffer))},a=U.widthBytes||new Uint8Array(5),u=U.heightBytes||new Uint8Array(6),d=U.videocodecidBytes||new Uint8Array(12),l;if(!U.widthBytes){for(l=0;l<5;l++)a[l]="width".charCodeAt(l);for(l=0;l<6;l++)u[l]="height".charCodeAt(l);for(l=0;l<12;l++)d[l]="videocodecid".charCodeAt(l);U.widthBytes=a,U.heightBytes=u,U.videocodecidBytes=d}switch(this.keyFrame=!1,e){case U.VIDEO_TAG:this.length=16,n*=6;break;case U.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case U.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(n),this.view=new DataView(this.bytes.buffer),this.bytes[0]=e,this.position=this.length,this.keyFrame=t,this.pts=0,this.dts=0,this.writeBytes=function(f,h,g){var b=h||0,S;g=g||f.byteLength,S=b+g,i(this,g),this.bytes.set(f.subarray(b,S),this.position),this.position+=g,this.length=Math.max(this.length,this.position)},this.writeByte=function(f){i(this,1),this.bytes[this.position]=f,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(f){i(this,2),this.view.setUint16(this.position,f),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(f){return this.bytes[this.length-f]},this.nalUnitSize=function(){return r===0?0:this.length-(r+4)},this.startNalUnit=function(){if(r>0)throw new Error("Attempted to create new NAL wihout closing the old one");r=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(f){var h,g;this.length===r+4?this.length-=4:r>0&&(h=r+4,g=this.length-h,this.position=r,this.view.setUint32(this.position,g),this.position=this.length,f&&f.push(this.bytes.subarray(h,h+g))),r=0},this.writeMetaDataDouble=function(f,h){var g;if(i(this,2+f.length+9),this.view.setUint16(this.position,f.length),this.position+=2,f==="width")this.bytes.set(a,this.position),this.position+=5;else if(f==="height")this.bytes.set(u,this.position),this.position+=6;else if(f==="videocodecid")this.bytes.set(d,this.position),this.position+=12;else for(g=0;g<f.length;g++)this.bytes[this.position]=f.charCodeAt(g),this.position++;this.position++,this.view.setFloat64(this.position,h),this.position+=8,this.length=Math.max(this.length,this.position),++r},this.writeMetaDataBoolean=function(f,h){var g;for(i(this,2),this.view.setUint16(this.position,f.length),this.position+=2,g=0;g<f.length;g++)i(this,1),this.bytes[this.position]=f.charCodeAt(g),this.position++;i(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,h?1:0),this.position++,this.length=Math.max(this.length,this.position),++r},this.finalize=function(){var f,h;switch(this.bytes[0]){case U.VIDEO_TAG:this.bytes[11]=(this.keyFrame||t?16:32)|7,this.bytes[12]=t?0:1,f=this.pts-this.dts,this.bytes[13]=(f&16711680)>>>16,this.bytes[14]=(f&65280)>>>8,this.bytes[15]=(f&255)>>>0;break;case U.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=t?0:1;break;case U.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,r),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position;break}return h=this.length-11,this.bytes[1]=(h&16711680)>>>16,this.bytes[2]=(h&65280)>>>8,this.bytes[3]=(h&255)>>>0,this.bytes[4]=(this.dts&16711680)>>>16,this.bytes[5]=(this.dts&65280)>>>8,this.bytes[6]=(this.dts&255)>>>0,this.bytes[7]=(this.dts&4278190080)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,i(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=U.frameTime(this.bytes),this}},U.AUDIO_TAG=8,U.VIDEO_TAG=9,U.METADATA_TAG=18,U.isAudioFrame=function(s){return U.AUDIO_TAG===s[0]},U.isVideoFrame=function(s){return U.VIDEO_TAG===s[0]},U.isMetaData=function(s){return U.METADATA_TAG===s[0]},U.isKeyFrame=function(s){return U.isVideoFrame(s)?s[11]===23:!!(U.isAudioFrame(s)||U.isMetaData(s))},U.frameTime=function(s){var e=s[4]<<16;return e|=s[5]<<8,e|=s[6]<<0,e|=s[7]<<24,e};var Q=U,tr=function s(e){this.numberOfTracks=0,this.metadataStream=e.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,s.prototype.init.call(this),this.push=function(t){if(t.text)return this.pendingCaptions.push(t);if(t.frames)return this.pendingMetadata.push(t);t.track.type==="video"&&(this.videoTrack=t.track,this.videoTags=t.tags,this.pendingTracks++),t.track.type==="audio"&&(this.audioTrack=t.track,this.audioTags=t.tags,this.pendingTracks++)}};tr.prototype=new m,tr.prototype.flush=function(s){var e,t,r,n,i={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if(s!=="VideoSegmentStream"&&s!=="AudioSegmentStream")return;if(this.pendingTracks===0&&(this.processedTracks++,this.processedTracks<this.numberOfTracks))return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?n=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(n=this.audioTrack.timelineStartInfo.pts),i.tags.videoTags=this.videoTags,i.tags.audioTags=this.audioTags,r=0;r<this.pendingCaptions.length;r++)t=this.pendingCaptions[r],t.startTime=t.startPts-n,t.startTime/=9e4,t.endTime=t.endPts-n,t.endTime/=9e4,i.captionStreams[t.stream]=!0,i.captions.push(t);for(r=0;r<this.pendingMetadata.length;r++)e=this.pendingMetadata[r],e.cueTime=e.pts-n,e.cueTime/=9e4,i.metadata.push(e);i.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",i),this.trigger("done")}};var Fa=tr,Ea=function(){var e=this;this.list=[],this.push=function(t){this.list.push({bytes:t.bytes,dts:t.dts,pts:t.pts,keyFrame:t.keyFrame,metaDataTag:t.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return e.list.length}})},bn=Ea,Da=Bt.H264Stream,bt,St,_t,rr,Sn,_n;rr=function(e,t){typeof t.pts=="number"&&(e.timelineStartInfo.pts===void 0?e.timelineStartInfo.pts=t.pts:e.timelineStartInfo.pts=Math.min(e.timelineStartInfo.pts,t.pts)),typeof t.dts=="number"&&(e.timelineStartInfo.dts===void 0?e.timelineStartInfo.dts=t.dts:e.timelineStartInfo.dts=Math.min(e.timelineStartInfo.dts,t.dts))},Sn=function(e,t){var r=new Q(Q.METADATA_TAG);return r.dts=t,r.pts=t,r.writeMetaDataDouble("videocodecid",7),r.writeMetaDataDouble("width",e.width),r.writeMetaDataDouble("height",e.height),r},_n=function(e,t){var r,n=new Q(Q.VIDEO_TAG,!0);for(n.dts=t,n.pts=t,n.writeByte(1),n.writeByte(e.profileIdc),n.writeByte(e.profileCompatibility),n.writeByte(e.levelIdc),n.writeByte(255),n.writeByte(225),n.writeShort(e.sps[0].length),n.writeBytes(e.sps[0]),n.writeByte(e.pps.length),r=0;r<e.pps.length;++r)n.writeShort(e.pps[r].length),n.writeBytes(e.pps[r]);return n},_t=function(e){var t=[],r=[],n;_t.prototype.init.call(this),this.push=function(i){rr(e,i),e&&(e.audioobjecttype=i.audioobjecttype,e.channelcount=i.channelcount,e.samplerate=i.samplerate,e.samplingfrequencyindex=i.samplingfrequencyindex,e.samplesize=i.samplesize,e.extraData=e.audioobjecttype<<11|e.samplingfrequencyindex<<7|e.channelcount<<3),i.pts=Math.round(i.pts/90),i.dts=Math.round(i.dts/90),t.push(i)},this.flush=function(){var i,a,u,d=new bn;if(t.length===0){this.trigger("done","AudioSegmentStream");return}for(u=-1/0;t.length;)i=t.shift(),r.length&&i.pts>=r[0]&&(u=r.shift(),this.writeMetaDataTags(d,u)),(e.extraData!==n||i.pts-u>=1e3)&&(this.writeMetaDataTags(d,i.pts),n=e.extraData,u=i.pts),a=new Q(Q.AUDIO_TAG),a.pts=i.pts,a.dts=i.dts,a.writeBytes(i.data),d.push(a.finalize());r.length=0,n=null,this.trigger("data",{track:e,tags:d.list}),this.trigger("done","AudioSegmentStream")},this.writeMetaDataTags=function(i,a){var u;u=new Q(Q.METADATA_TAG),u.pts=a,u.dts=a,u.writeMetaDataDouble("audiocodecid",10),u.writeMetaDataBoolean("stereo",e.channelcount===2),u.writeMetaDataDouble("audiosamplerate",e.samplerate),u.writeMetaDataDouble("audiosamplesize",16),i.push(u.finalize()),u=new Q(Q.AUDIO_TAG,!0),u.pts=a,u.dts=a,u.view.setUint16(u.position,e.extraData),u.position+=2,u.length=Math.max(u.length,u.position),i.push(u.finalize())},this.onVideoKeyFrame=function(i){r.push(i)}},_t.prototype=new m,St=function(e){var t=[],r,n;St.prototype.init.call(this),this.finishFrame=function(i,a){if(!!a){if(r&&e&&e.newMetadata&&(a.keyFrame||i.length===0)){var u=Sn(r,a.dts).finalize(),d=_n(e,a.dts).finalize();u.metaDataTag=d.metaDataTag=!0,i.push(u),i.push(d),e.newMetadata=!1,this.trigger("keyframe",a.dts)}a.endNalUnit(),i.push(a.finalize()),n=null}},this.push=function(i){rr(e,i),i.pts=Math.round(i.pts/90),i.dts=Math.round(i.dts/90),t.push(i)},this.flush=function(){for(var i,a=new bn;t.length&&t[0].nalUnitType!=="access_unit_delimiter_rbsp";)t.shift();if(t.length===0){this.trigger("done","VideoSegmentStream");return}for(;t.length;)i=t.shift(),i.nalUnitType==="seq_parameter_set_rbsp"?(e.newMetadata=!0,r=i.config,e.width=r.width,e.height=r.height,e.sps=[i.data],e.profileIdc=r.profileIdc,e.levelIdc=r.levelIdc,e.profileCompatibility=r.profileCompatibility,n.endNalUnit()):i.nalUnitType==="pic_parameter_set_rbsp"?(e.newMetadata=!0,e.pps=[i.data],n.endNalUnit()):i.nalUnitType==="access_unit_delimiter_rbsp"?(n&&this.finishFrame(a,n),n=new Q(Q.VIDEO_TAG),n.pts=i.pts,n.dts=i.dts):(i.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(n.keyFrame=!0),n.endNalUnit()),n.startNalUnit(),n.writeBytes(i.data);n&&this.finishFrame(a,n),this.trigger("data",{track:e,tags:a.list}),this.trigger("done","VideoSegmentStream")}},St.prototype=new m,bt=function(e){var t=this,r,n,i,a,u,d,l,f,h,g,b,S;bt.prototype.init.call(this),e=e||{},this.metadataStream=new k.MetadataStream,e.metadataStream=this.metadataStream,r=new k.TransportPacketStream,n=new k.TransportParseStream,i=new k.ElementaryStream,a=new k.TimestampRolloverStream("video"),u=new k.TimestampRolloverStream("audio"),d=new k.TimestampRolloverStream("timed-metadata"),l=new ge,f=new Da,S=new Fa(e),r.pipe(n).pipe(i),i.pipe(a).pipe(f),i.pipe(u).pipe(l),i.pipe(d).pipe(this.metadataStream).pipe(S),b=new k.CaptionStream(e),f.pipe(b).pipe(S),i.on("data",function(v){var w,L,j;if(v.type==="metadata"){for(w=v.tracks.length;w--;)v.tracks[w].type==="video"?L=v.tracks[w]:v.tracks[w].type==="audio"&&(j=v.tracks[w]);L&&!h&&(S.numberOfTracks++,h=new St(L),f.pipe(h).pipe(S)),j&&!g&&(S.numberOfTracks++,g=new _t(j),l.pipe(g).pipe(S),h&&h.on("keyframe",g.onVideoKeyFrame))}}),this.push=function(v){r.push(v)},this.flush=function(){r.flush()},this.resetCaptions=function(){b.reset()},S.on("data",function(v){t.trigger("data",v)}),S.on("done",function(){t.trigger("done")})},bt.prototype=new m;var Ma=bt,Ua=function(e,t,r){var n=new Uint8Array(9),i=new DataView(n.buffer),a,u,d;return e=e||0,t=t===void 0?!0:t,r=r===void 0?!0:r,i.setUint8(0,70),i.setUint8(1,76),i.setUint8(2,86),i.setUint8(3,1),i.setUint8(4,(t?4:0)|(r?1:0)),i.setUint32(5,n.byteLength),e<=0?(u=new Uint8Array(n.byteLength+4),u.set(n),u.set([0,0,0,0],n.byteLength),u):(a=new Q(Q.METADATA_TAG),a.pts=a.dts=0,a.writeMetaDataDouble("duration",e),d=a.finalize().length,u=new Uint8Array(n.byteLength+d),u.set(n),u.set(i.byteLength,d),u)},Ca=Ua,Pa={tag:Q,Transmuxer:Ma,getFlvHeader:Ca},Oa=k,ka=H.ONE_SECOND_IN_TS,Tn=function s(e,t){var r=[],n=0,i=0,a=0,u=1/0,d=null,l=null;t=t||{},s.prototype.init.call(this),this.push=function(f){W.collectDtsInfo(e,f),e&&xt.forEach(function(h){e[h]=f[h]}),r.push(f)},this.setEarliestDts=function(f){i=f},this.setVideoBaseMediaDecodeTime=function(f){u=f},this.setAudioAppendStart=function(f){a=f},this.processFrames_=function(){var f,h,g,b,S;r.length!==0&&(f=ve.trimAdtsFramesByEarliestDts(r,e,i),f.length!==0&&(e.baseMediaDecodeTime=W.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),ve.prefixWithSilence(e,f,a,u),e.samples=ve.generateSampleTable(f),g=te.mdat(ve.concatenateFrameData(f)),r=[],h=te.moof(n,[e]),n++,e.initSegment=te.initSegment([e]),b=new Uint8Array(h.byteLength+g.byteLength),b.set(h),b.set(g,h.byteLength),W.clearDtsInfo(e),d===null&&(l=d=f[0].pts),l+=f.length*(ka*1024/e.samplerate),S={start:d},this.trigger("timingInfo",S),this.trigger("data",{track:e,boxes:b})))},this.flush=function(){this.processFrames_(),this.trigger("timingInfo",{start:d,end:l}),this.resetTiming_(),this.trigger("done","AudioSegmentStream")},this.partialFlush=function(){this.processFrames_(),this.trigger("partialdone","AudioSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","AudioSegmentStream")},this.resetTiming_=function(){W.clearDtsInfo(e),d=null,l=null},this.reset=function(){this.resetTiming_(),r=[],this.trigger("reset")}};Tn.prototype=new m;var wn=Tn,In=function s(e,t){var r=0,n=[],i=[],a,u,d=null,l=null,f,h=!0;t=t||{},s.prototype.init.call(this),this.push=function(g){W.collectDtsInfo(e,g),typeof e.timelineStartInfo.dts>"u"&&(e.timelineStartInfo.dts=g.dts),g.nalUnitType==="seq_parameter_set_rbsp"&&!a&&(a=g.config,e.sps=[g.data],yt.forEach(function(b){e[b]=a[b]},this)),g.nalUnitType==="pic_parameter_set_rbsp"&&!u&&(u=g.data,e.pps=[g.data]),n.push(g)},this.processNals_=function(g){var b;for(n=i.concat(n);n.length&&n[0].nalUnitType!=="access_unit_delimiter_rbsp";)n.shift();if(n.length!==0){var S=de.groupNalsIntoFrames(n);if(!!S.length){if(i=S[S.length-1],g&&(S.pop(),S.duration-=i.duration,S.nalCount-=i.length,S.byteLength-=i.byteLength),!S.length){n=[];return}if(this.trigger("timelineStartInfo",e.timelineStartInfo),h){if(f=de.groupFramesIntoGops(S),!f[0][0].keyFrame){if(f=de.extendFirstKeyFrame(f),!f[0][0].keyFrame){n=[].concat.apply([],S).concat(i),i=[];return}S=[].concat.apply([],f),S.duration=f.duration}h=!1}for(d===null&&(d=S[0].pts,l=d),l+=S.duration,this.trigger("timingInfo",{start:d,end:l}),b=0;b<S.length;b++){var v=S[b];e.samples=de.generateSampleTableForFrame(v);var w=te.mdat(de.concatenateNalDataForFrame(v));W.clearDtsInfo(e),W.collectDtsInfo(e,v),e.baseMediaDecodeTime=W.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps);var L=te.moof(r,[e]);r++,e.initSegment=te.initSegment([e]);var j=new Uint8Array(L.byteLength+w.byteLength);j.set(L),j.set(w,L.byteLength),this.trigger("data",{track:e,boxes:j,sequence:r,videoFrameDts:v.dts,videoFramePts:v.pts})}n=[]}}},this.resetTimingAndConfig_=function(){a=void 0,u=void 0,d=null,l=null},this.partialFlush=function(){this.processNals_(!0),this.trigger("partialdone","VideoSegmentStream")},this.flush=function(){this.processNals_(!1),this.resetTimingAndConfig_(),this.trigger("done","VideoSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","VideoSegmentStream")},this.reset=function(){this.resetTimingAndConfig_(),i=[],n=[],h=!0,this.trigger("reset")}};In.prototype=new m;var La=In,Ra=He.isLikelyAacData,An=function(e){return e.prototype=new m,e.prototype.init.call(e),e},Ba=function(e){var t={type:"ts",tracks:{audio:null,video:null},packet:new k.TransportPacketStream,parse:new k.TransportParseStream,elementary:new k.ElementaryStream,timestampRollover:new k.TimestampRolloverStream,adts:new Nt.Adts,h264:new Nt.h264.H264Stream,captionStream:new k.CaptionStream(e),metadataStream:new k.MetadataStream};return t.headOfPipeline=t.packet,t.packet.pipe(t.parse).pipe(t.elementary).pipe(t.timestampRollover),t.timestampRollover.pipe(t.h264),t.h264.pipe(t.captionStream),t.timestampRollover.pipe(t.metadataStream),t.timestampRollover.pipe(t.adts),t.elementary.on("data",function(r){if(r.type==="metadata"){for(var n=0;n<r.tracks.length;n++)t.tracks[r.tracks[n].type]||(t.tracks[r.tracks[n].type]=r.tracks[n],t.tracks[r.tracks[n].type].timelineStartInfo.baseMediaDecodeTime=e.baseMediaDecodeTime);t.tracks.video&&!t.videoSegmentStream&&(t.videoSegmentStream=new La(t.tracks.video,e),t.videoSegmentStream.on("timelineStartInfo",function(i){t.tracks.audio&&!e.keepOriginalTimestamps&&t.audioSegmentStream.setEarliestDts(i.dts-e.baseMediaDecodeTime)}),t.videoSegmentStream.on("timingInfo",t.trigger.bind(t,"videoTimingInfo")),t.videoSegmentStream.on("data",function(i){t.trigger("data",{type:"video",data:i})}),t.videoSegmentStream.on("done",t.trigger.bind(t,"done")),t.videoSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.videoSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.h264.pipe(t.videoSegmentStream)),t.tracks.audio&&!t.audioSegmentStream&&(t.audioSegmentStream=new wn(t.tracks.audio,e),t.audioSegmentStream.on("data",function(i){t.trigger("data",{type:"audio",data:i})}),t.audioSegmentStream.on("done",t.trigger.bind(t,"done")),t.audioSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.audioSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),t.adts.pipe(t.audioSegmentStream)),t.trigger("trackinfo",{hasAudio:!!t.tracks.audio,hasVideo:!!t.tracks.video})}}),t.captionStream.on("data",function(r){var n;t.tracks.video?n=t.tracks.video.timelineStartInfo.pts||0:n=0,r.startTime=H.metadataTsToSeconds(r.startPts,n,e.keepOriginalTimestamps),r.endTime=H.metadataTsToSeconds(r.endPts,n,e.keepOriginalTimestamps),t.trigger("caption",r)}),t=An(t),t.metadataStream.on("data",t.trigger.bind(t,"id3Frame")),t},Na=function(e){var t={type:"aac",tracks:{audio:null},metadataStream:new k.MetadataStream,aacStream:new xn,audioRollover:new k.TimestampRolloverStream("audio"),timedMetadataRollover:new k.TimestampRolloverStream("timed-metadata"),adtsStream:new ge(!0)};return t.headOfPipeline=t.aacStream,t.aacStream.pipe(t.audioRollover).pipe(t.adtsStream),t.aacStream.pipe(t.timedMetadataRollover).pipe(t.metadataStream),t.metadataStream.on("timestamp",function(r){t.aacStream.setTimestamp(r.timeStamp)}),t.aacStream.on("data",function(r){r.type!=="timed-metadata"&&r.type!=="audio"||t.audioSegmentStream||(t.tracks.audio=t.tracks.audio||{timelineStartInfo:{baseMediaDecodeTime:e.baseMediaDecodeTime},codec:"adts",type:"audio"},t.audioSegmentStream=new wn(t.tracks.audio,e),t.audioSegmentStream.on("data",function(n){t.trigger("data",{type:"audio",data:n})}),t.audioSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.audioSegmentStream.on("done",t.trigger.bind(t,"done")),t.audioSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),t.adtsStream.pipe(t.audioSegmentStream),t.trigger("trackinfo",{hasAudio:!!t.tracks.audio,hasVideo:!!t.tracks.video}))}),t=An(t),t.metadataStream.on("data",t.trigger.bind(t,"id3Frame")),t},Fn=function(e,t){e.on("data",t.trigger.bind(t,"data")),e.on("done",t.trigger.bind(t,"done")),e.on("partialdone",t.trigger.bind(t,"partialdone")),e.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),e.on("audioTimingInfo",t.trigger.bind(t,"audioTimingInfo")),e.on("videoTimingInfo",t.trigger.bind(t,"videoTimingInfo")),e.on("trackinfo",t.trigger.bind(t,"trackinfo")),e.on("id3Frame",function(r){r.dispatchType=e.metadataStream.dispatchType,r.cueTime=H.videoTsToSeconds(r.pts),t.trigger("id3Frame",r)}),e.on("caption",function(r){t.trigger("caption",r)})},En=function s(e){var t=null,r=!0;e=e||{},s.prototype.init.call(this),e.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.push=function(n){if(r){var i=Ra(n);i&&(!t||t.type!=="aac")?(t=Na(e),Fn(t,this)):!i&&(!t||t.type!=="ts")&&(t=Ba(e),Fn(t,this)),r=!1}t.headOfPipeline.push(n)},this.flush=function(){!t||(r=!0,t.headOfPipeline.flush())},this.partialFlush=function(){!t||t.headOfPipeline.partialFlush()},this.endTimeline=function(){!t||t.headOfPipeline.endTimeline()},this.reset=function(){!t||t.headOfPipeline.reset()},this.setBaseMediaDecodeTime=function(n){e.keepOriginalTimestamps||(e.baseMediaDecodeTime=n),t&&(t.tracks.audio&&(t.tracks.audio.timelineStartInfo.dts=void 0,t.tracks.audio.timelineStartInfo.pts=void 0,W.clearDtsInfo(t.tracks.audio),t.audioRollover&&t.audioRollover.discontinuity()),t.tracks.video&&(t.videoSegmentStream&&(t.videoSegmentStream.gopCache_=[]),t.tracks.video.timelineStartInfo.dts=void 0,t.tracks.video.timelineStartInfo.pts=void 0,W.clearDtsInfo(t.tracks.video)),t.timestampRollover&&t.timestampRollover.discontinuity())},this.setRemux=function(n){e.remux=n,t&&t.coalesceStream&&t.coalesceStream.setRemux(n)},this.setAudioAppendStart=function(n){!t||!t.tracks.audio||!t.audioSegmentStream||t.audioSegmentStream.setAudioAppendStart(n)},this.alignGopsWith=function(n){}};En.prototype=new m;var ja=En,Wa={Transmuxer:ja},Dn=ze.getUint64,za=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:t.getUint32(4),timescale:t.getUint32(8)},n=12;r.version===0?(r.earliestPresentationTime=t.getUint32(n),r.firstOffset=t.getUint32(n+4),n+=8):(r.earliestPresentationTime=Dn(e.subarray(n)),r.firstOffset=Dn(e.subarray(n+8)),n+=16),n+=2;var i=t.getUint16(n);for(n+=2;i>0;n+=12,i--)r.references.push({referenceType:(e[n]&128)>>>7,referencedSize:t.getUint32(n)&2147483647,subsegmentDuration:t.getUint32(n+4),startsWithSap:!!(e[n+8]&128),sapType:(e[n+8]&112)>>>4,sapDeltaTime:t.getUint32(n+8)&268435455});return r},Va=za,Mn=ze.getUint64,Y,nr,ne=function(e){return new Date(e*1e3-20828448e5)},Ga=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=[],n,i;for(n=0;n+4<e.length;n+=i){if(i=t.getUint32(n),n+=4,i<=0){r.push("<span style='color:red;'>MALFORMED DATA</span>");continue}switch(e[n]&31){case 1:r.push("slice_layer_without_partitioning_rbsp");break;case 5:r.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:r.push("sei_rbsp");break;case 7:r.push("seq_parameter_set_rbsp");break;case 8:r.push("pic_parameter_set_rbsp");break;case 9:r.push("access_unit_delimiter_rbsp");break;default:r.push("UNKNOWN NAL - "+e[n]&31);break}}return r},be={avc1:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{dataReferenceIndex:t.getUint16(6),width:t.getUint16(24),height:t.getUint16(26),horizresolution:t.getUint16(28)+t.getUint16(30)/16,vertresolution:t.getUint16(32)+t.getUint16(34)/16,frameCount:t.getUint16(40),depth:t.getUint16(74),config:Y(e.subarray(78,e.byteLength))}},avcC:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={configurationVersion:e[0],avcProfileIndication:e[1],profileCompatibility:e[2],avcLevelIndication:e[3],lengthSizeMinusOne:e[4]&3,sps:[],pps:[]},n=e[5]&31,i,a,u,d;for(u=6,d=0;d<n;d++)a=t.getUint16(u),u+=2,r.sps.push(new Uint8Array(e.subarray(u,u+a))),u+=a;for(i=e[u],u++,d=0;d<i;d++)a=t.getUint16(u),u+=2,r.pps.push(new Uint8Array(e.subarray(u,u+a))),u+=a;return r},btrt:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{bufferSizeDB:t.getUint32(0),maxBitrate:t.getUint32(4),avgBitrate:t.getUint32(8)}},edts:function(e){return{boxes:Y(e)}},elst:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),edits:[]},n=t.getUint32(4),i;for(i=8;n;n--)r.version===0?(r.edits.push({segmentDuration:t.getUint32(i),mediaTime:t.getInt32(i+4),mediaRate:t.getUint16(i+8)+t.getUint16(i+10)/(256*256)}),i+=12):(r.edits.push({segmentDuration:Mn(e.subarray(i)),mediaTime:Mn(e.subarray(i+8)),mediaRate:t.getUint16(i+16)+t.getUint16(i+18)/(256*256)}),i+=20);return r},esds:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),esId:e[6]<<8|e[7],streamPriority:e[8]&31,decoderConfig:{objectProfileIndication:e[11],streamType:e[12]>>>2&63,bufferSize:e[13]<<16|e[14]<<8|e[15],maxBitrate:e[16]<<24|e[17]<<16|e[18]<<8|e[19],avgBitrate:e[20]<<24|e[21]<<16|e[22]<<8|e[23],decoderConfigDescriptor:{tag:e[24],length:e[25],audioObjectType:e[26]>>>3&31,samplingFrequencyIndex:(e[26]&7)<<1|e[27]>>>7&1,channelConfiguration:e[27]>>>3&15}}}},ftyp:function(e){for(var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={majorBrand:re(e.subarray(0,4)),minorVersion:t.getUint32(4),compatibleBrands:[]},n=8;n<e.byteLength;)r.compatibleBrands.push(re(e.subarray(n,n+4))),n+=4;return r},dinf:function(e){return{boxes:Y(e)}},dref:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),dataReferences:Y(e.subarray(8))}},hdlr:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:re(e.subarray(8,12)),name:""},n=8;for(n=24;n<e.byteLength;n++){if(e[n]===0){n++;break}r.name+=String.fromCharCode(e[n])}return r.name=decodeURIComponent(escape(r.name)),r},mdat:function(e){return{byteLength:e.byteLength,nals:Ga(e)}},mdhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=4,n,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),language:""};return i.version===1?(r+=4,i.creationTime=ne(t.getUint32(r)),r+=8,i.modificationTime=ne(t.getUint32(r)),r+=4,i.timescale=t.getUint32(r),r+=8,i.duration=t.getUint32(r)):(i.creationTime=ne(t.getUint32(r)),r+=4,i.modificationTime=ne(t.getUint32(r)),r+=4,i.timescale=t.getUint32(r),r+=4,i.duration=t.getUint32(r)),r+=4,n=t.getUint16(r),i.language+=String.fromCharCode((n>>10)+96),i.language+=String.fromCharCode(((n&992)>>5)+96),i.language+=String.fromCharCode((n&31)+96),i},mdia:function(e){return{boxes:Y(e)}},mfhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sequenceNumber:e[4]<<24|e[5]<<16|e[6]<<8|e[7]}},minf:function(e){return{boxes:Y(e)}},mp4a:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={dataReferenceIndex:t.getUint16(6),channelcount:t.getUint16(16),samplesize:t.getUint16(18),samplerate:t.getUint16(24)+t.getUint16(26)/65536};return e.byteLength>28&&(r.streamDescriptor=Y(e.subarray(28))[0]),r},moof:function(e){return{boxes:Y(e)}},moov:function(e){return{boxes:Y(e)}},mvex:function(e){return{boxes:Y(e)}},mvhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=4,n={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return n.version===1?(r+=4,n.creationTime=ne(t.getUint32(r)),r+=8,n.modificationTime=ne(t.getUint32(r)),r+=4,n.timescale=t.getUint32(r),r+=8,n.duration=t.getUint32(r)):(n.creationTime=ne(t.getUint32(r)),r+=4,n.modificationTime=ne(t.getUint32(r)),r+=4,n.timescale=t.getUint32(r),r+=4,n.duration=t.getUint32(r)),r+=4,n.rate=t.getUint16(r)+t.getUint16(r+2)/16,r+=4,n.volume=t.getUint8(r)+t.getUint8(r+1)/8,r+=2,r+=2,r+=2*4,n.matrix=new Uint32Array(e.subarray(r,r+9*4)),r+=9*4,r+=6*4,n.nextTrackId=t.getUint32(r),n},pdin:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),rate:t.getUint32(4),initialDelay:t.getUint32(8)}},sdtp:function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},r;for(r=4;r<e.byteLength;r++)t.samples.push({dependsOn:(e[r]&48)>>4,isDependedOn:(e[r]&12)>>2,hasRedundancy:e[r]&3});return t},sidx:Va,smhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),balance:e[4]+e[5]/256}},stbl:function(e){return{boxes:Y(e)}},ctts:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),compositionOffsets:[]},n=t.getUint32(4),i;for(i=8;n;i+=8,n--)r.compositionOffsets.push({sampleCount:t.getUint32(i),sampleOffset:t[r.version===0?"getUint32":"getInt32"](i+4)});return r},stss:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),syncSamples:[]},n=t.getUint32(4),i;for(i=8;n;i+=4,n--)r.syncSamples.push(t.getUint32(i));return r},stco:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),chunkOffsets:[]},n=t.getUint32(4),i;for(i=8;n;i+=4,n--)r.chunkOffsets.push(t.getUint32(i));return r},stsc:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=t.getUint32(4),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleToChunks:[]},i;for(i=8;r;i+=12,r--)n.sampleToChunks.push({firstChunk:t.getUint32(i),samplesPerChunk:t.getUint32(i+4),sampleDescriptionIndex:t.getUint32(i+8)});return n},stsd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleDescriptions:Y(e.subarray(8))}},stsz:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleSize:t.getUint32(4),entries:[]},n;for(n=12;n<e.byteLength;n+=4)r.entries.push(t.getUint32(n));return r},stts:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),timeToSamples:[]},n=t.getUint32(4),i;for(i=8;n;i+=8,n--)r.timeToSamples.push({sampleCount:t.getUint32(i),sampleDelta:t.getUint32(i+4)});return r},styp:function(e){return be.ftyp(e)},tfdt:Ht,tfhd:Gt,tkhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=4,n={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return n.version===1?(r+=4,n.creationTime=ne(t.getUint32(r)),r+=8,n.modificationTime=ne(t.getUint32(r)),r+=4,n.trackId=t.getUint32(r),r+=4,r+=8,n.duration=t.getUint32(r)):(n.creationTime=ne(t.getUint32(r)),r+=4,n.modificationTime=ne(t.getUint32(r)),r+=4,n.trackId=t.getUint32(r),r+=4,r+=4,n.duration=t.getUint32(r)),r+=4,r+=2*4,n.layer=t.getUint16(r),r+=2,n.alternateGroup=t.getUint16(r),r+=2,n.volume=t.getUint8(r)+t.getUint8(r+1)/8,r+=2,r+=2,n.matrix=new Uint32Array(e.subarray(r,r+9*4)),r+=9*4,n.width=t.getUint16(r)+t.getUint16(r+2)/65536,r+=4,n.height=t.getUint16(r)+t.getUint16(r+2)/65536,n},traf:function(e){return{boxes:Y(e)}},trak:function(e){return{boxes:Y(e)}},trex:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4),defaultSampleDescriptionIndex:t.getUint32(8),defaultSampleDuration:t.getUint32(12),defaultSampleSize:t.getUint32(16),sampleDependsOn:e[20]&3,sampleIsDependedOn:(e[21]&192)>>6,sampleHasRedundancy:(e[21]&48)>>4,samplePaddingValue:(e[21]&14)>>1,sampleIsDifferenceSample:!!(e[21]&1),sampleDegradationPriority:t.getUint16(22)}},trun:qt,"url ":function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4))}},vmhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),graphicsmode:t.getUint16(4),opcolor:new Uint16Array([t.getUint16(6),t.getUint16(8),t.getUint16(10)])}}};Y=function(e){for(var t=0,r=[],n,i,a,u,d,l=new ArrayBuffer(e.length),f=new Uint8Array(l),h=0;h<e.length;++h)f[h]=e[h];for(n=new DataView(l);t<e.byteLength;)i=n.getUint32(t),a=re(e.subarray(t+4,t+8)),u=i>1?t+i:e.byteLength,d=(be[a]||function(g){return{data:g}})(e.subarray(t+8,u)),d.size=i,d.type=a,r.push(d),t=u;return r},nr=function(e,t){var r;return t=t||0,r=new Array(t*2+1).join(" "),e.map(function(n,i){return r+n.type+`
`+Object.keys(n).filter(function(a){return a!=="type"&&a!=="boxes"}).map(function(a){var u=r+"  "+a+": ",d=n[a];if(d instanceof Uint8Array||d instanceof Uint32Array){var l=Array.prototype.slice.call(new Uint8Array(d.buffer,d.byteOffset,d.byteLength)).map(function(f){return" "+("00"+f.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return l?l.length===1?u+"<"+l.join("").slice(1)+">":u+`<
`+l.map(function(f){return r+"  "+f}).join(`
`)+`
`+r+"  >":u+"<>"}return u+JSON.stringify(d,null,2).split(`
`).map(function(f,h){return h===0?f:r+"  "+f}).join(`
`)}).join(`
`)+(n.boxes?`
`+nr(n.boxes,t+1):"")}).join(`
`)};var qa={inspect:Y,textify:nr,parseType:re,findBox:R,parseTraf:be.traf,parseTfdt:be.tfdt,parseHdlr:be.hdlr,parseTfhd:be.tfhd,parseTrun:be.trun,parseSidx:be.sidx},Ha={8:"audio",9:"video",18:"metadata"},$a=function(e){return"0x"+("00"+e.toString(16)).slice(-2).toUpperCase()},ir=function(e){for(var t=[],r;e.byteLength>0;)r=0,t.push($a(e[r++])),e=e.subarray(r);return t.join(" ")},Ya=function(e,t){var r=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"],n=e[1]&parseInt("01111111",2)<<16|e[2]<<8|e[3];return t=t||{},t.avcPacketType=r[e[0]],t.CompositionTime=e[1]&parseInt("10000000",2)?-n:n,e[0]===1?t.nalUnitTypeRaw=ir(e.subarray(4,100)):t.data=ir(e.subarray(4)),t},Xa=function(e,t){var r=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"],n=e[0]&parseInt("00001111",2);return t=t||{},t.frameType=r[(e[0]&parseInt("11110000",2))>>>4],t.codecID=n,n===7?Ya(e.subarray(1),t):t},Qa=function(e,t){var r=["AAC Sequence Header","AAC Raw"];return t=t||{},t.aacPacketType=r[e[0]],t.data=ir(e.subarray(1)),t},Ka=function(e,t){var r=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"],n=["5.5-kHz","11-kHz","22-kHz","44-kHz"],i=(e[0]&parseInt("11110000",2))>>>4;return t=t||{},t.soundFormat=r[i],t.soundRate=n[(e[0]&parseInt("00001100",2))>>>2],t.soundSize=(e[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",t.soundType=e[0]&parseInt("00000001",2)?"Stereo":"Mono",i===10?Qa(e.subarray(1),t):t},Za=function(e){return{tagType:Ha[e[0]],dataSize:e[1]<<16|e[2]<<8|e[3],timestamp:e[7]<<24|e[4]<<16|e[5]<<8|e[6],streamID:e[8]<<16|e[9]<<8|e[10]}},Un=function(e){var t=Za(e);switch(e[0]){case 8:Ka(e.subarray(11),t);break;case 9:Xa(e.subarray(11),t);break}return t},Ja=function(e){var t=9,r,n=[],i;for(t+=4;t<e.byteLength;)r=e[t+1]<<16,r|=e[t+2]<<8,r|=e[t+3],r+=11,i=e.subarray(t,t+r),n.push(Un(i)),t+=r+4;return n},es=function(e){return JSON.stringify(e,null,2)},ts={inspectTag:Un,inspect:Ja,textify:es},Cn=function(e){var t=e[1]&31;return t<<=8,t|=e[2],t},Tt=function(e){return!!(e[1]&64)},wt=function(e){var t=0;return(e[3]&48)>>>4>1&&(t+=e[4]+1),t},rs=function(e,t){var r=Cn(e);return r===0?"pat":r===t?"pmt":t?"pes":null},ns=function(e){var t=Tt(e),r=4+wt(e);return t&&(r+=e[r]+1),(e[r+10]&31)<<8|e[r+11]},is=function(e){var t={},r=Tt(e),n=4+wt(e);if(r&&(n+=e[n]+1),!!(e[n+5]&1)){var i,a,u;i=(e[n+1]&15)<<8|e[n+2],a=3+i-4,u=(e[n+10]&15)<<8|e[n+11];for(var d=12+u;d<a;){var l=n+d;t[(e[l+1]&31)<<8|e[l+2]]=e[l],d+=((e[l+3]&15)<<8|e[l+4])+5}return t}},as=function(e,t){var r=Cn(e),n=t[r];switch(n){case $.H264_STREAM_TYPE:return"video";case $.ADTS_STREAM_TYPE:return"audio";case $.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},ss=function(e){var t=Tt(e);if(!t)return null;var r=4+wt(e);if(r>=e.byteLength)return null;var n=null,i;return i=e[r+7],i&192&&(n={},n.pts=(e[r+9]&14)<<27|(e[r+10]&255)<<20|(e[r+11]&254)<<12|(e[r+12]&255)<<5|(e[r+13]&254)>>>3,n.pts*=4,n.pts+=(e[r+13]&6)>>>1,n.dts=n.pts,i&64&&(n.dts=(e[r+14]&14)<<27|(e[r+15]&255)<<20|(e[r+16]&254)<<12|(e[r+17]&255)<<5|(e[r+18]&254)>>>3,n.dts*=4,n.dts+=(e[r+18]&6)>>>1)),n},ar=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},os=function(e){for(var t=4+wt(e),r=e.subarray(t),n=0,i=0,a=!1,u;i<r.byteLength-3;i++)if(r[i+2]===1){n=i+5;break}for(;n<r.byteLength;)switch(r[n]){case 0:if(r[n-1]!==0){n+=2;break}else if(r[n-2]!==0){n++;break}i+3!==n-2&&(u=ar(r[i+3]&31),u==="slice_layer_without_partitioning_rbsp_idr"&&(a=!0));do n++;while(r[n]!==1&&n<r.length);i=n-2,n+=3;break;case 1:if(r[n-1]!==0||r[n-2]!==0){n+=3;break}u=ar(r[i+3]&31),u==="slice_layer_without_partitioning_rbsp_idr"&&(a=!0),i=n-2,n+=3;break;default:n+=3;break}return r=r.subarray(i),n-=i,i=0,r&&r.byteLength>3&&(u=ar(r[i+3]&31),u==="slice_layer_without_partitioning_rbsp_idr"&&(a=!0)),a},us={parseType:rs,parsePat:ns,parsePmt:is,parsePayloadUnitStartIndicator:Tt,parsePesType:as,parsePesTime:ss,videoPacketContainsKeyFrame:os},je=cn.handleRollover,P={};P.ts=us,P.aac=He;var Fe=H.ONE_SECOND_IN_TS,K=188,fe=71,ds=function(e,t){for(var r=0,n=K,i,a;n<e.byteLength;){if(e[r]===fe&&e[n]===fe){switch(i=e.subarray(r,n),a=P.ts.parseType(i,t.pid),a){case"pat":t.pid=P.ts.parsePat(i);break;case"pmt":var u=P.ts.parsePmt(i);t.table=t.table||{},Object.keys(u).forEach(function(d){t.table[d]=u[d]});break}r+=K,n+=K;continue}r++,n++}},Pn=function(e,t,r){for(var n=0,i=K,a,u,d,l,f,h=!1;i<=e.byteLength;){if(e[n]===fe&&(e[i]===fe||i===e.byteLength)){switch(a=e.subarray(n,i),u=P.ts.parseType(a,t.pid),u){case"pes":d=P.ts.parsePesType(a,t.table),l=P.ts.parsePayloadUnitStartIndicator(a),d==="audio"&&l&&(f=P.ts.parsePesTime(a),f&&(f.type="audio",r.audio.push(f),h=!0));break}if(h)break;n+=K,i+=K;continue}n++,i++}for(i=e.byteLength,n=i-K,h=!1;n>=0;){if(e[n]===fe&&(e[i]===fe||i===e.byteLength)){switch(a=e.subarray(n,i),u=P.ts.parseType(a,t.pid),u){case"pes":d=P.ts.parsePesType(a,t.table),l=P.ts.parsePayloadUnitStartIndicator(a),d==="audio"&&l&&(f=P.ts.parsePesTime(a),f&&(f.type="audio",r.audio.push(f),h=!0));break}if(h)break;n-=K,i-=K;continue}n--,i--}},fs=function(e,t,r){for(var n=0,i=K,a,u,d,l,f,h,g,b,S=!1,v={data:[],size:0};i<e.byteLength;){if(e[n]===fe&&e[i]===fe){switch(a=e.subarray(n,i),u=P.ts.parseType(a,t.pid),u){case"pes":if(d=P.ts.parsePesType(a,t.table),l=P.ts.parsePayloadUnitStartIndicator(a),d==="video"&&(l&&!S&&(f=P.ts.parsePesTime(a),f&&(f.type="video",r.video.push(f),S=!0)),!r.firstKeyFrame)){if(l&&v.size!==0){for(h=new Uint8Array(v.size),g=0;v.data.length;)b=v.data.shift(),h.set(b,g),g+=b.byteLength;if(P.ts.videoPacketContainsKeyFrame(h)){var w=P.ts.parsePesTime(h);w?(r.firstKeyFrame=w,r.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}v.size=0}v.data.push(a),v.size+=a.byteLength}break}if(S&&r.firstKeyFrame)break;n+=K,i+=K;continue}n++,i++}for(i=e.byteLength,n=i-K,S=!1;n>=0;){if(e[n]===fe&&e[i]===fe){switch(a=e.subarray(n,i),u=P.ts.parseType(a,t.pid),u){case"pes":d=P.ts.parsePesType(a,t.table),l=P.ts.parsePayloadUnitStartIndicator(a),d==="video"&&l&&(f=P.ts.parsePesTime(a),f&&(f.type="video",r.video.push(f),S=!0));break}if(S)break;n-=K,i-=K;continue}n--,i--}},cs=function(e,t){if(e.audio&&e.audio.length){var r=t;(typeof r>"u"||isNaN(r))&&(r=e.audio[0].dts),e.audio.forEach(function(a){a.dts=je(a.dts,r),a.pts=je(a.pts,r),a.dtsTime=a.dts/Fe,a.ptsTime=a.pts/Fe})}if(e.video&&e.video.length){var n=t;if((typeof n>"u"||isNaN(n))&&(n=e.video[0].dts),e.video.forEach(function(a){a.dts=je(a.dts,n),a.pts=je(a.pts,n),a.dtsTime=a.dts/Fe,a.ptsTime=a.pts/Fe}),e.firstKeyFrame){var i=e.firstKeyFrame;i.dts=je(i.dts,n),i.pts=je(i.pts,n),i.dtsTime=i.dts/Fe,i.ptsTime=i.pts/Fe}}},ls=function(e){for(var t=!1,r=0,n=null,i=null,a=0,u=0,d;e.length-u>=3;){var l=P.aac.parseType(e,u);switch(l){case"timed-metadata":if(e.length-u<10){t=!0;break}if(a=P.aac.parseId3TagSize(e,u),a>e.length){t=!0;break}i===null&&(d=e.subarray(u,u+a),i=P.aac.parseAacTimestamp(d)),u+=a;break;case"audio":if(e.length-u<7){t=!0;break}if(a=P.aac.parseAdtsSize(e,u),a>e.length){t=!0;break}n===null&&(d=e.subarray(u,u+a),n=P.aac.parseSampleRate(d)),r++,u+=a;break;default:u++;break}if(t)return null}if(n===null||i===null)return null;var f=Fe/n,h={audio:[{type:"audio",dts:i,pts:i},{type:"audio",dts:i+r*1024*f,pts:i+r*1024*f}]};return h},ps=function(e){var t={pid:null,table:null},r={};ds(e,t);for(var n in t.table)if(t.table.hasOwnProperty(n)){var i=t.table[n];switch(i){case $.H264_STREAM_TYPE:r.video=[],fs(e,t,r),r.video.length===0&&delete r.video;break;case $.ADTS_STREAM_TYPE:r.audio=[],Pn(e,t,r),r.audio.length===0&&delete r.audio;break}}return r},hs=function(e,t){var r=P.aac.isLikelyAacData(e),n;return r?n=ls(e):n=ps(e),!n||!n.audio&&!n.video?null:(cs(n,t),n)},ms={inspect:hs,parseAudioPes_:Pn},It={codecs:Nt,mp4:Aa,flv:Pa,mp2t:Oa,partial:Wa};It.mp4.tools=qa,It.flv.tools=ts,It.mp2t.tools=ms;var gs=It;return gs})});var Ye=class{constructor(){this._listeners={}}addEventListener(o,p){let x=this._listeners[o];Array.isArray(x)?x.push(p):this._listeners[o]=[p]}removeEventListener(o,p){if(o===void 0){this._listeners={};return}let x=this._listeners[o];if(!Array.isArray(x))return;if(p===void 0){delete this._listeners[o];return}let m=x.indexOf(p);m!==-1&&x.splice(m,1),x.length===0&&delete this._listeners[o]}trigger(o,p){let x=this._listeners[o];!Array.isArray(x)||x.slice().forEach(m=>{try{m(p)}catch(y){D.error("EventEmitter: listener error",y instanceof Error?y:null)}})}};function ce(){}var ws=0,ur=class extends Ye{constructor(){super();this.error=ce,this.warn=ce,this.info=ce,this.debug=ce,this._currentLevel=ws}setLevel(p){let x=p<0||p>4?0:p;this._currentLevel=x,this.error=x>=1?console.error.bind(console):ce,this.warn=x>=2?console.warn.bind(console):ce,this.info=x>=3?console.info.bind(console):ce,this.debug=x>=4?console.debug.bind(console):ce,this.trigger("onLogLevelChange",x)}getLevel(){return this._currentLevel}hasLevel(p){return p>=this._currentLevel}},Is=new ur,D=Is;var Ps={},T,Wn=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Wn.decode();var Ft=new Uint8Array;function Xe(){return Ft.byteLength===0&&(Ft=new Uint8Array(T.memory.buffer)),Ft}function At(c,o){return Wn.decode(Xe().subarray(c,c+o))}var X=0;function As(c,o){let p=o(c.length*1);return Xe().set(c,p/1),X=c.length,p}function ie(c){return c==null}var Et=new Int32Array;function Ut(){return Et.byteLength===0&&(Et=new Int32Array(T.memory.buffer)),Et}function Me(c){return()=>{throw new Error(`${c} is not defined`)}}function Ue(c,o){if(!(c instanceof o))throw new Error(`expected instance of ${o.name}`);return c.ptr}var Dt=new TextEncoder("utf-8"),Fs=typeof Dt.encodeInto=="function"?function(c,o){return Dt.encodeInto(c,o)}:function(c,o){let p=Dt.encode(c);return o.set(p),{read:c.length,written:p.length}};function le(c,o,p){if(p===void 0){let I=Dt.encode(c),M=o(I.length);return Xe().subarray(M,M+I.length).set(I),X=I.length,M}let x=c.length,m=o(x),y=Xe(),_=0;for(;_<x;_++){let I=c.charCodeAt(_);if(I>127)break;y[m+_]=I}if(_!==x){_!==0&&(c=c.slice(_)),m=p(m,x,x=_+c.length*3);let I=Xe().subarray(m+_,m+x);_+=Fs(c,I).written}return X=_,m}var Mt=new Float64Array;function dr(){return Mt.byteLength===0&&(Mt=new Float64Array(T.memory.buffer)),Mt}function Es(c,o){let p=o(c.length*8);return dr().set(c,p/8),X=c.length,p}var Ct=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",UnknownError:1,1:"UnknownError"}),Pt=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",UnknownError:1,1:"UnknownError"}),fr=Object.freeze({UnknownError:0,0:"UnknownError",NoContentLoaded:1,1:"NoContentLoaded"}),Ot=Object.freeze({SourceBufferNotFound:0,0:"SourceBufferNotFound",UnknownError:1,1:"UnknownError"}),cr=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",UnknownError:1,1:"UnknownError"}),he=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",MediaSourceIsClosed:1,1:"MediaSourceIsClosed",QuotaExceededError:2,2:"QuotaExceededError",TypeNotSupportedError:3,3:"TypeNotSupportedError",EmptyMimeType:4,4:"EmptyMimeType",UnknownError:5,5:"UnknownError"}),Ce=Object.freeze({NoResource:0,0:"NoResource",NoSourceBuffer:1,1:"NoSourceBuffer",TransmuxerError:2,2:"TransmuxerError",UnknownError:3,3:"UnknownError"}),yo=Object.freeze({Init:0,0:"Init",Seeked:1,1:"Seeked",Seeking:2,2:"Seeking",Ended:3,3:"Ended",ReadyStateChanged:4,4:"ReadyStateChanged",RegularInterval:5,5:"RegularInterval",Error:6,6:"Error"}),vo=Object.freeze({MediaPlaylistRefresh:0,0:"MediaPlaylistRefresh"}),Pe=Object.freeze({Error:0,0:"Error",Warn:1,1:"Warn",Info:2,2:"Info",Debug:3,3:"Debug"}),zn=Object.freeze({Audio:0,0:"Audio",Video:1,1:"Video"}),Qe=Object.freeze({Closed:0,0:"Closed",Ended:1,1:"Ended",Open:2,2:"Open"}),Ds=Object.freeze({Init:0,0:"Init",Seeking:1,1:"Seeking",Seeked:2,2:"Seeked",RegularInterval:3,3:"RegularInterval",LoadedData:4,4:"LoadedData",LoadedMetadata:5,5:"LoadedMetadata",CanPlay:6,6:"CanPlay",CanPlayThrough:7,7:"CanPlayThrough",Ended:8,8:"Ended",Pause:9,9:"Pause",Play:10,10:"Play",RateChange:11,11:"RateChange",Stalled:12,12:"Stalled"}),q=class{static __wrap(o){let p=Object.create(q.prototype);return p.ptr=o,p}__destroy_into_raw(){let o=this.ptr;return this.ptr=0,o}free(){let o=this.__destroy_into_raw();T.__wbg_addsourcebufferresult_free(o)}static success(o){let p=T.addsourcebufferresult_success(o);return q.__wrap(p)}static error(o,p){var x=ie(p)?0:le(p,T.__wbindgen_malloc,T.__wbindgen_realloc),m=X;let y=T.addsourcebufferresult_error(o,x,m);return q.__wrap(y)}},Z=class{static __wrap(o){let p=Object.create(Z.prototype);return p.ptr=o,p}__destroy_into_raw(){let o=this.ptr;return this.ptr=0,o}free(){let o=this.__destroy_into_raw();T.__wbg_appendbufferresult_free(o)}static success(o,p){let x=T.appendbufferresult_success(!ie(o),ie(o)?0:o,!ie(p),ie(p)?0:p);return Z.__wrap(x)}static error(o,p){var x=ie(p)?0:le(p,T.__wbindgen_malloc,T.__wbindgen_realloc),m=X;let y=T.appendbufferresult_error(o,x,m);return Z.__wrap(y)}},se=class{static __wrap(o){let p=Object.create(se.prototype);return p.ptr=o,p}__destroy_into_raw(){let o=this.ptr;return this.ptr=0,o}free(){let o=this.__destroy_into_raw();T.__wbg_attachmediasourceresult_free(o)}static success(){let o=T.attachmediasourceresult_success();return se.__wrap(o)}static error(o,p){var x=ie(p)?0:le(p,T.__wbindgen_malloc,T.__wbindgen_realloc),m=X;let y=T.attachmediasourceresult_error(o,x,m);return se.__wrap(y)}},pe=class{static __wrap(o){let p=Object.create(pe.prototype);return p.ptr=o,p}__destroy_into_raw(){let o=this.ptr;return this.ptr=0,o}free(){let o=this.__destroy_into_raw();T.__wbg_dispatcher_free(o)}constructor(){let o=T.dispatcher_new();return pe.__wrap(o)}load_content(o){let p=le(o,T.__wbindgen_malloc,T.__wbindgen_realloc),x=X;T.dispatcher_load_content(this.ptr,p,x)}minimum_position(){try{let x=T.__wbindgen_add_to_stack_pointer(-16);T.dispatcher_minimum_position(x,this.ptr);var o=Ut()[x/4+0],p=dr()[x/8+1];return o===0?void 0:p}finally{T.__wbindgen_add_to_stack_pointer(16)}}maximum_position(){try{let x=T.__wbindgen_add_to_stack_pointer(-16);T.dispatcher_maximum_position(x,this.ptr);var o=Ut()[x/4+0],p=dr()[x/8+1];return o===0?void 0:p}finally{T.__wbindgen_add_to_stack_pointer(16)}}set_wanted_speed(o){T.dispatcher_set_wanted_speed(this.ptr,o)}stop(){T.dispatcher_stop(this.ptr)}static log(o,p){let x=le(p,T.__wbindgen_malloc,T.__wbindgen_realloc),m=X;T.dispatcher_log(o,x,m)}on_request_finished(o,p,x,m,y){let _=le(m,T.__wbindgen_malloc,T.__wbindgen_realloc),I=X;T.dispatcher_on_request_finished(this.ptr,o,p,x,_,I,y)}on_request_failed(o){T.dispatcher_on_request_failed(this.ptr,o)}on_media_source_state_change(o){T.dispatcher_on_media_source_state_change(this.ptr,o)}on_source_buffer_update(o){T.dispatcher_on_source_buffer_update(this.ptr,o)}on_source_buffer_error(o){T.dispatcher_on_source_buffer_error(this.ptr,o)}on_playback_tick(o){Ue(o,Se);var p=o.ptr;o.ptr=0,T.dispatcher_on_playback_tick(this.ptr,p)}on_timer_ended(o,p){T.dispatcher_on_timer_ended(this.ptr,o,p)}},oe=class{static __wrap(o){let p=Object.create(oe.prototype);return p.ptr=o,p}__destroy_into_raw(){let o=this.ptr;return this.ptr=0,o}free(){let o=this.__destroy_into_raw();T.__wbg_endofstreamresult_free(o)}static success(){let o=T.attachmediasourceresult_success();return oe.__wrap(o)}static error(o,p){var x=ie(p)?0:le(p,T.__wbindgen_malloc,T.__wbindgen_realloc),m=X;let y=T.attachmediasourceresult_error(o,x,m);return oe.__wrap(y)}},Se=class{static __wrap(o){let p=Object.create(Se.prototype);return p.ptr=o,p}__destroy_into_raw(){let o=this.ptr;return this.ptr=0,o}free(){let o=this.__destroy_into_raw();T.__wbg_mediaobservation_free(o)}constructor(o,p,x,m,y,_){let I=Es(m,T.__wbindgen_malloc),M=X,O=T.mediaobservation_new(o,p,x,I,M,y,_);return Se.__wrap(O)}},ee=class{static __wrap(o){let p=Object.create(ee.prototype);return p.ptr=o,p}__destroy_into_raw(){let o=this.ptr;return this.ptr=0,o}free(){let o=this.__destroy_into_raw();T.__wbg_mediasourcedurationupdateresult_free(o)}static success(){let o=T.attachmediasourceresult_success();return ee.__wrap(o)}static error(o,p){var x=ie(p)?0:le(p,T.__wbindgen_malloc,T.__wbindgen_realloc),m=X;let y=T.attachmediasourceresult_error(o,x,m);return ee.__wrap(y)}};var ue=class{static __wrap(o){let p=Object.create(ue.prototype);return p.ptr=o,p}__destroy_into_raw(){let o=this.ptr;return this.ptr=0,o}free(){let o=this.__destroy_into_raw();T.__wbg_removebufferresult_free(o)}static success(){let o=T.attachmediasourceresult_success();return ue.__wrap(o)}static error(o,p){var x=ie(p)?0:le(p,T.__wbindgen_malloc,T.__wbindgen_realloc),m=X;let y=T.attachmediasourceresult_error(o,x,m);return ue.__wrap(y)}},ae=class{static __wrap(o){let p=Object.create(ae.prototype);return p.ptr=o,p}__destroy_into_raw(){let o=this.ptr;return this.ptr=0,o}free(){let o=this.__destroy_into_raw();T.__wbg_removemediasourceresult_free(o)}static success(){let o=T.attachmediasourceresult_success();return ae.__wrap(o)}static error(o,p){var x=ie(p)?0:le(p,T.__wbindgen_malloc,T.__wbindgen_realloc),m=X;let y=T.attachmediasourceresult_error(o,x,m);return ae.__wrap(y)}};async function Ms(c,o){if(typeof Response=="function"&&c instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(c,o)}catch(x){if(c.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",x);else throw x}let p=await c.arrayBuffer();return await WebAssembly.instantiate(p,o)}else{let p=await WebAssembly.instantiate(c,o);return p instanceof WebAssembly.Instance?{instance:p,module:c}:p}}function Us(){let c={};return c.wbg={},c.wbg.__wbg_jsLog_da12411f674ee50f=function(o,p,x){jsLog(o>>>0,At(p,x))},c.wbg.__wbg_jsTimer_13ace9ec5780a1dd=function(o,p){return jsTimer(o,p>>>0)},c.wbg.__wbg_jsGetResourceData_1a5580de201a7896=function(o,p){let x=jsGetResourceData(p);var m=ie(x)?0:As(x,T.__wbindgen_malloc),y=X;Ut()[o/4+1]=y,Ut()[o/4+0]=m},c.wbg.__wbg_jsFetch_1c0faf7eaeeec79c=function(o,p){return jsFetch(At(o,p))},c.wbg.__wbg_jsAbortRequest_3ad497cfce2a4eb6=typeof jsAbortRequest=="function"?jsAbortRequest:Me("jsAbortRequest"),c.wbg.__wbg_jsAttachMediaSource_69fcab1c5cd6f603=function(){let o=jsAttachMediaSource();Ue(o,se);var p=o.ptr;return o.ptr=0,p},c.wbg.__wbg_jsRemoveMediaSource_bfd555f14dbd804d=function(){let o=jsRemoveMediaSource();Ue(o,ae);var p=o.ptr;return o.ptr=0,p},c.wbg.__wbg_jsSetMediaSourceDuration_4c22750bc2e2b8b6=function(o){let p=jsSetMediaSourceDuration(o);Ue(p,ee);var x=p.ptr;return p.ptr=0,x},c.wbg.__wbg_jsAddSourceBuffer_f769ac5dd28e087f=function(o,p,x){let m=jsAddSourceBuffer(o>>>0,At(p,x));Ue(m,q);var y=m.ptr;return m.ptr=0,y},c.wbg.__wbg_jsAppendBuffer_1c43e16b9b4bc73f=function(o,p,x){let m=jsAppendBuffer(o,p,x!==0);Ue(m,Z);var y=m.ptr;return m.ptr=0,y},c.wbg.__wbg_jsEndOfStream_d21dc02fa7e95e93=function(){let o=jsEndOfStream();Ue(o,oe);var p=o.ptr;return o.ptr=0,p},c.wbg.__wbg_jsStartObservingPlayback_39e965722ac389f3=typeof jsStartObservingPlayback=="function"?jsStartObservingPlayback:Me("jsStartObservingPlayback"),c.wbg.__wbg_jsStopObservingPlayback_6ba8aea701a8a72e=typeof jsStopObservingPlayback=="function"?jsStopObservingPlayback:Me("jsStopObservingPlayback"),c.wbg.__wbg_jsFreeResource_efd8cc10a164752b=typeof jsFreeResource=="function"?jsFreeResource:Me("jsFreeResource"),c.wbg.__wbg_jsSetPlaybackRate_de156f1496b14d47=typeof jsSetPlaybackRate=="function"?jsSetPlaybackRate:Me("jsSetPlaybackRate"),c.wbg.__wbg_jsSeek_264e96c2a274615f=typeof jsSeek=="function"?jsSeek:Me("jsSeek"),c.wbg.__wbg_jsSetMediaOffset_b84e1bab99ac5cad=typeof jsSetMediaOffset=="function"?jsSetMediaOffset:Me("jsSetMediaOffset"),c.wbg.__wbg_jsUpdateContentInfo_e4cbd198194c3a1a=function(o,p,x,m){jsUpdateContentInfo(o===0?void 0:p,x===0?void 0:m)},c.wbg.__wbindgen_throw=function(o,p){throw new Error(At(o,p))},c}function Cs(c,o){return T=c.exports,Vn.__wbindgen_wasm_module=o,Mt=new Float64Array,Et=new Int32Array,Ft=new Uint8Array,T}async function Vn(c){typeof c>"u"&&(c=new URL("wasp_hls_bg.wasm",Ps.url));let o=Us();(typeof c=="string"||typeof Request=="function"&&c instanceof Request||typeof URL=="function"&&c instanceof URL)&&(c=fetch(c));let{instance:p,module:x}=await Ms(await c,o);return Cs(p,x)}var Gn=Vn;function lr(){let c="",o=-1;return function(){return o++,o>=Number.MAX_SAFE_INTEGER&&(c+="0",o=0),c+String(o)}}function qn(){let c=-1;return function(){return c++,c>=Number.MAX_SAFE_INTEGER&&(D.warn("Exceeding `numberIdGenerator` limit. Collisions may occur"),c=0),c}}var Ke=class{constructor(o){this._sourceBuffer=o,this._queue=[],this._pendingTask=null;let p=setInterval(()=>{this._flush()},2e3),x=this._onPendingTaskError.bind(this),m=()=>{this._flush()};o.addEventListener("error",x),o.addEventListener("updateend",m),this._dispose=[()=>{clearInterval(p),o.removeEventListener("error",x),o.removeEventListener("updateend",m)}]}push(o){return D.debug("QSB: receiving order to push data to the SourceBuffer"),this._addToQueue({type:0,value:o})}removeBuffer(o,p){return D.debug("QSB: receiving order to remove data from the SourceBuffer",o,p),this._addToQueue({type:1,value:{start:o,end:p}})}getBufferedRanges(){return this._sourceBuffer.buffered}dispose(){for(this._dispose.forEach(o=>o()),this._pendingTask!==null&&(this._pendingTask.reject(new Error("QueuedSourceBuffer Cancelled")),this._pendingTask=null);this._queue.length>0;){let o=this._queue.shift();o!==void 0&&o.reject(new Error("QueuedSourceBuffer Cancelled"))}}_onPendingTaskError(o){let p=o instanceof Error?o:new Error("An unknown error occured when doing operations on the SourceBuffer");this._pendingTask!=null&&this._pendingTask.reject(p)}_addToQueue(o){return new Promise((p,x)=>{let m=this._queue.length===0&&this._pendingTask===null,y={resolve:p,reject:x,...o};this._queue.push(y),m&&this._flush()})}_flush(){if(!this._sourceBuffer.updating){if(this._pendingTask!==null){let o=this._pendingTask,{resolve:p}=o;return this._pendingTask=null,p(),this._flush()}else{let o=this._queue.shift();if(o===void 0)return;this._pendingTask=o}try{switch(this._pendingTask.type){case 0:let o=this._pendingTask.value;if(o===void 0){this._flush();return}D.debug("QSB: pushing data"),this._sourceBuffer.appendBuffer(o);break;case 1:let{start:p,end:x}=this._pendingTask.value;D.debug("QSB: removing data from SourceBuffer",p,x),this._sourceBuffer.remove(p,x);break;default:Os(this._pendingTask)}}catch(o){this._onPendingTaskError(o)}}}};function Os(c){throw new Error("Unreachable path taken")}var pr=class{constructor(){this._instanceInfo=null,this.hasWorkerMse=void 0}start(o){this.hasWorkerMse=o,this._instanceInfo={dispatcher:new pe,content:null}}dispose(){this._instanceInfo?.dispatcher.free(),_e.freeEverything(),Te.freeEverything()}changeContent(o){if(this._instanceInfo===null){D.error();return}_e.freeEverything(),Te.freeEverything(),this._instanceInfo.content=o}getDispatcher(){return this._instanceInfo===null?null:this._instanceInfo.dispatcher}getContentInfo(){return this._instanceInfo===null?null:this._instanceInfo.content}},kt=class{constructor(){this._generateId=qn(),this._store={}}create(o){let p=this._generateId();return this._store[p]=o,p}delete(o){delete this._store[o]}get(o){return this._store[o]}freeEverything(){this._store={}}},A=new pr,_e=new kt,Te=new kt;function Lt(){let c=A.getContentInfo();if(c===null)return;let{mediaSourceObj:o}=c;if(o!==null)return o}function Hn(c){let o=Ls(c);if(o===null)return;let p=me(o,1952867444);if(p===null)return;let x=p[0];return x===1?Kn(p,4):x===0?we(p,4):void 0}function $n(c){let o=Rs(c);if(o.length===0)return;let p=0;for(let x of o){let m=me(x,1953658222);if(m===null)return;let y=0,_=m[y];if(y+=1,_>1)return;let I=Qn(m,y);y+=3;let M=(I&256)>0,O=0;if(!M&&(O=ks(x),O===void 0))return;let Le=(I&1)>0,Je=(I&4)>0,et=(I&512)>0,H=(I&1024)>0,Rt=(I&2048)>0,Re=we(m,y);y+=4,Le&&(y+=4),Je&&(y+=4);let tt=Re,ge=0;for(;tt-- >0;)M?(ge+=we(m,y),y+=4):ge+=O,et&&(y+=4),H&&(y+=4),Rt&&(y+=4);p+=ge}return p}function Yn(c){let o=Bs(c);if(o===null)return;let p=me(o,1835296868);if(p===null)return;let x=0,m=p[x];return x+=4,m===1?we(p,x+16):m===0?we(p,x+8):void 0}function ks(c){let o=me(c,1952868452);if(o===null)return;let p=1,x=Qn(o,p);p+=3;let m=(x&1)>0,y=(x&2)>0;return(x&8)>0?(p+=4,m&&(p+=8),y&&(p+=4),we(o,p)):void 0}function Ls(c){let o=me(c,1836019558);return o===null?null:me(o,1953653094)}function Rs(c){return Ns(c,1836019558).reduce((p,x)=>{let m=me(x,1953653094);return m!==null&&p.push(m),p},[])}function Bs(c){let o=me(c,1836019574);if(o===null)return null;let p=me(o,1953653099);return p===null?null:me(p,1835297121)}function me(c,o){let p=Xn(c,o);return p!==null?c.subarray(p[1],p[2]):null}function Ns(c,o){let p=[],x=c;for(;;){let m=Xn(x,o);if(m===null)return p;if(m[2]===0||x.length===0)throw new Error("Error while parsing ISOBMFF box");p.push(x.subarray(m[1],m[2])),x=x.subarray(m[2])}}function Xn(c,o){let p=c.length,x=0,m,y=0,_;for(;x+8<=p;){if(_=x,y=we(c,_),_+=4,m=we(c,_),_+=4,y===0)y=p-x;else if(y===1){if(_+8>p)return null;y=Kn(c,_),_+=8}if(y<0)throw new Error("ISOBMFF: Size out of range");if(m===o)return o===1970628964&&(_+=16),[x,_,x+y];x+=y}return null}function Qn(c,o){return c[o+0]*65536+c[o+1]*256+c[o+2]}function we(c,o){return c[o+0]*16777216+c[o+1]*65536+c[o+2]*256+c[o+3]}function Kn(c,o){return(c[o+0]*16777216+c[o+1]*65536+c[o+2]*256+c[o+3])*4294967296+c[o+4]*16777216+c[o+5]*65536+c[o+6]*256+c[o+7]}function V(c,o){D.debug("<-- sending to main:",c.type),o===void 0?postMessage(c):postMessage(c,o)}var ti=Ts(ei());var Oe,js=/^[a-z]+\/mp2t;/i;function Ws(c){return js.test(c)}function gr(c){return ri(c)?typeof MediaSource>"u"?!0:!MediaSource.isTypeSupported(c):!1}function ri(c){return Ws(c)}function xr(c,o){if(!ri(c))return c;let p=c.replace(/mp2t/i,"mp4");o===zn.Audio&&(p=c.replace(/video/i,"audio"));let x=/avc1\.(66|77|100)\.(\d+)/.exec(p);if(x){let m=x[1],y;m==="66"?y="4200":m==="77"?y="4d00":(m!=="100"&&D.error("Impossible regex catch"),y="6400");let _=Number(x[2]);_>=256&&D.error("Invalid legacy avc1 level number.");let I=(_>>4).toString(16)+(_&15).toString(16);p=`avc1.${y}${I}`}return p}function ni(){Oe=void 0}function yr(c){Oe===void 0&&(Oe=new ti.default.mp4.Transmuxer);let o=[];if(Oe.on("data",p),Oe.push(c),Oe.flush(),Oe.off("data",p),o.length===0)return null;if(o.length===1)return o[0];{let x=o.reduce((_,I)=>_+I.byteLength,0),m=new Uint8Array(x),y=0;for(let _ of o)m.set(_,y),y+=_.byteLength;return m}function p(x){let m=new Uint8Array(x.initSegment.byteLength+x.data.byteLength);m.set(x.initSegment,0),m.set(x.data,x.initSegment.byteLength),o.push(m)}}function ke(c,o){return c instanceof Error?c.name+": "+c.message:o}var ii=lr();function zs(c){return _e.get(c)}function Vs(c,o){let p=performance.now().toFixed(2);switch(c){case Pe.Error:D.error(p,o);break;case Pe.Warn:D.warn(p,o);break;case Pe.Info:D.info(p,o);break;case Pe.Debug:D.debug(p,o);break}}function Gs(c,o){let p=self.setTimeout(()=>{let x=A.getDispatcher();x!==null&&x.on_timer_ended(p,o)},c);return p}function qs(c){clearTimeout(c)}function Hs(c){let o=new AbortController,p=Te.create({abortController:o}),x=performance.now();return fetch(c,{signal:o.signal}).then(async m=>{let y=await m.arrayBuffer(),_=performance.now()-x;Te.delete(p);let I=A.getDispatcher();if(I!==null){let M=new Uint8Array(y),O=_e.create(M);I.on_request_finished(p,O,M.byteLength,m.url,_)}}).catch(m=>{Te.delete(p),m instanceof Error&&m.name}),p}function $s(c){let o=Te.get(c);return o!==void 0?(o.abortController.abort(),Promise.resolve().then(()=>{Te.delete(c)}),!0):!1}function Ys(c){let o=A.getContentInfo();if(o===null||o.mediaSourceObj===null){D.error("Attempting to seek when no MediaSource is created");return}V({type:"seek",value:{mediaSourceId:o.mediaSourceObj.mediaSourceId,position:c}})}function Xs(c){let o=A.getContentInfo();if(o===null||o.mediaSourceObj===null){D.error("Attempting to set playback rate when no MediaSource is created");return}V({type:"update-playback-rate",value:{mediaSourceId:o.mediaSourceObj.mediaSourceId,playbackRate:c}})}function Qs(){let c=A.getContentInfo();if(c===null)return se.error(fr.NoContentLoaded);try{let o=function(){A.getDispatcher()?.on_media_source_state_change(Qe.Ended)},p=function(){A.getDispatcher()?.on_media_source_state_change(Qe.Open)},x=function(){A.getDispatcher()?.on_media_source_state_change(Qe.Closed)};if(A.hasWorkerMse!==!0){let m=ii();c.mediaSourceObj={nextSourceBufferId:0,sourceBuffers:[],type:"main",mediaSourceId:m},V({type:"create-media-source",value:{contentId:c.contentId,mediaSourceId:m}})}else{let m=new MediaSource;m.addEventListener("sourceclose",x),m.addEventListener("sourceended",o),m.addEventListener("sourceopen",p);let y=()=>{m.removeEventListener("sourceclose",x),m.removeEventListener("sourceended",o),m.removeEventListener("sourceopen",p)},_=m.handle,I;_==null&&(I=URL.createObjectURL(m));let M=ii();c.mediaSourceObj={type:"worker",mediaSourceId:M,mediaSource:m,removeEventListeners:y,sourceBuffers:[],nextSourceBufferId:0},V({type:"attach-media-source",value:{contentId:c.contentId,handle:_,src:I,mediaSourceId:M}},_!==void 0?[_]:[])}}catch{return se.error(fr.UnknownError)}return se.success()}function Ks(){let c=A.getContentInfo();if(c===null)return ae.error(Ct.NoMediaSourceAttached);if(c.mediaSourceObj===null)return ae.error(Ct.NoMediaSourceAttached);if(c.mediaSourceObj.type==="worker"){let{mediaSource:o,removeEventListeners:p}=c.mediaSourceObj;if(p(),o!==null&&o.readyState!=="closed"){let{readyState:x,sourceBuffers:m}=o;for(let y=m.length-1;y>=0;y--){let _=m[y];if(!_.updating)try{x==="open"&&_.abort(),o.removeSourceBuffer(_)}catch(I){let M=ke(I,"Unknown error while removing SourceBuffer");return pe.log(Pe.Error,"Could not remove SourceBuffer: "+M),ae.error(Ct.UnknownError,M)}}}}return V({type:"clear-media-source",value:{mediaSourceId:c.mediaSourceObj.mediaSourceId}}),ae.success()}function Zs(c){let o=A.getContentInfo();if(o===null)return ee.error(Pt.NoMediaSourceAttached);if(o.mediaSourceObj===null)return ee.error(Pt.NoMediaSourceAttached);if(o.mediaSourceObj.type==="worker")try{return o.mediaSourceObj.mediaSource.duration=c,ee.success()}catch{return ee.error(Pt.UnknownError)}else return V({type:"update-media-source-duration",value:{mediaSourceId:o.mediaSourceObj.mediaSourceId,duration:c}}),ee.success()}function Js(c,o){let p=A.getContentInfo();if(p===null)return q.error(he.NoMediaSourceAttached);if(p.mediaSourceObj===null)return q.error(he.NoMediaSourceAttached);if(p.mediaSourceObj.type==="main"){let{sourceBuffers:x,nextSourceBufferId:m}=p.mediaSourceObj;try{let y=o;gr(o)&&(y=xr(o,c));let _=m;return x.push({lastInitTimescale:void 0,id:_,transmuxer:y===o?null:yr,sourceBuffer:null}),p.mediaSourceObj.nextSourceBufferId++,V({type:"create-source-buffer",value:{mediaSourceId:p.mediaSourceObj.mediaSourceId,sourceBufferId:_,contentType:y}}),q.success(_)}catch(y){let _=ke(y,"Unknown error while creating Sourcebuffer");return q.error(he.UnknownError,_)}}else{let{mediaSource:x,sourceBuffers:m,nextSourceBufferId:y}=p.mediaSourceObj;if(x.readyState==="closed")return q.error(he.MediaSourceIsClosed);if(o==="")return q.error(he.EmptyMimeType);try{let _=o;gr(o)&&(_=xr(o,c));let I=x.addSourceBuffer(_),M=y,O=new Ke(I);return m.push({lastInitTimescale:void 0,id:M,sourceBuffer:O,transmuxer:_===o?null:yr}),p.mediaSourceObj.nextSourceBufferId++,q.success(M)}catch(_){let I=ke(_,"Unknown error while creating Sourcebuffer");return _ instanceof Error?_.name==="QuotaExceededError"?q.error(he.QuotaExceededError,I):_.name==="NotSupportedError"?q.error(he.TypeNotSupportedError,I):q.error(he.UnknownError,I):q.error(he.UnknownError,I)}}}function eo(c,o,p){let x=_e.get(o),m=Lt();if(x===void 0)return Z.error(Ce.NoResource,"Segment preparation error: No resource with the given `resourceId`");if(m===void 0)return Z.error(Ce.NoSourceBuffer,"Segment preparation error: No MediaSource attached");let y=m.sourceBuffers.findIndex(({id:O})=>O===c);if(y<-1)return Z.error(Ce.NoSourceBuffer,"Segment preparation error: No SourceBuffer with the given `SourceBufferId`");let _=m.sourceBuffers[y];if(_.transmuxer!==null)try{let O=_.transmuxer(x);if(O!==null)x=O;else return Z.error(Ce.TransmuxerError,"Segment preparation error: the transmuxer couldn't process the segment")}catch(O){let Le=ke(O,"Unknown error while transmuxing segment");return Z.error(Ce.TransmuxerError,Le)}let I=Yn(x);I!==void 0?_.lastInitTimescale=I:I=_.lastInitTimescale;let M;p===!0&&I!==void 0&&(M=so(x,I));try{if(_.sourceBuffer!==null)_.sourceBuffer.push(x).then(()=>{try{A.getDispatcher()?.on_source_buffer_update(c)}catch(O){D.error("Error when calling `on_source_buffer_update`",O)}}).catch(()=>{try{A.getDispatcher()?.on_source_buffer_error(c)}catch(O){D.error("Error when calling `on_source_buffer_error`",O)}});else{let O=x.buffer;V({type:"append-buffer",value:{mediaSourceId:m.mediaSourceId,sourceBufferId:c,data:O}},[O])}}catch{return Z.error(Ce.UnknownError)}return Z.success(M?.time,M?.duration)}function to(c,o,p){try{let x=Lt();if(x===void 0)return ue.error(Ot.SourceBufferNotFound,"No MediaSource created.");if(x.type==="worker"){let m=x.sourceBuffers.find(({id:y})=>y===c);if(m===void 0)return ue.error(Ot.SourceBufferNotFound,"SourceBuffer linked to the given id not found.");m.sourceBuffer.removeBuffer(o,p).then(()=>{try{A.getDispatcher()?.on_source_buffer_update(c)}catch(y){D.error("Error when calling `on_source_buffer_update`",y)}}).catch(()=>{try{A.getDispatcher()?.on_source_buffer_error(c)}catch(y){D.error("Error when calling `on_source_buffer_error`",y)}})}else V({type:"remove-buffer",value:{mediaSourceId:x.mediaSourceId,sourceBufferId:c,start:o,end:p}})}catch(x){let m=ke(x,"Unknown error while removing buffer");return ue.error(Ot.UnknownError,m)}return ue.success()}function ro(){try{let c=Lt();if(c===void 0)return oe.error(cr.NoMediaSourceAttached,"There's no MediaSource attached currently.");c.type==="worker"?c.mediaSource.endOfStream():V({type:"end-of-stream",value:{mediaSourceId:c.mediaSourceId}})}catch(c){let o=ke(c,"Unknown error while calling endOfStream");return oe.error(cr.UnknownError,o)}return oe.success()}function no(){let c=A.getContentInfo();if(c!==null){if(c.mediaSourceObj===null){pe.log(Pe.Error,"Cannot start observing playback: No MediaSource Attached");return}V({type:"start-playback-observation",value:{mediaSourceId:c.mediaSourceObj.mediaSourceId}})}}function vr(){let c=A.getContentInfo();c!==null&&c.mediaSourceObj!==null&&V({type:"stop-playback-observation",value:{mediaSourceId:c.mediaSourceObj.mediaSourceId}})}function io(c){let o=A.getContentInfo();o!==null&&V({type:"media-offset-update",value:{contentId:o.contentId,offset:c}})}function ao(c){return _e.get(c)===void 0?!1:(_e.delete(c),!0)}function so(c,o){let p=Hn(c);if(p===void 0)return null;let x=$n(c);return{time:p/o,duration:x===void 0?void 0:x/o}}function oo(c,o){let p=A.getContentInfo();p!==null&&V({type:"content-info-update",value:{contentId:p.contentId,minimumPosition:c,maximumPosition:o}})}var G=self;G.jsAbortRequest=$s;G.jsAddSourceBuffer=Js;G.jsAppendBuffer=eo;G.jsAttachMediaSource=Qs;G.jsClearTimer=qs;G.jsEndOfStream=ro;G.jsFetch=Hs;G.jsFreeResource=ao;G.jsGetResourceData=zs;G.jsLog=Vs;G.jsRemoveBuffer=to;G.jsRemoveMediaSource=Ks;G.jsSeek=Ys;G.jsSetMediaOffset=io;G.jsSetMediaSourceDuration=Zs;G.jsStartObservingPlayback=no;G.jsStopObservingPlayback=vr;G.jsTimer=Gs;G.jsUpdateContentInfo=oo;G.jsSetPlaybackRate=Xs;var ai=!1;function br(){onmessage=function(c){if(c.origin!==""){D.error("Unexpected trans-origin message");return}let{data:o}=c;if(typeof o!="object"||o===null||typeof o.type!="string"){D.error("unexpected main message");return}switch(o.type){case"init":if(ai)return oi("Worker initialization already done",0);D.setLevel(o.value.logLevel),ai=!0;let{wasmUrl:p,hasWorkerMse:x}=o.value;uo(p,x);break;case"dispose":fo();break;case"load":{let m=A.getDispatcher();if(m===null)return si(o.value.contentId);let y={contentId:o.value.contentId,mediaSourceObj:null,observationsObj:null};A.changeContent(y),ni(),m.load_content(o.value.url);break}case"stop":{let m=A.getDispatcher();if(m===null)return si(o.value.contentId);let y=A.getContentInfo();if(y===null||y.contentId!==o.value.contentId)return;try{m.stop()}catch(_){D.error("Error: when stopping the content:",_)}V({type:"content-stopped",value:{contentId:o.value.contentId}});break}case"media-source-state-changed":{let m=A.getDispatcher(),y=A.getContentInfo();if(m===null||y===null||y.mediaSourceObj?.mediaSourceId!==o.value.mediaSourceId)return;m.on_media_source_state_change(o.value.state);break}case"source-buffer-updated":{let m=A.getDispatcher(),y=A.getContentInfo();if(m===null||y===null||y.mediaSourceObj?.mediaSourceId!==o.value.mediaSourceId)return;m.on_source_buffer_update(o.value.sourceBufferId);break}case"observation":{let m=A.getDispatcher(),y=A.getContentInfo();if(m===null||y===null||y.mediaSourceObj?.mediaSourceId!==o.value.mediaSourceId)return;let _=new Se(o.value.reason,o.value.currentTime,o.value.readyState,o.value.buffered,o.value.paused,o.value.seeking);m.on_playback_tick(_);break}case"create-media-source-error":{let m=A.getDispatcher(),y=A.getContentInfo();if(m===null||y===null||y.mediaSourceObj?.mediaSourceId!==o.value.mediaSourceId)return;m.stop();break}case"update-media-source-duration-error":{let m=A.getDispatcher(),y=A.getContentInfo();if(m===null||y===null||y.mediaSourceObj?.mediaSourceId!==o.value.mediaSourceId)return;D.error("Error: when setting the MediaSource's duration");break}case"create-source-buffer-error":{let m=A.getDispatcher(),y=A.getContentInfo();if(m===null||y===null||y.mediaSourceObj?.mediaSourceId!==o.value.mediaSourceId)return;m.stop();break}case"update-wanted-speed":{let m=A.getDispatcher(),y=A.getContentInfo();if(m===null||y===null||y.mediaSourceObj?.mediaSourceId!==o.value.mediaSourceId)return;m.set_wanted_speed(o.value.wantedSpeed);break}case"update-logger-level":D.setLevel(o.value);break}}}function oi(c,o){let p;typeof c=="string"?p=c:c instanceof Error&&(p=c.message),V({type:"initialization-error",value:{code:o,message:p}})}function si(c){V({type:"content-error",value:{contentId:c,message:"Error: Worker not initialized.",code:0}})}function uo(c,o){Gn(fetch(c)).then(()=>{A.start(o),V({type:"initialized",value:null})}).catch(p=>{oi(p,1)})}function fo(){vr(),A.dispose()}br();})();
/*! @name mux.js @version 6.1.0 @license Apache-2.0 */
