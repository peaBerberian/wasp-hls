(()=>{var ts=Object.create;var bi=Object.defineProperty;var rs=Object.getOwnPropertyDescriptor;var is=Object.getOwnPropertyNames;var ns=Object.getPrototypeOf,as=Object.prototype.hasOwnProperty;var Si=(c,d)=>()=>(d||c((d={exports:{}}).exports,d),d.exports);var ss=(c,d,h,x)=>{if(d&&typeof d=="object"||typeof d=="function")for(let g of is(d))!as.call(c,g)&&g!==h&&bi(c,g,{get:()=>d[g],enumerable:!(x=rs(d,g))||x.enumerable});return c};var os=(c,d,h)=>(h=c!=null?ts(ns(c)):{},ss(d||!c||!c.__esModule?bi(h,"default",{value:c,enumerable:!0}):h,c));var Li=Si((po,ki)=>{var Ne;typeof window<"u"?Ne=window:typeof global<"u"?Ne=global:typeof self<"u"?Ne=self:Ne={};ki.exports=Ne});var Ri=Si((Xt,Kt)=>{(function(c,d){typeof Xt=="object"&&typeof Kt<"u"?Kt.exports=d(Li()):typeof define=="function"&&define.amd?define(["global/window"],d):(c=typeof globalThis<"u"?globalThis:c||self,c.muxjs=d(c.window))})(Xt,function(c){"use strict";function d(s){return s&&typeof s=="object"&&"default"in s?s:{default:s}}var h=d(c),x=function(){this.init=function(){var e={};this.on=function(t,r){e[t]||(e[t]=[]),e[t]=e[t].concat(r)},this.off=function(t,r){var i;return e[t]?(i=e[t].indexOf(r),e[t]=e[t].slice(),e[t].splice(i,1),i>-1):!1},this.trigger=function(t){var r,i,n,a;if(r=e[t],!!r)if(arguments.length===2)for(n=r.length,i=0;i<n;++i)r[i].call(this,arguments[1]);else{for(a=[],i=arguments.length,i=1;i<arguments.length;++i)a.push(arguments[i]);for(n=r.length,i=0;i<n;++i)r[i].apply(this,a)}},this.dispose=function(){e={}}}};x.prototype.pipe=function(s){return this.on("data",function(e){s.push(e)}),this.on("done",function(e){s.flush(e)}),this.on("partialdone",function(e){s.partialFlush(e)}),this.on("endedtimeline",function(e){s.endTimeline(e)}),this.on("reset",function(e){s.reset(e)}),s},x.prototype.push=function(s){this.trigger("data",s)},x.prototype.flush=function(s){this.trigger("done",s)},x.prototype.partialFlush=function(s){this.trigger("partialdone",s)},x.prototype.endTimeline=function(s){this.trigger("endedtimeline",s)},x.prototype.reset=function(s){this.trigger("reset",s)};var g=x,S=9e4,_,w,E,P,Se,je,ze;_=function(e){return e*S},w=function(e,t){return e*t},E=function(e){return e/S},P=function(e,t){return e/t},Se=function(e,t){return _(P(e,t))},je=function(e,t){return w(E(e),t)},ze=function(e,t,r){return E(r?e:e-t)};var W={ONE_SECOND_IN_TS:S,secondsToVideoTs:_,secondsToAudioTs:w,videoTsToSeconds:E,audioTsToSeconds:P,audioTsToVideoTs:Se,videoTsToAudioTs:je,metadataTsToSeconds:ze},_t=W.ONE_SECOND_IN_TS,_e,We=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];_e=function(e){var t,r=0;_e.prototype.init.call(this),this.skipWarn_=function(i,n){this.trigger("log",{level:"warn",message:"adts skiping bytes "+i+" to "+n+" in frame "+r+" outside syncword"})},this.push=function(i){var n=0,a,o,u,l,f;if(e||(r=0),i.type==="audio"){t&&t.length?(u=t,t=new Uint8Array(u.byteLength+i.data.byteLength),t.set(u),t.set(i.data,u.byteLength)):t=i.data;for(var p;n+7<t.length;){if(t[n]!==255||(t[n+1]&246)!==240){typeof p!="number"&&(p=n),n++;continue}if(typeof p=="number"&&(this.skipWarn_(p,n),p=null),o=(~t[n+1]&1)*2,a=(t[n+3]&3)<<11|t[n+4]<<3|(t[n+5]&224)>>5,l=((t[n+6]&3)+1)*1024,f=l*_t/We[(t[n+2]&60)>>>2],t.byteLength-n<a)break;this.trigger("data",{pts:i.pts+r*f,dts:i.dts+r*f,sampleCount:l,audioobjecttype:(t[n+2]>>>6&3)+1,channelcount:(t[n+2]&1)<<2|(t[n+3]&192)>>>6,samplerate:We[(t[n+2]&60)>>>2],samplingfrequencyindex:(t[n+2]&60)>>>2,samplesize:16,data:t.subarray(n+7+o,n+a)}),r++,n+=a}typeof p=="number"&&(this.skipWarn_(p,n),p=null),t=t.subarray(n)}},this.flush=function(){r=0,this.trigger("done")},this.reset=function(){t=void 0,this.trigger("reset")},this.endTimeline=function(){t=void 0,this.trigger("endedtimeline")}},_e.prototype=new g;var ne=_e,ir;ir=function(e){var t=e.byteLength,r=0,i=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+i},this.loadWord=function(){var n=e.byteLength-t,a=new Uint8Array(4),o=Math.min(4,t);if(o===0)throw new Error("no bytes available");a.set(e.subarray(n,n+o)),r=new DataView(a.buffer).getUint32(0),i=o*8,t-=o},this.skipBits=function(n){var a;i>n?(r<<=n,i-=n):(n-=i,a=Math.floor(n/8),n-=a*8,t-=a,this.loadWord(),r<<=n,i-=n)},this.readBits=function(n){var a=Math.min(i,n),o=r>>>32-a;return i-=a,i>0?r<<=a:t>0&&this.loadWord(),a=n-a,a>0?o<<a|this.readBits(a):o},this.skipLeadingZeros=function(){var n;for(n=0;n<i;++n)if((r&2147483648>>>n)!==0)return r<<=n,i-=n,n;return this.loadWord(),n+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var n=this.skipLeadingZeros();return this.readBits(n+1)-1},this.readExpGolomb=function(){var n=this.readUnsignedExpGolomb();return 1&n?1+n>>>1:-1*(n>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var qi=ir,Ve,Ee,nr;Ee=function(){var e=0,t,r;Ee.prototype.init.call(this),this.push=function(i){var n;r?(n=new Uint8Array(r.byteLength+i.data.byteLength),n.set(r),n.set(i.data,r.byteLength),r=n):r=i.data;for(var a=r.byteLength;e<a-3;e++)if(r[e+2]===1){t=e+5;break}for(;t<a;)switch(r[t]){case 0:if(r[t-1]!==0){t+=2;break}else if(r[t-2]!==0){t++;break}e+3!==t-2&&this.trigger("data",r.subarray(e+3,t-2));do t++;while(r[t]!==1&&t<a);e=t-2,t+=3;break;case 1:if(r[t-1]!==0||r[t-2]!==0){t+=3;break}this.trigger("data",r.subarray(e+3,t-2)),e=t-2,t+=3;break;default:t+=3;break}r=r.subarray(e),t-=e,e=0},this.reset=function(){r=null,e=0,this.trigger("reset")},this.flush=function(){r&&r.byteLength>3&&this.trigger("data",r.subarray(e+3)),r=null,e=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},Ee.prototype=new g,nr={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},Ve=function(){var e=new Ee,t,r,i,n,a,o,u;Ve.prototype.init.call(this),t=this,this.push=function(l){l.type==="video"&&(r=l.trackId,i=l.pts,n=l.dts,e.push(l))},e.on("data",function(l){var f={trackId:r,pts:i,dts:n,data:l,nalUnitTypeCode:l[0]&31};switch(f.nalUnitTypeCode){case 5:f.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:f.nalUnitType="sei_rbsp",f.escapedRBSP=a(l.subarray(1));break;case 7:f.nalUnitType="seq_parameter_set_rbsp",f.escapedRBSP=a(l.subarray(1)),f.config=o(f.escapedRBSP);break;case 8:f.nalUnitType="pic_parameter_set_rbsp";break;case 9:f.nalUnitType="access_unit_delimiter_rbsp";break}t.trigger("data",f)}),e.on("done",function(){t.trigger("done")}),e.on("partialdone",function(){t.trigger("partialdone")}),e.on("reset",function(){t.trigger("reset")}),e.on("endedtimeline",function(){t.trigger("endedtimeline")}),this.flush=function(){e.flush()},this.partialFlush=function(){e.partialFlush()},this.reset=function(){e.reset()},this.endTimeline=function(){e.endTimeline()},u=function(f,p){var m=8,v=8,b,y;for(b=0;b<f;b++)v!==0&&(y=p.readExpGolomb(),v=(m+y+256)%256),m=v===0?m:v},a=function(f){for(var p=f.byteLength,m=[],v=1,b,y;v<p-2;)f[v]===0&&f[v+1]===0&&f[v+2]===3?(m.push(v+2),v+=2):v++;if(m.length===0)return f;b=p-m.length,y=new Uint8Array(b);var T=0;for(v=0;v<b;T++,v++)T===m[0]&&(T++,m.shift()),y[v]=f[T];return y},o=function(f){var p=0,m=0,v=0,b=0,y,T,k,N,ye,qt,mi,gi,xi,Ht,yi,z=[1,1],vi,ve;if(y=new qi(f),T=y.readUnsignedByte(),N=y.readUnsignedByte(),k=y.readUnsignedByte(),y.skipUnsignedExpGolomb(),nr[T]&&(ye=y.readUnsignedExpGolomb(),ye===3&&y.skipBits(1),y.skipUnsignedExpGolomb(),y.skipUnsignedExpGolomb(),y.skipBits(1),y.readBoolean()))for(yi=ye!==3?8:12,ve=0;ve<yi;ve++)y.readBoolean()&&(ve<6?u(16,y):u(64,y));if(y.skipUnsignedExpGolomb(),qt=y.readUnsignedExpGolomb(),qt===0)y.readUnsignedExpGolomb();else if(qt===1)for(y.skipBits(1),y.skipExpGolomb(),y.skipExpGolomb(),mi=y.readUnsignedExpGolomb(),ve=0;ve<mi;ve++)y.skipExpGolomb();if(y.skipUnsignedExpGolomb(),y.skipBits(1),gi=y.readUnsignedExpGolomb(),xi=y.readUnsignedExpGolomb(),Ht=y.readBits(1),Ht===0&&y.skipBits(1),y.skipBits(1),y.readBoolean()&&(p=y.readUnsignedExpGolomb(),m=y.readUnsignedExpGolomb(),v=y.readUnsignedExpGolomb(),b=y.readUnsignedExpGolomb()),y.readBoolean()&&y.readBoolean()){switch(vi=y.readUnsignedByte(),vi){case 1:z=[1,1];break;case 2:z=[12,11];break;case 3:z=[10,11];break;case 4:z=[16,11];break;case 5:z=[40,33];break;case 6:z=[24,11];break;case 7:z=[20,11];break;case 8:z=[32,11];break;case 9:z=[80,33];break;case 10:z=[18,11];break;case 11:z=[15,11];break;case 12:z=[64,33];break;case 13:z=[160,99];break;case 14:z=[4,3];break;case 15:z=[3,2];break;case 16:z=[2,1];break;case 255:{z=[y.readUnsignedByte()<<8|y.readUnsignedByte(),y.readUnsignedByte()<<8|y.readUnsignedByte()];break}}z&&z[0]/z[1]}return{profileIdc:T,levelIdc:k,profileCompatibility:N,width:(gi+1)*16-p*2-m*2,height:(2-Ht)*(xi+1)*16-v*2-b*2,sarRatio:z}}},Ve.prototype=new g;var Tt={H264Stream:Ve,NalByteStream:Ee},wt={Adts:ne,h264:Tt},ar=Math.pow(2,32),Hi=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r;return t.getBigUint64?(r=t.getBigUint64(0),r<Number.MAX_SAFE_INTEGER?Number(r):r):t.getUint32(0)*ar+t.getUint32(4)},Me={getUint64:Hi,MAX_UINT32:ar},sr=Me.MAX_UINT32,A,or,ur,It,dr,fr,lr,cr,At,pr,hr,mr,gr,xr,yr,vr,br,Sr,_r,Tr,wr,Ft,I,Dt,Ir,Ar,Fr,Dr,Ur,Er,Mr,Cr,Ge,Pr,Or,kr;(function(){var s;if(I={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(s in I)I.hasOwnProperty(s)&&(I[s]=[s.charCodeAt(0),s.charCodeAt(1),s.charCodeAt(2),s.charCodeAt(3)]);Dt=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),Ar=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),Ir=new Uint8Array([0,0,0,1]),Fr=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),Dr=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),Ur={video:Fr,audio:Dr},Cr=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),Mr=new Uint8Array([0,0,0,0,0,0,0,0]),Ge=new Uint8Array([0,0,0,0,0,0,0,0]),Pr=Ge,Or=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),kr=Ge,Er=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),A=function(e){var t=[],r=0,i,n,a;for(i=1;i<arguments.length;i++)t.push(arguments[i]);for(i=t.length;i--;)r+=t[i].byteLength;for(n=new Uint8Array(r+8),a=new DataView(n.buffer,n.byteOffset,n.byteLength),a.setUint32(0,n.byteLength),n.set(e,4),i=0,r=8;i<t.length;i++)n.set(t[i],r),r+=t[i].byteLength;return n},or=function(){return A(I.dinf,A(I.dref,Cr))},ur=function(e){return A(I.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},It=function(){return A(I.ftyp,Dt,Ir,Dt,Ar)},vr=function(e){return A(I.hdlr,Ur[e])},dr=function(e){return A(I.mdat,e)},yr=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,e.duration&255,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=e.samplerate&255),A(I.mdhd,t)},xr=function(e){return A(I.mdia,yr(e),vr(e.type),lr(e))},fr=function(e){return A(I.mfhd,new Uint8Array([0,0,0,0,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255]))},lr=function(e){return A(I.minf,e.type==="video"?A(I.vmhd,Er):A(I.smhd,Mr),or(),Sr(e))},cr=function(e,t){for(var r=[],i=t.length;i--;)r[i]=Tr(t[i]);return A.apply(null,[I.moof,fr(e)].concat(r))},At=function(e){for(var t=e.length,r=[];t--;)r[t]=mr(e[t]);return A.apply(null,[I.moov,hr(4294967295)].concat(r).concat(pr(e)))},pr=function(e){for(var t=e.length,r=[];t--;)r[t]=wr(e[t]);return A.apply(null,[I.mvex].concat(r))},hr=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return A(I.mvhd,t)},br=function(e){var t=e.samples||[],r=new Uint8Array(4+t.length),i,n;for(n=0;n<t.length;n++)i=t[n].flags,r[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return A(I.sdtp,r)},Sr=function(e){return A(I.stbl,_r(e),A(I.stts,kr),A(I.stsc,Pr),A(I.stsz,Or),A(I.stco,Ge))},function(){var s,e;_r=function(r){return A(I.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),r.type==="video"?s(r):e(r))},s=function(r){var i=r.sps||[],n=r.pps||[],a=[],o=[],u,l;for(u=0;u<i.length;u++)a.push((i[u].byteLength&65280)>>>8),a.push(i[u].byteLength&255),a=a.concat(Array.prototype.slice.call(i[u]));for(u=0;u<n.length;u++)o.push((n[u].byteLength&65280)>>>8),o.push(n[u].byteLength&255),o=o.concat(Array.prototype.slice.call(n[u]));if(l=[I.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(r.width&65280)>>8,r.width&255,(r.height&65280)>>8,r.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),A(I.avcC,new Uint8Array([1,r.profileIdc,r.profileCompatibility,r.levelIdc,255].concat([i.length],a,[n.length],o))),A(I.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],r.sarRatio){var f=r.sarRatio[0],p=r.sarRatio[1];l.push(A(I.pasp,new Uint8Array([(f&4278190080)>>24,(f&16711680)>>16,(f&65280)>>8,f&255,(p&4278190080)>>24,(p&16711680)>>16,(p&65280)>>8,p&255])))}return A.apply(null,l)},e=function(r){return A(I.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(r.channelcount&65280)>>8,r.channelcount&255,(r.samplesize&65280)>>8,r.samplesize&255,0,0,0,0,(r.samplerate&65280)>>8,r.samplerate&255,0,0]),ur(r))}}(),gr=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,0,(e.duration&4278190080)>>24,(e.duration&16711680)>>16,(e.duration&65280)>>8,e.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(e.width&65280)>>8,e.width&255,0,0,(e.height&65280)>>8,e.height&255,0,0]);return A(I.tkhd,t)},Tr=function(e){var t,r,i,n,a,o,u;return t=A(I.tfhd,new Uint8Array([0,0,0,58,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),o=Math.floor(e.baseMediaDecodeTime/sr),u=Math.floor(e.baseMediaDecodeTime%sr),r=A(I.tfdt,new Uint8Array([1,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255])),a=32+20+8+16+8+8,e.type==="audio"?(i=Ft(e,a),A(I.traf,t,r,i)):(n=br(e),i=Ft(e,n.length+a),A(I.traf,t,r,i,n))},mr=function(e){return e.duration=e.duration||4294967295,A(I.trak,gr(e),xr(e))},wr=function(e){var t=new Uint8Array([0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.type!=="video"&&(t[t.length-1]=0),A(I.trex,t)},function(){var s,e,t;t=function(i,n){var a=0,o=0,u=0,l=0;return i.length&&(i[0].duration!==void 0&&(a=1),i[0].size!==void 0&&(o=2),i[0].flags!==void 0&&(u=4),i[0].compositionTimeOffset!==void 0&&(l=8)),[0,0,a|o|u|l,1,(i.length&4278190080)>>>24,(i.length&16711680)>>>16,(i.length&65280)>>>8,i.length&255,(n&4278190080)>>>24,(n&16711680)>>>16,(n&65280)>>>8,n&255]},e=function(i,n){var a,o,u,l,f,p;for(l=i.samples||[],n+=8+12+16*l.length,u=t(l,n),o=new Uint8Array(u.length+l.length*16),o.set(u),a=u.length,p=0;p<l.length;p++)f=l[p],o[a++]=(f.duration&4278190080)>>>24,o[a++]=(f.duration&16711680)>>>16,o[a++]=(f.duration&65280)>>>8,o[a++]=f.duration&255,o[a++]=(f.size&4278190080)>>>24,o[a++]=(f.size&16711680)>>>16,o[a++]=(f.size&65280)>>>8,o[a++]=f.size&255,o[a++]=f.flags.isLeading<<2|f.flags.dependsOn,o[a++]=f.flags.isDependedOn<<6|f.flags.hasRedundancy<<4|f.flags.paddingValue<<1|f.flags.isNonSyncSample,o[a++]=f.flags.degradationPriority&240<<8,o[a++]=f.flags.degradationPriority&15,o[a++]=(f.compositionTimeOffset&4278190080)>>>24,o[a++]=(f.compositionTimeOffset&16711680)>>>16,o[a++]=(f.compositionTimeOffset&65280)>>>8,o[a++]=f.compositionTimeOffset&255;return A(I.trun,o)},s=function(i,n){var a,o,u,l,f,p;for(l=i.samples||[],n+=8+12+8*l.length,u=t(l,n),a=new Uint8Array(u.length+l.length*8),a.set(u),o=u.length,p=0;p<l.length;p++)f=l[p],a[o++]=(f.duration&4278190080)>>>24,a[o++]=(f.duration&16711680)>>>16,a[o++]=(f.duration&65280)>>>8,a[o++]=f.duration&255,a[o++]=(f.size&4278190080)>>>24,a[o++]=(f.size&16711680)>>>16,a[o++]=(f.size&65280)>>>8,a[o++]=f.size&255;return A(I.trun,a)},Ft=function(i,n){return i.type==="audio"?s(i,n):e(i,n)}}();var Q={ftyp:It,mdat:dr,moof:cr,moov:At,initSegment:function(e){var t=It(),r=At(e),i;return i=new Uint8Array(t.byteLength+r.byteLength),i.set(t),i.set(r,t.byteLength),i}},$i=function(e){return e>>>0},Yi=function(e){return("00"+e.toString(16)).slice(-2)},qe={toUnsigned:$i,toHexString:Yi},Xi=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3]),t},Z=Xi,Ki=qe.toUnsigned,Qi=function s(e,t){var r=[],i,n,a,o,u;if(!t.length)return null;for(i=0;i<e.byteLength;)n=Ki(e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]),a=Z(e.subarray(i+4,i+8)),o=n>1?i+n:e.byteLength,a===t[0]&&(t.length===1?r.push(e.subarray(i+8,o)):(u=s(e.subarray(i+8,o),t.slice(1)),u.length&&(r=r.concat(u)))),i=o;return r},L=Qi,Zi=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4)},i=r.flags[2]&1,n=r.flags[2]&2,a=r.flags[2]&8,o=r.flags[2]&16,u=r.flags[2]&32,l=r.flags[0]&65536,f=r.flags[0]&131072,p;return p=8,i&&(p+=4,r.baseDataOffset=t.getUint32(12),p+=4),n&&(r.sampleDescriptionIndex=t.getUint32(p),p+=4),a&&(r.defaultSampleDuration=t.getUint32(p),p+=4),o&&(r.defaultSampleSize=t.getUint32(p),p+=4),u&&(r.defaultSampleFlags=t.getUint32(p)),l&&(r.durationIsEmpty=!0),!i&&f&&(r.baseDataOffsetIsMoof=!0),r},Ut=Zi,Ji=function(e){return{isLeading:(e[0]&12)>>>2,dependsOn:e[0]&3,isDependedOn:(e[1]&192)>>>6,hasRedundancy:(e[1]&48)>>>4,paddingValue:(e[1]&14)>>>1,isNonSyncSample:e[1]&1,degradationPriority:e[2]<<8|e[3]}},Lr=Ji,en=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},r=new DataView(e.buffer,e.byteOffset,e.byteLength),i=t.flags[2]&1,n=t.flags[2]&4,a=t.flags[1]&1,o=t.flags[1]&2,u=t.flags[1]&4,l=t.flags[1]&8,f=r.getUint32(4),p=8,m;for(i&&(t.dataOffset=r.getInt32(p),p+=4),n&&f&&(m={flags:Lr(e.subarray(p,p+4))},p+=4,a&&(m.duration=r.getUint32(p),p+=4),o&&(m.size=r.getUint32(p),p+=4),l&&(t.version===1?m.compositionTimeOffset=r.getInt32(p):m.compositionTimeOffset=r.getUint32(p),p+=4),t.samples.push(m),f--);f--;)m={},a&&(m.duration=r.getUint32(p),p+=4),o&&(m.size=r.getUint32(p),p+=4),u&&(m.flags=Lr(e.subarray(p,p+4)),p+=4),l&&(t.version===1?m.compositionTimeOffset=r.getInt32(p):m.compositionTimeOffset=r.getUint32(p),p+=4),t.samples.push(m);return t},Et=en,tn=qe.toUnsigned,rn=Me.getUint64,nn=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4))};return t.version===1?t.baseMediaDecodeTime=rn(e.subarray(4)):t.baseMediaDecodeTime=tn(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),t},Mt=nn,He=qe.toUnsigned,Ce=qe.toHexString,an=Me.getUint64,Rr,Br,Nr,jr,zr,Ct;Rr=function(e){var t={},r=L(e,["moov","trak"]);return r.reduce(function(i,n){var a,o,u,l,f;return a=L(n,["tkhd"])[0],!a||(o=a[0],u=o===0?12:20,l=He(a[u]<<24|a[u+1]<<16|a[u+2]<<8|a[u+3]),f=L(n,["mdia","mdhd"])[0],!f)?null:(o=f[0],u=o===0?12:20,i[l]=He(f[u]<<24|f[u+1]<<16|f[u+2]<<8|f[u+3]),i)},t)},Br=function(e,t){var r;r=L(t,["moof","traf"]);var i=r.reduce(function(n,a){var o=L(a,["tfhd"])[0],u=He(o[4]<<24|o[5]<<16|o[6]<<8|o[7]),l=e[u]||9e4,f=L(a,["tfdt"])[0],p=new DataView(f.buffer,f.byteOffset,f.byteLength),m;f[0]===1?m=an(f.subarray(4,12)):m=p.getUint32(4);var v;return typeof m=="bigint"?v=m/h.default.BigInt(l):typeof m=="number"&&!isNaN(m)&&(v=m/l),v<Number.MAX_SAFE_INTEGER&&(v=Number(v)),v<n&&(n=v),n},1/0);return typeof i=="bigint"||isFinite(i)?i:0},Nr=function(e,t){var r=L(t,["moof","traf"]),i=0,n=0,a;if(r&&r.length){var o=L(r[0],["tfhd"])[0],u=L(r[0],["trun"])[0],l=L(r[0],["tfdt"])[0];if(o){var f=Ut(o);a=f.trackId}if(l){var p=Mt(l);i=p.baseMediaDecodeTime}if(u){var m=Et(u);m.samples&&m.samples.length&&(n=m.samples[0].compositionTimeOffset||0)}}var v=e[a]||9e4;typeof i=="bigint"&&(n=h.default.BigInt(n),v=h.default.BigInt(v));var b=(i+n)/v;return typeof b=="bigint"&&b<Number.MAX_SAFE_INTEGER&&(b=Number(b)),b},jr=function(e){var t=L(e,["moov","trak"]),r=[];return t.forEach(function(i){var n=L(i,["mdia","hdlr"]),a=L(i,["tkhd"]);n.forEach(function(o,u){var l=Z(o.subarray(8,12)),f=a[u],p,m,v;l==="vide"&&(p=new DataView(f.buffer,f.byteOffset,f.byteLength),m=p.getUint8(0),v=m===0?p.getUint32(12):p.getUint32(20),r.push(v))})}),r},Ct=function(e){var t=e[0],r=t===0?12:20;return He(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])},zr=function(e){var t=L(e,["moov","trak"]),r=[];return t.forEach(function(i){var n={},a=L(i,["tkhd"])[0],o,u;a&&(o=new DataView(a.buffer,a.byteOffset,a.byteLength),u=o.getUint8(0),n.id=u===0?o.getUint32(12):o.getUint32(20));var l=L(i,["mdia","hdlr"])[0];if(l){var f=Z(l.subarray(8,12));f==="vide"?n.type="video":f==="soun"?n.type="audio":n.type=f}var p=L(i,["mdia","minf","stbl","stsd"])[0];if(p){var m=p.subarray(8);n.codec=Z(m.subarray(4,8));var v=L(m,[n.codec])[0],b,y;v&&(/^[asm]vc[1-9]$/i.test(n.codec)?(b=v.subarray(78),y=Z(b.subarray(4,8)),y==="avcC"&&b.length>11?(n.codec+=".",n.codec+=Ce(b[9]),n.codec+=Ce(b[10]),n.codec+=Ce(b[11])):n.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(n.codec)?(b=v.subarray(28),y=Z(b.subarray(4,8)),y==="esds"&&b.length>20&&b[19]!==0?(n.codec+="."+Ce(b[19]),n.codec+="."+Ce(b[20]>>>2&63).replace(/^0/,"")):n.codec="mp4a.40.2"):n.codec=n.codec.toLowerCase())}var T=L(i,["mdia","mdhd"])[0];T&&(n.timescale=Ct(T)),r.push(n)}),r};var sn={findBox:L,parseType:Z,timescale:Rr,startTime:Br,compositionStartTime:Nr,videoTrackIds:jr,tracks:zr,getTimescaleFromMediaHeader:Ct},on=function(e){var t,r,i=[],n=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,i.byteLength=0,t=0;t<e.length;t++)r=e[t],r.nalUnitType==="access_unit_delimiter_rbsp"?(i.length&&(i.duration=r.dts-i.dts,n.byteLength+=i.byteLength,n.nalCount+=i.length,n.duration+=i.duration,n.push(i)),i=[r],i.byteLength=r.data.byteLength,i.pts=r.pts,i.dts=r.dts):(r.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(i.keyFrame=!0),i.duration=r.dts-i.dts,i.byteLength+=r.data.byteLength,i.push(r));return n.length&&(!i.duration||i.duration<=0)&&(i.duration=n[n.length-1].duration),n.byteLength+=i.byteLength,n.nalCount+=i.length,n.duration+=i.duration,n.push(i),n},un=function(e){var t,r,i=[],n=[];for(i.byteLength=0,i.nalCount=0,i.duration=0,i.pts=e[0].pts,i.dts=e[0].dts,n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=e[0].pts,n.dts=e[0].dts,t=0;t<e.length;t++)r=e[t],r.keyFrame?(i.length&&(n.push(i),n.byteLength+=i.byteLength,n.nalCount+=i.nalCount,n.duration+=i.duration),i=[r],i.nalCount=r.length,i.byteLength=r.byteLength,i.pts=r.pts,i.dts=r.dts,i.duration=r.duration):(i.duration+=r.duration,i.nalCount+=r.length,i.byteLength+=r.byteLength,i.push(r));return n.length&&i.duration<=0&&(i.duration=n[n.length-1].duration),n.byteLength+=i.byteLength,n.nalCount+=i.nalCount,n.duration+=i.duration,n.push(i),n},dn=function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},fn=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},Wr=function(e,t){var r=fn();return r.dataOffset=t,r.compositionTimeOffset=e.pts-e.dts,r.duration=e.duration,r.size=4*e.length,r.size+=e.byteLength,e.keyFrame&&(r.flags.dependsOn=2,r.flags.isNonSyncSample=0),r},ln=function(e,t){var r,i,n,a,o,u=t||0,l=[];for(r=0;r<e.length;r++)for(a=e[r],i=0;i<a.length;i++)o=a[i],n=Wr(o,u),u+=n.size,l.push(n);return l},cn=function(e){var t,r,i,n,a,o,u=0,l=e.byteLength,f=e.nalCount,p=l+4*f,m=new Uint8Array(p),v=new DataView(m.buffer);for(t=0;t<e.length;t++)for(n=e[t],r=0;r<n.length;r++)for(a=n[r],i=0;i<a.length;i++)o=a[i],v.setUint32(u,o.data.byteLength),u+=4,m.set(o.data,u),u+=o.data.byteLength;return m},pn=function(e,t){var r,i=t||0,n=[];return r=Wr(e,i),n.push(r),n},hn=function(e){var t,r,i=0,n=e.byteLength,a=e.length,o=n+4*a,u=new Uint8Array(o),l=new DataView(u.buffer);for(t=0;t<e.length;t++)r=e[t],l.setUint32(i,r.data.byteLength),i+=4,u.set(r.data,i),i+=r.data.byteLength;return u},ee={groupNalsIntoFrames:on,groupFramesIntoGops:un,extendFirstKeyFrame:dn,generateSampleTable:ln,concatenateNalData:cn,generateSampleTableForFrame:pn,concatenateNalDataForFrame:hn},ue=[33,16,5,32,164,27],Pt=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],M=function(e){for(var t=[];e--;)t.push(0);return t},mn=function(e){return Object.keys(e).reduce(function(t,r){return t[r]=new Uint8Array(e[r].reduce(function(i,n){return i.concat(n)},[])),t},{})},Ot,gn=function(){if(!Ot){var e={96e3:[ue,[227,64],M(154),[56]],88200:[ue,[231],M(170),[56]],64e3:[ue,[248,192],M(240),[56]],48e3:[ue,[255,192],M(268),[55,148,128],M(54),[112]],44100:[ue,[255,192],M(268),[55,163,128],M(84),[112]],32e3:[ue,[255,192],M(268),[55,234],M(226),[112]],24e3:[ue,[255,192],M(268),[55,255,128],M(268),[111,112],M(126),[224]],16e3:[ue,[255,192],M(268),[55,255,128],M(268),[111,255],M(269),[223,108],M(195),[1,192]],12e3:[Pt,M(268),[3,127,248],M(268),[6,255,240],M(268),[13,255,224],M(268),[27,253,128],M(259),[56]],11025:[Pt,M(268),[3,127,248],M(268),[6,255,240],M(268),[13,255,224],M(268),[27,255,192],M(268),[55,175,128],M(108),[112]],8e3:[Pt,M(268),[3,121,16],M(47),[7]]};Ot=mn(e)}return Ot},xn=function(e){var t,r,i=0;for(t=0;t<e.length;t++)r=e[t],i+=r.data.byteLength;return i},yn=function(e,t,r,i){var n,a=0,o=0,u=0,l=0,f,p,m;if(!!t.length&&(n=W.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),a=Math.ceil(W.ONE_SECOND_IN_TS/(e.samplerate/1024)),r&&i&&(o=n-Math.max(r,i),u=Math.floor(o/a),l=u*a),!(u<1||l>W.ONE_SECOND_IN_TS/2))){for(f=gn()[e.samplerate],f||(f=t[0].data),p=0;p<u;p++)m=t[0],t.splice(0,0,{data:f,dts:m.dts-a,pts:m.pts-a});return e.baseMediaDecodeTime-=Math.floor(W.videoTsToAudioTs(l,e.samplerate)),l}},vn=function(e,t,r){return t.minSegmentDts>=r?e:(t.minSegmentDts=1/0,e.filter(function(i){return i.dts>=r?(t.minSegmentDts=Math.min(t.minSegmentDts,i.dts),t.minSegmentPts=t.minSegmentDts,!0):!1}))},bn=function(e){var t,r,i=[];for(t=0;t<e.length;t++)r=e[t],i.push({size:r.data.byteLength,duration:1024});return i},Sn=function(e){var t,r,i=0,n=new Uint8Array(xn(e));for(t=0;t<e.length;t++)r=e[t],n.set(r.data,i),i+=r.data.byteLength;return n},de={prefixWithSilence:yn,trimAdtsFramesByEarliestDts:vn,generateSampleTable:bn,concatenateFrameData:Sn},_n=W.ONE_SECOND_IN_TS,Tn=function(e,t){typeof t.pts=="number"&&(e.timelineStartInfo.pts===void 0&&(e.timelineStartInfo.pts=t.pts),e.minSegmentPts===void 0?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),e.maxSegmentPts===void 0?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),typeof t.dts=="number"&&(e.timelineStartInfo.dts===void 0&&(e.timelineStartInfo.dts=t.dts),e.minSegmentDts===void 0?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),e.maxSegmentDts===void 0?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))},wn=function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},In=function(e,t){var r,i,n=e.minSegmentDts;return t||(n-=e.timelineStartInfo.dts),r=e.timelineStartInfo.baseMediaDecodeTime,r+=n,r=Math.max(0,r),e.type==="audio"&&(i=e.samplerate/_n,r*=i,r=Math.floor(r)),r},j={clearDtsInfo:wn,calculateTrackBaseMediaDecodeTime:In,collectDtsInfo:Tn},Vr=4,An=128,Fn=function(e){for(var t=0,r={payloadType:-1,payloadSize:0},i=0,n=0;t<e.byteLength&&e[t]!==An;){for(;e[t]===255;)i+=255,t++;for(i+=e[t++];e[t]===255;)n+=255,t++;if(n+=e[t++],!r.payload&&i===Vr){var a=String.fromCharCode(e[t+3],e[t+4],e[t+5],e[t+6]);if(a==="GA94"){r.payloadType=i,r.payloadSize=n,r.payload=e.subarray(t,t+n);break}else r.payload=void 0}t+=n,i=0,n=0}return r},Dn=function(e){return e.payload[0]!==181||(e.payload[1]<<8|e.payload[2])!==49||String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])!=="GA94"||e.payload[7]!==3?null:e.payload.subarray(8,e.payload.length-1)},Un=function(e,t){var r=[],i,n,a,o;if(!(t[0]&64))return r;for(n=t[0]&31,i=0;i<n;i++)a=i*3,o={type:t[a+2]&3,pts:e},t[a+2]&4&&(o.ccData=t[a+3]<<8|t[a+4],r.push(o));return r},En=function(e){for(var t=e.byteLength,r=[],i=1,n,a;i<t-2;)e[i]===0&&e[i+1]===0&&e[i+2]===3?(r.push(i+2),i+=2):i++;if(r.length===0)return e;n=t-r.length,a=new Uint8Array(n);var o=0;for(i=0;i<n;o++,i++)o===r[0]&&(o++,r.shift()),a[i]=e[o];return a},Pe={parseSei:Fn,parseUserData:Dn,parseCaptionPackets:Un,discardEmulationPreventionBytes:En,USER_DATA_REGISTERED_ITU_T_T35:Vr},K=function s(e){e=e||{},s.prototype.init.call(this),this.parse708captions_=typeof e.parse708captions=="boolean"?e.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new B(0,0),new B(0,1),new B(1,0),new B(1,1)],this.parse708captions_&&(this.cc708Stream_=new R({captionServices:e.captionServices})),this.reset(),this.ccStreams_.forEach(function(t){t.on("data",this.trigger.bind(this,"data")),t.on("partialdone",this.trigger.bind(this,"partialdone")),t.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};K.prototype=new g,K.prototype.push=function(s){var e,t,r;if(s.nalUnitType==="sei_rbsp"&&(e=Pe.parseSei(s.escapedRBSP),!!e.payload&&e.payloadType===Pe.USER_DATA_REGISTERED_ITU_T_T35&&(t=Pe.parseUserData(e),!!t))){if(s.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(s.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}r=Pe.parseCaptionPackets(s.pts,t),this.captionPackets_=this.captionPackets_.concat(r),this.latestDts_!==s.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=s.dts}},K.prototype.flushCCStreams=function(s){this.ccStreams_.forEach(function(e){return s==="flush"?e.flush():e.partialFlush()},this)},K.prototype.flushStream=function(s){if(!this.captionPackets_.length){this.flushCCStreams(s);return}this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2?this.dispatchCea608Packet(e):this.dispatchCea708Packet(e)},this),this.captionPackets_.length=0,this.flushCCStreams(s)},K.prototype.flush=function(){return this.flushStream("flush")},K.prototype.partialFlush=function(){return this.flushStream("partialFlush")},K.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(s){s.reset()})},K.prototype.dispatchCea608Packet=function(s){this.setsTextOrXDSActive(s)?this.activeCea608Channel_[s.type]=null:this.setsChannel1Active(s)?this.activeCea608Channel_[s.type]=0:this.setsChannel2Active(s)&&(this.activeCea608Channel_[s.type]=1),this.activeCea608Channel_[s.type]!==null&&this.ccStreams_[(s.type<<1)+this.activeCea608Channel_[s.type]].push(s)},K.prototype.setsChannel1Active=function(s){return(s.ccData&30720)===4096},K.prototype.setsChannel2Active=function(s){return(s.ccData&30720)===6144},K.prototype.setsTextOrXDSActive=function(s){return(s.ccData&28928)===256||(s.ccData&30974)===4138||(s.ccData&30974)===6186},K.prototype.dispatchCea708Packet=function(s){this.parse708captions_&&this.cc708Stream_.push(s)};var Mn={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},Cn=function(e){var t=Mn[e]||e;return e&4096&&e===t?"":String.fromCharCode(t)},$e=function(e){return 32<=e&&e<=127||160<=e&&e<=255},ae=function(e){this.windowNum=e,this.reset()};ae.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},ae.prototype.getText=function(){return this.rows.join(`
`)},ae.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},ae.prototype.newLine=function(s){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(s),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},ae.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},ae.prototype.addText=function(s){this.rows[this.rowIdx]+=s},ae.prototype.backspace=function(){if(!this.isEmpty()){var s=this.rows[this.rowIdx];this.rows[this.rowIdx]=s.substr(0,s.length-1)}};var Ye=function(e,t,r){this.serviceNum=e,this.text="",this.currentWindow=new ae(-1),this.windows=[],this.stream=r,typeof t=="string"&&this.createTextDecoder(t)};Ye.prototype.init=function(s,e){this.startPts=s;for(var t=0;t<8;t++)this.windows[t]=new ae(t),typeof e=="function"&&(this.windows[t].beforeRowOverflow=e)},Ye.prototype.setCurrentWindow=function(s){this.currentWindow=this.windows[s]},Ye.prototype.createTextDecoder=function(s){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(s)}catch(e){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+s+" encoding. "+e})}};var R=function s(e){e=e||{},s.prototype.init.call(this);var t=this,r=e.captionServices||{},i={},n;Object.keys(r).forEach(function(a){n=r[a],/^SERVICE/.test(a)&&(i[a]=n.encoding)}),this.serviceEncodings=i,this.current708Packet=null,this.services={},this.push=function(a){a.type===3?(t.new708Packet(),t.add708Bytes(a)):(t.current708Packet===null&&t.new708Packet(),t.add708Bytes(a))}};R.prototype=new g,R.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},R.prototype.add708Bytes=function(s){var e=s.ccData,t=e>>>8,r=e&255;this.current708Packet.ptsVals.push(s.pts),this.current708Packet.data.push(t),this.current708Packet.data.push(r)},R.prototype.push708Packet=function(){var s=this.current708Packet,e=s.data,t=null,r=null,i=0,n=e[i++];for(s.seq=n>>6,s.sizeCode=n&63;i<e.length;i++)n=e[i++],t=n>>5,r=n&31,t===7&&r>0&&(n=e[i++],t=n),this.pushServiceBlock(t,i,r),r>0&&(i+=r-1)},R.prototype.pushServiceBlock=function(s,e,t){var r,i=e,n=this.current708Packet.data,a=this.services[s];for(a||(a=this.initService(s,i));i<e+t&&i<n.length;i++)r=n[i],$e(r)?i=this.handleText(i,a):r===24?i=this.multiByteCharacter(i,a):r===16?i=this.extendedCommands(i,a):128<=r&&r<=135?i=this.setCurrentWindow(i,a):152<=r&&r<=159?i=this.defineWindow(i,a):r===136?i=this.clearWindows(i,a):r===140?i=this.deleteWindows(i,a):r===137?i=this.displayWindows(i,a):r===138?i=this.hideWindows(i,a):r===139?i=this.toggleWindows(i,a):r===151?i=this.setWindowAttributes(i,a):r===144?i=this.setPenAttributes(i,a):r===145?i=this.setPenColor(i,a):r===146?i=this.setPenLocation(i,a):r===143?a=this.reset(i,a):r===8?a.currentWindow.backspace():r===12?a.currentWindow.clearText():r===13?a.currentWindow.pendingNewLine=!0:r===14?a.currentWindow.clearText():r===141&&i++},R.prototype.extendedCommands=function(s,e){var t=this.current708Packet.data,r=t[++s];return $e(r)&&(s=this.handleText(s,e,{isExtended:!0})),s},R.prototype.getPts=function(s){return this.current708Packet.ptsVals[Math.floor(s/2)]},R.prototype.initService=function(s,e){var r="SERVICE"+s,t=this,r,i;return r in this.serviceEncodings&&(i=this.serviceEncodings[r]),this.services[s]=new Ye(s,i,t),this.services[s].init(this.getPts(e),function(n){t.flushDisplayed(n,t.services[s])}),this.services[s]},R.prototype.handleText=function(s,e,t){var r=t&&t.isExtended,i=t&&t.isMultiByte,n=this.current708Packet.data,a=r?4096:0,o=n[s],u=n[s+1],l=e.currentWindow,f,p;return e.textDecoder_&&!r?(i?(p=[o,u],s++):p=[o],f=e.textDecoder_.decode(new Uint8Array(p))):f=Cn(a|o),l.pendingNewLine&&!l.isEmpty()&&l.newLine(this.getPts(s)),l.pendingNewLine=!1,l.addText(f),s},R.prototype.multiByteCharacter=function(s,e){var t=this.current708Packet.data,r=t[s+1],i=t[s+2];return $e(r)&&$e(i)&&(s=this.handleText(++s,e,{isMultiByte:!0})),s},R.prototype.setCurrentWindow=function(s,e){var t=this.current708Packet.data,r=t[s],i=r&7;return e.setCurrentWindow(i),s},R.prototype.defineWindow=function(s,e){var t=this.current708Packet.data,r=t[s],i=r&7;e.setCurrentWindow(i);var n=e.currentWindow;return r=t[++s],n.visible=(r&32)>>5,n.rowLock=(r&16)>>4,n.columnLock=(r&8)>>3,n.priority=r&7,r=t[++s],n.relativePositioning=(r&128)>>7,n.anchorVertical=r&127,r=t[++s],n.anchorHorizontal=r,r=t[++s],n.anchorPoint=(r&240)>>4,n.rowCount=r&15,r=t[++s],n.columnCount=r&63,r=t[++s],n.windowStyle=(r&56)>>3,n.penStyle=r&7,n.virtualRowCount=n.rowCount+1,s},R.prototype.setWindowAttributes=function(s,e){var t=this.current708Packet.data,r=t[s],i=e.currentWindow.winAttr;return r=t[++s],i.fillOpacity=(r&192)>>6,i.fillRed=(r&48)>>4,i.fillGreen=(r&12)>>2,i.fillBlue=r&3,r=t[++s],i.borderType=(r&192)>>6,i.borderRed=(r&48)>>4,i.borderGreen=(r&12)>>2,i.borderBlue=r&3,r=t[++s],i.borderType+=(r&128)>>5,i.wordWrap=(r&64)>>6,i.printDirection=(r&48)>>4,i.scrollDirection=(r&12)>>2,i.justify=r&3,r=t[++s],i.effectSpeed=(r&240)>>4,i.effectDirection=(r&12)>>2,i.displayEffect=r&3,s},R.prototype.flushDisplayed=function(s,e){for(var t=[],r=0;r<8;r++)e.windows[r].visible&&!e.windows[r].isEmpty()&&t.push(e.windows[r].getText());e.endPts=s,e.text=t.join(`

`),this.pushCaption(e),e.startPts=s},R.prototype.pushCaption=function(s){s.text!==""&&(this.trigger("data",{startPts:s.startPts,endPts:s.endPts,text:s.text,stream:"cc708_"+s.serviceNum}),s.text="",s.startPts=s.endPts)},R.prototype.displayWindows=function(s,e){var t=this.current708Packet.data,r=t[++s],i=this.getPts(s);this.flushDisplayed(i,e);for(var n=0;n<8;n++)r&1<<n&&(e.windows[n].visible=1);return s},R.prototype.hideWindows=function(s,e){var t=this.current708Packet.data,r=t[++s],i=this.getPts(s);this.flushDisplayed(i,e);for(var n=0;n<8;n++)r&1<<n&&(e.windows[n].visible=0);return s},R.prototype.toggleWindows=function(s,e){var t=this.current708Packet.data,r=t[++s],i=this.getPts(s);this.flushDisplayed(i,e);for(var n=0;n<8;n++)r&1<<n&&(e.windows[n].visible^=1);return s},R.prototype.clearWindows=function(s,e){var t=this.current708Packet.data,r=t[++s],i=this.getPts(s);this.flushDisplayed(i,e);for(var n=0;n<8;n++)r&1<<n&&e.windows[n].clearText();return s},R.prototype.deleteWindows=function(s,e){var t=this.current708Packet.data,r=t[++s],i=this.getPts(s);this.flushDisplayed(i,e);for(var n=0;n<8;n++)r&1<<n&&e.windows[n].reset();return s},R.prototype.setPenAttributes=function(s,e){var t=this.current708Packet.data,r=t[s],i=e.currentWindow.penAttr;return r=t[++s],i.textTag=(r&240)>>4,i.offset=(r&12)>>2,i.penSize=r&3,r=t[++s],i.italics=(r&128)>>7,i.underline=(r&64)>>6,i.edgeType=(r&56)>>3,i.fontStyle=r&7,s},R.prototype.setPenColor=function(s,e){var t=this.current708Packet.data,r=t[s],i=e.currentWindow.penColor;return r=t[++s],i.fgOpacity=(r&192)>>6,i.fgRed=(r&48)>>4,i.fgGreen=(r&12)>>2,i.fgBlue=r&3,r=t[++s],i.bgOpacity=(r&192)>>6,i.bgRed=(r&48)>>4,i.bgGreen=(r&12)>>2,i.bgBlue=r&3,r=t[++s],i.edgeRed=(r&48)>>4,i.edgeGreen=(r&12)>>2,i.edgeBlue=r&3,s},R.prototype.setPenLocation=function(s,e){var t=this.current708Packet.data,r=t[s],i=e.currentWindow.penLoc;return e.currentWindow.pendingNewLine=!0,r=t[++s],i.row=r&15,r=t[++s],i.column=r&63,s},R.prototype.reset=function(s,e){var t=this.getPts(s);return this.flushDisplayed(t,e),this.initService(e.serviceNum,s)};var Pn={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},Xe=function(e){return e===null?"":(e=Pn[e]||e,String.fromCharCode(e))},Ke=14,On=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],me=function(){for(var e=[],t=Ke+1;t--;)e.push("");return e},B=function s(e,t){s.prototype.init.call(this),this.field_=e||0,this.dataChannel_=t||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(r){var i,n,a,o,u;if(i=r.ccData&32639,i===this.lastControlCode_){this.lastControlCode_=null;return}if((i&61440)===4096?this.lastControlCode_=i:i!==this.PADDING_&&(this.lastControlCode_=null),a=i>>>8,o=i&255,i!==this.PADDING_)if(i===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(i===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(r.pts),this.flushDisplayed(r.pts),n=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=n,this.startPts_=r.pts;else if(i===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(r.pts);else if(i===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(r.pts);else if(i===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(r.pts);else if(i===this.CARRIAGE_RETURN_)this.clearFormatting(r.pts),this.flushDisplayed(r.pts),this.shiftRowsUp_(),this.startPts_=r.pts;else if(i===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(i===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(r.pts),this.displayed_=me();else if(i===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=me();else if(i===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(r.pts),this.displayed_=me()),this.mode_="paintOn",this.startPts_=r.pts;else if(this.isSpecialCharacter(a,o))a=(a&3)<<8,u=Xe(a|o),this[this.mode_](r.pts,u),this.column_++;else if(this.isExtCharacter(a,o))this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),a=(a&3)<<8,u=Xe(a|o),this[this.mode_](r.pts,u),this.column_++;else if(this.isMidRowCode(a,o))this.clearFormatting(r.pts),this[this.mode_](r.pts," "),this.column_++,(o&14)===14&&this.addFormatting(r.pts,["i"]),(o&1)===1&&this.addFormatting(r.pts,["u"]);else if(this.isOffsetControlCode(a,o))this.column_+=o&3;else if(this.isPAC(a,o)){var l=On.indexOf(i&7968);this.mode_==="rollUp"&&(l-this.rollUpRows_+1<0&&(l=this.rollUpRows_-1),this.setRollUp(r.pts,l)),l!==this.row_&&(this.clearFormatting(r.pts),this.row_=l),o&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(r.pts,["u"]),(i&16)===16&&(this.column_=((i&14)>>1)*4),this.isColorPAC(o)&&(o&14)===14&&this.addFormatting(r.pts,["i"])}else this.isNormalChar(a)&&(o===0&&(o=null),u=Xe(a),u+=Xe(o),this[this.mode_](r.pts,u),this.column_+=u.length)}};B.prototype=new g,B.prototype.flushDisplayed=function(s){var e=this.displayed_.map(function(t,r){try{return t.trim()}catch{return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+r+"."}),""}},this).join(`
`).replace(/^\n+|\n+$/g,"");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:s,text:e,stream:this.name_})},B.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=me(),this.nonDisplayed_=me(),this.lastControlCode_=null,this.column_=0,this.row_=Ke,this.rollUpRows_=2,this.formatting_=[]},B.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},B.prototype.isSpecialCharacter=function(s,e){return s===this.EXT_&&e>=48&&e<=63},B.prototype.isExtCharacter=function(s,e){return(s===this.EXT_+1||s===this.EXT_+2)&&e>=32&&e<=63},B.prototype.isMidRowCode=function(s,e){return s===this.EXT_&&e>=32&&e<=47},B.prototype.isOffsetControlCode=function(s,e){return s===this.OFFSET_&&e>=33&&e<=35},B.prototype.isPAC=function(s,e){return s>=this.BASE_&&s<this.BASE_+8&&e>=64&&e<=127},B.prototype.isColorPAC=function(s){return s>=64&&s<=79||s>=96&&s<=127},B.prototype.isNormalChar=function(s){return s>=32&&s<=127},B.prototype.setRollUp=function(s,e){if(this.mode_!=="rollUp"&&(this.row_=Ke,this.mode_="rollUp",this.flushDisplayed(s),this.nonDisplayed_=me(),this.displayed_=me()),e!==void 0&&e!==this.row_)for(var t=0;t<this.rollUpRows_;t++)this.displayed_[e-t]=this.displayed_[this.row_-t],this.displayed_[this.row_-t]="";e===void 0&&(e=this.row_),this.topRow_=e-this.rollUpRows_+1},B.prototype.addFormatting=function(s,e){this.formatting_=this.formatting_.concat(e);var t=e.reduce(function(r,i){return r+"<"+i+">"},"");this[this.mode_](s,t)},B.prototype.clearFormatting=function(s){if(!!this.formatting_.length){var e=this.formatting_.reverse().reduce(function(t,r){return t+"</"+r+">"},"");this.formatting_=[],this[this.mode_](s,e)}},B.prototype.popOn=function(s,e){var t=this.nonDisplayed_[this.row_];t+=e,this.nonDisplayed_[this.row_]=t},B.prototype.rollUp=function(s,e){var t=this.displayed_[this.row_];t+=e,this.displayed_[this.row_]=t},B.prototype.shiftRowsUp_=function(){var s;for(s=0;s<this.topRow_;s++)this.displayed_[s]="";for(s=this.row_+1;s<Ke+1;s++)this.displayed_[s]="";for(s=this.topRow_;s<this.row_;s++)this.displayed_[s]=this.displayed_[s+1];this.displayed_[this.row_]=""},B.prototype.paintOn=function(s,e){var t=this.displayed_[this.row_];t+=e,this.displayed_[this.row_]=t};var Qe={CaptionStream:K,Cea608Stream:B,Cea708Stream:R},V={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},kn=8589934592,Ln=4294967296,Gr="shared",kt=function(e,t){var r=1;for(e>t&&(r=-1);Math.abs(t-e)>Ln;)e+=r*kn;return e},qr=function s(e){var t,r;s.prototype.init.call(this),this.type_=e||Gr,this.push=function(i){this.type_!==Gr&&i.type!==this.type_||(r===void 0&&(r=i.dts),i.dts=kt(i.dts,r),i.pts=kt(i.pts,r),t=i.dts,this.trigger("data",i))},this.flush=function(){r=t,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){r=void 0,t=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};qr.prototype=new g;var Hr={TimestampRolloverStream:qr,handleRollover:kt},$r=function(e,t,r){var i,n="";for(i=t;i<r;i++)n+="%"+("00"+e[i].toString(16)).slice(-2);return n},Ze=function(e,t,r){return decodeURIComponent($r(e,t,r))},Rn=function(e,t,r){return unescape($r(e,t,r))},Je=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Yr={TXXX:function(e){var t;if(e.data[0]===3){for(t=1;t<e.data.length;t++)if(e.data[t]===0){e.description=Ze(e.data,1,t),e.value=Ze(e.data,t+1,e.data.length).replace(/\0*$/,"");break}e.data=e.value}},WXXX:function(e){var t;if(e.data[0]===3){for(t=1;t<e.data.length;t++)if(e.data[t]===0){e.description=Ze(e.data,1,t),e.url=Ze(e.data,t+1,e.data.length);break}}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(e.data[t]===0){e.owner=Rn(e.data,0,t);break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}},et;et=function(e){var t={descriptor:e&&e.descriptor},r=0,i=[],n=0,a;if(et.prototype.init.call(this),this.dispatchType=V.METADATA_STREAM_TYPE.toString(16),t.descriptor)for(a=0;a<t.descriptor.length;a++)this.dispatchType+=("00"+t.descriptor[a].toString(16)).slice(-2);this.push=function(o){var u,l,f,p,m,v;if(o.type==="timed-metadata"){if(o.dataAlignmentIndicator&&(n=0,i.length=0),i.length===0&&(o.data.length<10||o.data[0]!=="I".charCodeAt(0)||o.data[1]!=="D".charCodeAt(0)||o.data[2]!=="3".charCodeAt(0))){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(i.push(o),n+=o.data.byteLength,i.length===1&&(r=Je(o.data.subarray(6,10)),r+=10),!(n<r)){for(u={data:new Uint8Array(r),frames:[],pts:i[0].pts,dts:i[0].dts},m=0;m<r;)u.data.set(i[0].data.subarray(0,r-m),m),m+=i[0].data.byteLength,n-=i[0].data.byteLength,i.shift();l=10,u.data[5]&64&&(l+=4,l+=Je(u.data.subarray(10,14)),r-=Je(u.data.subarray(16,20)));do{if(f=Je(u.data.subarray(l+4,l+8)),f<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(v=String.fromCharCode(u.data[l],u.data[l+1],u.data[l+2],u.data[l+3]),p={id:v,data:u.data.subarray(l+10,l+f+10)},p.key=p.id,Yr[p.id]&&(Yr[p.id](p),p.owner==="com.apple.streaming.transportStreamTimestamp")){var b=p.data,y=(b[3]&1)<<30|b[4]<<22|b[5]<<14|b[6]<<6|b[7]>>>2;y*=4,y+=b[7]&3,p.timeStamp=y,u.pts===void 0&&u.dts===void 0&&(u.pts=p.timeStamp,u.dts=p.timeStamp),this.trigger("timestamp",p)}u.frames.push(p),l+=10,l+=f}while(l<r);this.trigger("data",u)}}}},et.prototype=new g;var Bn=et,Nn=Hr.TimestampRolloverStream,tt,Oe,rt,Te=188,Lt=71;tt=function(){var e=new Uint8Array(Te),t=0;tt.prototype.init.call(this),this.push=function(r){var i=0,n=Te,a;for(t?(a=new Uint8Array(r.byteLength+t),a.set(e.subarray(0,t)),a.set(r,t),t=0):a=r;n<a.byteLength;){if(a[i]===Lt&&a[n]===Lt){this.trigger("data",a.subarray(i,n)),i+=Te,n+=Te;continue}i++,n++}i<a.byteLength&&(e.set(a.subarray(i),0),t=a.byteLength-i)},this.flush=function(){t===Te&&e[0]===Lt&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}},tt.prototype=new g,Oe=function(){var e,t,r,i;Oe.prototype.init.call(this),i=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(a,o){var u=0;o.payloadUnitStartIndicator&&(u+=a[u]+1),o.type==="pat"?t(a.subarray(u),o):r(a.subarray(u),o)},t=function(a,o){o.section_number=a[7],o.last_section_number=a[8],i.pmtPid=(a[10]&31)<<8|a[11],o.pmtPid=i.pmtPid},r=function(a,o){var u,l,f,p;if(!!(a[5]&1)){for(i.programMapTable={video:null,audio:null,"timed-metadata":{}},u=(a[1]&15)<<8|a[2],l=3+u-4,f=(a[10]&15)<<8|a[11],p=12+f;p<l;){var m=a[p],v=(a[p+1]&31)<<8|a[p+2];m===V.H264_STREAM_TYPE&&i.programMapTable.video===null?i.programMapTable.video=v:m===V.ADTS_STREAM_TYPE&&i.programMapTable.audio===null?i.programMapTable.audio=v:m===V.METADATA_STREAM_TYPE&&(i.programMapTable["timed-metadata"][v]=m),p+=((a[p+3]&15)<<8|a[p+4])+5}o.programMapTable=i.programMapTable}},this.push=function(n){var a={},o=4;if(a.payloadUnitStartIndicator=!!(n[1]&64),a.pid=n[1]&31,a.pid<<=8,a.pid|=n[2],(n[3]&48)>>>4>1&&(o+=n[o]+1),a.pid===0)a.type="pat",e(n.subarray(o),a),this.trigger("data",a);else if(a.pid===this.pmtPid)for(a.type="pmt",e(n.subarray(o),a),this.trigger("data",a);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([n,o,a]):this.processPes_(n,o,a)},this.processPes_=function(n,a,o){o.pid===this.programMapTable.video?o.streamType=V.H264_STREAM_TYPE:o.pid===this.programMapTable.audio?o.streamType=V.ADTS_STREAM_TYPE:o.streamType=this.programMapTable["timed-metadata"][o.pid],o.type="pes",o.data=n.subarray(a),this.trigger("data",o)}},Oe.prototype=new g,Oe.STREAM_TYPES={h264:27,adts:15},rt=function(){var e=this,t=!1,r={data:[],size:0},i={data:[],size:0},n={data:[],size:0},a,o=function(f,p){var m,v=f[0]<<16|f[1]<<8|f[2];p.data=new Uint8Array,v===1&&(p.packetLength=6+(f[4]<<8|f[5]),p.dataAlignmentIndicator=(f[6]&4)!==0,m=f[7],m&192&&(p.pts=(f[9]&14)<<27|(f[10]&255)<<20|(f[11]&254)<<12|(f[12]&255)<<5|(f[13]&254)>>>3,p.pts*=4,p.pts+=(f[13]&6)>>>1,p.dts=p.pts,m&64&&(p.dts=(f[14]&14)<<27|(f[15]&255)<<20|(f[16]&254)<<12|(f[17]&255)<<5|(f[18]&254)>>>3,p.dts*=4,p.dts+=(f[18]&6)>>>1)),p.data=f.subarray(9+f[8]))},u=function(f,p,m){var v=new Uint8Array(f.size),b={type:p},y=0,T=0,k=!1,N;if(!(!f.data.length||f.size<9)){for(b.trackId=f.data[0].pid,y=0;y<f.data.length;y++)N=f.data[y],v.set(N.data,T),T+=N.data.byteLength;o(v,b),k=p==="video"||b.packetLength<=f.size,(m||k)&&(f.size=0,f.data.length=0),k&&e.trigger("data",b)}};rt.prototype.init.call(this),this.push=function(l){({pat:function(){},pes:function(){var p,m;switch(l.streamType){case V.H264_STREAM_TYPE:p=r,m="video";break;case V.ADTS_STREAM_TYPE:p=i,m="audio";break;case V.METADATA_STREAM_TYPE:p=n,m="timed-metadata";break;default:return}l.payloadUnitStartIndicator&&u(p,m,!0),p.data.push(l),p.size+=l.data.byteLength},pmt:function(){var p={type:"metadata",tracks:[]};a=l.programMapTable,a.video!==null&&p.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+a.video,codec:"avc",type:"video"}),a.audio!==null&&p.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+a.audio,codec:"adts",type:"audio"}),t=!0,e.trigger("data",p)}})[l.type]()},this.reset=function(){r.size=0,r.data.length=0,i.size=0,i.data.length=0,this.trigger("reset")},this.flushStreams_=function(){u(r,"video"),u(i,"audio"),u(n,"timed-metadata")},this.flush=function(){if(!t&&a){var l={type:"metadata",tracks:[]};a.video!==null&&l.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+a.video,codec:"avc",type:"video"}),a.audio!==null&&l.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+a.audio,codec:"adts",type:"audio"}),e.trigger("data",l)}t=!1,this.flushStreams_(),this.trigger("done")}},rt.prototype=new g;var Xr={PAT_PID:0,MP2T_PACKET_LENGTH:Te,TransportPacketStream:tt,TransportParseStream:Oe,ElementaryStream:rt,TimestampRolloverStream:Nn,CaptionStream:Qe.CaptionStream,Cea608Stream:Qe.Cea608Stream,Cea708Stream:Qe.Cea708Stream,MetadataStream:Bn};for(var Rt in V)V.hasOwnProperty(Rt)&&(Xr[Rt]=V[Rt]);var O=Xr,jn=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Kr=function(e,t){var r=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],i=e[t+5],n=(i&16)>>4;return r=r>=0?r:0,n?r+20:r+10},zn=function s(e,t){return e.length-t<10||e[t]!=="I".charCodeAt(0)||e[t+1]!=="D".charCodeAt(0)||e[t+2]!=="3".charCodeAt(0)?t:(t+=Kr(e,t),s(e,t))},Wn=function(e){var t=zn(e,0);return e.length>=t+2&&(e[t]&255)===255&&(e[t+1]&240)===240&&(e[t+1]&22)===16},Qr=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Vn=function(e,t,r){var i,n="";for(i=t;i<r;i++)n+="%"+("00"+e[i].toString(16)).slice(-2);return n},Gn=function(e,t,r){return unescape(Vn(e,t,r))},qn=function(e,t){var r=(e[t+5]&224)>>5,i=e[t+4]<<3,n=e[t+3]&3<<11;return n|i|r},Hn=function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":e[t]&!0&&(e[t+1]&240)===240?"audio":null},$n=function(e){for(var t=0;t+5<e.length;){if(e[t]!==255||(e[t+1]&246)!==240){t++;continue}return jn[(e[t+2]&60)>>>2]}return null},Yn=function(e){var t,r,i,n;t=10,e[5]&64&&(t+=4,t+=Qr(e.subarray(10,14)));do{if(r=Qr(e.subarray(t+4,t+8)),r<1)return null;if(n=String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3]),n==="PRIV"){i=e.subarray(t+10,t+r+10);for(var a=0;a<i.byteLength;a++)if(i[a]===0){var o=Gn(i,0,a);if(o==="com.apple.streaming.transportStreamTimestamp"){var u=i.subarray(a+1),l=(u[3]&1)<<30|u[4]<<22|u[5]<<14|u[6]<<6|u[7]>>>2;return l*=4,l+=u[7]&3,l}break}}t+=10,t+=r}while(t<e.byteLength);return null},ke={isLikelyAacData:Wn,parseId3TagSize:Kr,parseAdtsSize:qn,parseType:Hn,parseSampleRate:$n,parseAacTimestamp:Yn},it;it=function(){var e=new Uint8Array,t=0;it.prototype.init.call(this),this.setTimestamp=function(r){t=r},this.push=function(r){var i=0,n=0,a,o,u,l;for(e.length?(l=e.length,e=new Uint8Array(r.byteLength+l),e.set(e.subarray(0,l)),e.set(r,l)):e=r;e.length-n>=3;){if(e[n]==="I".charCodeAt(0)&&e[n+1]==="D".charCodeAt(0)&&e[n+2]==="3".charCodeAt(0)){if(e.length-n<10||(i=ke.parseId3TagSize(e,n),n+i>e.length))break;o={type:"timed-metadata",data:e.subarray(n,n+i)},this.trigger("data",o),n+=i;continue}else if((e[n]&255)===255&&(e[n+1]&240)===240){if(e.length-n<7||(i=ke.parseAdtsSize(e,n),n+i>e.length))break;u={type:"audio",data:e.subarray(n,n+i),pts:t,dts:t},this.trigger("data",u),n+=i;continue}n++}a=e.length-n,a>0?e=e.subarray(n):e=new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}},it.prototype=new g;var Zr=it,Xn=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],nt=Xn,Kn=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],at=Kn,Qn=Tt.H264Stream,Zn=ke.isLikelyAacData,Jn=W.ONE_SECOND_IN_TS,Le,we,st,ge,ea=function(e,t){t.stream=e,this.trigger("log",t)},Jr=function(e,t){for(var r=Object.keys(t),i=0;i<r.length;i++){var n=r[i];n==="headOfPipeline"||!t[n].on||t[n].on("log",ea.bind(e,n))}},ei=function(e,t){var r;if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},Bt=function(e,t,r,i,n,a){var o=r-t,u=i-t,l=n-r;return{start:{dts:e,pts:e+o},end:{dts:e+u,pts:e+l},prependedContentDuration:a,baseMediaDecodeTime:e}};we=function(e,t){var r=[],i,n=0,a=0,o=1/0;t=t||{},i=t.firstSequenceNumber||0,we.prototype.init.call(this),this.push=function(u){j.collectDtsInfo(e,u),e&&nt.forEach(function(l){e[l]=u[l]}),r.push(u)},this.setEarliestDts=function(u){n=u},this.setVideoBaseMediaDecodeTime=function(u){o=u},this.setAudioAppendStart=function(u){a=u},this.flush=function(){var u,l,f,p,m,v,b;if(r.length===0){this.trigger("done","AudioSegmentStream");return}u=de.trimAdtsFramesByEarliestDts(r,e,n),e.baseMediaDecodeTime=j.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),b=de.prefixWithSilence(e,u,a,o),e.samples=de.generateSampleTable(u),f=Q.mdat(de.concatenateFrameData(u)),r=[],l=Q.moof(i,[e]),p=new Uint8Array(l.byteLength+f.byteLength),i++,p.set(l),p.set(f,l.byteLength),j.clearDtsInfo(e),m=Math.ceil(Jn*1024/e.samplerate),u.length&&(v=u.length*m,this.trigger("segmentTimingInfo",Bt(W.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),u[0].dts,u[0].pts,u[0].dts+v,u[0].pts+v,b||0)),this.trigger("timingInfo",{start:u[0].pts,end:u[0].pts+v})),this.trigger("data",{track:e,boxes:p}),this.trigger("done","AudioSegmentStream")},this.reset=function(){j.clearDtsInfo(e),r=[],this.trigger("reset")}},we.prototype=new g,Le=function(e,t){var r,i=[],n=[],a,o;t=t||{},r=t.firstSequenceNumber||0,Le.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(u){j.collectDtsInfo(e,u),u.nalUnitType==="seq_parameter_set_rbsp"&&!a&&(a=u.config,e.sps=[u.data],at.forEach(function(l){e[l]=a[l]},this)),u.nalUnitType==="pic_parameter_set_rbsp"&&!o&&(o=u.data,e.pps=[u.data]),i.push(u)},this.flush=function(){for(var u,l,f,p,m,v,b=0,y,T;i.length&&i[0].nalUnitType!=="access_unit_delimiter_rbsp";)i.shift();if(i.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(u=ee.groupNalsIntoFrames(i),f=ee.groupFramesIntoGops(u),f[0][0].keyFrame||(l=this.getGopForFusion_(i[0],e),l?(b=l.duration,f.unshift(l),f.byteLength+=l.byteLength,f.nalCount+=l.nalCount,f.pts=l.pts,f.dts=l.dts,f.duration+=l.duration):f=ee.extendFirstKeyFrame(f)),n.length){var k;if(t.alignGopsAtEnd?k=this.alignGopsAtEnd_(f):k=this.alignGopsAtStart_(f),!k){this.gopCache_.unshift({gop:f.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),i=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}j.clearDtsInfo(e),f=k}j.collectDtsInfo(e,f),e.samples=ee.generateSampleTable(f),m=Q.mdat(ee.concatenateNalData(f)),e.baseMediaDecodeTime=j.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",f.map(function(N){return{pts:N.pts,dts:N.dts,byteLength:N.byteLength}})),y=f[0],T=f[f.length-1],this.trigger("segmentTimingInfo",Bt(e.baseMediaDecodeTime,y.dts,y.pts,T.dts+T.duration,T.pts+T.duration,b)),this.trigger("timingInfo",{start:f[0].pts,end:f[f.length-1].pts+f[f.length-1].duration}),this.gopCache_.unshift({gop:f.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),i=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),p=Q.moof(r,[e]),v=new Uint8Array(p.byteLength+m.byteLength),r++,v.set(p),v.set(m,p.byteLength),this.trigger("data",{track:e,boxes:v}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),i=[],this.gopCache_.length=0,n.length=0,this.trigger("reset")},this.resetStream_=function(){j.clearDtsInfo(e),a=void 0,o=void 0},this.getGopForFusion_=function(u){var l=45e3,f=1e4,p=1/0,m,v,b,y,T;for(T=0;T<this.gopCache_.length;T++)y=this.gopCache_[T],b=y.gop,!(!(e.pps&&ei(e.pps[0],y.pps[0]))||!(e.sps&&ei(e.sps[0],y.sps[0])))&&(b.dts<e.timelineStartInfo.dts||(m=u.dts-b.dts-b.duration,m>=-f&&m<=l&&(!v||p>m)&&(v=y,p=m)));return v?v.gop:null},this.alignGopsAtStart_=function(u){var l,f,p,m,v,b,y,T;for(v=u.byteLength,b=u.nalCount,y=u.duration,l=f=0;l<n.length&&f<u.length&&(p=n[l],m=u[f],p.pts!==m.pts);){if(m.pts>p.pts){l++;continue}f++,v-=m.byteLength,b-=m.nalCount,y-=m.duration}return f===0?u:f===u.length?null:(T=u.slice(f),T.byteLength=v,T.duration=y,T.nalCount=b,T.pts=T[0].pts,T.dts=T[0].dts,T)},this.alignGopsAtEnd_=function(u){var l,f,p,m,v,b;for(l=n.length-1,f=u.length-1,v=null,b=!1;l>=0&&f>=0;){if(p=n[l],m=u[f],p.pts===m.pts){b=!0;break}if(p.pts>m.pts){l--;continue}l===n.length-1&&(v=f),f--}if(!b&&v===null)return null;var y;if(b?y=f:y=v,y===0)return u;var T=u.slice(y),k=T.reduce(function(N,ye){return N.byteLength+=ye.byteLength,N.duration+=ye.duration,N.nalCount+=ye.nalCount,N},{byteLength:0,duration:0,nalCount:0});return T.byteLength=k.byteLength,T.duration=k.duration,T.nalCount=k.nalCount,T.pts=T[0].pts,T.dts=T[0].dts,T},this.alignGopsWith=function(u){n=u}},Le.prototype=new g,ge=function(e,t){this.numberOfTracks=0,this.metadataStream=t,e=e||{},typeof e.remux<"u"?this.remuxTracks=!!e.remux:this.remuxTracks=!0,typeof e.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=e.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,ge.prototype.init.call(this),this.push=function(r){if(r.text)return this.pendingCaptions.push(r);if(r.frames)return this.pendingMetadata.push(r);this.pendingTracks.push(r.track),this.pendingBytes+=r.boxes.byteLength,r.track.type==="video"&&(this.videoTrack=r.track,this.pendingBoxes.push(r.boxes)),r.track.type==="audio"&&(this.audioTrack=r.track,this.pendingBoxes.unshift(r.boxes))}},ge.prototype=new g,ge.prototype.flush=function(s){var e=0,t={captions:[],captionStreams:{},metadata:[],info:{}},r,i,n,a=0,o;if(this.pendingTracks.length<this.numberOfTracks){if(s!=="VideoSegmentStream"&&s!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(a=this.videoTrack.timelineStartInfo.pts,at.forEach(function(u){t.info[u]=this.videoTrack[u]},this)):this.audioTrack&&(a=this.audioTrack.timelineStartInfo.pts,nt.forEach(function(u){t.info[u]=this.audioTrack[u]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?t.type=this.pendingTracks[0].type:t.type="combined",this.emittedTracks+=this.pendingTracks.length,n=Q.initSegment(this.pendingTracks),t.initSegment=new Uint8Array(n.byteLength),t.initSegment.set(n),t.data=new Uint8Array(this.pendingBytes),o=0;o<this.pendingBoxes.length;o++)t.data.set(this.pendingBoxes[o],e),e+=this.pendingBoxes[o].byteLength;for(o=0;o<this.pendingCaptions.length;o++)r=this.pendingCaptions[o],r.startTime=W.metadataTsToSeconds(r.startPts,a,this.keepOriginalTimestamps),r.endTime=W.metadataTsToSeconds(r.endPts,a,this.keepOriginalTimestamps),t.captionStreams[r.stream]=!0,t.captions.push(r);for(o=0;o<this.pendingMetadata.length;o++)i=this.pendingMetadata[o],i.cueTime=W.metadataTsToSeconds(i.pts,a,this.keepOriginalTimestamps),t.metadata.push(i);for(t.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",t),o=0;o<t.captions.length;o++)r=t.captions[o],this.trigger("caption",r);for(o=0;o<t.metadata.length;o++)i=t.metadata[o],this.trigger("id3Frame",i)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},ge.prototype.setRemux=function(s){this.remuxTracks=s},st=function(e){var t=this,r=!0,i,n;st.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var a={};this.transmuxPipeline_=a,a.type="aac",a.metadataStream=new O.MetadataStream,a.aacStream=new Zr,a.audioTimestampRolloverStream=new O.TimestampRolloverStream("audio"),a.timedMetadataTimestampRolloverStream=new O.TimestampRolloverStream("timed-metadata"),a.adtsStream=new ne,a.coalesceStream=new ge(e,a.metadataStream),a.headOfPipeline=a.aacStream,a.aacStream.pipe(a.audioTimestampRolloverStream).pipe(a.adtsStream),a.aacStream.pipe(a.timedMetadataTimestampRolloverStream).pipe(a.metadataStream).pipe(a.coalesceStream),a.metadataStream.on("timestamp",function(o){a.aacStream.setTimestamp(o.timeStamp)}),a.aacStream.on("data",function(o){o.type!=="timed-metadata"&&o.type!=="audio"||a.audioSegmentStream||(n=n||{timelineStartInfo:{baseMediaDecodeTime:t.baseMediaDecodeTime},codec:"adts",type:"audio"},a.coalesceStream.numberOfTracks++,a.audioSegmentStream=new we(n,e),a.audioSegmentStream.on("log",t.getLogTrigger_("audioSegmentStream")),a.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),a.adtsStream.pipe(a.audioSegmentStream).pipe(a.coalesceStream),t.trigger("trackinfo",{hasAudio:!!n,hasVideo:!!i}))}),a.coalesceStream.on("data",this.trigger.bind(this,"data")),a.coalesceStream.on("done",this.trigger.bind(this,"done")),Jr(this,a)},this.setupTsPipeline=function(){var a={};this.transmuxPipeline_=a,a.type="ts",a.metadataStream=new O.MetadataStream,a.packetStream=new O.TransportPacketStream,a.parseStream=new O.TransportParseStream,a.elementaryStream=new O.ElementaryStream,a.timestampRolloverStream=new O.TimestampRolloverStream,a.adtsStream=new ne,a.h264Stream=new Qn,a.captionStream=new O.CaptionStream(e),a.coalesceStream=new ge(e,a.metadataStream),a.headOfPipeline=a.packetStream,a.packetStream.pipe(a.parseStream).pipe(a.elementaryStream).pipe(a.timestampRolloverStream),a.timestampRolloverStream.pipe(a.h264Stream),a.timestampRolloverStream.pipe(a.adtsStream),a.timestampRolloverStream.pipe(a.metadataStream).pipe(a.coalesceStream),a.h264Stream.pipe(a.captionStream).pipe(a.coalesceStream),a.elementaryStream.on("data",function(o){var u;if(o.type==="metadata"){for(u=o.tracks.length;u--;)!i&&o.tracks[u].type==="video"?(i=o.tracks[u],i.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime):!n&&o.tracks[u].type==="audio"&&(n=o.tracks[u],n.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime);i&&!a.videoSegmentStream&&(a.coalesceStream.numberOfTracks++,a.videoSegmentStream=new Le(i,e),a.videoSegmentStream.on("log",t.getLogTrigger_("videoSegmentStream")),a.videoSegmentStream.on("timelineStartInfo",function(l){n&&!e.keepOriginalTimestamps&&(n.timelineStartInfo=l,a.audioSegmentStream.setEarliestDts(l.dts-t.baseMediaDecodeTime))}),a.videoSegmentStream.on("processedGopsInfo",t.trigger.bind(t,"gopInfo")),a.videoSegmentStream.on("segmentTimingInfo",t.trigger.bind(t,"videoSegmentTimingInfo")),a.videoSegmentStream.on("baseMediaDecodeTime",function(l){n&&a.audioSegmentStream.setVideoBaseMediaDecodeTime(l)}),a.videoSegmentStream.on("timingInfo",t.trigger.bind(t,"videoTimingInfo")),a.h264Stream.pipe(a.videoSegmentStream).pipe(a.coalesceStream)),n&&!a.audioSegmentStream&&(a.coalesceStream.numberOfTracks++,a.audioSegmentStream=new we(n,e),a.audioSegmentStream.on("log",t.getLogTrigger_("audioSegmentStream")),a.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),a.audioSegmentStream.on("segmentTimingInfo",t.trigger.bind(t,"audioSegmentTimingInfo")),a.adtsStream.pipe(a.audioSegmentStream).pipe(a.coalesceStream)),t.trigger("trackinfo",{hasAudio:!!n,hasVideo:!!i})}}),a.coalesceStream.on("data",this.trigger.bind(this,"data")),a.coalesceStream.on("id3Frame",function(o){o.dispatchType=a.metadataStream.dispatchType,t.trigger("id3Frame",o)}),a.coalesceStream.on("caption",this.trigger.bind(this,"caption")),a.coalesceStream.on("done",this.trigger.bind(this,"done")),Jr(this,a)},this.setBaseMediaDecodeTime=function(a){var o=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=a),n&&(n.timelineStartInfo.dts=void 0,n.timelineStartInfo.pts=void 0,j.clearDtsInfo(n),o.audioTimestampRolloverStream&&o.audioTimestampRolloverStream.discontinuity()),i&&(o.videoSegmentStream&&(o.videoSegmentStream.gopCache_=[]),i.timelineStartInfo.dts=void 0,i.timelineStartInfo.pts=void 0,j.clearDtsInfo(i),o.captionStream.reset()),o.timestampRolloverStream&&o.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(a){n&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(a)},this.setRemux=function(a){var o=this.transmuxPipeline_;e.remux=a,o&&o.coalesceStream&&o.coalesceStream.setRemux(a)},this.alignGopsWith=function(a){i&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(a)},this.getLogTrigger_=function(a){var o=this;return function(u){u.stream=a,o.trigger("log",u)}},this.push=function(a){if(r){var o=Zn(a);o&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!o&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),r=!1}this.transmuxPipeline_.headOfPipeline.push(a)},this.flush=function(){r=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},st.prototype=new g;var Nt={Transmuxer:st,VideoSegmentStream:Le,AudioSegmentStream:we,AUDIO_PROPERTIES:nt,VIDEO_PROPERTIES:at,generateSegmentTimingInfo:Bt},ta=Pe.discardEmulationPreventionBytes,ra=Qe.CaptionStream,ia=function(e,t){for(var r=e,i=0;i<t.length;i++){var n=t[i];if(r<n.size)return n;r-=n.size}return null},na=function(e,t,r){var i=new DataView(e.buffer,e.byteOffset,e.byteLength),n={logs:[],seiNals:[]},a,o,u,l;for(o=0;o+4<e.length;o+=u)if(u=i.getUint32(o),o+=4,!(u<=0))switch(e[o]&31){case 6:var f=e.subarray(o+1,o+1+u),p=ia(o,t);if(a={nalUnitType:"sei_rbsp",size:u,data:f,escapedRBSP:ta(f),trackId:r},p)a.pts=p.pts,a.dts=p.dts,l=p;else if(l)a.pts=l.pts,a.dts=l.dts;else{n.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+o+" for trackId "+r+". See mux.js#223."});break}n.seiNals.push(a);break}return n},aa=function(e,t,r){var i=t,n=r.defaultSampleDuration||0,a=r.defaultSampleSize||0,o=r.trackId,u=[];return e.forEach(function(l){var f=Et(l),p=f.samples;p.forEach(function(m){m.duration===void 0&&(m.duration=n),m.size===void 0&&(m.size=a),m.trackId=o,m.dts=i,m.compositionTimeOffset===void 0&&(m.compositionTimeOffset=0),typeof i=="bigint"?(m.pts=i+h.default.BigInt(m.compositionTimeOffset),i+=h.default.BigInt(m.duration)):(m.pts=i+m.compositionTimeOffset,i+=m.duration)}),u=u.concat(p)}),u},sa=function(e,t){var r=L(e,["moof","traf"]),i=L(e,["mdat"]),n={},a=[];return i.forEach(function(o,u){var l=r[u];a.push({mdat:o,traf:l})}),a.forEach(function(o){var u=o.mdat,l=o.traf,f=L(l,["tfhd"]),p=Ut(f[0]),m=p.trackId,v=L(l,["tfdt"]),b=v.length>0?Mt(v[0]).baseMediaDecodeTime:0,y=L(l,["trun"]),T,k;t===m&&y.length>0&&(T=aa(y,b,p),k=na(u,T,m),n[m]||(n[m]={seiNals:[],logs:[]}),n[m].seiNals=n[m].seiNals.concat(k.seiNals),n[m].logs=n[m].logs.concat(k.logs))}),n},oa=function(e,t,r){var i;if(t===null)return null;i=sa(e,t);var n=i[t]||{};return{seiNals:n.seiNals,logs:n.logs,timescale:r}},ua=function(){var e=!1,t,r,i,n,a,o;this.isInitialized=function(){return e},this.init=function(u){t=new ra,e=!0,o=u?u.isPartial:!1,t.on("data",function(l){l.startTime=l.startPts/n,l.endTime=l.endPts/n,a.captions.push(l),a.captionStreams[l.stream]=!0}),t.on("log",function(l){a.logs.push(l)})},this.isNewInit=function(u,l){return u&&u.length===0||l&&typeof l=="object"&&Object.keys(l).length===0?!1:i!==u[0]||n!==l[i]},this.parse=function(u,l,f){var p;if(this.isInitialized()){if(!l||!f)return null;if(this.isNewInit(l,f))i=l[0],n=f[i];else if(i===null||!n)return r.push(u),null}else return null;for(;r.length>0;){var m=r.shift();this.parse(m,l,f)}return p=oa(u,i,n),p&&p.logs&&(a.logs=a.logs.concat(p.logs)),p===null||!p.seiNals?a.logs.length?{logs:a.logs,captions:[],captionStreams:[]}:null:(this.pushNals(p.seiNals),this.flushStream(),a)},this.pushNals=function(u){if(!this.isInitialized()||!u||u.length===0)return null;u.forEach(function(l){t.push(l)})},this.flushStream=function(){if(!this.isInitialized())return null;o?t.partialFlush():t.flush()},this.clearParsedCaptions=function(){a.captions=[],a.captionStreams={},a.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;t.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){r=[],i=null,n=null,a?this.clearParsedCaptions():a={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},da=ua,fa={generator:Q,probe:sn,Transmuxer:Nt.Transmuxer,AudioSegmentStream:Nt.AudioSegmentStream,VideoSegmentStream:Nt.VideoSegmentStream,CaptionParser:da},U;U=function(e,t){var r=0,i=16384,n=function(p,m){var v,b=p.position+m;b<p.bytes.byteLength||(v=new Uint8Array(b*2),v.set(p.bytes.subarray(0,p.position),0),p.bytes=v,p.view=new DataView(p.bytes.buffer))},a=U.widthBytes||new Uint8Array(5),o=U.heightBytes||new Uint8Array(6),u=U.videocodecidBytes||new Uint8Array(12),l;if(!U.widthBytes){for(l=0;l<5;l++)a[l]="width".charCodeAt(l);for(l=0;l<6;l++)o[l]="height".charCodeAt(l);for(l=0;l<12;l++)u[l]="videocodecid".charCodeAt(l);U.widthBytes=a,U.heightBytes=o,U.videocodecidBytes=u}switch(this.keyFrame=!1,e){case U.VIDEO_TAG:this.length=16,i*=6;break;case U.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case U.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(i),this.view=new DataView(this.bytes.buffer),this.bytes[0]=e,this.position=this.length,this.keyFrame=t,this.pts=0,this.dts=0,this.writeBytes=function(f,p,m){var v=p||0,b;m=m||f.byteLength,b=v+m,n(this,m),this.bytes.set(f.subarray(v,b),this.position),this.position+=m,this.length=Math.max(this.length,this.position)},this.writeByte=function(f){n(this,1),this.bytes[this.position]=f,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(f){n(this,2),this.view.setUint16(this.position,f),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(f){return this.bytes[this.length-f]},this.nalUnitSize=function(){return r===0?0:this.length-(r+4)},this.startNalUnit=function(){if(r>0)throw new Error("Attempted to create new NAL wihout closing the old one");r=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(f){var p,m;this.length===r+4?this.length-=4:r>0&&(p=r+4,m=this.length-p,this.position=r,this.view.setUint32(this.position,m),this.position=this.length,f&&f.push(this.bytes.subarray(p,p+m))),r=0},this.writeMetaDataDouble=function(f,p){var m;if(n(this,2+f.length+9),this.view.setUint16(this.position,f.length),this.position+=2,f==="width")this.bytes.set(a,this.position),this.position+=5;else if(f==="height")this.bytes.set(o,this.position),this.position+=6;else if(f==="videocodecid")this.bytes.set(u,this.position),this.position+=12;else for(m=0;m<f.length;m++)this.bytes[this.position]=f.charCodeAt(m),this.position++;this.position++,this.view.setFloat64(this.position,p),this.position+=8,this.length=Math.max(this.length,this.position),++r},this.writeMetaDataBoolean=function(f,p){var m;for(n(this,2),this.view.setUint16(this.position,f.length),this.position+=2,m=0;m<f.length;m++)n(this,1),this.bytes[this.position]=f.charCodeAt(m),this.position++;n(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,p?1:0),this.position++,this.length=Math.max(this.length,this.position),++r},this.finalize=function(){var f,p;switch(this.bytes[0]){case U.VIDEO_TAG:this.bytes[11]=(this.keyFrame||t?16:32)|7,this.bytes[12]=t?0:1,f=this.pts-this.dts,this.bytes[13]=(f&16711680)>>>16,this.bytes[14]=(f&65280)>>>8,this.bytes[15]=(f&255)>>>0;break;case U.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=t?0:1;break;case U.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,r),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position;break}return p=this.length-11,this.bytes[1]=(p&16711680)>>>16,this.bytes[2]=(p&65280)>>>8,this.bytes[3]=(p&255)>>>0,this.bytes[4]=(this.dts&16711680)>>>16,this.bytes[5]=(this.dts&65280)>>>8,this.bytes[6]=(this.dts&255)>>>0,this.bytes[7]=(this.dts&4278190080)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,n(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=U.frameTime(this.bytes),this}},U.AUDIO_TAG=8,U.VIDEO_TAG=9,U.METADATA_TAG=18,U.isAudioFrame=function(s){return U.AUDIO_TAG===s[0]},U.isVideoFrame=function(s){return U.VIDEO_TAG===s[0]},U.isMetaData=function(s){return U.METADATA_TAG===s[0]},U.isKeyFrame=function(s){return U.isVideoFrame(s)?s[11]===23:!!(U.isAudioFrame(s)||U.isMetaData(s))},U.frameTime=function(s){var e=s[4]<<16;return e|=s[5]<<8,e|=s[6]<<0,e|=s[7]<<24,e};var $=U,jt=function s(e){this.numberOfTracks=0,this.metadataStream=e.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,s.prototype.init.call(this),this.push=function(t){if(t.text)return this.pendingCaptions.push(t);if(t.frames)return this.pendingMetadata.push(t);t.track.type==="video"&&(this.videoTrack=t.track,this.videoTags=t.tags,this.pendingTracks++),t.track.type==="audio"&&(this.audioTrack=t.track,this.audioTags=t.tags,this.pendingTracks++)}};jt.prototype=new g,jt.prototype.flush=function(s){var e,t,r,i,n={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if(s!=="VideoSegmentStream"&&s!=="AudioSegmentStream")return;if(this.pendingTracks===0&&(this.processedTracks++,this.processedTracks<this.numberOfTracks))return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?i=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(i=this.audioTrack.timelineStartInfo.pts),n.tags.videoTags=this.videoTags,n.tags.audioTags=this.audioTags,r=0;r<this.pendingCaptions.length;r++)t=this.pendingCaptions[r],t.startTime=t.startPts-i,t.startTime/=9e4,t.endTime=t.endPts-i,t.endTime/=9e4,n.captionStreams[t.stream]=!0,n.captions.push(t);for(r=0;r<this.pendingMetadata.length;r++)e=this.pendingMetadata[r],e.cueTime=e.pts-i,e.cueTime/=9e4,n.metadata.push(e);n.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",n),this.trigger("done")}};var la=jt,ca=function(){var e=this;this.list=[],this.push=function(t){this.list.push({bytes:t.bytes,dts:t.dts,pts:t.pts,keyFrame:t.keyFrame,metaDataTag:t.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return e.list.length}})},ti=ca,pa=Tt.H264Stream,ot,ut,dt,zt,ri,ii;zt=function(e,t){typeof t.pts=="number"&&(e.timelineStartInfo.pts===void 0?e.timelineStartInfo.pts=t.pts:e.timelineStartInfo.pts=Math.min(e.timelineStartInfo.pts,t.pts)),typeof t.dts=="number"&&(e.timelineStartInfo.dts===void 0?e.timelineStartInfo.dts=t.dts:e.timelineStartInfo.dts=Math.min(e.timelineStartInfo.dts,t.dts))},ri=function(e,t){var r=new $($.METADATA_TAG);return r.dts=t,r.pts=t,r.writeMetaDataDouble("videocodecid",7),r.writeMetaDataDouble("width",e.width),r.writeMetaDataDouble("height",e.height),r},ii=function(e,t){var r,i=new $($.VIDEO_TAG,!0);for(i.dts=t,i.pts=t,i.writeByte(1),i.writeByte(e.profileIdc),i.writeByte(e.profileCompatibility),i.writeByte(e.levelIdc),i.writeByte(255),i.writeByte(225),i.writeShort(e.sps[0].length),i.writeBytes(e.sps[0]),i.writeByte(e.pps.length),r=0;r<e.pps.length;++r)i.writeShort(e.pps[r].length),i.writeBytes(e.pps[r]);return i},dt=function(e){var t=[],r=[],i;dt.prototype.init.call(this),this.push=function(n){zt(e,n),e&&(e.audioobjecttype=n.audioobjecttype,e.channelcount=n.channelcount,e.samplerate=n.samplerate,e.samplingfrequencyindex=n.samplingfrequencyindex,e.samplesize=n.samplesize,e.extraData=e.audioobjecttype<<11|e.samplingfrequencyindex<<7|e.channelcount<<3),n.pts=Math.round(n.pts/90),n.dts=Math.round(n.dts/90),t.push(n)},this.flush=function(){var n,a,o,u=new ti;if(t.length===0){this.trigger("done","AudioSegmentStream");return}for(o=-1/0;t.length;)n=t.shift(),r.length&&n.pts>=r[0]&&(o=r.shift(),this.writeMetaDataTags(u,o)),(e.extraData!==i||n.pts-o>=1e3)&&(this.writeMetaDataTags(u,n.pts),i=e.extraData,o=n.pts),a=new $($.AUDIO_TAG),a.pts=n.pts,a.dts=n.dts,a.writeBytes(n.data),u.push(a.finalize());r.length=0,i=null,this.trigger("data",{track:e,tags:u.list}),this.trigger("done","AudioSegmentStream")},this.writeMetaDataTags=function(n,a){var o;o=new $($.METADATA_TAG),o.pts=a,o.dts=a,o.writeMetaDataDouble("audiocodecid",10),o.writeMetaDataBoolean("stereo",e.channelcount===2),o.writeMetaDataDouble("audiosamplerate",e.samplerate),o.writeMetaDataDouble("audiosamplesize",16),n.push(o.finalize()),o=new $($.AUDIO_TAG,!0),o.pts=a,o.dts=a,o.view.setUint16(o.position,e.extraData),o.position+=2,o.length=Math.max(o.length,o.position),n.push(o.finalize())},this.onVideoKeyFrame=function(n){r.push(n)}},dt.prototype=new g,ut=function(e){var t=[],r,i;ut.prototype.init.call(this),this.finishFrame=function(n,a){if(!!a){if(r&&e&&e.newMetadata&&(a.keyFrame||n.length===0)){var o=ri(r,a.dts).finalize(),u=ii(e,a.dts).finalize();o.metaDataTag=u.metaDataTag=!0,n.push(o),n.push(u),e.newMetadata=!1,this.trigger("keyframe",a.dts)}a.endNalUnit(),n.push(a.finalize()),i=null}},this.push=function(n){zt(e,n),n.pts=Math.round(n.pts/90),n.dts=Math.round(n.dts/90),t.push(n)},this.flush=function(){for(var n,a=new ti;t.length&&t[0].nalUnitType!=="access_unit_delimiter_rbsp";)t.shift();if(t.length===0){this.trigger("done","VideoSegmentStream");return}for(;t.length;)n=t.shift(),n.nalUnitType==="seq_parameter_set_rbsp"?(e.newMetadata=!0,r=n.config,e.width=r.width,e.height=r.height,e.sps=[n.data],e.profileIdc=r.profileIdc,e.levelIdc=r.levelIdc,e.profileCompatibility=r.profileCompatibility,i.endNalUnit()):n.nalUnitType==="pic_parameter_set_rbsp"?(e.newMetadata=!0,e.pps=[n.data],i.endNalUnit()):n.nalUnitType==="access_unit_delimiter_rbsp"?(i&&this.finishFrame(a,i),i=new $($.VIDEO_TAG),i.pts=n.pts,i.dts=n.dts):(n.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(i.keyFrame=!0),i.endNalUnit()),i.startNalUnit(),i.writeBytes(n.data);i&&this.finishFrame(a,i),this.trigger("data",{track:e,tags:a.list}),this.trigger("done","VideoSegmentStream")}},ut.prototype=new g,ot=function(e){var t=this,r,i,n,a,o,u,l,f,p,m,v,b;ot.prototype.init.call(this),e=e||{},this.metadataStream=new O.MetadataStream,e.metadataStream=this.metadataStream,r=new O.TransportPacketStream,i=new O.TransportParseStream,n=new O.ElementaryStream,a=new O.TimestampRolloverStream("video"),o=new O.TimestampRolloverStream("audio"),u=new O.TimestampRolloverStream("timed-metadata"),l=new ne,f=new pa,b=new la(e),r.pipe(i).pipe(n),n.pipe(a).pipe(f),n.pipe(o).pipe(l),n.pipe(u).pipe(this.metadataStream).pipe(b),v=new O.CaptionStream(e),f.pipe(v).pipe(b),n.on("data",function(y){var T,k,N;if(y.type==="metadata"){for(T=y.tracks.length;T--;)y.tracks[T].type==="video"?k=y.tracks[T]:y.tracks[T].type==="audio"&&(N=y.tracks[T]);k&&!p&&(b.numberOfTracks++,p=new ut(k),f.pipe(p).pipe(b)),N&&!m&&(b.numberOfTracks++,m=new dt(N),l.pipe(m).pipe(b),p&&p.on("keyframe",m.onVideoKeyFrame))}}),this.push=function(y){r.push(y)},this.flush=function(){r.flush()},this.resetCaptions=function(){v.reset()},b.on("data",function(y){t.trigger("data",y)}),b.on("done",function(){t.trigger("done")})},ot.prototype=new g;var ha=ot,ma=function(e,t,r){var i=new Uint8Array(9),n=new DataView(i.buffer),a,o,u;return e=e||0,t=t===void 0?!0:t,r=r===void 0?!0:r,n.setUint8(0,70),n.setUint8(1,76),n.setUint8(2,86),n.setUint8(3,1),n.setUint8(4,(t?4:0)|(r?1:0)),n.setUint32(5,i.byteLength),e<=0?(o=new Uint8Array(i.byteLength+4),o.set(i),o.set([0,0,0,0],i.byteLength),o):(a=new $($.METADATA_TAG),a.pts=a.dts=0,a.writeMetaDataDouble("duration",e),u=a.finalize().length,o=new Uint8Array(i.byteLength+u),o.set(i),o.set(n.byteLength,u),o)},ga=ma,xa={tag:$,Transmuxer:ha,getFlvHeader:ga},ya=O,va=W.ONE_SECOND_IN_TS,ni=function s(e,t){var r=[],i=0,n=0,a=0,o=1/0,u=null,l=null;t=t||{},s.prototype.init.call(this),this.push=function(f){j.collectDtsInfo(e,f),e&&nt.forEach(function(p){e[p]=f[p]}),r.push(f)},this.setEarliestDts=function(f){n=f},this.setVideoBaseMediaDecodeTime=function(f){o=f},this.setAudioAppendStart=function(f){a=f},this.processFrames_=function(){var f,p,m,v,b;r.length!==0&&(f=de.trimAdtsFramesByEarliestDts(r,e,n),f.length!==0&&(e.baseMediaDecodeTime=j.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),de.prefixWithSilence(e,f,a,o),e.samples=de.generateSampleTable(f),m=Q.mdat(de.concatenateFrameData(f)),r=[],p=Q.moof(i,[e]),i++,e.initSegment=Q.initSegment([e]),v=new Uint8Array(p.byteLength+m.byteLength),v.set(p),v.set(m,p.byteLength),j.clearDtsInfo(e),u===null&&(l=u=f[0].pts),l+=f.length*(va*1024/e.samplerate),b={start:u},this.trigger("timingInfo",b),this.trigger("data",{track:e,boxes:v})))},this.flush=function(){this.processFrames_(),this.trigger("timingInfo",{start:u,end:l}),this.resetTiming_(),this.trigger("done","AudioSegmentStream")},this.partialFlush=function(){this.processFrames_(),this.trigger("partialdone","AudioSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","AudioSegmentStream")},this.resetTiming_=function(){j.clearDtsInfo(e),u=null,l=null},this.reset=function(){this.resetTiming_(),r=[],this.trigger("reset")}};ni.prototype=new g;var ai=ni,si=function s(e,t){var r=0,i=[],n=[],a,o,u=null,l=null,f,p=!0;t=t||{},s.prototype.init.call(this),this.push=function(m){j.collectDtsInfo(e,m),typeof e.timelineStartInfo.dts>"u"&&(e.timelineStartInfo.dts=m.dts),m.nalUnitType==="seq_parameter_set_rbsp"&&!a&&(a=m.config,e.sps=[m.data],at.forEach(function(v){e[v]=a[v]},this)),m.nalUnitType==="pic_parameter_set_rbsp"&&!o&&(o=m.data,e.pps=[m.data]),i.push(m)},this.processNals_=function(m){var v;for(i=n.concat(i);i.length&&i[0].nalUnitType!=="access_unit_delimiter_rbsp";)i.shift();if(i.length!==0){var b=ee.groupNalsIntoFrames(i);if(!!b.length){if(n=b[b.length-1],m&&(b.pop(),b.duration-=n.duration,b.nalCount-=n.length,b.byteLength-=n.byteLength),!b.length){i=[];return}if(this.trigger("timelineStartInfo",e.timelineStartInfo),p){if(f=ee.groupFramesIntoGops(b),!f[0][0].keyFrame){if(f=ee.extendFirstKeyFrame(f),!f[0][0].keyFrame){i=[].concat.apply([],b).concat(n),n=[];return}b=[].concat.apply([],f),b.duration=f.duration}p=!1}for(u===null&&(u=b[0].pts,l=u),l+=b.duration,this.trigger("timingInfo",{start:u,end:l}),v=0;v<b.length;v++){var y=b[v];e.samples=ee.generateSampleTableForFrame(y);var T=Q.mdat(ee.concatenateNalDataForFrame(y));j.clearDtsInfo(e),j.collectDtsInfo(e,y),e.baseMediaDecodeTime=j.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps);var k=Q.moof(r,[e]);r++,e.initSegment=Q.initSegment([e]);var N=new Uint8Array(k.byteLength+T.byteLength);N.set(k),N.set(T,k.byteLength),this.trigger("data",{track:e,boxes:N,sequence:r,videoFrameDts:y.dts,videoFramePts:y.pts})}i=[]}}},this.resetTimingAndConfig_=function(){a=void 0,o=void 0,u=null,l=null},this.partialFlush=function(){this.processNals_(!0),this.trigger("partialdone","VideoSegmentStream")},this.flush=function(){this.processNals_(!1),this.resetTimingAndConfig_(),this.trigger("done","VideoSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","VideoSegmentStream")},this.reset=function(){this.resetTimingAndConfig_(),n=[],i=[],p=!0,this.trigger("reset")}};si.prototype=new g;var ba=si,Sa=ke.isLikelyAacData,oi=function(e){return e.prototype=new g,e.prototype.init.call(e),e},_a=function(e){var t={type:"ts",tracks:{audio:null,video:null},packet:new O.TransportPacketStream,parse:new O.TransportParseStream,elementary:new O.ElementaryStream,timestampRollover:new O.TimestampRolloverStream,adts:new wt.Adts,h264:new wt.h264.H264Stream,captionStream:new O.CaptionStream(e),metadataStream:new O.MetadataStream};return t.headOfPipeline=t.packet,t.packet.pipe(t.parse).pipe(t.elementary).pipe(t.timestampRollover),t.timestampRollover.pipe(t.h264),t.h264.pipe(t.captionStream),t.timestampRollover.pipe(t.metadataStream),t.timestampRollover.pipe(t.adts),t.elementary.on("data",function(r){if(r.type==="metadata"){for(var i=0;i<r.tracks.length;i++)t.tracks[r.tracks[i].type]||(t.tracks[r.tracks[i].type]=r.tracks[i],t.tracks[r.tracks[i].type].timelineStartInfo.baseMediaDecodeTime=e.baseMediaDecodeTime);t.tracks.video&&!t.videoSegmentStream&&(t.videoSegmentStream=new ba(t.tracks.video,e),t.videoSegmentStream.on("timelineStartInfo",function(n){t.tracks.audio&&!e.keepOriginalTimestamps&&t.audioSegmentStream.setEarliestDts(n.dts-e.baseMediaDecodeTime)}),t.videoSegmentStream.on("timingInfo",t.trigger.bind(t,"videoTimingInfo")),t.videoSegmentStream.on("data",function(n){t.trigger("data",{type:"video",data:n})}),t.videoSegmentStream.on("done",t.trigger.bind(t,"done")),t.videoSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.videoSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.h264.pipe(t.videoSegmentStream)),t.tracks.audio&&!t.audioSegmentStream&&(t.audioSegmentStream=new ai(t.tracks.audio,e),t.audioSegmentStream.on("data",function(n){t.trigger("data",{type:"audio",data:n})}),t.audioSegmentStream.on("done",t.trigger.bind(t,"done")),t.audioSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.audioSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),t.adts.pipe(t.audioSegmentStream)),t.trigger("trackinfo",{hasAudio:!!t.tracks.audio,hasVideo:!!t.tracks.video})}}),t.captionStream.on("data",function(r){var i;t.tracks.video?i=t.tracks.video.timelineStartInfo.pts||0:i=0,r.startTime=W.metadataTsToSeconds(r.startPts,i,e.keepOriginalTimestamps),r.endTime=W.metadataTsToSeconds(r.endPts,i,e.keepOriginalTimestamps),t.trigger("caption",r)}),t=oi(t),t.metadataStream.on("data",t.trigger.bind(t,"id3Frame")),t},Ta=function(e){var t={type:"aac",tracks:{audio:null},metadataStream:new O.MetadataStream,aacStream:new Zr,audioRollover:new O.TimestampRolloverStream("audio"),timedMetadataRollover:new O.TimestampRolloverStream("timed-metadata"),adtsStream:new ne(!0)};return t.headOfPipeline=t.aacStream,t.aacStream.pipe(t.audioRollover).pipe(t.adtsStream),t.aacStream.pipe(t.timedMetadataRollover).pipe(t.metadataStream),t.metadataStream.on("timestamp",function(r){t.aacStream.setTimestamp(r.timeStamp)}),t.aacStream.on("data",function(r){r.type!=="timed-metadata"&&r.type!=="audio"||t.audioSegmentStream||(t.tracks.audio=t.tracks.audio||{timelineStartInfo:{baseMediaDecodeTime:e.baseMediaDecodeTime},codec:"adts",type:"audio"},t.audioSegmentStream=new ai(t.tracks.audio,e),t.audioSegmentStream.on("data",function(i){t.trigger("data",{type:"audio",data:i})}),t.audioSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.audioSegmentStream.on("done",t.trigger.bind(t,"done")),t.audioSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),t.adtsStream.pipe(t.audioSegmentStream),t.trigger("trackinfo",{hasAudio:!!t.tracks.audio,hasVideo:!!t.tracks.video}))}),t=oi(t),t.metadataStream.on("data",t.trigger.bind(t,"id3Frame")),t},ui=function(e,t){e.on("data",t.trigger.bind(t,"data")),e.on("done",t.trigger.bind(t,"done")),e.on("partialdone",t.trigger.bind(t,"partialdone")),e.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),e.on("audioTimingInfo",t.trigger.bind(t,"audioTimingInfo")),e.on("videoTimingInfo",t.trigger.bind(t,"videoTimingInfo")),e.on("trackinfo",t.trigger.bind(t,"trackinfo")),e.on("id3Frame",function(r){r.dispatchType=e.metadataStream.dispatchType,r.cueTime=W.videoTsToSeconds(r.pts),t.trigger("id3Frame",r)}),e.on("caption",function(r){t.trigger("caption",r)})},di=function s(e){var t=null,r=!0;e=e||{},s.prototype.init.call(this),e.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.push=function(i){if(r){var n=Sa(i);n&&(!t||t.type!=="aac")?(t=Ta(e),ui(t,this)):!n&&(!t||t.type!=="ts")&&(t=_a(e),ui(t,this)),r=!1}t.headOfPipeline.push(i)},this.flush=function(){!t||(r=!0,t.headOfPipeline.flush())},this.partialFlush=function(){!t||t.headOfPipeline.partialFlush()},this.endTimeline=function(){!t||t.headOfPipeline.endTimeline()},this.reset=function(){!t||t.headOfPipeline.reset()},this.setBaseMediaDecodeTime=function(i){e.keepOriginalTimestamps||(e.baseMediaDecodeTime=i),t&&(t.tracks.audio&&(t.tracks.audio.timelineStartInfo.dts=void 0,t.tracks.audio.timelineStartInfo.pts=void 0,j.clearDtsInfo(t.tracks.audio),t.audioRollover&&t.audioRollover.discontinuity()),t.tracks.video&&(t.videoSegmentStream&&(t.videoSegmentStream.gopCache_=[]),t.tracks.video.timelineStartInfo.dts=void 0,t.tracks.video.timelineStartInfo.pts=void 0,j.clearDtsInfo(t.tracks.video)),t.timestampRollover&&t.timestampRollover.discontinuity())},this.setRemux=function(i){e.remux=i,t&&t.coalesceStream&&t.coalesceStream.setRemux(i)},this.setAudioAppendStart=function(i){!t||!t.tracks.audio||!t.audioSegmentStream||t.audioSegmentStream.setAudioAppendStart(i)},this.alignGopsWith=function(i){}};di.prototype=new g;var wa=di,Ia={Transmuxer:wa},fi=Me.getUint64,Aa=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:t.getUint32(4),timescale:t.getUint32(8)},i=12;r.version===0?(r.earliestPresentationTime=t.getUint32(i),r.firstOffset=t.getUint32(i+4),i+=8):(r.earliestPresentationTime=fi(e.subarray(i)),r.firstOffset=fi(e.subarray(i+8)),i+=16),i+=2;var n=t.getUint16(i);for(i+=2;n>0;i+=12,n--)r.references.push({referenceType:(e[i]&128)>>>7,referencedSize:t.getUint32(i)&2147483647,subsegmentDuration:t.getUint32(i+4),startsWithSap:!!(e[i+8]&128),sapType:(e[i+8]&112)>>>4,sapDeltaTime:t.getUint32(i+8)&268435455});return r},Fa=Aa,li=Me.getUint64,H,Wt,J=function(e){return new Date(e*1e3-20828448e5)},Da=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=[],i,n;for(i=0;i+4<e.length;i+=n){if(n=t.getUint32(i),i+=4,n<=0){r.push("<span style='color:red;'>MALFORMED DATA</span>");continue}switch(e[i]&31){case 1:r.push("slice_layer_without_partitioning_rbsp");break;case 5:r.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:r.push("sei_rbsp");break;case 7:r.push("seq_parameter_set_rbsp");break;case 8:r.push("pic_parameter_set_rbsp");break;case 9:r.push("access_unit_delimiter_rbsp");break;default:r.push("UNKNOWN NAL - "+e[i]&31);break}}return r},fe={avc1:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{dataReferenceIndex:t.getUint16(6),width:t.getUint16(24),height:t.getUint16(26),horizresolution:t.getUint16(28)+t.getUint16(30)/16,vertresolution:t.getUint16(32)+t.getUint16(34)/16,frameCount:t.getUint16(40),depth:t.getUint16(74),config:H(e.subarray(78,e.byteLength))}},avcC:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={configurationVersion:e[0],avcProfileIndication:e[1],profileCompatibility:e[2],avcLevelIndication:e[3],lengthSizeMinusOne:e[4]&3,sps:[],pps:[]},i=e[5]&31,n,a,o,u;for(o=6,u=0;u<i;u++)a=t.getUint16(o),o+=2,r.sps.push(new Uint8Array(e.subarray(o,o+a))),o+=a;for(n=e[o],o++,u=0;u<n;u++)a=t.getUint16(o),o+=2,r.pps.push(new Uint8Array(e.subarray(o,o+a))),o+=a;return r},btrt:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{bufferSizeDB:t.getUint32(0),maxBitrate:t.getUint32(4),avgBitrate:t.getUint32(8)}},edts:function(e){return{boxes:H(e)}},elst:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),edits:[]},i=t.getUint32(4),n;for(n=8;i;i--)r.version===0?(r.edits.push({segmentDuration:t.getUint32(n),mediaTime:t.getInt32(n+4),mediaRate:t.getUint16(n+8)+t.getUint16(n+10)/(256*256)}),n+=12):(r.edits.push({segmentDuration:li(e.subarray(n)),mediaTime:li(e.subarray(n+8)),mediaRate:t.getUint16(n+16)+t.getUint16(n+18)/(256*256)}),n+=20);return r},esds:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),esId:e[6]<<8|e[7],streamPriority:e[8]&31,decoderConfig:{objectProfileIndication:e[11],streamType:e[12]>>>2&63,bufferSize:e[13]<<16|e[14]<<8|e[15],maxBitrate:e[16]<<24|e[17]<<16|e[18]<<8|e[19],avgBitrate:e[20]<<24|e[21]<<16|e[22]<<8|e[23],decoderConfigDescriptor:{tag:e[24],length:e[25],audioObjectType:e[26]>>>3&31,samplingFrequencyIndex:(e[26]&7)<<1|e[27]>>>7&1,channelConfiguration:e[27]>>>3&15}}}},ftyp:function(e){for(var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={majorBrand:Z(e.subarray(0,4)),minorVersion:t.getUint32(4),compatibleBrands:[]},i=8;i<e.byteLength;)r.compatibleBrands.push(Z(e.subarray(i,i+4))),i+=4;return r},dinf:function(e){return{boxes:H(e)}},dref:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),dataReferences:H(e.subarray(8))}},hdlr:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:Z(e.subarray(8,12)),name:""},i=8;for(i=24;i<e.byteLength;i++){if(e[i]===0){i++;break}r.name+=String.fromCharCode(e[i])}return r.name=decodeURIComponent(escape(r.name)),r},mdat:function(e){return{byteLength:e.byteLength,nals:Da(e)}},mdhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=4,i,n={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),language:""};return n.version===1?(r+=4,n.creationTime=J(t.getUint32(r)),r+=8,n.modificationTime=J(t.getUint32(r)),r+=4,n.timescale=t.getUint32(r),r+=8,n.duration=t.getUint32(r)):(n.creationTime=J(t.getUint32(r)),r+=4,n.modificationTime=J(t.getUint32(r)),r+=4,n.timescale=t.getUint32(r),r+=4,n.duration=t.getUint32(r)),r+=4,i=t.getUint16(r),n.language+=String.fromCharCode((i>>10)+96),n.language+=String.fromCharCode(((i&992)>>5)+96),n.language+=String.fromCharCode((i&31)+96),n},mdia:function(e){return{boxes:H(e)}},mfhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sequenceNumber:e[4]<<24|e[5]<<16|e[6]<<8|e[7]}},minf:function(e){return{boxes:H(e)}},mp4a:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={dataReferenceIndex:t.getUint16(6),channelcount:t.getUint16(16),samplesize:t.getUint16(18),samplerate:t.getUint16(24)+t.getUint16(26)/65536};return e.byteLength>28&&(r.streamDescriptor=H(e.subarray(28))[0]),r},moof:function(e){return{boxes:H(e)}},moov:function(e){return{boxes:H(e)}},mvex:function(e){return{boxes:H(e)}},mvhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=4,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return i.version===1?(r+=4,i.creationTime=J(t.getUint32(r)),r+=8,i.modificationTime=J(t.getUint32(r)),r+=4,i.timescale=t.getUint32(r),r+=8,i.duration=t.getUint32(r)):(i.creationTime=J(t.getUint32(r)),r+=4,i.modificationTime=J(t.getUint32(r)),r+=4,i.timescale=t.getUint32(r),r+=4,i.duration=t.getUint32(r)),r+=4,i.rate=t.getUint16(r)+t.getUint16(r+2)/16,r+=4,i.volume=t.getUint8(r)+t.getUint8(r+1)/8,r+=2,r+=2,r+=2*4,i.matrix=new Uint32Array(e.subarray(r,r+9*4)),r+=9*4,r+=6*4,i.nextTrackId=t.getUint32(r),i},pdin:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),rate:t.getUint32(4),initialDelay:t.getUint32(8)}},sdtp:function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},r;for(r=4;r<e.byteLength;r++)t.samples.push({dependsOn:(e[r]&48)>>4,isDependedOn:(e[r]&12)>>2,hasRedundancy:e[r]&3});return t},sidx:Fa,smhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),balance:e[4]+e[5]/256}},stbl:function(e){return{boxes:H(e)}},ctts:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),compositionOffsets:[]},i=t.getUint32(4),n;for(n=8;i;n+=8,i--)r.compositionOffsets.push({sampleCount:t.getUint32(n),sampleOffset:t[r.version===0?"getUint32":"getInt32"](n+4)});return r},stss:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),syncSamples:[]},i=t.getUint32(4),n;for(n=8;i;n+=4,i--)r.syncSamples.push(t.getUint32(n));return r},stco:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),chunkOffsets:[]},i=t.getUint32(4),n;for(n=8;i;n+=4,i--)r.chunkOffsets.push(t.getUint32(n));return r},stsc:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=t.getUint32(4),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleToChunks:[]},n;for(n=8;r;n+=12,r--)i.sampleToChunks.push({firstChunk:t.getUint32(n),samplesPerChunk:t.getUint32(n+4),sampleDescriptionIndex:t.getUint32(n+8)});return i},stsd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleDescriptions:H(e.subarray(8))}},stsz:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleSize:t.getUint32(4),entries:[]},i;for(i=12;i<e.byteLength;i+=4)r.entries.push(t.getUint32(i));return r},stts:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),timeToSamples:[]},i=t.getUint32(4),n;for(n=8;i;n+=8,i--)r.timeToSamples.push({sampleCount:t.getUint32(n),sampleDelta:t.getUint32(n+4)});return r},styp:function(e){return fe.ftyp(e)},tfdt:Mt,tfhd:Ut,tkhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=4,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return i.version===1?(r+=4,i.creationTime=J(t.getUint32(r)),r+=8,i.modificationTime=J(t.getUint32(r)),r+=4,i.trackId=t.getUint32(r),r+=4,r+=8,i.duration=t.getUint32(r)):(i.creationTime=J(t.getUint32(r)),r+=4,i.modificationTime=J(t.getUint32(r)),r+=4,i.trackId=t.getUint32(r),r+=4,r+=4,i.duration=t.getUint32(r)),r+=4,r+=2*4,i.layer=t.getUint16(r),r+=2,i.alternateGroup=t.getUint16(r),r+=2,i.volume=t.getUint8(r)+t.getUint8(r+1)/8,r+=2,r+=2,i.matrix=new Uint32Array(e.subarray(r,r+9*4)),r+=9*4,i.width=t.getUint16(r)+t.getUint16(r+2)/65536,r+=4,i.height=t.getUint16(r)+t.getUint16(r+2)/65536,i},traf:function(e){return{boxes:H(e)}},trak:function(e){return{boxes:H(e)}},trex:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4),defaultSampleDescriptionIndex:t.getUint32(8),defaultSampleDuration:t.getUint32(12),defaultSampleSize:t.getUint32(16),sampleDependsOn:e[20]&3,sampleIsDependedOn:(e[21]&192)>>6,sampleHasRedundancy:(e[21]&48)>>4,samplePaddingValue:(e[21]&14)>>1,sampleIsDifferenceSample:!!(e[21]&1),sampleDegradationPriority:t.getUint16(22)}},trun:Et,"url ":function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4))}},vmhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),graphicsmode:t.getUint16(4),opcolor:new Uint16Array([t.getUint16(6),t.getUint16(8),t.getUint16(10)])}}};H=function(e){for(var t=0,r=[],i,n,a,o,u,l=new ArrayBuffer(e.length),f=new Uint8Array(l),p=0;p<e.length;++p)f[p]=e[p];for(i=new DataView(l);t<e.byteLength;)n=i.getUint32(t),a=Z(e.subarray(t+4,t+8)),o=n>1?t+n:e.byteLength,u=(fe[a]||function(m){return{data:m}})(e.subarray(t+8,o)),u.size=n,u.type=a,r.push(u),t=o;return r},Wt=function(e,t){var r;return t=t||0,r=new Array(t*2+1).join(" "),e.map(function(i,n){return r+i.type+`
`+Object.keys(i).filter(function(a){return a!=="type"&&a!=="boxes"}).map(function(a){var o=r+"  "+a+": ",u=i[a];if(u instanceof Uint8Array||u instanceof Uint32Array){var l=Array.prototype.slice.call(new Uint8Array(u.buffer,u.byteOffset,u.byteLength)).map(function(f){return" "+("00"+f.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return l?l.length===1?o+"<"+l.join("").slice(1)+">":o+`<
`+l.map(function(f){return r+"  "+f}).join(`
`)+`
`+r+"  >":o+"<>"}return o+JSON.stringify(u,null,2).split(`
`).map(function(f,p){return p===0?f:r+"  "+f}).join(`
`)}).join(`
`)+(i.boxes?`
`+Wt(i.boxes,t+1):"")}).join(`
`)};var Ua={inspect:H,textify:Wt,parseType:Z,findBox:L,parseTraf:fe.traf,parseTfdt:fe.tfdt,parseHdlr:fe.hdlr,parseTfhd:fe.tfhd,parseTrun:fe.trun,parseSidx:fe.sidx},Ea={8:"audio",9:"video",18:"metadata"},Ma=function(e){return"0x"+("00"+e.toString(16)).slice(-2).toUpperCase()},Vt=function(e){for(var t=[],r;e.byteLength>0;)r=0,t.push(Ma(e[r++])),e=e.subarray(r);return t.join(" ")},Ca=function(e,t){var r=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"],i=e[1]&parseInt("01111111",2)<<16|e[2]<<8|e[3];return t=t||{},t.avcPacketType=r[e[0]],t.CompositionTime=e[1]&parseInt("10000000",2)?-i:i,e[0]===1?t.nalUnitTypeRaw=Vt(e.subarray(4,100)):t.data=Vt(e.subarray(4)),t},Pa=function(e,t){var r=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"],i=e[0]&parseInt("00001111",2);return t=t||{},t.frameType=r[(e[0]&parseInt("11110000",2))>>>4],t.codecID=i,i===7?Ca(e.subarray(1),t):t},Oa=function(e,t){var r=["AAC Sequence Header","AAC Raw"];return t=t||{},t.aacPacketType=r[e[0]],t.data=Vt(e.subarray(1)),t},ka=function(e,t){var r=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"],i=["5.5-kHz","11-kHz","22-kHz","44-kHz"],n=(e[0]&parseInt("11110000",2))>>>4;return t=t||{},t.soundFormat=r[n],t.soundRate=i[(e[0]&parseInt("00001100",2))>>>2],t.soundSize=(e[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",t.soundType=e[0]&parseInt("00000001",2)?"Stereo":"Mono",n===10?Oa(e.subarray(1),t):t},La=function(e){return{tagType:Ea[e[0]],dataSize:e[1]<<16|e[2]<<8|e[3],timestamp:e[7]<<24|e[4]<<16|e[5]<<8|e[6],streamID:e[8]<<16|e[9]<<8|e[10]}},ci=function(e){var t=La(e);switch(e[0]){case 8:ka(e.subarray(11),t);break;case 9:Pa(e.subarray(11),t);break}return t},Ra=function(e){var t=9,r,i=[],n;for(t+=4;t<e.byteLength;)r=e[t+1]<<16,r|=e[t+2]<<8,r|=e[t+3],r+=11,n=e.subarray(t,t+r),i.push(ci(n)),t+=r+4;return i},Ba=function(e){return JSON.stringify(e,null,2)},Na={inspectTag:ci,inspect:Ra,textify:Ba},pi=function(e){var t=e[1]&31;return t<<=8,t|=e[2],t},ft=function(e){return!!(e[1]&64)},lt=function(e){var t=0;return(e[3]&48)>>>4>1&&(t+=e[4]+1),t},ja=function(e,t){var r=pi(e);return r===0?"pat":r===t?"pmt":t?"pes":null},za=function(e){var t=ft(e),r=4+lt(e);return t&&(r+=e[r]+1),(e[r+10]&31)<<8|e[r+11]},Wa=function(e){var t={},r=ft(e),i=4+lt(e);if(r&&(i+=e[i]+1),!!(e[i+5]&1)){var n,a,o;n=(e[i+1]&15)<<8|e[i+2],a=3+n-4,o=(e[i+10]&15)<<8|e[i+11];for(var u=12+o;u<a;){var l=i+u;t[(e[l+1]&31)<<8|e[l+2]]=e[l],u+=((e[l+3]&15)<<8|e[l+4])+5}return t}},Va=function(e,t){var r=pi(e),i=t[r];switch(i){case V.H264_STREAM_TYPE:return"video";case V.ADTS_STREAM_TYPE:return"audio";case V.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},Ga=function(e){var t=ft(e);if(!t)return null;var r=4+lt(e);if(r>=e.byteLength)return null;var i=null,n;return n=e[r+7],n&192&&(i={},i.pts=(e[r+9]&14)<<27|(e[r+10]&255)<<20|(e[r+11]&254)<<12|(e[r+12]&255)<<5|(e[r+13]&254)>>>3,i.pts*=4,i.pts+=(e[r+13]&6)>>>1,i.dts=i.pts,n&64&&(i.dts=(e[r+14]&14)<<27|(e[r+15]&255)<<20|(e[r+16]&254)<<12|(e[r+17]&255)<<5|(e[r+18]&254)>>>3,i.dts*=4,i.dts+=(e[r+18]&6)>>>1)),i},Gt=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},qa=function(e){for(var t=4+lt(e),r=e.subarray(t),i=0,n=0,a=!1,o;n<r.byteLength-3;n++)if(r[n+2]===1){i=n+5;break}for(;i<r.byteLength;)switch(r[i]){case 0:if(r[i-1]!==0){i+=2;break}else if(r[i-2]!==0){i++;break}n+3!==i-2&&(o=Gt(r[n+3]&31),o==="slice_layer_without_partitioning_rbsp_idr"&&(a=!0));do i++;while(r[i]!==1&&i<r.length);n=i-2,i+=3;break;case 1:if(r[i-1]!==0||r[i-2]!==0){i+=3;break}o=Gt(r[n+3]&31),o==="slice_layer_without_partitioning_rbsp_idr"&&(a=!0),n=i-2,i+=3;break;default:i+=3;break}return r=r.subarray(n),i-=n,n=0,r&&r.byteLength>3&&(o=Gt(r[n+3]&31),o==="slice_layer_without_partitioning_rbsp_idr"&&(a=!0)),a},Ha={parseType:ja,parsePat:za,parsePmt:Wa,parsePayloadUnitStartIndicator:ft,parsePesType:Va,parsePesTime:Ga,videoPacketContainsKeyFrame:qa},Ie=Hr.handleRollover,C={};C.ts=Ha,C.aac=ke;var xe=W.ONE_SECOND_IN_TS,Y=188,te=71,$a=function(e,t){for(var r=0,i=Y,n,a;i<e.byteLength;){if(e[r]===te&&e[i]===te){switch(n=e.subarray(r,i),a=C.ts.parseType(n,t.pid),a){case"pat":t.pid=C.ts.parsePat(n);break;case"pmt":var o=C.ts.parsePmt(n);t.table=t.table||{},Object.keys(o).forEach(function(u){t.table[u]=o[u]});break}r+=Y,i+=Y;continue}r++,i++}},hi=function(e,t,r){for(var i=0,n=Y,a,o,u,l,f,p=!1;n<=e.byteLength;){if(e[i]===te&&(e[n]===te||n===e.byteLength)){switch(a=e.subarray(i,n),o=C.ts.parseType(a,t.pid),o){case"pes":u=C.ts.parsePesType(a,t.table),l=C.ts.parsePayloadUnitStartIndicator(a),u==="audio"&&l&&(f=C.ts.parsePesTime(a),f&&(f.type="audio",r.audio.push(f),p=!0));break}if(p)break;i+=Y,n+=Y;continue}i++,n++}for(n=e.byteLength,i=n-Y,p=!1;i>=0;){if(e[i]===te&&(e[n]===te||n===e.byteLength)){switch(a=e.subarray(i,n),o=C.ts.parseType(a,t.pid),o){case"pes":u=C.ts.parsePesType(a,t.table),l=C.ts.parsePayloadUnitStartIndicator(a),u==="audio"&&l&&(f=C.ts.parsePesTime(a),f&&(f.type="audio",r.audio.push(f),p=!0));break}if(p)break;i-=Y,n-=Y;continue}i--,n--}},Ya=function(e,t,r){for(var i=0,n=Y,a,o,u,l,f,p,m,v,b=!1,y={data:[],size:0};n<e.byteLength;){if(e[i]===te&&e[n]===te){switch(a=e.subarray(i,n),o=C.ts.parseType(a,t.pid),o){case"pes":if(u=C.ts.parsePesType(a,t.table),l=C.ts.parsePayloadUnitStartIndicator(a),u==="video"&&(l&&!b&&(f=C.ts.parsePesTime(a),f&&(f.type="video",r.video.push(f),b=!0)),!r.firstKeyFrame)){if(l&&y.size!==0){for(p=new Uint8Array(y.size),m=0;y.data.length;)v=y.data.shift(),p.set(v,m),m+=v.byteLength;if(C.ts.videoPacketContainsKeyFrame(p)){var T=C.ts.parsePesTime(p);T?(r.firstKeyFrame=T,r.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}y.size=0}y.data.push(a),y.size+=a.byteLength}break}if(b&&r.firstKeyFrame)break;i+=Y,n+=Y;continue}i++,n++}for(n=e.byteLength,i=n-Y,b=!1;i>=0;){if(e[i]===te&&e[n]===te){switch(a=e.subarray(i,n),o=C.ts.parseType(a,t.pid),o){case"pes":u=C.ts.parsePesType(a,t.table),l=C.ts.parsePayloadUnitStartIndicator(a),u==="video"&&l&&(f=C.ts.parsePesTime(a),f&&(f.type="video",r.video.push(f),b=!0));break}if(b)break;i-=Y,n-=Y;continue}i--,n--}},Xa=function(e,t){if(e.audio&&e.audio.length){var r=t;(typeof r>"u"||isNaN(r))&&(r=e.audio[0].dts),e.audio.forEach(function(a){a.dts=Ie(a.dts,r),a.pts=Ie(a.pts,r),a.dtsTime=a.dts/xe,a.ptsTime=a.pts/xe})}if(e.video&&e.video.length){var i=t;if((typeof i>"u"||isNaN(i))&&(i=e.video[0].dts),e.video.forEach(function(a){a.dts=Ie(a.dts,i),a.pts=Ie(a.pts,i),a.dtsTime=a.dts/xe,a.ptsTime=a.pts/xe}),e.firstKeyFrame){var n=e.firstKeyFrame;n.dts=Ie(n.dts,i),n.pts=Ie(n.pts,i),n.dtsTime=n.dts/xe,n.ptsTime=n.pts/xe}}},Ka=function(e){for(var t=!1,r=0,i=null,n=null,a=0,o=0,u;e.length-o>=3;){var l=C.aac.parseType(e,o);switch(l){case"timed-metadata":if(e.length-o<10){t=!0;break}if(a=C.aac.parseId3TagSize(e,o),a>e.length){t=!0;break}n===null&&(u=e.subarray(o,o+a),n=C.aac.parseAacTimestamp(u)),o+=a;break;case"audio":if(e.length-o<7){t=!0;break}if(a=C.aac.parseAdtsSize(e,o),a>e.length){t=!0;break}i===null&&(u=e.subarray(o,o+a),i=C.aac.parseSampleRate(u)),r++,o+=a;break;default:o++;break}if(t)return null}if(i===null||n===null)return null;var f=xe/i,p={audio:[{type:"audio",dts:n,pts:n},{type:"audio",dts:n+r*1024*f,pts:n+r*1024*f}]};return p},Qa=function(e){var t={pid:null,table:null},r={};$a(e,t);for(var i in t.table)if(t.table.hasOwnProperty(i)){var n=t.table[i];switch(n){case V.H264_STREAM_TYPE:r.video=[],Ya(e,t,r),r.video.length===0&&delete r.video;break;case V.ADTS_STREAM_TYPE:r.audio=[],hi(e,t,r),r.audio.length===0&&delete r.audio;break}}return r},Za=function(e,t){var r=C.aac.isLikelyAacData(e),i;return r?i=Ka(e):i=Qa(e),!i||!i.audio&&!i.video?null:(Xa(i,t),i)},Ja={inspect:Za,parseAudioPes_:hi},ct={codecs:wt,mp4:fa,flv:xa,mp2t:ya,partial:Ia};ct.mp4.tools=Ua,ct.flv.tools=Na,ct.mp2t.tools=Ja;var es=ct;return es})});var xs={},D,_i=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});_i.decode();var ht=new Uint8Array;function Fe(){return ht.byteLength===0&&(ht=new Uint8Array(D.memory.buffer)),ht}function pt(c,d){return _i.decode(Fe().subarray(c,c+d))}var re=0;function us(c,d){let h=d(c.length*1);return Fe().set(c,h/1),re=c.length,h}function Ae(c){return c==null}var mt=new Int32Array;function vt(){return mt.byteLength===0&&(mt=new Int32Array(D.memory.buffer)),mt}function se(c){return()=>{throw new Error(`${c} is not defined`)}}function Ti(c,d){if(!(c instanceof d))throw new Error(`expected instance of ${d.name}`);return c.ptr}var gt=new TextEncoder("utf-8"),ds=typeof gt.encodeInto=="function"?function(c,d){return gt.encodeInto(c,d)}:function(c,d){let h=gt.encode(c);return d.set(h),{read:c.length,written:h.length}};function xt(c,d,h){if(h===void 0){let w=gt.encode(c),E=d(w.length);return Fe().subarray(E,E+w.length).set(w),re=w.length,E}let x=c.length,g=d(x),S=Fe(),_=0;for(;_<x;_++){let w=c.charCodeAt(_);if(w>127)break;S[g+_]=w}if(_!==x){_!==0&&(c=c.slice(_)),g=h(g,x,x=_+c.length*3);let w=Fe().subarray(g+_,g+x);_+=ds(c,w).written}return re=_,g}function fs(c,d){return Fe().subarray(c/1,c/1+d)}var yt=new Float64Array;function ls(){return yt.byteLength===0&&(yt=new Float64Array(D.memory.buffer)),yt}function cs(c,d){let h=d(c.length*8);return ls().set(c,h/8),re=c.length,h}var Hs=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",UnknownError:1,1:"UnknownError"}),$s=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",UnknownError:1,1:"UnknownError"}),Ys=Object.freeze({UnknownError:0,0:"UnknownError"}),Xs=Object.freeze({SourceBufferNotFound:0,0:"SourceBufferNotFound",UnknownError:1,1:"UnknownError"}),Ks=Object.freeze({UnknownError:0,0:"UnknownError"}),Qs=Object.freeze({NoMediaSourceAttached:0,0:"NoMediaSourceAttached",MediaSourceIsClosed:1,1:"MediaSourceIsClosed",QuotaExceededError:2,2:"QuotaExceededError",TypeNotSupportedError:3,3:"TypeNotSupportedError",EmptyMimeType:4,4:"EmptyMimeType",UnknownError:5,5:"UnknownError"}),be=Object.freeze({NoResource:0,0:"NoResource",NoSourceBuffer:1,1:"NoSourceBuffer",TransmuxerError:2,2:"TransmuxerError",UnknownError:3,3:"UnknownError"}),Zs=Object.freeze({Init:0,0:"Init",Seeked:1,1:"Seeked",Seeking:2,2:"Seeking",Ended:3,3:"Ended",ReadyStateChanged:4,4:"ReadyStateChanged",RegularInterval:5,5:"RegularInterval",Error:6,6:"Error"}),Js=Object.freeze({MediaPlaylistRefresh:0,0:"MediaPlaylistRefresh"}),De=Object.freeze({Error:0,0:"Error",Warn:1,1:"Warn",Info:2,2:"Info",Debug:3,3:"Debug"}),wi=Object.freeze({Audio:0,0:"Audio",Video:1,1:"Video"}),Re=Object.freeze({Closed:0,0:"Closed",Ended:1,1:"Ended",Open:2,2:"Open"}),ps=Object.freeze({Init:0,0:"Init",Seeking:1,1:"Seeking",Seeked:2,2:"Seeked",RegularInterval:3,3:"RegularInterval",LoadedData:4,4:"LoadedData",LoadedMetadata:5,5:"LoadedMetadata",CanPlay:6,6:"CanPlay",CanPlayThrough:7,7:"CanPlayThrough",Ended:8,8:"Ended",Pause:9,9:"Pause",Play:10,10:"Play",RateChange:11,11:"RateChange",Stalled:12,12:"Stalled"});var X=class{static __wrap(d){let h=Object.create(X.prototype);return h.ptr=d,h}__destroy_into_raw(){let d=this.ptr;return this.ptr=0,d}free(){let d=this.__destroy_into_raw();D.__wbg_appendbufferresult_free(d)}static success(d,h){let x=D.appendbufferresult_success(!Ae(d),Ae(d)?0:d,!Ae(h),Ae(h)?0:h);return X.__wrap(x)}static error(d,h){var x=Ae(h)?0:xt(h,D.__wbindgen_malloc,D.__wbindgen_realloc),g=re;let S=D.appendbufferresult_error(d,x,g);return X.__wrap(S)}};var oe=class{static __wrap(d){let h=Object.create(oe.prototype);return h.ptr=d,h}__destroy_into_raw(){let d=this.ptr;return this.ptr=0,d}free(){let d=this.__destroy_into_raw();D.__wbg_dispatcher_free(d)}constructor(){let d=D.dispatcher_new();return oe.__wrap(d)}load_content(d){let h=xt(d,D.__wbindgen_malloc,D.__wbindgen_realloc),x=re;D.dispatcher_load_content(this.ptr,h,x)}get_available_audio_tracks(){try{let g=D.__wbindgen_add_to_stack_pointer(-16);D.dispatcher_get_available_audio_tracks(g,this.ptr);var d=vt()[g/4+0],h=vt()[g/4+1],x=fs(d,h).slice();return D.__wbindgen_free(d,h*1),x}finally{D.__wbindgen_add_to_stack_pointer(16)}}stop(){D.dispatcher_stop(this.ptr)}static log(d,h){let x=xt(h,D.__wbindgen_malloc,D.__wbindgen_realloc),g=re;D.dispatcher_log(d,x,g)}on_request_finished(d,h,x,g,S){let _=xt(g,D.__wbindgen_malloc,D.__wbindgen_realloc),w=re;D.dispatcher_on_request_finished(this.ptr,d,h,x,_,w,S)}on_request_failed(d){D.dispatcher_on_request_failed(this.ptr,d)}on_media_source_state_change(d){D.dispatcher_on_media_source_state_change(this.ptr,d)}on_source_buffer_update(d){D.dispatcher_on_source_buffer_update(this.ptr,d)}on_source_buffer_error(d){D.dispatcher_on_source_buffer_error(this.ptr,d)}on_playback_tick(d){Ti(d,le);var h=d.ptr;d.ptr=0,D.dispatcher_on_playback_tick(this.ptr,h)}on_timer_ended(d,h){D.dispatcher_on_timer_ended(this.ptr,d,h)}};var le=class{static __wrap(d){let h=Object.create(le.prototype);return h.ptr=d,h}__destroy_into_raw(){let d=this.ptr;return this.ptr=0,d}free(){let d=this.__destroy_into_raw();D.__wbg_mediaobservation_free(d)}constructor(d,h,x,g,S,_){let w=cs(g,D.__wbindgen_malloc),E=re,P=D.mediaobservation_new(d,h,x,w,E,S,_);return le.__wrap(P)}};async function hs(c,d){if(typeof Response=="function"&&c instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(c,d)}catch(x){if(c.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",x);else throw x}let h=await c.arrayBuffer();return await WebAssembly.instantiate(h,d)}else{let h=await WebAssembly.instantiate(c,d);return h instanceof WebAssembly.Instance?{instance:h,module:c}:h}}function ms(){let c={};return c.wbg={},c.wbg.__wbg_jsLog_da12411f674ee50f=function(d,h,x){jsLog(d>>>0,pt(h,x))},c.wbg.__wbg_jsTimer_13ace9ec5780a1dd=function(d,h){return jsTimer(d,h>>>0)},c.wbg.__wbg_jsGetResourceData_1a5580de201a7896=function(d,h){let x=jsGetResourceData(h);var g=Ae(x)?0:us(x,D.__wbindgen_malloc),S=re;vt()[d/4+1]=S,vt()[d/4+0]=g},c.wbg.__wbg_jsFetch_1c0faf7eaeeec79c=function(d,h){return jsFetch(pt(d,h))},c.wbg.__wbg_jsAbortRequest_3ad497cfce2a4eb6=typeof jsAbortRequest=="function"?jsAbortRequest:se("jsAbortRequest"),c.wbg.__wbg_jsAttachMediaSource_69fcab1c5cd6f603=typeof jsAttachMediaSource=="function"?jsAttachMediaSource:se("jsAttachMediaSource"),c.wbg.__wbg_jsRemoveMediaSource_bfd555f14dbd804d=typeof jsRemoveMediaSource=="function"?jsRemoveMediaSource:se("jsRemoveMediaSource"),c.wbg.__wbg_jsSetMediaSourceDuration_4c22750bc2e2b8b6=typeof jsSetMediaSourceDuration=="function"?jsSetMediaSourceDuration:se("jsSetMediaSourceDuration"),c.wbg.__wbg_jsAddSourceBuffer_f769ac5dd28e087f=function(d,h,x){return jsAddSourceBuffer(d>>>0,pt(h,x))},c.wbg.__wbg_jsAppendBuffer_1c43e16b9b4bc73f=function(d,h,x){let g=jsAppendBuffer(d,h,x!==0);Ti(g,X);var S=g.ptr;return g.ptr=0,S},c.wbg.__wbg_jsEndOfStream_d21dc02fa7e95e93=typeof jsEndOfStream=="function"?jsEndOfStream:se("jsEndOfStream"),c.wbg.__wbg_jsStartObservingPlayback_39e965722ac389f3=typeof jsStartObservingPlayback=="function"?jsStartObservingPlayback:se("jsStartObservingPlayback"),c.wbg.__wbg_jsStopObservingPlayback_6ba8aea701a8a72e=typeof jsStopObservingPlayback=="function"?jsStopObservingPlayback:se("jsStopObservingPlayback"),c.wbg.__wbg_jsFreeResource_efd8cc10a164752b=typeof jsFreeResource=="function"?jsFreeResource:se("jsFreeResource"),c.wbg.__wbg_jsSeek_264e96c2a274615f=typeof jsSeek=="function"?jsSeek:se("jsSeek"),c.wbg.__wbindgen_throw=function(d,h){throw new Error(pt(d,h))},c}function gs(c,d){return D=c.exports,Ii.__wbindgen_wasm_module=d,yt=new Float64Array,mt=new Int32Array,ht=new Uint8Array,D}async function Ii(c){typeof c>"u"&&(c=new URL("wasp_hls_bg.wasm",xs.url));let d=ms();(typeof c=="string"||typeof Request=="function"&&c instanceof Request||typeof URL=="function"&&c instanceof URL)&&(c=fetch(c));let{instance:h,module:x}=await hs(await c,d);return gs(h,x)}var Ai=Ii;function $t(){let c="",d=-1;return function(){return d++,d>=Number.MAX_SAFE_INTEGER&&(c+="0",d=0),c+String(d)}}function Fi(){let c=-1;return function(){return c++,c>=Number.MAX_SAFE_INTEGER&&(console.warn("Exceeding `numberIdGenerator` limit. Collisions may occur"),c=0),c}}function Di(c){let d=vs(c);if(d===null)return;let h=ie(d,1952867444);if(h===null)return;let x=h[0];return x===1?Pi(h,4):x===0?ce(h,4):void 0}function Ui(c){let d=bs(c);if(d.length===0)return;let h=0;for(let x of d){let g=ie(x,1953658222);if(g===null)return;let S=0,_=g[S];if(S+=1,_>1)return;let w=Ci(g,S);S+=3;let E=(w&256)>0,P=0;if(!E&&(P=ys(x),P===void 0))return;let Se=(w&1)>0,je=(w&4)>0,ze=(w&512)>0,W=(w&1024)>0,_t=(w&2048)>0,_e=ce(g,S);S+=4,Se&&(S+=4),je&&(S+=4);let We=_e,ne=0;for(;We-- >0;)E?(ne+=ce(g,S),S+=4):ne+=P,ze&&(S+=4),W&&(S+=4),_t&&(S+=4);h+=ne}return h}function Ei(c){let d=Ss(c);if(d===null)return;let h=ie(d,1835296868);if(h===null)return;let x=0,g=h[x];return x+=4,g===1?ce(h,x+16):g===0?ce(h,x+8):void 0}function ys(c){let d=ie(c,1952868452);if(d===null)return;let h=1,x=Ci(d,h);h+=3;let g=(x&1)>0,S=(x&2)>0;return(x&8)>0?(h+=4,g&&(h+=8),S&&(h+=4),ce(d,h)):void 0}function vs(c){let d=ie(c,1836019558);return d===null?null:ie(d,1953653094)}function bs(c){return _s(c,1836019558).reduce((h,x)=>{let g=ie(x,1953653094);return g!==null&&h.push(g),h},[])}function Ss(c){let d=ie(c,1836019574);if(d===null)return null;let h=ie(d,1953653099);return h===null?null:ie(h,1835297121)}function ie(c,d){let h=Mi(c,d);return h!==null?c.subarray(h[1],h[2]):null}function _s(c,d){let h=[],x=c;for(;;){let g=Mi(x,d);if(g===null)return h;if(g[2]===0||x.length===0)throw new Error("Error while parsing ISOBMFF box");h.push(x.subarray(g[1],g[2])),x=x.subarray(g[2])}}function Mi(c,d){let h=c.length,x=0,g,S=0,_;for(;x+8<=h;){if(_=x,S=ce(c,_),_+=4,g=ce(c,_),_+=4,S===0)S=h-x;else if(S===1){if(_+8>h)return null;S=Pi(c,_),_+=8}if(S<0)throw new Error("ISOBMFF: Size out of range");if(g===d)return d===1970628964&&(_+=16),[x,_,x+S];x+=S}return null}function Ci(c,d){return c[d+0]*65536+c[d+1]*256+c[d+2]}function ce(c,d){return c[d+0]*16777216+c[d+1]*65536+c[d+2]*256+c[d+3]}function Pi(c,d){return(c[d+0]*16777216+c[d+1]*65536+c[d+2]*256+c[d+3])*4294967296+c[d+4]*16777216+c[d+5]*65536+c[d+6]*256+c[d+7]}var Be=class{constructor(d){this._sourceBuffer=d,this._queue=[],this._pendingTask=null;let h=setInterval(()=>{this._flush()},2e3),x=this._onPendingTaskError.bind(this),g=()=>{this._flush()};d.addEventListener("error",x),d.addEventListener("updateend",g),this._dispose=[()=>{clearInterval(h),d.removeEventListener("error",x),d.removeEventListener("updateend",g)}]}push(d){return console.debug("QSB: receiving order to push data to the SourceBuffer"),this._addToQueue({type:0,value:d})}removeBuffer(d,h){return console.debug("QSB: receiving order to remove data from the SourceBuffer",d,h),this._addToQueue({type:1,value:{start:d,end:h}})}getBufferedRanges(){return this._sourceBuffer.buffered}dispose(){for(this._dispose.forEach(d=>d()),this._pendingTask!==null&&(this._pendingTask.reject(new Error("QueuedSourceBuffer Cancelled")),this._pendingTask=null);this._queue.length>0;){let d=this._queue.shift();d!==void 0&&d.reject(new Error("QueuedSourceBuffer Cancelled"))}}_onPendingTaskError(d){let h=d instanceof Error?d:new Error("An unknown error occured when doing operations on the SourceBuffer");this._pendingTask!=null&&this._pendingTask.reject(h)}_addToQueue(d){return new Promise((h,x)=>{let g=this._queue.length===0&&this._pendingTask===null,S={resolve:h,reject:x,...d};this._queue.push(S),g&&this._flush()})}_flush(){if(!this._sourceBuffer.updating){if(this._pendingTask!==null){let d=this._pendingTask,{resolve:h}=d;return this._pendingTask=null,h(),this._flush()}else{let d=this._queue.shift();if(d===void 0)return;this._pendingTask=d}try{switch(this._pendingTask.type){case 0:let d=this._pendingTask.value;if(d===void 0){this._flush();return}console.debug("QSB: pushing data"),this._sourceBuffer.appendBuffer(d);break;case 1:let{start:h,end:x}=this._pendingTask.value;console.debug("QSB: removing data from SourceBuffer",h,x),this._sourceBuffer.remove(h,x);break;default:Ts(this._pendingTask)}}catch(d){this._onPendingTaskError(d)}}}};function Ts(c){throw new Error("Unreachable path taken")}var Yt=class{constructor(){this._instanceInfo=null,this.hasWorkerMse=void 0}start(d){this.hasWorkerMse=d,this._instanceInfo={dispatcher:new oe,content:null}}dispose(){this._instanceInfo?.dispatcher.free(),pe.freeEverything(),he.freeEverything()}changeContent(d){if(this._instanceInfo===null){console.error();return}pe.freeEverything(),he.freeEverything(),this._instanceInfo.content=d}getDispatcher(){return this._instanceInfo===null?null:this._instanceInfo.dispatcher}getContentInfo(){return this._instanceInfo===null?null:this._instanceInfo.content}},bt=class{constructor(){this._generateId=Fi(),this._store={}}create(d){let h=this._generateId();return this._store[h]=d,h}delete(d){delete this._store[d]}get(d){return this._store[d]}freeEverything(){this._store={}}},F=new Yt,pe=new bt,he=new bt;function St(){let c=F.getContentInfo();if(c===null)return;let{mediaSourceObj:d}=c;if(d!==null)return d}function G(c,d){console.debug("<-- sending to main:",c.type),d===void 0?postMessage(c):postMessage(c,d)}function Oi(c,d){let h=Di(c);if(h===void 0)return null;let x=Ui(c);return{time:h/d,duration:x===void 0?void 0:x/d}}var Bi=os(Ri());var Ue,ws=/^[a-z]+\/mp2t;/i;function Is(c){return ws.test(c)}function Qt(c){return Ni(c)?typeof MediaSource>"u"?!0:!MediaSource.isTypeSupported(c):!1}function Ni(c){return Is(c)}function Zt(c,d){if(!Ni(c))return c;let h=c.replace(/mp2t/i,"mp4");d===wi.Audio&&(h=c.replace(/video/i,"audio"));let x=/avc1\.(66|77|100)\.(\d+)/.exec(h);if(x){let g=x[1],S;g==="66"?S="4200":g==="77"?S="4d00":(g!=="100"&&console.error("Impossible regex catch"),S="6400");let _=Number(x[2]);_>=256&&console.error("Invalid legacy avc1 level number.");let w=(_>>4).toString(16)+(_&15).toString(16);h=`avc1.${S}${w}`}return h}function ji(){Ue=void 0}function Jt(c){Ue===void 0&&(Ue=new Bi.default.mp4.Transmuxer);let d=[];if(Ue.on("data",function(h){let x=new Uint8Array(h.initSegment.byteLength+h.data.byteLength);x.set(h.initSegment,0),x.set(h.data,h.initSegment.byteLength),d.push(x)}),Ue.push(c),Ue.flush(),d.length===0)return null;if(d.length===1)return d[0];{let h=d.reduce((S,_)=>S+_.byteLength,0),x=new Uint8Array(h),g=0;for(let S of d)x.set(S,g),g+=S.byteLength;return x}}function er(c,d){return c instanceof Error?c.name+": "+c.message:d}var zi=$t();function As(c){return pe.get(c)}function Fs(c,d){let h=performance.now().toFixed(2);switch(c){case De.Error:console.error(h,d);break;case De.Warn:console.warn(h,d);break;case De.Info:console.info(h,d);break;case De.Debug:console.debug(h,d);break}}function Ds(c,d){let h=setTimeout(()=>{let x=F.getDispatcher();x!==null&&x.on_timer_ended(h,d)},c);return h}function Us(c){clearTimeout(c)}function Es(c){let d=new AbortController,h=he.create({abortController:d}),x=performance.now();return fetch(c,{signal:d.signal}).then(async g=>{let S=await g.arrayBuffer(),_=performance.now()-x;he.delete(h);let w=F.getDispatcher();if(w!==null){let E=new Uint8Array(S),P=pe.create(E);w.on_request_finished(h,P,E.byteLength,g.url,_)}}).catch(g=>{he.delete(h),g instanceof Error&&g.name}),h}function Ms(c){let d=he.get(c);return d!==void 0?(d.abortController.abort(),Promise.resolve().then(()=>{he.delete(c)}),!0):!1}function Cs(c){let d=F.getContentInfo();if(d===null||d.mediaSourceObj===null){console.error("Attempting to seek when no MediaSource is created");return}G({type:"seek",value:{mediaSourceId:d.mediaSourceObj.mediaSourceId,position:c}})}function Ps(){let c=F.getContentInfo();if(c!==null)try{let d=function(){F.getDispatcher()?.on_media_source_state_change(Re.Ended)},h=function(){F.getDispatcher()?.on_media_source_state_change(Re.Open)},x=function(){F.getDispatcher()?.on_media_source_state_change(Re.Closed)};if(F.hasWorkerMse!==!0){let g=zi();c.mediaSourceObj={nextSourceBufferId:0,sourceBuffers:[],type:"main",mediaSourceId:g},G({type:"create-media-source",value:{contentId:c.contentId,mediaSourceId:g}})}else{let g=new MediaSource;g.addEventListener("sourceclose",x),g.addEventListener("sourceended",d),g.addEventListener("sourceopen",h);let S=()=>{g.removeEventListener("sourceclose",x),g.removeEventListener("sourceended",d),g.removeEventListener("sourceopen",h)},_=g.handle,w;_==null&&(w=URL.createObjectURL(g));let E=zi();c.mediaSourceObj={type:"worker",mediaSourceId:E,mediaSource:g,removeEventListeners:S,sourceBuffers:[],nextSourceBufferId:0},G({type:"attach-media-source",value:{contentId:c.contentId,handle:_,src:w,mediaSourceId:E}},_!==void 0?[_]:[])}}catch{Os(()=>{})}}function Os(c){typeof queueMicrotask=="function"?queueMicrotask(c):Promise.resolve().then(c).catch(()=>{})}function ks(){let c=F.getContentInfo();if(c!==null&&c.mediaSourceObj!==null){if(c.mediaSourceObj.type==="worker"){let{mediaSource:d,removeEventListeners:h}=c.mediaSourceObj;if(h(),d!==null&&d.readyState!=="closed"){let{readyState:x,sourceBuffers:g}=d;for(let S=g.length-1;S>=0;S--){let _=g[S];if(!_.updating)try{x==="open"&&_.abort(),d.removeSourceBuffer(_)}catch(w){let E=er(w,"Unknown error while removing SourceBuffer");oe.log(De.Error,"Could not remove SourceBuffer: "+E)}}}}G({type:"clear-media-source",value:{mediaSourceId:c.mediaSourceObj.mediaSourceId}})}}function Ls(c){let d=F.getContentInfo();if(d!==null&&d.mediaSourceObj!==null)if(d.mediaSourceObj.type==="worker")try{d.mediaSourceObj.mediaSource.duration=c}catch{}else G({type:"update-media-source-duration",value:{mediaSourceId:d.mediaSourceObj.mediaSourceId,duration:c}})}function Rs(c,d){let h=F.getContentInfo();if(h===null)throw new Error("Error 1");if(h.mediaSourceObj===null)throw new Error("Error 2");if(h.mediaSourceObj.type==="main"){let{sourceBuffers:x,nextSourceBufferId:g}=h.mediaSourceObj;try{let S=d;Qt(d)&&(S=Zt(d,c));let _=g;return x.push({lastInitTimescale:void 0,id:_,transmuxer:S===d?null:Jt,sourceBuffer:null}),h.mediaSourceObj.nextSourceBufferId++,G({type:"create-source-buffer",value:{mediaSourceId:h.mediaSourceObj.mediaSourceId,sourceBufferId:_,contentType:S}}),_}catch(S){throw S}}else{let{mediaSource:x,sourceBuffers:g,nextSourceBufferId:S}=h.mediaSourceObj;if(x.readyState==="closed")throw new Error("A");if(d==="")throw new Error("B");try{let _=d;Qt(d)&&(_=Zt(d,c));let w=x.addSourceBuffer(_),E=S,P=new Be(w);return g.push({lastInitTimescale:void 0,id:E,sourceBuffer:P,transmuxer:_===d?null:Jt}),h.mediaSourceObj.nextSourceBufferId++,E}catch{throw new Error("C")}}}function Bs(c,d,h){let x=pe.get(d),g=St();if(x===void 0)return X.error(be.NoResource,"Segment preparation error: No resource with the given `resourceId`");if(g===void 0)return X.error(be.NoSourceBuffer,"Segment preparation error: No MediaSource attached");let S=g.sourceBuffers.findIndex(({id:P})=>P===c);if(S<-1)return X.error(be.NoSourceBuffer,"Segment preparation error: No SourceBuffer with the given `SourceBufferId`");let _=g.sourceBuffers[S];if(_.transmuxer!==null)try{let P=_.transmuxer(x);if(P!==null)x=P;else return X.error(be.TransmuxerError,"Segment preparation error: the transmuxer couldn't process the segment")}catch(P){let Se=er(P,"Unknown error while transmuxing segment");return X.error(be.TransmuxerError,Se)}let w=Ei(x);w!==void 0?_.lastInitTimescale=w:w=_.lastInitTimescale;let E;h===!0&&w!==void 0&&(E=Oi(x,w));try{if(_.sourceBuffer!==null)_.sourceBuffer.push(x).then(()=>{try{F.getDispatcher()?.on_source_buffer_update(c)}catch(P){console.error("Error when calling `on_source_buffer_update`",P)}}).catch(()=>{try{F.getDispatcher()?.on_source_buffer_error(c)}catch(P){console.error("Error when calling `on_source_buffer_error`",P)}});else{let P=x.buffer;G({type:"append-buffer",value:{mediaSourceId:g.mediaSourceId,sourceBufferId:c,data:P}},[P])}}catch{return X.error(be.UnknownError)}return X.success(E?.time,E?.duration)}function Ns(c,d,h){try{let x=St();if(x===void 0)return;if(x.type==="worker"){let g=x.sourceBuffers.find(({id:S})=>S===c);if(g===void 0)return;g.sourceBuffer.removeBuffer(d,h).then(()=>{try{F.getDispatcher()?.on_source_buffer_update(c)}catch(S){console.error("Error when calling `on_source_buffer_update`",S)}}).catch(()=>{try{F.getDispatcher()?.on_source_buffer_error(c)}catch(S){console.error("Error when calling `on_source_buffer_error`",S)}})}else G({type:"remove-buffer",value:{mediaSourceId:x.mediaSourceId,sourceBufferId:c,start:d,end:h}})}catch{return}}function js(){try{let c=St();if(c===void 0)return;c.type==="worker"?c.mediaSource.endOfStream():G({type:"end-of-stream",value:{mediaSourceId:c.mediaSourceId}})}catch{return}}function zs(){let c=F.getContentInfo();c!==null&&c.mediaSourceObj!==null&&G({type:"start-playback-observation",value:{mediaSourceId:c.mediaSourceObj.mediaSourceId}})}function tr(){let c=F.getContentInfo();c!==null&&c.mediaSourceObj!==null&&G({type:"stop-playback-observation",value:{mediaSourceId:c.mediaSourceObj.mediaSourceId}})}function Ws(c){return pe.get(c)===void 0?!1:(pe.delete(c),!0)}var q=self;q.jsLog=Fs;q.jsFetch=Es;q.jsAbortRequest=Ms;q.jsAttachMediaSource=Ps;q.jsRemoveMediaSource=ks;q.jsSetMediaSourceDuration=Ls;q.jsAddSourceBuffer=Rs;q.jsAppendBuffer=Bs;q.jsRemoveBuffer=Ns;q.jsEndOfStream=js;q.jsStartObservingPlayback=zs;q.jsStopObservingPlayback=tr;q.jsFreeResource=Ws;q.jsSeek=Cs;q.jsTimer=Ds;q.jsClearTimer=Us;q.jsGetResourceData=As;var Wi=!1;function rr(){onmessage=function(c){if(c.origin!==""){console.error("Unexpected trans-origin message");return}let{data:d}=c;if(typeof d!="object"||d===null||typeof d.type!="string"){console.error("unexpected main message");return}switch(d.type){case"init":if(Wi)return Gi("Worker initialization already done",0);Wi=!0;let{wasmUrl:h,hasWorkerMse:x}=d.value;Vs(h,x);break;case"dispose":Gs();break;case"load":{let g=F.getDispatcher();if(g===null)return Vi(d.value.contentId);let S={contentId:d.value.contentId,mediaSourceObj:null,observationsObj:null};F.changeContent(S),ji(),g.load_content(d.value.url);break}case"stop":{let g=F.getDispatcher();if(g===null)return Vi(d.value.contentId);g.stop();break}case"media-source-state-changed":{let g=F.getDispatcher(),S=F.getContentInfo();if(g===null||S===null||S.mediaSourceObj?.mediaSourceId!==d.value.mediaSourceId)return;g.on_media_source_state_change(d.value.state);break}case"source-buffer-updated":{let g=F.getDispatcher(),S=F.getContentInfo();if(g===null||S===null||S.mediaSourceObj?.mediaSourceId!==d.value.mediaSourceId)return;g.on_source_buffer_update(d.value.sourceBufferId);break}case"observation":{let g=F.getDispatcher(),S=F.getContentInfo();if(g===null||S===null||S.mediaSourceObj?.mediaSourceId!==d.value.mediaSourceId)return;let _=new le(d.value.reason,d.value.currentTime,d.value.readyState,d.value.buffered,d.value.paused,d.value.seeking);g.on_playback_tick(_);break}case"create-media-source-error":{let g=F.getDispatcher(),S=F.getContentInfo();if(g===null||S===null||S.mediaSourceObj?.mediaSourceId!==d.value.mediaSourceId)return;g.stop();break}case"update-media-source-duration-error":{let g=F.getDispatcher(),S=F.getContentInfo();if(g===null||S===null||S.mediaSourceObj?.mediaSourceId!==d.value.mediaSourceId)return;console.error("Error: when setting the MediaSource's duration");break}case"create-source-buffer-error":{let g=F.getDispatcher(),S=F.getContentInfo();if(g===null||S===null||S.mediaSourceObj?.mediaSourceId!==d.value.mediaSourceId)return;g.stop();break}}}}function Gi(c,d){let h;typeof c=="string"?h=c:c instanceof Error&&(h=c.message),G({type:"initialization-error",value:{code:d,message:h}})}function Vi(c){G({type:"content-error",value:{contentId:c,message:"Error: Worker not initialized.",code:0}})}function Vs(c,d){Ai(fetch(c)).then(()=>{F.start(d),G({type:"initialized",value:null})}).catch(h=>{Gi(h,1)})}function Gs(){tr(),F.dispose()}rr();})();
/*! @name mux.js @version 6.1.0 @license Apache-2.0 */
